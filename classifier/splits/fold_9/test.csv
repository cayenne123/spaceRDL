Requirements Description,功能需求/初始化,功能需求/控制计算/姿态控制,功能需求/控制计算/姿态确定,功能需求/控制计算/模式管理,功能需求/控制计算/轨道计算,功能需求/控制计算/运行时保障/故障诊断和处理,功能需求/控制计算/运行时保障/数据有效性判断,功能需求/控制输出,功能需求/数据采集,功能需求/遥控,功能需求/遥测
"序|需求名称|编号|功能及处理描述
|星敏感器1数据的采集与处理|FREQ4.1|选择通讯的星敏1LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|星敏感器2数据的采集与处理|FREQ4.2|选择通讯的星敏2LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
",0,0,0,0,0,0,0,0,1,0,0
"软件需求标识：FREQ18 
软件需求名称：模拟太敏数据处理 
需求类别：其他 
软件需求描述：模拟太敏数据处理。",0,0,0,0,0,0,0,0,1,0,0
"功能：计算给控制器的姿态和角速度误差。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：卫星搜索太阳使得数字/模拟太阳见太阳后，控制卫星，使数字卫星本体-z轴对准太阳(模拟太阳对日时偏置10度)，从而使帆板法线指向太阳，确保能源供应。
输入：DssStateFlag，TShadowTime；滚动数字太阳监视码，俯仰数字太阳监视码；滚动模拟太阳监视码，俯仰模拟太阳监视码，滚动数字太阳输出，俯仰数字太阳输出，滚动模拟太阳输出，俯仰模拟太阳输出",0,1,0,0,0,0,0,0,0,0,0
功能：姿态角、角速度与姿态四元数预估。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
处理：
OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,0,0,0,1
"AO在主动段初始化中进行如下工作：
星时清零；
工作模式为主动段；",1,0,0,0,0,0,0,0,0,0,0
"功能描述：计算卫星对规划目标的姿态四元数和控制量。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：选择通讯的数传天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）数传天线有四个LTU，天线1和2各有两个互为备份。应用软件初始上电时不与数传天线通讯，与数传天线开始通讯的条件为：收到数传天线预指或复位总线指令和数传天线加电。停止与数传天线通讯的条件为：收到数传天线停止总线指令和数传天线断电。其中数传天线加断电状态由1553B的接收数传天线伺服控制器状态设置数据命令来确定。同时也根据这个命令确定参与通讯的LTU。初始为选择主份，收到主切备时切换到备份；在备份通讯时，收到备切主时切换到主份。
（2）向数传天线LTU发完取数命令后，获得数传天线LTU返回的数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
"控制计算机实时遥测包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包1|FRE65
|发送姿态数据包3|FRE65.1
|星敏感器姿态数据包|FRE65.2
|星敏感器自检数据包|FRE65.3
|姿态控制数据包|FRE65.4
|轨道数据包|FRE65.5
|LTU自检数据包|FRE65.6
|AOCC及状态数据包|FRE65.7
|发送星敏修正数据包|FRE65.8
|发送对日定向数据包|FRE65.9
|数传天线地面夹角数据|FRE65.10

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据指令完成数传天线的指向控制。
输入：数传天线j (j=1,2)，预置指令，跟踪开始指令，跟踪结束指令，地面站i在惯性系指向，被数传天线j(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线j(j=1,2)跟踪的地面站i的矢量在本体系的表示，数传天线收到的预置角度
输出：数传天线1和2的指令转角",0,1,0,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
CMG 1数据的采集与处理|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 2数据的采集与处理|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 3数据的采集与处理|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 4数据的采集与处理|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 5数据的采集与处理|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 控制指令的输出处理|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
CMG的程序注入修改|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
CMG的内存下传|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,0,0,0,1,0,0
功能描述：仅使用红外定姿时，计算正常飞行轮控所需电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：选择三轴控制力
处理：根据推力器分支设置控制力。
说明：3种分支共计3组控制力（每组包括正负X轴，Y轴，Z轴共4个）",0,1,0,0,0,0,0,0,0,0,0
"功能描述：0.262秒的中断服务主程序。
处理： 
STEP1：若ZT36=5,则进入自旋模式；
STEP2：
STEP3：若BZ8=5,则进行STEP4，否则返回；
STEP4：陀螺数据输入及转换
STEP5：若BZ1 = 3，FSA = 0，则进行姿态预估器（4）和Z轴捕获太阳；
STEP6：若BZ1 = 6，则：
调用姿态预估器（2）；
，
STEP7：进行轨控开关机，轨控段喷气姿态控制，飞轮动量保持控制及飞轮启动；
STEP8：若BZ1 = 5，则：
帆板未展开模式。",0,0,0,1,0,0,0,0,0,0,0
功能描述：抖动帆板。,0,0,0,0,0,1,0,0,0,0,0
"功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：将星务通过CAN总线广播的GPS定位数据转换成轨道根数。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据红外信息，进行全姿态捕获
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：计算巡天模式下的目标姿态
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收发送OBDH重要数据
处理：数据不需要应用软件处理。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：动量轮喷气卸载进入和退出条件计算。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：判断陀螺的使用范围。
输入：	本控制周期内采样的陀螺角度增量 (量纲：弧度) （=,…,）
      	上周期陀螺数据
      	标志 N_GyroDiagnV
处理
对陀螺数据进行有效性判断。若某个陀螺故障或某个陀螺为新上电，则不进行有效性判断（陀螺不引入）。其中陀螺新加电有三种情况1、判断出陀螺故障且允许自主加电情况下，应用软件自主加电。2、数据指令加电。3、脉冲遥控指令加电。对于新加电陀螺，则在该陀螺加电时间小于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为0；当该陀螺加电时间大于等于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为1。
若SLTU陀螺不加电或该陀螺故障，不引入。当“允许使用电源状态诊断陀螺”时，应用软件根据与SLTU通讯得到的陀螺电源状态确定陀螺加断电状态；当“不允许使用电源状态诊断陀螺”时，应用软件只根据数据指令确定陀螺加断电状态。若SLTU得到的六个电源状态均断电，则不根据电源状态判断陀螺是否加电。",0,0,0,0,0,0,1,0,0,0,0
"软件需求名称：化学推进使用及通信 
需求类别：其他 
软件需求描述：与发动机通信，输出本周期喷气脉宽。
处理：
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
UPS初始化|FREQ52|UPS初始化|B|2
化学推进数据采集|FREQ53|化学推进数据采集|B|3
推力器脉冲输出|FREQ54|推力器脉冲输出|B|4
推力器健康字设置|FREQ55|推力器健康字设置|B|5
部件操作（程控490N点火，故障重构）|FREQ56|部件操作（程控490N点火，故障重构）|B|
",0,0,0,0,0,0,0,1,0,0,0
功能描述：为正常模式姿态确定提供初始姿态。,0,0,1,0,0,0,0,0,0,0,0
光行差修正的初始设置为：AOCC应用软件对APS星敏信息进行补偿计算，不向星敏发送相对J2000的时间和速度。,0,0,0,0,0,0,0,0,1,0,0
功能描述：机械陀螺数据处理,0,0,0,0,0,0,0,0,1,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：选择通讯的LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）甚高精度星敏共有1个LTU，AOCC每个控制周期根据注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中是否通讯的甚高精度星敏LTU发送取数指令。
（2）向甚高精度LTU发送完取数指令后，获得甚高精度星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
功能描述：对部件加断电指令的处理 ,0,0,0,0,0,0,0,1,0,0,0
"功能描述：采集红外数据，计算姿态等。
处理：同用户需求的
STEP1:判断红外数据有效性
若左红外数据有效，则HL=1，否则HL=0。
若右红外数据有效，则HR=1，否则HR=0。
若ZT5=0不用红外，则HL=0，HR=0。
STEP2:计算公式同的（2）（3）（4）（5）（6）（7）（8）（9）（10）。
（9）若ZT3=F或B，则计算dΦH、dΘH。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：
 太阳捕获功能主要实现速率阻尼、俯仰搜索、滚动搜索、巡航等功能，使卫星由任意姿态进入保持对日定向巡航姿态运行。太阳捕获功能分为速率阻尼、俯仰搜索、滚动搜索和巡航四种方式（FReq-6）。
                        表5-2 方式字定义
名称|方式字定义|说明
RDSM|0|速率阻尼方式.(默认方式，程控结束后进入)
PASM|1|俯仰搜索方式
RASM|2|滚动搜索方式
CSM|3|巡航运行方式

处理： 
  （1） 模块初始化设置
   程序结束后，根据任务书5.4.5.3.1节进行模块初始化设置。考虑到地面遥控指令可以重新进入太阳捕获模式（速率阻尼初始化置陀螺故障诊断不允许），软件对模块初始化中的变量分为2个部分，其中以下部分为程控结束后只设置一次的变量：   
推力器输出状态清零；
CleNum = 0;  
采用MRE板数据设置陀螺顶替标志；（考虑S陀螺健康时才进行相应顶替）。
若有飞轮的电源状态为开，则允许飞轮进行转速控制WheelCon＝TRUE；
部分软件自身使用的变量。
（2）在太阳捕获中需要进行动量轮刹车控制以及方式控制：
动量轮刹车控制详见5.2.17节。（有动量轮加电，则进行动量轮刹车控制。）
（3）方式控制如下：
(I) 对卫星进行速率阻尼，连续35个控制周期三轴角速度绝对值（实际取最大值即可）小于0.14°/s，进入俯仰搜索方式；或者进入速率阻尼方式的时间超过2000个控制周期（256秒）后，进入俯仰搜索，开始搜索太阳。
(II)进入俯仰搜索方式，使卫星以+/-0.5/s（速率阻尼结束后进入时根据SPz13选择极性)绕Y轴转动，若5625个控制周期（720秒）后没有捕获到太阳，进入滚动搜索方式。进入滚动搜索方式后，使卫星以0.5°/s绕X轴转动。
(III) 若(II)中滚动搜索方式经过6250个控制周期（800秒）后还未见到太阳则再重复俯仰搜索和滚动搜索，则再次进入（II），即俯仰捕获方式（这种情况下b＝-0.5/s）。其中滚动搜索不成功的故障处理逻辑见5.2.14节。
(IV) 在(II)(III)过程中一旦捕获到太阳且持续时间大于2.048秒(16个控制周期)，则进入巡航方式。进入巡航模式后，控制SADA归零。
说明：捕获太阳时，对于持续时间大于2.048秒的判断，太阳连续可见（SP61/62 = 1）的条件下，俯仰搜索时，俯仰角绝对值大于1°的累计时间；滚动搜索时，滚动角绝对值大于1°的累计时间。",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""
|复位初始化|FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""
",1,0,0,0,0,0,0,0,0,0,0
"功能描述：输出喷气指令
处理：
（1）将喷气的喷管打开
（2）将喷气长度写入各自通道的定时器；",0,0,0,0,0,0,0,1,0,0,0
"软件需求标识：FREQ4 
软件需求名称：星时计算 
软件需求描述：星时计算。见“任务书”4.1.3.1“星时计算”。",0,0,0,0,0,0,0,0,1,0,0
功能描述：利用GPS通道板数据进行GPS定轨程序。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：仅利用星敏感器A、C的测量，修正姿态四元数与姿态角速度移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：对星敏感器输出数据进行有效性判断，并选取定姿星敏组合。,0,0,0,0,0,0,1,0,0,0,0
"软件需求名称：故障诊断和处理 
需求类别：其他 
软件需求描述：《用户需求》4.8。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.8.1|陀螺故障检测及选择|《用户需求》4.8.1|
FREQ12.3-R4.8.2|加计故障检测及选择|《用户需求》4.8.2|
FREQ12.3-R4.8.3|星敏感器故障检测及选择|《用户需求》4.8.3|
FREQ12.3-R4.8.4|帆板驱动机构故障检测及选择|《用户需求》4.8.4|
FREQ12.3-R4.8.5|动量轮故障检测及选择|《用户需求》4.8.5|
FREQ12.3-R4.8.6-K|推进系统故障检测及选择|《用户需求》4.8.6|
FREQ12.3-R4.8.7-K|系统故障检测及选择|《用户需求》4.8.7|
",0,0,0,0,0,1,0,0,0,0,0
功能描述：喷气卸载进入和退出条件计算。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：姿态机动模式控制
",0,0,0,1,0,0,0,0,0,0,0
功能描述：计算岁差章动矩阵。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据红外输出，估计卫星姿态与陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用加速度计数据诊断加速度计部件状态
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：星时计算
处理：控制周期中断服务程序，对星时加1",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据从SLTU接收的0.25秒或1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
输入：0.25秒或1秒内陀螺的角度增量 (量纲：弧度)
(i=1,2,3,…6，依次表示陀螺G1，G2，…，G6的输出)；
采样周期 (量纲：秒)；
陀螺数据有效性标志F_GyroValid(由陀螺有效性判据给出)。
陀螺系统在星体三轴方向等效的常值漂移估值 (量纲：弧度/小时)
星敏感器数据有效性标志：F_SAValid，F_SBValid，F_SCValid
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：二次电源切换。
处理：
ACU内部含有两套二次电源，两套互为备份，可以同时加电工作，通常仅一份工作。AOCC每个控制周期采集工作电源的状态模拟量，并设置当班状态（5V和12V遥测模拟量≥3V即当班，若同时符合条件则置主份当班），若连续4个控制周期两套电源均不当班，且允许自主切换，则连续两个控制周期先后发送主份电源开、备份电源关两条指令，并置主份当班。
若当班电源的5V或12V遥测模拟量连续5个控制周期<3V时，且允许自主切换，则连续两个控制周期先后发送另一份电源开、本电源关两条指令，并禁止自主切换；若禁止自主切换，则设置切机命令字。
上电/复位初始化为允许自主切换，当班标志为保持。",0,0,0,0,0,0,0,1,0,0,0
"序|需求名称|编号|功能及处理描述
|红外1数据的采集与处理|FREQ3.1|选择通讯的红外1LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|红外2数据的采集与处理|FREQ3.2|选择通讯的红外2LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：若连续3个周期判断出星箭分离信号为分离，则置初始速率阻尼模式，对卫星的角速度进行控制。
处理：
自主或指令进入此模式后，进行如下初始设置：
星时赋初值为0.375s；
连续2个周期发送“推进加电”指令；
根据自锁阀状态设置自锁阀1和/或自锁阀2开
发送6个陀螺加电指令，引入6个陀螺信息，且不需要陀螺等待时间
每个控制周期顺序调用用户需求中的逻辑：
轨道与星历；
部件故障检测与信号选取；
陀螺数据处理；
惯性姿态陀螺预估；
速率阻尼；
控制器输入量计算；
if((1<t <60|| t>80)且Flag_equation=0) 调用 相平面喷气脉宽；
模式转换条件：
若t >100，则WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收AOCC重要数据包
处理：将接收AOCC重要数据包存储地址中内容解包成重要数据中的各个变量和参数。其处理过程如下：
STEP1：对接收的数据进行合法性判断；
STEP2：将接收的重要数据放入应用软件的缓存区中；
STEP3：解包相应的数据，并赋值给相应的变量。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用A，C头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.8。
STEP1：计算，将下标B换成C；FM3更改：若，则：，FSTD=1；
STEP2：计算，。的各项乘以，的各项乘以。将下标B换成C；
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：使用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,0,0,0,1
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
甚高陀螺通讯故障诊断|大量程通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
部件故障诊断与处理|确定各敏感器和执行机构故障诊断及处理
陀螺故障检测|确定各敏感器和执行机构故障诊断及处理
动量轮故障检测|检测工作中的动量轮的故障
大力矩飞轮故障检测|检测工作中的大力矩飞轮的故障
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式7的系统故障诊断|在模式7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
磁力矩器数模一致性诊断|磁力矩器数模一致性诊断
DSS输出一致性诊断|DSS输出一致性诊断
ASS1输出一致性诊断|ASS1输出一致性诊断
ACU 1553B接收故障诊断及处理|由于卫星的执行机构控制均需通过ACU进行，当ACU接收控制指令内存区异常将导致卫星失去控制能力，因此有必要对ACU接收执行机构控制指令的正确性进行判断。在检测到执行机构控制指令接收校验和异常后CCU需要自主进行处理",0,0,0,0,0,0,1,0,0,0,0
功能描述：对工作的飞轮进行电压补偿，并输出控制电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：滚动/俯仰姿态机动目标姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：光纤陀螺数据处理,0,0,0,0,0,0,0,0,1,0,0
"功能描述：各模式控制量计算
序号|功能编号|功能简述|功能详述
|FREQ3.4.3.1|等待段调用流程|用户需求4.1.1【调用流程】
|FREQ3.4.3.2|太阳定向模式调用流程|用户需求4.1.2【调用流程】
|FREQ3.4.3.3|恒星定向2/4模式调用流程|用户需求4.1.3【调用流程】
|FREQ3.4.3.4|惯性调姿模式调用流程|用户需求4.1.5【调用流程】
|FREQ3.4.3.5|轨控定向模式调用流程|用户需求4.1.6【调用流程】
|FREQ3.4.3.6|着陆准备模式调用流程|用户需求4.1.7【调用流程】
|FREQ3.4.3.7|主减速模式调用流程|用户需求4.1.8【调用流程】
|FREQ3.4.3.8|快速调整模式调用流程|用户需求4.1.9【调用流程】
|FREQ3.4.3.9|接近下降模式调用流程|用户需求4.1.10【调用流程】
|FREQ3.4.3.10|悬停模式调用流程|用户需求4.1.11【调用流程】
|FREQ3.4.3.11|避障模式调用流程|用户需求4.1.12【调用流程】
|FREQ3.4.3.12|缓速下降模式调用流程|用户需求4.1.13【调用流程】
|FREQ3.4.3.13|自主定位模式调用流程|用户需求4.1.14【调用流程】
|FREQ3.4.3.14|起飞准备模式调用流程|用户需求4.1.15【调用流程】
|FREQ3.4.3.15|垂直上升模式调用流程|用户需求4.1.16【调用流程】
|FREQ3.4.3.16|上升调姿模式调用流程|用户需求4.1.17【调用流程】
|FREQ3.4.3.17|轨道入射模式调用流程|用户需求4.1.18【调用流程】
|FREQ3.4.3.18|星光环月模式调用流程|用户需求4.1.19【调用流程】
|FREQ3.4.3.19|速率阻尼模式调用流程|用户需求4.1.20【调用流程】
|FREQ3.4.3.20|无控模式调用流程|用户需求4.1.21【调用流程】
",0,0,0,1,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|喷气开关逻辑相平面分区，喷气脉冲宽度计算|FREQ31|4.3.1.1|进行单轴相平面分区及控制规律计算
|三轴姿态喷气控制与推力器脉宽分配|FREQ32|4.3.1.3|为三轴姿态喷气控制选择推力器
|轨控发动机与其备份的使用|FREQ33|4.3.1.4|轨控模式时使用轨控发动机及其备份
|动量轮摩擦补偿计算|FREQ34|4.3.2.2|动量轮摩擦力矩的补偿电压计算
|动量轮角动量保持控制|FREQ35|4.3.2.3|计算将动量轮保持至标称角动量所需的电压
|动量轮的启动与保持|FREQ36|4.3.2.4|启动动量轮至标称角动量，并保持
|正常飞行模式动量轮分配电压计算|FREQ37|4.3.2.5|计算正常飞行模式轮控所需电压
|正常模式轮子保护与动量卸载|FREQ38|4.3.3.1|决定采用磁卸载还是喷气卸载方式，调用相应程序
|磁卸载计算|FREQ39|4.3.3.2|计算磁卸载所需的磁矩与磁力矩器工作电压
|结构滤波器计算|FREQ95|4.3.2.6|PID计算控制力矩经过结构滤波器后，改善姿态控制效果
|太阳定向主程序|FREQ40|4.4.3.3|搜索并捕获太阳，完成并保持帆板对太阳定向
|重捕地球与建立正常姿态（1）|FREQ41|4.4.4.1|在完成对日定向后，由地面指令转入重捕地球。在偏航捕获阶段，通过红外和太阳敏感器定姿，消除卫星的偏航角。在完成偏航捕获后，由红外地球敏感器测量信号进行计算得到俯仰角和滚动角，控制滚动、俯仰使其趋向于0
|捕获地球与建立正常姿态（2）|FREQ42|4.4.4.2|当红外敏感器故障时，在太阳定向完成后，利用数字太阳与星敏感器信息，进行全姿态捕获，并建立正常姿态。
|三轴等效角动量偏差|FREQ91|4.3.4.1|根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差
|俯仰通道轮控算法|FREQ92|4.3.4.2|根据俯仰角和俯仰通道角动量偏差信息实现俯仰轴姿态控制
|磁进动、章动阻尼及俯仰轮卸载控制|FREQ93|4.3.4.3|通过磁力矩器，实现滚动-偏航轴的进动控制及章动阻尼，并对俯仰飞轮进行磁卸载
|三轴轮控算法|FREQ94|4.3.4.4|偏置动量轮处于力矩模式，根据红外地球敏感器测量信息计算得到的滚动角和俯仰角实现三轴姿态控制。滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制
|帆板捕获及跟踪控制|FREQ102|4.3.5|根据地面指令或自主使帆板跟踪太阳
|干扰补偿控制算法及动量轮分配电压计算|FREQ95|任务书的4.1.15|计算有效载荷干扰补偿控制电压，以及计算动量轮分配电压
|全姿态捕获动量轮控制方式主程序|FREQ40.5|4.4.5|全姿态捕获动量轮控制方式主程序
",0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。
|红外2数据的采集与处理|FREQ1.3.2|""红外2
1553取数指令""|红外2的弦宽和前基|在通讯允许的条件下（红外2的当班标志为1），向红外2 RT发取数指令，获得红外2数据并处理成对应的弦宽和前基。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据星敏感器的输入，计算姿态偏差，角速度等。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：对弦宽、基准与给定的范围进行比较，同时根据太阳星历输出进行见太阳判断，确定红外输出的有效性。,0,0,0,0,0,0,1,0,0,0,0
功能描述：秒脉冲信号处理。,0,0,0,0,0,0,0,1,0,0,0
功能描述：将GPS轨道确定参数转换成控制系统中太阳星历和地磁场计算所需的19个轨道参数,0,0,0,0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的星敏间基准修正与有效性判断修正系数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集并处理四个动量轮加电状态，三路伽马关机敏感器关机信号，四路触地开关信号                                                                                                                                                                                                                                                                                                                                          处理：
序号|功能点编号|功能描述
1|FREQ3.3.1|动量轮加电状态
2|FREQ3.3.2|三路伽马关机敏感器关机信号
3|FREQ3.3.3|四路触地开关信号
",0,0,0,0,0,0,0,0,1,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.8.1~4.8.8。
序号|功能点编号|功能描述|说明
|FREQ3.4.10.1|陀螺故障检测及选择|《用户需求》4.8.1
|FREQ3.4.10.2|加速度计故障检测及选择|《用户需求》4.8.2
|FREQ3.4.10.3|星敏感器故障检测及选择|《用户需求》4.8.3
|FREQ3.4.10.4|系统故障检测及选择|《用户需求》4.8.4
|FREQ3.4.10.5|加计通讯故障处理|《用户需求》4.8.5
|FREQ3.4.10.6|陀螺通讯故障处理|《用户需求》4.8.6
|FREQ3.4.10.7|测速波束有效性检测及选择|《用户需求》4.8.7
|FREQ3.4.10.8.1|单机类故障诊断_陀螺|《用户需求》4.8.8 
|FREQ3.4.10.8.2|单机类故障诊断_加计|《用户需求》4.8.8
|FREQ3.4.10.8.3|单机类故障诊断_星敏|《用户需求》4.8.8
|FREQ3.4.10.8.4|单机类故障诊断_微波测距测速|《用户需求》4.8.8
|FREQ3.4.10.8.5|单机类故障诊断_激光测距|《用户需求》4.8.8
|FREQ3.4.10.8.6|单机类故障诊断_激光测速|《用户需求》4.8.8
|FREQ3.4.10.8.7|自主启动IMU数据存储|《用户需求》4.8.8
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压
说明：  控制方式发生改变时，每回首次调用该模块时清轮子角动量积分量。",0,1,0,0,0,0,0,0,0,0,0
功能描述：利用红外、数字/太阳敏感器确定姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：帆板驱动线路数据处理 
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收遥控固定参数注入块的结构滤波器系数
处理：
调整各系数的初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：完成整星绕滚动轴的姿态侧摆角保持功能
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
条件|FRTS的取值
ZT35(2) = 1且|1
其余情况|0

STEP2：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP3：进行运行段姿态确定，具体过程如下：
进行红外数据采集及处理和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP4：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3且ZT9  3且ZT时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
当ZT40(4) = 1时，进行数传天线捕获跟踪控制
STEP5：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：模式8切换方式
处理：
if(>6900 且AutoInStopNum<2) 置WorkMode=2，CMGInControlFlag=0；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：中继天线数据处理
处理：
处理数据时应对接收数据中的捕跟分系统工作模式进行保护判断。",0,0,0,0,0,0,0,0,1,0,0
功能描述：无控模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：与星敏感器通讯获得星敏感器数据状态，修改星敏感器程序。
输出：星敏感器命令包、星敏感器故障标志、定姿标志、位输出。
处理：
光行差修正的初始设置为：AOCC应用软件不对Astro10星敏信息进行补偿计算，而仅每150秒向星敏发送相对J2000的速度。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据红外输初，计算太阳在本体坐标系中方位、姿态偏差、弦宽误差估计与量测新息。
输入：姿态估值 
	   红外数据有效性输出 ，
      红外常值偏差估值 ， (量纲：弧度)
红外数据有效性标志F_IresValid（由有效性判据给出）
输出的太阳方位",0,0,1,0,0,0,0,0,0,0,0
功能描述：CMG启动模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：用整星广播时间校正星上时间
处理：解包广播校时数据，
- 若为星务UTC校时，计算星务星箭分离星时；
- 若当前星时与星务星箭分离星时相差绝对值小于dt，则实施校时；否则不校时。
- 校时成功后，更新星敏、CCD、微波测距仪、可见光相机的同步信号基准时刻。
说明：上电/复位时，dt = 200秒；成功校时后，dt = 10秒",0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收服务请求确认字
处理： 将接收服务请求确认字存储地址中内容解包成服务请求确认字的数据格式，根据不同的服务请求确认字停止对应的服务请求的申请。",0,0,0,0,0,0,0,0,0,1,0
"软件需求名称：姿态控制算法 
需求类别：其他 
软件需求描述： 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.5.1|相平面和动量轮联合控制|《用户需求》4.5.1|
FREQ12.3-R4.5.2|喷气姿态控制|《用户需求》4.5.2|
FREQ12.3-R4.5.2.1|相平面姿控算法|《用户需求》4.5.2.1|
FREQ12.3-R4.5.2.2|相平面喷管选择|《用户需求》4.5.2.2|
FREQ12.3-R4.5.2.3|脉冲调宽姿控算法|《用户需求》4.5.2.3|
FREQ12.3-R4.5.2.4|脉冲调宽喷管选择|《用户需求》4.5.2.4|
FREQ12.3-R4.5.3|动量轮控制|《用户需求》4.5.3|
FREQ12.3-R4.5.3.1|动量轮启动与保持|《用户需求》4.5.3.1|
FREQ12.3-R4.5.3.2|动量轮姿态控制|《用户需求》4.5.3.2|
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：当星敏感器需要粗姿态时，利用卫星的姿态估值，计算星敏感器的测量系在惯性坐标系中的四元数表示。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收OBDH时间数据,0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|部件状态、双组元推进状态1、推进状态2、ACU工作状态|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|计算得到的喷气脉宽、磁力矩器电压|控制指令消息的输出|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
|部件加断电指令的处理|FREQ1.8.4|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.5|保存CCU的重要数据|接收CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.6|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|FREQ1.8.7|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.8|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.9||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令
",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.3|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.4|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1|地面站赤经赤纬计算
|运行段帆板控制|FREQ4.12|5.5.1|三轴稳定模式下的帆板控制
|太阳帆板自主跟踪控制|FREQ4.13|5.5.2|根据帆板角误差、控制帆板跟踪太阳
|数传天线指向控制|FREQ4.14|5.6.2|根据指令完成数传天线的指向控制
|中继轨道计算|FREQ4.21|5.7.1|根据指令完成数传天线的指向控制
|中继天线指向控制|FREQ4.22|5.7.2和5.7.3|根据指令完成中继天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|双脉冲变轨|FREQ4.21|""任务书的
4.2.3""|根据地面注入的指令可实现两次轨控的功能
|3CMG框架角速度 指令解算|FREQ4.22|5.4.2.6|当采用3CMG进行姿态控制时，根据控制器计算出的力矩，实现CMG的框架角速度解算。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：使星体Z轴对日定向，适当时重捕地球。
处理过程：
(1)若星敏数据无效且FEA=0，则Ψ=0.12，调用“-Z轴对日定向”，BZ1=3；
(2)当FEA=0时；FM3②增加判断；
(3)当FEA=5时，其中姿态角的阀值增加调整系数。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收遥控可变地址注入块
处理：软件设计时需要判断地址是否对齐，若未对齐，则不执行此注入块。",0,0,0,0,0,0,0,0,0,1,0
功能描述：接收遥控固定参数注入块的红外太阳姿态修正系数,0,0,0,0,0,0,0,0,0,1,0
功能描述：计算将动量轮保持至标称角动量所需的电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：卫星速率阻尼下来后，转动卫星，使得数字或模拟太阳见到太阳；先绕本体x轴转动，若转动360度太阳未见太阳，停止x轴转动，再绕本体y轴转动，若转动360度太阳仍未见太阳，重复上述过程(若模拟太阳搜索，则减少转动角度)；
输入：，控制周期；滚动、俯仰数字太阳监视码，TsearchSun；滚动、俯仰模拟太阳监视码；

",0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收星箭分离信号及天线状态数据
处理：控制计算机在收到星箭分离指令并且判断数据正确后，即认为星箭分离有效，通过方式代码的服务请求，申请OBDH停止发送星箭分离信号。天线状态的数据具体见与外总线通讯协议。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用星敏感器D的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：CMG数据处理。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：利用数字太阳角输出，保持卫星帆板对太阳定向。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据红外信息绕滚动俯仰转动，进行滚动俯仰捕获
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
下图中模式之间的连接线分为实线和虚线，实线表示正常转移，虚线表示故障转移，在下表中具体列出了模式转移的条件。
                            图5-1 自主模式转换图
表5.2.4.4-2 模式自主转换条件（除复位后重要数据恢复成功转模式外）
序号|功能编号|功能简述|功能详述
|FREQ3.4. 1.22|WM0_to_WM1|连续27s满足组合体分离状态为已分离且触地开关状态为未触地后，系统转太阳定向模式，置LAFlag=00H，为组合体状态；
|FREQ3.4. 1.27|WM1_to_WM20|太阳定向模式中，若故障标志FailureFlag=3，则转入无控模式
|FREQ3.4. 1.28|WM2_to_WM3|""恒星定向2模式中，若惯性调姿开始时刻到tgon≤t≤tgon +ΔtMS且
tgon≥0，则转惯性调姿模式""
|FREQ3.4. 1.29|WM2_to_WM19|恒星定向2模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.30|WM3_to_WM4|""惯性调姿模式中，若姿态好或恒星定向4的时间到，即连续20个周期满足|qBT|≤qhon且|ω|≤ωhon或t≥thon，则转入恒星定向4模式""
|FREQ3.4. 1.31|WM3_to_WM19|惯性调姿模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.32|WM4_to_WM5|恒星定向4模式中，若轨控开始时刻到tgi≤t≤tgi+ΔtMS且tgi>0，则转入轨控定向模式
|FREQ3.4. 1.33|WM4_to_WM6|""恒星定向4模式中，若着陆上升组合体状态下着陆准备开始时刻到且启动动力下降标志有效，即LAFlag=0且
t0+Δtdb-t0p≤t≤t0+Δtdb-t0p+ΔtMS且
BKFlag=1，则转入着陆准备模式""
|FREQ3.4. 1.34|WM4_to_WM19|恒星定向4模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.35|WM5_to_WM1|轨控定向模式中，若轨控子模式字GMODE=2后计时>240s，则转入太阳定向模式
|FREQ3.4. 1.36|WM5_to_WM19|轨控定向模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.37|WM6_to_WM7|着陆准备模式中，若着陆准备模式开始时刻到且启动动力下降标志BKFlag=1，则转入主减速模式
|FREQ3.4. 1.38|WM7_to_WM8|主减速模式中，若FailureFlag=0且PDMSFlag=1，则转入快速调整模式
|FREQ3.4. 1.39|WM7_to_WM9_1|主减速模式中，若FailureFlag=0但是高度已经在主减速切换到接近下降的高度内h<hSafe1，则转入接近下降模式
|FREQ3.4. 1.40|WM7_to_WM9_2|主减速模式中，若（出现陀螺饱和Flag=1，则转入接近下降模式
|FREQ3.4. 1.42|WM7_to_WM10_2|主减速模式中，若FailureFlag=5且 速度满足故障时切换到悬停模式的条件且高度已在悬停高度偏差内，则转入悬停模式
|FREQ3.4. 1.44|WM7_to_WM10_4|主减速模式中，若FailureFlag=5且制导时间已经在切换到悬停模式的阀值内，则转入悬停模式
|FREQ3.4. 1.45|WM8_to_WM9_1|快速调整模式中，若PDMSFlag=2，则转入接近下降模式
|FREQ3.4. 1.46|WM8_to_WM9_2|快速调整模式中，若允许调用安全模式制导律ZT11(D10)=1，则转入接近下降模式
|FREQ3.4. 1.47|WM8_to_WM9_3|快速调整模式中，若高度已经小于快速调整转入接近下降的高度h<hSafe2，则转入接近下降模式
|FREQ3.4. 1.48|WM8_to_WM9_4|快速调整模式中，若出现陀螺饱和Flag=1，则转入接近下降模式
|FREQ3.4. 1.49|WM9_to_WM10_1|接近下降模式中，若接近段无超差AppFFlag=0且动力下降段模式切换标志PDMSFlag=4，则转入悬停模式
|FREQ3.4. 1.50|WM9_to_WM10_2|接近下降模式中，若接近段有超差AppFFlag=1且速度满足故障时切换到悬停模式的条件且高度已在悬停高度偏差内h≤hsus+ dhsus，则转入悬停模式
|FREQ3.4. 1.51|WM9_to_WM10_3|接近下降模式中，若接近段有超差AppFFlag=1且制导时间已经在切换到悬停模式的阀值内tgo1<tgo1AS，则转入悬停模式
|FREQ3.4. 1.52|WM10_to_WM11_1|悬停模式中，若已获安全着陆点SLPFlag=1，则转入避障模式
|FREQ3.4. 1.53|WM10_to_WM11_2|悬停模式中，若悬停计时超过悬停模式切换到避障模式的计时阀值tSH，则转入避障模式
|FREQ3.4. 1.54|WM10_to_WM11_3|悬停模式中，若成像时间已经只剩一个控制周期Tsus≤Δt，则转入避障模式
|FREQ3.4. 1.74|WM10_to_WM11_4|悬停模式中，若BZ1=7或8或9或10时发生过复位，则当vmb_B 低于阀值后转避障
|FREQ3.4. 1.55|WM11_to_WM12_1|避障模式中，若高度距离缓速下降起始高度已经达到模式切换阀值，则转入缓速下降模式
|FREQ3.4. 1.56|WM11_to_WM12_2|避障模式中，若制导时间与避障垂向规划轨迹标称时间之差大于2个控制周期，则转入缓速下降模式
|FREQ3.4. 1.57|WM12_to_WM20_1|""缓速下降模式中，若收到关机信号且缓速下降持续时间大于缓速下降切换到无控的时间切换阀值1，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.58|WM12_to_WM20_2|""缓速下降模式中，若缓速下降持续时间大于缓速下降切换到无控的时间切换阀值2，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.59|WM12_to_WM20_3|""缓速下降模式中，若缓速下降持续时间大于缓速下降切换到无控的时间切换阀值3且注入指令允许加速度关机，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.60|WM14_to_WM15|""起飞准备模式中，若起飞时间到且收到着陆上升器分离信号，则转垂直上升模式
转模式删除tLaunch=t""
|FREQ3.4. 1.70|WM14_to_WM20|起飞准备模式中，若FailureFlag=7，则转无控模式，置BZ1=20
|FREQ3.4. 1.61|WM15_to_WM16|""垂直上升模式中，t>tswitch或（max(|φc|,|θc|,|ψc|)<Φswitch且dh>vswitch 且FailureFlag=0，则切换为BZ1=16""
|FREQ3.4. 1.71|WM15_to_WM17|""垂直上升模式中，t>tswitch或（max(|φc|,|θc|,|ψc|)<Φswitch且dh>vswitch 且FailureFlag≠0，则置PEGConvergeFlag=0，切换为BZ1=16""
|FREQ3.4. 1.69|WM15_to_WM20|垂直上升模式中，若t≥tLaunch+Δtac 且RCSOnFlag≠1，则切换为无控模式BZ1=20
|FREQ3.4. 1.62|WM16_to_WM17|上升调姿模式中，若t-tswitch>tPD1且δθgui≤ΔθPD）或t-tswitch>tPD2，则转入轨道入射模式
|FREQ3.4. 1.72|WM16_to_WM17_2|上升调姿模式中，若FailureFlag≠0，则置PEGConvergeFlag=0，并切换轨道入射模式BZ1=17。
|FREQ3.4. 1.63|WM17_to_WM1_1|轨道入射模式中，若GMODE=2且TGMODE·Δt>Δtaf，则转入太阳定向模式
|FREQ3.4. 1.75|WM17_to_WM3|轨道入射模式中，若GMODE=2且FailureFlag=8，则转入惯性调姿
|FREQ3.4. 1.65|WM18_to_WM1|星光环月模式下，若FailureFlag=6，则转入太阳定向模式
|FREQ3.4. 1.66|WM18_to_WM20|星光环月模式下，若收到轨道器或地面发送的转无控命令，或收到微波应答机发送的停控指令后，则转入无控模式
|FREQ3.4. 1.67|WM19_to_WM2|速率阻尼模式下，若连续100个周期满足惯性角速度好，且ZT11(D11)=1，则转恒星定向2
|FREQ3.4. 1.68|WM19_to_WM1|速率阻尼模式下，若FailureFlag=2，则转入太阳定向模式
|FREQ3.4. 1.73|WM19_to_WM1_2|速率阻尼模式下，若连续100个周期满足惯性角速度好，且ZT11(D11) ≠1，则转入太阳定向模式
",0,0,0,1,0,0,0,0,0,0,0
"功能：对日定向和对地定向的目标姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输出：数字太阳敏感器输出；模拟太阳敏感器输出；模拟式太阳敏感器视场码；0-1式太阳敏感器的信号（0或1）；数字太阳敏感器视场码。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得数字太阳、模拟太阳、0-1太阳数据；每个控制周期根据DSSLTUSeltFlag确定进行通讯的太阳LTU，发送取数指令，具体如下表所示：
DSSLTUSeltFlag |进行通讯的太阳LTU|发送的取数指令
01H|太阳LTU1|43H
02H|太阳LTU2|43H
其它|根据LTU故障诊断的结果决定太阳LTU的选取。初始状态为太阳LTU1|43H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，具体参见LTU通讯协议件。
（3）太阳LTU数据采集过程中的故障处理见4.4.3中规定。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：将S-84坐标系下的追踪器GPS原始数据转换成J地心天球坐标系下的数据，根据该数据与轨道计算数据的对比结果，给出GPS数据可用性标志
说明：计算目标器GPS时，将输入、输出改为目标器的相应变量。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：模式1切换方式。
处理：
若t >100，则WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：利用星敏感器和陀螺输出计算姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.7.1~4.7.4。
序号|功能点编号|功能描述|说明
|FREQ3.4.9.1|轨控开关机|《用户需求》4.7.1
|FREQ3.4.9.2|轨控发动机选择A|《用户需求》4.7.2
|FREQ3.4.9.3|轨控发动机选择B|《用户需求》4.7.3
|FREQ3.4.9.4|轨控发动机选择C|《用户需求》4.7.4
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：卫星的10个工作模式切换方式。
处理：
对每个模式分别按照切换条件处理。见用户需求3.3节。
工作模式切换表
""换后
模式
切换
前模式""|Mode1|Mode2|Mode3|Mode4|Mode5|Mode6|Mode7|Mode8|Mode9
Mode0|1,2||||||||1,2
Mode1||1,2||||||2|1,2
Mode2|||2|2||||1,2|1,2
Mode3||2||1,2|||||1,2
Mode4||1,2|||1,2||||1,2
Mode5||1,2||1,2||1,2|||1,2
Mode6||1,2||2|1,2||1,2||1,2
Mode7||2|||1,2|1|||1,2
Mode8||1,2|||||||1,2
Mode9||1,2|||||||

说明：代号“1”表示自主进入；代号“2”表示地面/总线指令进入",0,0,0,1,0,0,0,0,0,0,0
功能描述：检测推力器的泄露，必要时做相应的主备份切换。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：根据需求，计算去往定点观测模式机动过程中所需的目标姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据CMG输出数据和理论数据进行CMG故障检测。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：使星体-Z轴对日定向后，使用星敏感器重捕地球。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：对星敏感器输出数据进行有效性判断。
输入：STSFailureDiagPermFlag, ZT6，星敏1 输出四元数，
星敏2输出四元数，星敏3输出四元数，预估四元数
t， t星A，t星B ，t星C ,  tmdts ,ZAR , ZBO Z , ZCR Z ,  ms ,  ms1 ,  ms2 ， ms3。
输出：ZA，XA，ZB，XB，ZC，XC，
星敏感器参与定姿标志FSTA，FSTB，FSTC，FSTD 。",0,0,0,0,0,0,1,0,0,0,0
"功能描述：利用A，B头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.7。
STEP1：计算；FM3更改：若，则：，FSTD=1；
STEP2：计算，。的各项乘以，的各项乘以。
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：与帆板通信，控制帆板并获得帆板状态数据。
处理：
功能编号|功能|引用文档|备注
FREQ46|帆板初始化|帆板协议|B
FREQ47|帆板数据采集|任务书、帆板协议|B
FREQ48|数据解包与转换|帆板协议|B
FREQ49|帆板数据有效性判断、处理|任务书|B
FREQ50|帆板控制量输出|帆板协议|B
FREQ51|帆板故障重构|任务书|B
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：帆板故障检测，切换帆板LTU。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：确定ASS21,ASS22,ASS31,ASS32及帆板角度传感器等的信号选取。",0,0,0,0,0,0,1,0,0,0,0
"功能描述：接收遥控固定参数注入块的系统正常姿态控制器系数
处理：
调整部分零动量稳态、机动PID系数和正常模式偏航角偏差限幅的初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：处理地面遥控注入的内存下卸指令注入
处理：解包内存下卸指令注入，得到内存下卸起始地址用于第七类快帧数据打包。
说明： 遥测数据指令采用16字节(有效使用9字节)格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,0,0,0,1,0
"功能描述：地面站赤经赤纬计算
处理：同用户需求的",0,0,0,0,1,0,0,0,0,0,0
功能描述：计算在整星角动量偏置下，CMG控制时的框架角速率指令。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：轨道与星历计算。
",0,0,0,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发送遥测数据块
处理： 处理过程如下：
OBDH每个实时遥测帧周期（0.8秒）从AOCC获取并下发60字节DS量遥测数据。每个遥测格式分64帧，以F0---F63标记，每帧所要求AOCC传送的内容各不相同，按数据更新情况分为快速数据（DF），中速数据（MF），慢速数据（SF）。每种数据在不同的卫星的姿态控制方式下，所要求传送的DS遥测量是不同的，可分为三轴稳定模式与非三轴稳定模式；三轴稳定模式下又可分为星敏感器是否参加定姿两种情况。遥测数据DF，MF，SF含义为：
快速数据，每帧传送数据相同，即每帧一循环；
中速数据，每16帧一循环；
慢速数据，每32帧一循环。
遥测输出数据格式及定义见文件R/JBK-10/0.RX1：
星上应用程序每0.524秒在定时中断响应主程序中装载快速遥测数据，在4秒主程序中装载中速和慢速数据，并根据当前控制系统模式装载不同的数据到规定遥测数据区中。为了能根据正确遥测相应的遥测数据，星上应用程序需要分别定义快帧遥测缓存区42字节，中帧遥测缓存区6×16字节和慢帧遥测缓存区12*32字节来存放星上的数据。同时应用程序每个周期都要根据OBDH的帧号从相应的遥测缓存区中找出正确的遥测数据进行打包。以下就快速遥测、中速遥测和慢速遥测的处理过程分别进行说明：
1）快速遥测
STEP1：根据星上控制模式，确定数据装载模式；
STEP2：根据不同的数据装载模式，确定装载数据；
STEP3：在0.524秒控制周期内将确定的装载数据转换为遥测要求的数据格式，并放入规定的缓存区；
STEP4：将规定缓存区的内容放入OBDH定义的内存中；
2）中速遥测
STEP1：根据星上控制模式，确定数据装载模式；
STEP2：根据不同的数据装载模式，确定装载数据；
STEP3：在4秒主程序内将确定的装载数据转换为遥测要求的数据格式，并放入规定的缓存区；
STEP4：根据遥测帧号从规定的缓存区中挑出遥测的数据并放入OBDH定义的内存中；
3）慢速遥测
STEP1：在4秒主程序内将确定的装载数据转换为遥测要求的数据格式，并放入规定的缓存区；
STEP2：根据遥测帧号从规定的缓存区中挑出遥测的数据并放入OBDH定义的内存中；
遥测的快帧内容不变，中帧和慢帧去掉加速度计相关内容，新增和更改内容详见《卫星控制分系统数字量实时遥测数据格式和参数定义》。",0,0,0,0,0,0,0,0,0,0,1
功能描述：发送星敏感器数据包,0,0,0,0,0,0,0,0,0,0,1
"功能描述：当整星－Z 轴对日后，通过旋转Z 轴令目标矢量进入XOZ 平面
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在AOCC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ61|初始化|与一体化太阳通信协议
FREQ62|数太使用要求|任务书、数太协议
FREQ63|通信|任务书、数太协议
FREQ64|通信故障处理|任务书
FREQ65|数据解包与转换|数太协议
FREQ66|数太数据有效性判断、处理|任务书
FREQ67|数太模拟量采集、处理|预留
FREQ68|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
功能描述：计算CMG的框架角速度。                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：修改奇异规避算法。,0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：模式切换 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.1-1-K|从太阳定向模式转出|《用户需求》4.1.1【模式转换条件】|
FREQ12.1-2|从恒星定向1模式转出|《用户需求》4.1.2【模式转换条件】|
FREQ12.1-3|从惯性调姿模式转出|《用户需求》4.1.3【模式转换条件】|
FREQ12.1-4|从恒星定向2模式转出|《用户需求》4.1.4【模式转换条件】|
FREQ12.1-5|从轨控定向模式转出|《用户需求》4.1.5【模式转换条件】|
FREQ12.1-6|从中继跟踪模式转出|《用户需求》4.1.6【模式转换条件】|
FREQ12.1-7|从速率阻尼模式转出|《用户需求》4.1.7【模式转换条件】|
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据需求，计算去往巡天模式机动过程中所需的目标姿态
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据姿轨控喷气规律计算结果，发出相应的喷气指令。
处理：同用户需求的。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：
 128ms周期计时（功能编号：FReq-13）。
处理： 设置128ms控制周期中断标志，计数器值为0时产生中断，不需要显示的重新装载。",0,0,0,0,0,0,0,1,0,0,0
功能描述：接收遥控固定参数注入块的光纤红外控制命令参数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：
  软件初始化结束后，开始进行各控制部件的初始化状态设置。
处理：（部件的开关 根据部件当前的加电状态、健康字进行，具体开关逻辑如下：） 
表5-1 程控流程
Ts周期（128ms）|操作内容|说明
""第0～78 Ts
(10s)""|""不控（10s）；
读取各部件加电状态及MRE重要数据；
判断ISU-C通讯状态：
累计健康次数大于等于5次，认为健康；否则为不健康；
说明：UPS健康字也在此期间读取，可进行滤波。""|""连续发送切换DPRU标志遥测数据；
等待DPRU通过1553B发送ISU-A、ISU-C的遥测数据；""
""第79～87Ts：
(1.024s)
""|""读取MRE重要数据(软件在程控期间读取2次即可)和模块加电状态：
发送SPE开关指令；
说明：为增加可靠性，软件中“发送SPE开关指令”操作2次。""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第88～198 Ts
(14.08s)""|""根据MRE重要数据和DPRU与当前份ISU-C通讯状态：（通过1553B总线向ISU-A发送下述指令）
开3+1S二浮陀螺X、Y、Z、S线路指令（无条件）；
2）开ISU-C指令（CIP）
（如果ISU-C通讯状态为不健康，则先关CIP-A/B，再根据MRE上CIP的健康状态，切换CIP）；""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第199～309 Ts：
(14.08s)""|""根据MRE重要数据和DPRU与当前份ISU-C通讯状态：（通过1553B总线向ISU-A发送下述指令）
开3+1S二浮陀螺X、Y、Z、S线路指令（无条件）；
2）开ISU-C指令（CIP）；
（如果ISU-C通讯状态为不健康，则先关CIP-A/B，再根据MRE上CIP的健康状态，切换CIP）；""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第310～419 Ts：
(14.08s)""|""根据MRE重要数据和ADIP、MPSDP、SADP的电源状态；（通过1553B总线向ISU-C发送下述指令）
开SADP指令；
开MPSDP指令；
说明：开SADP之前，先切换ADIP（根据供电关系）""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第420～529Ts：
(14.08s )""|""根据MRE重要数据和ADIP、MPSDP、SADP的电源状态；（通过1553B总线向ISU-C发送下述指令）
开SADP指令；
开MPSDP指令；
说明：开SADP之前，先切换ADIP（根据供电关系）""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第530～569Ts：
(5s)""|""根据MPSDP的电源状态；（通过1553B总线向ISU-C发送下述指令）
LV1/2开关指令；
MPSDP-A加电：开LV1；
MPSDP-B加电：开LV2；
双份加电：开LV1/2；
双份不加电：不操作""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第570～609s：
(5s)""|""根据MPSDP的电源状态；（通过1553B总线向ISU-C发送下述指令）
LV1/2开关指令；
MPSDP-A加电：开LV1；
MPSDP-B加电：开LV2；
双份加电：开LV1/2；
双份不加电：不操作""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；
""
第610～Ts：|空|
""第3910Ts：
（约500s）""|""置程控结束标志flgPCRun为TRUE；
模式初始化设置。""|参数设置

1）通用部件切换原则：A份健康开A份，A份不健康开B份；
2）MPSDP切换特殊原则：
      软件初始化5N推力器健康字时，是根据ISU-C送过来的5N推力器健康字来进行初始化；如果之后地面发送了设置5N推力器健康字遥控指令，则根据遥控指令来设置软件状态，同时将5N推力器健康字发送给ISU-C；
当两份MPSDP均健康时，根据5N推力器健康字状态：
如果两份健康字中有一份存在不健康的推力器，则开另一份；
如果两份健康字中均存在不健康的推力器，需要双份MPSDP加电。
3）MPSDP当班逻辑：
    MPSDP当班的逻辑在任务书的基础上进行适当完善：
如果两份健康字中均存在不健康的推力器，则A/B均当班；
单份加电，谁加电谁当班；
双分加电，默认A当班；	
若上电后双份均未加电，则按照MPSDP切换过程中开谁谁当班的原则。
4）ADIDP切换原则：
A份健康开A份，A份不健康开B份；
原则上不发ADIP关指令，如果双份均健康，则根据需要进行双份加电。
5）部件电源状态判断原则见任务书。
6）ISU-C二次电源供电：
ADIP-A供电给SADP-A、MPSDP-A、MPSDP-B；
ADIP-B供电给SADP-B、MPSDP-A、MPSDP-B；
7）程控期间，动量轮控制电压输出0V（数字量0x800）。",1,0,0,0,0,0,0,0,0,0,0
"计算机上电/复位后应用软件的工作流程如下。
图5-1应用软件初始化和复位处理流程",1,0,0,0,0,0,0,0,0,0,0
"功能描述：接收总线指令
处理： 将接收总线指令存储地址中内容解包成总线指令的数据格式，根据不同的总线指令进行相应的处理。其中侧摆指令仅在在模式1或9下响应。",0,0,0,0,0,0,0,0,0,1,0
功能描述：根据太阳矢量在帆板1法平面内投影与帆板法线之间的夹角，通过帆板驱动机构1控制帆板1，使帆板1能捕获及跟踪太阳。,0,1,0,0,0,0,0,0,0,0,0
功能描述：各个模式的初始化设置。,0,0,0,1,0,0,0,0,0,0,0
"功能描述：利用估计的四元数转换姿态角，送给星敏感器的四元数。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据加在CMG框架上的指令角速度而产生的期望角度与CMG框架产生的实际角度之差，自主诊断CMG框架的工作状态。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：为姿态机动提供的目标轨迹参考数据
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：与帆板通信，控制帆板并获得帆板状态数据。
处理：
见通信协议。
功能编号|功能|引用文档
FREQ70|初始化|中心控制单元与双轴帆板驱动线路通信协议
FREQ71|帆板使用要求|任务书、帆板协议
FREQ72|通信(串口)|任务书、帆板协议
FREQ73|通信故障处理|任务书
FREQ74|数据解包与转换|帆板协议
FREQ75|帆板数据有效性判断、处理|任务书
FREQ76|帆板模拟量采集、处理|任务书
FREQ77|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续64个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是D090H或者校验和错误或者未收到重要数据），上电或者复位后的前126个周期内，连续79个控制周期星箭分离信号均有效，则卫星自主转全捕对日模式；否则应用软件按照重要数据的初始值运行。则应用软件按照重要数据的初始值运行。应用软件只有在判断到星上时间为超过1257秒时，以及重要数据均正确的情况下，才使用重要数据恢复模式。若取到的重要数据正确，但取到的星时小于1257s，则需按重要数据文件要求取星时错误的要求进行模式恢复。,0,0,0,0,0,0,0,0,0,1,0
功能描述：接收遥控轨道参数注入块,0,0,0,0,0,0,0,0,0,1,0
功能：利用星敏感器A、B、C单独或组合定姿的方式，调用相应姿态修正程序。,0,0,1,0,0,0,0,0,0,0,0
功能描述：使卫星的角速度阻尼下来。,0,1,0,0,0,0,0,0,0,0,0
功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|平台陀螺数据的采集与处理|FREQ1.2.1|""平台陀螺1553B取数指令
""|陀螺1-4的速度增量|在通讯允许的条件下（每个陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|测微陀螺数据的采集与处理|FREQ1.2.2|""
遥测数据""|陀螺5-8的速度增量|从遥测数据中，获得陀螺数据并处理成对应的速度增量。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发送控制计算机计算得出的星历数据
处理：将控制计算机计算得出的星历数据打包后放到星历数据地址空间中。",0,0,0,0,0,0,0,0,0,0,1
功能描述：由模拟太阳A/B码、监视码得到模拟太阳角、见太阳标志。,0,0,0,0,0,0,0,0,1,0,0
"功能描述：发送天线数据包
",0,0,0,0,0,0,0,0,0,0,1
功能描述：根据给定电压乘电压/力矩系数和角动量变化率之差判断轮子的故障。,0,0,0,0,0,1,0,0,0,0,0
功能描述：帆板驱动线路数据处理 ,0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据红外信息，作姿态滤波修正。
处理：同用户需求的",0,0,1,0,0,0,0,0,0,0,0
功能描述：为三轴姿态喷气控制选择推力器。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：采集模拟太阳的数据，并处理成需要的数据格式。
处理：
（1）从A/D输入采集模拟太阳的角度数据
（2）从I/O输入采集模拟太阳的视场码",0,0,0,0,0,0,0,0,1,0,0
功能描述：接收BG与数传天线伺服控制器状态设置数据,0,0,0,0,0,0,0,0,0,1,0
功能描述：根据位置速度计算轨道参数,0,0,0,0,1,0,0,0,0,0,0
"功能描述：模拟量遥测 
",0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：遥测打包 
需求类别：其他 
软件需求描述：打包内容见“遥测”。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：遥测数据打包
处理： 
序号|功能点编号|功能描述
|FREQ4.2.1|四器巡航模式
|FREQ4.2.2|四器变轨模式
|FREQ4.2.3|组合体分离模式
|FREQ4.2.4|着上巡航模式
|FREQ4.2.5|着上轨控模式
|FREQ4.2.6|着上下降模式
|FREQ4.2.7|月面工作模式
|FREQ4.2.8|上升准备模式
|FREQ4.2.9|上升器巡航模式
|FREQ4.2.10|上升器轨控模式
",0,0,0,0,0,0,0,0,0,0,1
功能描述：根据帆板角误差、控制帆板跟踪太阳。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送姿态数据包、红外太阳敏感器数据包、星敏感器数据包、姿态控制数据包、天线数据包、轨道数据包、部件工作状态数据包、系统工作状态数据包、全姿态捕获模式数据包、模拟量遥测数据包。
处理：数据内容见《卫星控制分系统数字量遥测数据格式定义》。
要求应用软件设计时，对角速度相关的遥测参数采取平滑处理，并将处理后的结果遥测输出（高精度数据包中记录的角速度相关数据不采用平滑处理），平滑处理要求为本周期输出的遥测值为最近8个控制周期该遥测参数的平均值。需采取平滑处理的遥测参数包括不同定姿方式下的三轴角速度遥测（dφ/dθ/dψ、//、/）以及角速度误差遥测（//）。",0,0,0,0,0,0,0,0,0,0,1
"软件需求名称：遥测 
需求类别：其他 
软件需求描述：遥测打包。",0,0,0,0,0,0,0,0,0,0,1
"包括下表的功能点。
序号|功能描述|功能编号
|向ICU发送控制计算机重要数据|FREQ7.6.1
|向OBDH发送控制计算机重要数据|FREQ7.6.2

发送控制计算机重要数据的具体要求见重要数据文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据注入的时间，控制轨控发动机，完成初始轨道捕获和正常运行期间的轨道保持
处理过程：过程如下：
STEP1：进行姿态预估（见用户需求），得到姿态角和角速度
STEP2：令，：
STEP3：根据ZT6的值，计算得到：
STEP4：实现轨控开关机功能（见用户需求1.5），输出相应的状态标志及数据：
STEP5：进行轨控段喷气姿态控制（见用户需求）
STEP5：进行飞轮动量保持控制及飞轮启动（见用户需求）",0,0,0,1,0,0,0,0,0,0,0
"功能描述：星敏感器数据处理，安装偏差估计。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据-Y帆板角误差控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：CAN通信上行/下行数据的组帧和解包。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：星务接收、星务发送、快帧遥测1打包、快帧遥测2打包、轨道参数注入快帧打包、内存下卸快帧打包、慢帧遥测1打包、慢帧遥测2打包、慢帧遥测3打包、姿控广播、热控温度广播、重要数据打包、上行:目标星轨道、上行:数据指令响应处理、上行:固定地址注入解包、上行:可变地址注入解包、上行:轨道注入解包、上行:程序注入、上行:内存下卸指令注入、上行:部件指令、上行:任务块、重要数据返回解包、GNSS定位广播解包、整星广播对时解包、GNSS高精度秒脉冲对时广播解包、CAN总线使用要求",0,0,0,0,0,0,0,0,0,0,1
"软件需求标识：FREQ5 
软件需求名称：星时校正 
软件需求描述：星时校时。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收AOCC系统注入参数
处理：
当收到接收遥控注入结束标识消息后，将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。只有当某个块类型的所有数据都收到，且每块数据的校验和都正确时，才能使用此种类型的注入数据。注入的数据具体见上行注入文件。需要注意的是：地面注入ZT9时：若ZT9中为1的个数小于3个，则不改变星上ZT9的取值，如果等于3个，则BZ9=ZT9；应用软件不响应ZT1=2、ZT1=6、ZT1=8的注入指令。",0,0,0,0,0,0,0,0,0,1,0
"软件需求名称：帆板驱动装置的处理 
需求类别：其他 
软件需求描述：对帆板驱动装置的加断电等进行特殊处理。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：主动段模式初始化
处理：
- WorkMode（工作模式）：0（主动段）；
- StarTime（星上时间）：0.0；
- 俯仰磁力矩器线路主份工作；
- 星务校时：禁止星务校时；
- 均匀校时：禁止均匀校时；",1,0,0,0,0,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
处理：
OBDH重要数据有四块，大小共为256字节，AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：实现卫星星上自主或地面遥控下的自旋。为了节省内存，将此模式的代码从PROM中去掉。若需要此模式，则通过在轨注入的方式，将此模式引入控制。
处理过程：过程如下：
STEP1：进行姿态预估，得到姿态角和角速度
STEP2：令动量轮和磁力矩器的控制电压为0
STEP3：当ZT1 = D且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

根据ZT12向偏航和滚动发控制脉冲，处理完置ZT12为0
ZT12取值|处理
3|发偏航正脉冲0.5秒
C|发偏航负脉冲0.5秒
5|当时发滚动正脉冲0.5秒
A|当时发滚动正脉冲0.1秒
F|当L11 + L21 = 1时发滚动正脉冲0.5秒

STEP4：当ZT1 = F且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

确定的符号",0,0,0,1,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|卫星轨道计算|FREQ8|4.1.1|星上实时计算卫星轨道
|GPS计算|FREQ9|4.1.1.2|将GPS轨道确定参数转换成控制系统中太阳星历和地磁场计算所需的19个轨道参数
|光行差的修正参数和数字太阳敏感器输出角估值计算|FREQ10|4.1.2|计算光行差的修正参数，数字太阳敏感器输出角估值
|地磁场模型计算|FREQ11|4.1.3|星上实时计算地磁场强度
",0,0,0,0,1,0,0,0,0,0,0
