Requirements Description,功能需求/初始化,功能需求/控制计算/姿态控制,功能需求/控制计算/姿态确定,功能需求/控制计算/模式管理,功能需求/控制计算/轨道计算,功能需求/控制计算/运行时保障/故障诊断和处理,功能需求/控制计算/运行时保障/数据有效性判断,功能需求/控制输出,功能需求/数据采集,功能需求/遥控,功能需求/遥测
"序|需求名称|编号|功能及处理描述
|-Y帆板数据的采集与处理|FREQ7.3|选择通讯的-Y帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|+Y帆板数据的采集与处理|FREQ7.4|选择通讯的+Y帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|-Y帆板控制指令的输出处理|FREQ7.5|选择通讯的帆板-Y LTU，发送的控制指令。
|+Y帆板控制指令的输出处理|FREQ7.6|选择通讯的+Y帆板LTU，发送的控制指令。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：各模式初始化
序号|功能点编号|功能描述|说明
|FREQ3.4.2.1|等待段初始化|《用户需求》4.1.1【初始化】
|FREQ3.4.2.2|太阳定向模式初始化|《用户需求》4.1.2【初始化】
|FREQ3.4.2.3|恒星定向2初始化|《用户需求》4.1.3【初始化】
|FREQ3.4.2.4|惯性调姿模式初始化|《用户需求》4.1.4【初始化】
|FREQ3.4.2.5|恒星定向4初始化|《用户需求》4.1.5【初始化】
|FREQ3.4.2.6|轨控定向模式初始化|《用户需求》4.1.6【初始化】
|FREQ3.4.2.7|着陆准备模式初始化|《用户需求》4.1.7【初始化】
|FREQ3.4.2.8|主减速模式初始化|《用户需求》4.1.8【初始化】
|FREQ3.4.2.9|快速调整模式初始化|《用户需求》4.1.9【初始化】
|FREQ3.4.2.10|接近下降模式初始化|《用户需求》4.1.10【初始化】
|FREQ3.4.2.11|悬停模式初始化|《用户需求》4.1.11【初始化】
|FREQ3.4.2.12|避障模式初始化|《用户需求》4.1.12【初始化】
|FREQ3.4.2.13|缓速下降模式初始化|《用户需求》4.1.13【初始化】
|FREQ3.4.2.14|自主定位模式初始化|《用户需求》4.1.14【初始化】
|FREQ3.4.2.15|起飞准备模式初始化|《用户需求》4.1.15【初始化】
|FREQ3.4.2.16|垂直上升模式初始化|《用户需求》4.1.16【初始化】
|FREQ3.4.2.17|上升调姿模式初始化|《用户需求》4.1.17【初始化】
|FREQ3.4.2.18|轨道入射模式初始化|《用户需求》4.1.18【初始化】
|FREQ3.4.2.19|星光环月模式初始化|《用户需求》4.1.19【初始化】
|FREQ3.4.2.20|速率阻尼模式初始化|《用户需求》4.1.20【初始化】
|FREQ3.4.2.21|无控模式初始化|《用户需求》4.1.21【初始化】
",0,0,0,1,0,0,0,0,0,0,0
功能描述：发送矢量字,0,0,0,0,0,0,0,0,0,0,1
"功能：在完成对日定向后，由地面指令转入地球捕获。使用数字太阳敏感器和星敏感器定姿建立正常姿态。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：处理地面遥控注入的内存下卸指令注入
处理：解包内存下卸指令注入，得到内存下卸起始地址用于第七类快帧数据打包。
说明： 遥测数据指令采用16字节(有效使用9字节)格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,0,0,0,1,0
功能描述：对帆板驱动装置进行控制和诊断。,0,0,0,0,0,1,0,0,0,0,0
功能描述：动量轮摩擦力矩的补偿电压计算。,0,1,0,0,0,0,0,0,0,0,0
功能描述：接收轨道根数数据,0,0,0,0,0,0,0,0,0,1,0
功能描述：计算定点观测模式下的目标姿态TI C 和帆板理论转角。,0,0,1,0,0,0,0,0,0,0,0
功能描述：计算卫星偏流角，适用于地球椭球模型，星体姿态描述为转序。,0,0,0,0,1,0,0,0,0,0,0
功能描述：进行单轴相平面喷气控制规律计算。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：光纤陀螺取数指令及一体化红外指令
",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.3|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.4|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据轨控需求和姿控推力器使用情况，开推力器进行轨道控制
|轨道控制喷气|FREQ4.3|5.4.6|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1.1|地面站赤经赤纬计算
|数传天线指向控制|FREQ4.14|5.6.1|根据指令完成数传天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|基于三轴角动量反馈的偏置动量控制方法产品规范|FREQ4.21|/|规范化算法：
|数传天线指向目标角计算|FREQ4.14.2|5.6.1.2|根据指定跟踪数传天线与其被指定跟踪站的方位，计算其跟踪转角
",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：部件数据处理及状态选择 
需求类别：其他 
软件需求描述：部件数据采集、剔野和选择处理。",0,0,0,1,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。CCU应用软件取数消息与同步消息的发送时间间隔大于3ms
|红外2数据的采集与处理|FREQ1.3.2|""红外2
LTU取数指令""|红外2的数据|在通讯允许的条件下（红外2的当班标志为1），向红外2 LTU发取数指令，获得红外2数据并处理成对应的数据。
",0,0,0,0,0,0,0,0,1,0,0
"功能：利用红外、数字太阳敏感器确定姿态。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：接收总线指令 
需求类别：其他 
软件需求描述：接收并处理总线指令。",0,0,0,0,0,0,0,0,0,1,0
功能描述：根据CMG角动量及地磁场强度决定并输出磁棒控制电压。,0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：1553通信上行/下行数据的组帧和处理。 
软件需求描述：1553通信上行/下行数据的组帧和处理。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：遥测组帧、遥控接收、遥测帧头打包、遥测数据打包、下行：重要数据组帧、上行：数据指令处理、任务成像指令、上行：模式转换指令处理、上行：软件标志字指令处理、上行：控制参数指令处理、上行：变轨和位保指令处理、上行：部件加断电指令处理、上行：校时指令处理、上行：轨道注入指令处理、上行：部件数据转发指令处理、在轨维护指令处理、内存下传指令、重要数据保存、重要数据恢复",0,0,0,0,0,0,0,0,0,0,1
"功能描述：由平衡方程方法、陀螺自检信号和星敏感器数据进行陀螺的故障检测。

处理：(1)6个或5个陀螺参加诊断时，使用平衡方程进行诊断，并且若ZT35(3)=1地面允许自检信号引入诊断，则自检信号无效的陀螺分数减1。若ZT16(3)(4)=11，则星上自主选取定姿陀螺，否则由地面指定。
(2)4个陀螺参加诊断时，若ZT35(4)=0不允许星敏诊陀螺，则同(1)。
(3)3个陀螺参加诊断时，若ZT35(4)=0不允许星敏诊陀螺，则这3个陀螺就是定姿陀螺。
(4)4个或3个陀螺参加检测时，若ZT35(4)=1，则用星敏差分值诊陀螺。判分的阀值乘以，可以进行调整。当允许星上自主选取定姿陀螺时，仅当平衡方程不平衡时可以切换陀螺。",0,0,0,0,0,1,0,0,0,0,0
功能描述： 对部件电源加断电,0,0,0,0,0,0,0,1,0,0,0
"通讯串口
04H|波特率寄存器|RW|""波特率寄存器低位：0x04（115200）
0x18（19200）""
08H|波特率寄存器|RW|波特率寄存器高位：0x00
CAN总线初始化
寄存器名称|初始化内容|初始化意义
""CAN_ADDR        
(CAN总线地址)""|无。|无说明。
""控制寄存器
(Control Register)
""|0x07|""D7D6D5：保留。
D4：超载（接收设备不能按数据发送速率接收数据而造成的数据丢失）中断使能。
高：开放。低：禁止
D3：错误中断使能。
高：开放。低：禁止
D2：发送中断使能。
高：开放。低：禁止
D1：接收中断使能。
高：开放。低：禁止
D0：复位模式。
在初始化的时候，复位模式位置1，才可以进行初始化设置。""
命令寄存器(Command register)|0x=00001100|""D7D6D5：保留。必须。
D4：进入睡眠状态。
高：睡眠 。低：睡眠唤醒。
D3：清除超载状态。不产生超载中断。
高：清除。低：无动作。
D2：释放接收缓冲器。（读接收缓存器内容后，释放缓存器，以便其他报文立即可用）。
高：释放。低：无动作。
D1：夭折发送。
D0：发送请求。
高：报文即将发送。低：无动作。""
""验收代码寄存器
(Acceptance 
Code Register)""|0xa7=10100111|""当通过验收测试的报文被接收，且若存在空的接收缓存器，则各自的描述符和数据场被顺序存贮在空的缓存器中，在不存在空的接收缓存器的情况下，数据超载位被置位高(超载)，当完整的报文被正确接收，将出现下列操作：
接收缓存器状态位被置为高(满)
若接收中断开放位被置为高(开放)，接收中断被置为高(置位)
验收码位(AC.7~AC.0)和报文标识符的最高8位(ID.10~ID.3)必须等于由验收屏蔽位必须满足""
""验收屏蔽寄存器
((Acceptance 
Mask Register))""|0xf8|最后三位相关。
总线时序寄存器0(Bus Timing Register 0)|0x00|""总线时序寄存器的内容决定波特率预分频器(BRP)和同步跳转宽度(SJW)的数值。

通过总线定时器的内容，将波特率预分频器设置为2，即将输入的系统时钟二分频，由于输入的系统时钟已经是将计算机晶体频率14.7456MHz二分频，即7.3728MHz。所以这个时候时钟为3.6864 MHz。""
总线时序寄存器1(Bus Timing Register 1)|0x18|""采样（SAM）=1总线采样1次。
TSEG1和TSEG2确定每位周期的时钟周期数目和采样点位置：

由于一位周期是由

而

波特率＝""
""时钟分频器
(Clock Divider
register)""|0x40|""D7:CAN模式。
0：基本模式。
D5:1(旁路输入比较器，仅在复位模式下起作用)。""
""OCR
(output Control)""|0x|

在完成上述初始化后，要再次初始化控制寄存器。将最低位初始化为0。",1,0,0,0,0,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
平台陀螺通讯诊断及处理|进行平台陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
SpaceWire内总线通讯故障诊断|进行SpaceWire内总线通讯故障诊断
SpaceWire外总线通讯故障诊断|进行SpaceWire外总线通讯故障诊断
CAN总线通讯故障诊断|进行CAN总线通讯故障诊断
同步串口通讯故障诊断|进行同步串口通讯故障诊断
CMG通讯诊断及处理|进行CMG通讯故障诊断及处理
部件故障诊断|对部件进行故障诊断
陀螺故障诊断|由平衡方程方法、星敏感器数据、以及动力学输出对陀螺进行故障检测
CMG故障诊断|根据CMG输出数据和理论数据进行CMG故障检测
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
系统故障检测|根据姿态角和姿态角速度偏差数据进行系统故障的检测",0,0,0,0,0,0,1,0,0,0,0
"功能描述：已知扫描区域中心坐标和扫描范围后，计算扫描起点的目标姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：模式1切换方式。
处理：
若t >100，则WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得DSS、ASS、LSS数据；根据ZT14（2）（1）确定进行通讯的太阳LTU，发送取数指令，具体如下表所示
ZT14(2)(1)的值|进行通讯的太阳LTU|发送的取数指令
01|与之前通讯太阳LTU1或太阳LTU2进行通讯|""33H或
43H""
10|与之前通讯太阳LTU1或太阳LTU2进行通讯|""33H或
43H""
00或11|根据LTU故障诊断的结果决定太阳LTU的选取。初始状态为太阳LTU1|33H或43H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的12个字节数据，将数据根据LTU通讯协议转换，、L11~L15,L21~25。
（3）太阳LTU数据采集过程中的故障处理见本文的.1。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：用注入程序替代SRAM中对应程序块
处理：解包可变地址参数注入包，更新JumpSlot（下一周期软件根据JumpSlot中的ID转入JumpSlot指定的地址，运行替换后的注入代码）；
说明：JumpSlot是一结构数组，结构中的成员是被修改的模块的ID和注入模块的地址，定义如下：
struct OUMP_SLOT
{
unsigned int mole；
unsigned int *hr0；
unsigned int *hr1；
unsigned int *hr2；
}OSJump_Slot[8]",0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收AOCC重要数据包
处理：将接收AOCC重要数据包存储地址中内容解包成重要数据中的各个变量和参数。其处理过程如下：
STEP1：对接收的数据进行合法性判断；
STEP2：将接收的重要数据放入应用软件的缓存区中；
STEP3：解包相应的数据，并赋值给相应的变量。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,0,0,0,1
"功能描述：采集帆板归零信号，并处理成需要的数据格式。
处理：帆板归零的信号",0,0,0,0,0,0,0,0,1,0,0
"功能描述：卫星的10个工作模式切换方式。
处理：
对每个模式分别按照切换条件处理。见用户需求3.3节。
工作模式切换表
""换后
模式
切换
前模式""|Mode1|Mode2|Mode3|Mode4|Mode5|Mode6|Mode7|Mode8|Mode9
Mode0|1,2||||||||1,2
Mode1||1,2||||||2|1,2
Mode2|||2|2||||1,2|1,2
Mode3||2||1,2|||||1,2
Mode4||1,2|||1,2||||1,2
Mode5||1,2||1,2||1,2|||1,2
Mode6||1,2||2|1,2||1,2||1,2
Mode7||2|||1,2|1|||1,2
Mode8||1,2|||||||1,2
Mode9||1,2|||||||

说明：代号“1”表示自主进入；代号“2”表示地面/总线指令进入",0,0,0,1,0,0,0,0,0,0,0
功能描述：接收数据指令注入块的CMG串口指令,0,0,0,0,0,0,0,0,0,1,0
"功能描述：选择通讯的红外LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）红外共有两个LTU（正俯仰红外LTU和负俯仰红外LTU），AOCC每个控制周期向注入文件中的ZT5和IresLTUSeltFlag的最大组合中指定的红外LTU发送取数指令
（2）向选择的红外LTU发送完取数指令，获得红外LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：偏航捕获模式控制
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：向LTU和星敏感器发送自检指令，获得自检信息
处理：
（1）每0.524秒对1个部件LTU进行自检，依次为选通的太阳、选通的陀螺、选通的左和右帆板，每4个0.524秒对4个LTU自检一次；
(2）对红外LTU的自检见.3；
(3) 每4秒（8个0.524秒）发送一次星敏感器自检命令数据包（HK1包），；
(4)根据遥测格式将返回的自检信息通过OBDH传至地面。",0,0,0,0,0,0,0,0,1,0,0
功能描述：使用GPS轨道版数据进行GPS定轨。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、；输入陀螺自检信号GDi（i = 1，…，6）。
处理：
用户需求的的6(1)：陀螺脉冲当量；
用户需求的的6(2)
STEP1:A阵计算；
STEP2:",0,0,1,0,0,0,0,0,0,0,0
"包括下表的功能点。
序号|功能描述|功能编号
|向ICU发送控制计算机重要数据|FREQ7.6.1
|向OBDH发送控制计算机重要数据|FREQ7.6.2

发送控制计算机重要数据的具体要求见重要数据文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：星上自主检测陀螺故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的执行机构参数设定及诊断参数
处理：
调整CMG高速角动量与标称值偏差阀值系数的初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：转换动量轮脉冲得到轮子角动量。
处理：
控制系统配置4Nms平台动量轮4个（X、Y、Z、S）。平台动量轮每转18个脉冲，转/分钟对应4Nms。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：使星体−Z 轴对日定向，星体偏航姿态为零，适当时重捕地球。
",0,0,1,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的控制数据转换为消息需要的格式并输出。
MW数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发MW数据采集指令，获得ACU数据并处理成对应的MW的角动量。
部件加断电指令的处理|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每三个控制周期将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,0,0,0,1,0,0
"功能描述：
  软件初始化结束后，开始进行各控制部件的初始化状态设置。
处理：（部件的开关 根据部件当前的加电状态、健康字进行，具体开关逻辑如下：） 
表5-1 程控流程
Ts周期（128ms）|操作内容|说明
""第0～78 Ts
(10s)""|""不控（10s）；
读取各部件加电状态及MRE重要数据；
判断ISU-C通讯状态：
累计健康次数大于等于5次，认为健康；否则为不健康；
说明：UPS健康字也在此期间读取，可进行滤波。""|""连续发送切换DPRU标志遥测数据；
等待DPRU通过1553B发送ISU-A、ISU-C的遥测数据；""
""第79～87Ts：
(1.024s)
""|""读取MRE重要数据(软件在程控期间读取2次即可)和模块加电状态：
发送SPE开关指令；
说明：为增加可靠性，软件中“发送SPE开关指令”操作2次。""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第88～198 Ts
(14.08s)""|""根据MRE重要数据和DPRU与当前份ISU-C通讯状态：（通过1553B总线向ISU-A发送下述指令）
开3+1S二浮陀螺X、Y、Z、S线路指令（无条件）；
2）开ISU-C指令（CIP）
（如果ISU-C通讯状态为不健康，则先关CIP-A/B，再根据MRE上CIP的健康状态，切换CIP）；""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第199～309 Ts：
(14.08s)""|""根据MRE重要数据和DPRU与当前份ISU-C通讯状态：（通过1553B总线向ISU-A发送下述指令）
开3+1S二浮陀螺X、Y、Z、S线路指令（无条件）；
2）开ISU-C指令（CIP）；
（如果ISU-C通讯状态为不健康，则先关CIP-A/B，再根据MRE上CIP的健康状态，切换CIP）；""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第310～419 Ts：
(14.08s)""|""根据MRE重要数据和ADIP、MPSDP、SADP的电源状态；（通过1553B总线向ISU-C发送下述指令）
开SADP指令；
开MPSDP指令；
说明：开SADP之前，先切换ADIP（根据供电关系）""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第420～529Ts：
(14.08s )""|""根据MRE重要数据和ADIP、MPSDP、SADP的电源状态；（通过1553B总线向ISU-C发送下述指令）
开SADP指令；
开MPSDP指令；
说明：开SADP之前，先切换ADIP（根据供电关系）""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第530～569Ts：
(5s)""|""根据MPSDP的电源状态；（通过1553B总线向ISU-C发送下述指令）
LV1/2开关指令；
MPSDP-A加电：开LV1；
MPSDP-B加电：开LV2；
双份加电：开LV1/2；
双份不加电：不操作""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第570～609s：
(5s)""|""根据MPSDP的电源状态；（通过1553B总线向ISU-C发送下述指令）
LV1/2开关指令；
MPSDP-A加电：开LV1；
MPSDP-B加电：开LV2；
双份加电：开LV1/2；
双份不加电：不操作""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；
""
第610～Ts：|空|
""第3910Ts：
（约500s）""|""置程控结束标志flgPCRun为TRUE；
模式初始化设置。""|参数设置

1）通用部件切换原则：A份健康开A份，A份不健康开B份；
2）MPSDP切换特殊原则：
      软件初始化5N推力器健康字时，是根据ISU-C送过来的5N推力器健康字来进行初始化；如果之后地面发送了设置5N推力器健康字遥控指令，则根据遥控指令来设置软件状态，同时将5N推力器健康字发送给ISU-C；
当两份MPSDP均健康时，根据5N推力器健康字状态：
如果两份健康字中有一份存在不健康的推力器，则开另一份；
如果两份健康字中均存在不健康的推力器，需要双份MPSDP加电。
3）MPSDP当班逻辑：
    MPSDP当班的逻辑在任务书的基础上进行适当完善：
如果两份健康字中均存在不健康的推力器，则A/B均当班；
单份加电，谁加电谁当班；
双分加电，默认A当班；	
若上电后双份均未加电，则按照MPSDP切换过程中开谁谁当班的原则。
4）ADIDP切换原则：
A份健康开A份，A份不健康开B份；
原则上不发ADIP关指令，如果双份均健康，则根据需要进行双份加电。
5）部件电源状态判断原则见任务书。
6）ISU-C二次电源供电：
ADIP-A供电给SADP-A、MPSDP-A、MPSDP-B；
ADIP-B供电给SADP-B、MPSDP-A、MPSDP-B；
7）程控期间，动量轮控制电压输出0V（数字量0x800）。",1,0,0,0,0,0,0,0,0,0,0
"将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。
序号|功能描述|功能编号
|姿控数据块1|FREQ65.1
|变轨数据块|FREQ65.2
|轨道数据块|FREQ65.3
|动量轮参数块|FREQ65.4
|轮控系数块|FREQ65.5
|相平面控制参数块|FREQ65.6
|陀螺当量修正数据块|FREQ65.7
|红外太阳修正数据块|FREQ65.8
|星敏感器数据块|FREQ65.9
|故障判别因子系数块|FREQ65.10
|陀螺故障判别因子系数块|FREQ65.11
|全姿态捕获参数块|FREQ65.12
|SDC命令块|FREQ65.13
|LTU命令块|FREQ65.14
|程序块|FREQ65.15
|内存修改块|FREQ65.16
|姿控数据块2|FREQ65.17
|陀螺红外参数数据块|FREQ65.18
|星敏修正时无陀螺模式的修正参数块|FREQ65.19
|整星偏置动量数据块|FREQ65.20
|轨道注入保护参数块|FREQ65.21
|星敏感器程序块|FREQ65.22
|星敏感器程序注入控制块|FREQ65.23
|EEPROM程序操作块|FREQ65.24
|帆板命令块|FREQ65.25

具体内容见注入文件。",0,0,0,0,0,0,0,0,0,1,0
功能描述：光纤陀螺数据处理,0,0,0,0,0,0,0,0,1,0,0
功能描述：确定动量轮角动量数据的有效性。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示（十六进制）：
服务编码|发送的条件
12H|模式字转为8（侧摆机动）时
C3H|每隔1分钟或转模式时发送
3CH|上电/复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发一次；直到第60次为止
C0H|如果AOCC发生复位，利用方式代码请求服务，索取OBDH重要数据进行保存。若在大于0.25s的时间内仍未收到接收OBDH重要数据的指令，则重新请求服务，同时索要OBDH重要数据的计数器累加，若此计数器大于等于40，则不再索要OBDH重要数据。若索要OBDH重要数据成功，将此计数器清零。
96H|进入正常模式后发送，收到确认字后停止发送
30H|进入变轨模式后发送，收到确认字后停止发送
90H|进入全姿态工作模式后发送，收到确认字后停止发送
F0H|进入应急模式后发送，收到确认字后停止发送
0FH|进入停控模式后发送，收到确认字后停止发送
",0,0,0,0,0,0,0,0,0,0,1
功能描述：计算CMG的框架角速度。                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：修改奇异规避算法。,0,1,0,0,0,0,0,0,0,0,0
功能描述：判断陀螺故障，并选取可用的陀螺。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：选择通讯的星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输入：ZT6、inAPSLTUSeltFlag、星敏LTU返回的数据。
输出：星敏输出的四元数、相对时间和数据有效性标志。
处理：
（1）星敏共有两个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的星敏LTU发送取数指令。
（2）向选择的星敏LTU发送完取数指令后，获得星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：地面站赤经赤纬计算。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：接收AOCC重要数据1-4，并处理重要数据1中的内容。
处理：应急线路加电后与OBDH通信，获得陀螺和推力器状态，若连续3个控制周期都没有成功取得重要数据，默认陀螺使用7、8、9号，推力器使用主备份推力器，模拟式太阳敏感器使用ASS1和ASS21。由于AOCC可使用的陀螺为12个（陀螺1~12），可使用的陀螺为9个（陀螺1~9），因此，无法使用陀螺10~12的数据。当恢复AOCC重要数据后，若ZT9表明使用了陀螺10~12，则设置ZT9中陀螺10~12为不可用，陀螺7、8、9为可用，陀螺工作状态BZ9按照设置后的ZT9中由小到大的顺序（从陀螺1到陀螺9）选用3个陀螺。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：陀螺数据处理。
处理：
每个惯性姿态敏感器组件中，单个陀螺输出包括1个加速脉冲信号和1个减速脉冲信号。每个信号由1个20位计数器完成对信号的计数。计数器采用加计数方式，当脉冲数超过1048575时，计数器清零，重新计数，应用软件判断计数器溢出，数据为无符号数据。
本周期陀螺n（n＝1～6）加（减）速脉冲计数值(个)=（本周期加（减）脉冲数 － 上周期加（减）脉冲数）；
陀螺n角度增量( º)＝ （陀螺n加速脉冲计数值 – 陀螺n减速脉冲计数值）×陀螺脉冲当量。
对于陀螺n的脉冲数N需要分段处理：要求将每个陀螺量程范围-2.8º/s ~ +2.8º/s分为5段，每段使用不同的标度因数K，分段情况具体见任务书4.1.5.3节要求，当脉冲数超出范围时，则使用±2.8º/s时的标度因数",0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：上电和复位初始化 
需求类别：其他 
软件需求描述：系统软件上电复位后，调用应用软件AppInit函数，并根据初始化内容，启动任务
处理：
OBC上电/复位后，由系统软件引导应用软件运行。首先进行初始化，包括系统软件初始化和系统软件调用应用软件提供的初始化函数（AppInit）。启动任务并开始进行任务调度管理。 ",1,0,0,0,0,0,0,0,0,0,0
功能描述：动量轮转速采集 ,0,0,0,0,0,0,0,0,1,0,0
OBDH重要数据有两块，大小共为128字节，AOCC不做任何改动保存在RAM中。如果AOCC发生复位，应利用方式代码请求服务，索取OBDH重要数据进行保存。若在大于0.256s的时间内仍未收到接收OBDH重要数据的指令，则重新请求服务，同时索要OBDH重要数据的计数器累加，若此计数器大于等于40，则不再索要OBDH重要数据。若索要OBDH重要数据成功，将此计数器清零。,0,0,0,0,0,0,0,0,0,0,1
功能：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
功能描述： GPS定轨主程序，包括GPS数据有效、无效时的操作。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据红外输入，计算姿态偏差、弦宽误差估计与量测新息。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据太阳矢量在帆板1法平面内投影与帆板法线之间的夹角，通过帆板驱动机构1控制帆板1，使帆板1能捕获及跟踪太阳。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：选择星敏感器有效数据进行几何姿态确定，并在星敏无效情况下并采用陀螺数据进行姿态预估。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求标识：FREQ4 
软件需求名称：星时计算 
软件需求描述：星时计算。见“任务书”4.1.3.1“星时计算”。",0,0,0,0,0,0,0,0,1,0,0
功能描述：根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差。,0,1,0,0,0,0,0,0,0,0,0
功能描述：检测工作中的动量轮的故障并设置WheelState。,0,0,0,0,0,1,0,0,0,0,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
-Y帆板数据的采集与处理|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：俯仰通道喷气中断处理程序。
处理：将推力器1-8关掉",0,0,0,0,0,0,0,1,0,0,0
"功能描述：判断陀螺的使用范围。
",0,0,0,0,0,0,1,0,0,0,0
"此章节01星为“发送AOCC中继事件数据”，现删除，替换为“发送AOCC数据段黑匣子数据”
功能描述：发送AOCC数据段黑匣子数据",0,0,0,0,0,0,0,0,0,0,1
"功能描述：使用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：在Z轴已捕获太阳的条件下，完成对日定向及绕Z轴转动。
对日定向下，若在阳照区若连续3000秒无法对日成功，则根据地面指令，进行模拟太阳和数字太阳的自主切换，重新进行太搜，并将地面允许标志置为不允许。
进入条件：
偏航捕获及转对地定向，或{，FEA = 0}；
星敏感器全姿态捕获，星敏感器数据无效，或{FEA = 0，ZT3 = C}条件不成立
全姿态捕获，FSA0, { ZT1 = 3或BZ1 = 3 }
退出条件：
偏航捕获及转对地定向， FEA 0；
星敏感器全姿态捕获，星敏感器数据有效且{FEA = 0，ZT3 = C}条件成立
全姿态捕获，FSA＝0,或ZT1 3且BZ1  3 
处理过程：同用户需求的。
STEP1:FlagFSA=5
STEP2:调用姿态预估器(3)
STEP3:若ZT13≠4，使用模拟太阳定向
STEP4:若ZT13=4，使用数字太阳定向
STEP5:若BZ1 = 3，则调用运行段喷气姿态控制
STEP6:若BZ1 = 4，则调用轨控段喷气姿态控制
STEP7:若ZT2 = 2，FWi  C对工作的飞轮成立，则调用飞轮控制
STEP8:若ZT2  2或FWi<C对某一工作的飞轮成立，则输出控制电压清0。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：由-Z面姿控发动机(A1/A2/A3/A4/+X/-X)进行变轨。
处理
有姿控发动机姿控加变轨方式见用户需求5.3.1.3和姿控发动机变轨，cmg姿控方式见5.3.1.，两种方式由地面选取。",0,1,0,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的外1533B接收子地址内存管理区,0,0,0,0,0,0,0,0,0,1,0
功能：利用红外、数字太阳敏感器确定姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：与CMG通信，控制CMG并获得CMG数据。
处理：
功能编号|功能|引用文档
FREQ74|初始化|与CMG通讯协议
FREQ75|CMG使用要求|任务书
FREQ76|通信(串口)|与CMG通讯协议
FREQ77|通信故障处理|任务书
FREQ78|数据解包与转换|与CMG通讯协议
FREQ79|帆板数据有效性判断、处理|任务书
FREQ80|帆板模拟量采集、处理|任务书
FREQ81|部件在轨转发（在轨修改）|任务书
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：选择通讯的数传天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）数传天线有四个LTU，天线1和2各有两个互为备份。应用软件初始上电时不与数传天线通讯，与数传天线开始通讯的条件为：收到数传天线预指或复位总线指令和数传天线加电。停止与数传天线通讯的条件为：收到数传天线停止总线指令和数传天线断电。其中数传天线加断电状态由1553B的接收BG与数传天线伺服控制器状态设置数据命令来确定。同时也根据这个命令确定参与通讯的LTU。初始为选择主份，收到主切备时切换到备份；在备份通讯时，收到备切主时切换到主份。
（2）向数传天线LTU发完取数命令后，获得数传天线LTU返回的数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，具体参见LTU通讯协议件。
（3）数传天线LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：将陀螺有效输出数据，换算成卫星三轴角速度。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|平台陀螺数据的采集与处理|FREQ1.2.1|""平台陀螺1553B取数指令
""|陀螺1-4的速度增量|在通讯允许的条件下（每个陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|测微陀螺数据的采集与处理|FREQ1.2.2|""
遥测数据""|陀螺5-8的速度增量|从遥测数据中，获得陀螺数据并处理成对应的速度增量。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：采集22路数字太阳粗码、监视码和全开码。
处理：
采集方法：连续采集28路（中间有细码信息，处理时略过），采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,0,0,0,1,0,0
功能描述：喷气卸载进入和退出条件计算。,0,1,0,0,0,0,0,0,0,0,0
功能描述：计算机应急模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：使用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器；并记录喷气时间和次数等。
",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：应用软件初始化 
需求类别：其他 
软件需求描述：初始化函数为void AppInit(void )。在上电/复位时，系统软件调用此函数来完成应用软件的初始化。见“任务书”4.1.2.1“初始化函数”。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：根据星敏感器的输出数据判断陀螺故障。,0,0,0,0,0,1,0,0,0,0,0
功能描述：接收遥控轨道参数注入块,0,0,0,0,0,0,0,0,0,1,0
功能描述：由GPS得到轨道外推的16根数。,0,0,0,0,1,0,0,0,0,0,0
"包括下表的功能点。
序号|功能描述|功能编号
|从ICU接收控制计算机重要数据|FREQ7.7.1
|从OBDH接收控制计算机重要数据|FREQ7.7.2

接收控制计算机重要数据的具体要求见重要数据文件。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：CAN通信上行/下行数据的组帧和解包。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：星务接收、星务发送、快帧遥测1打包、快帧遥测2打包、快帧遥测3打包、快帧遥测4打包、快帧遥测5打包、姿态广播、星敏广播、陀螺广播、重要数据打包、上行:数据指令响应处理、上行:固定地址注入解包、上行:可变地址注入解包、上行:轨道注入解包、上行:程序注入、上行:内存下卸指令注入、上行:任务块、上行:地面站、重要数据返回解包、GPS定位广播解包、整星广播对时解包、GPS高精度秒脉冲对时广播解包、CAN总线使用要求",0,0,0,0,0,0,0,0,0,0,1
功能：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
功能描述：利用陀螺确定出卫星对目标的姿态四元数。,0,0,1,0,0,0,0,0,0,0,0
功能描述：正常对地运行模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：发送高精度姿态数据
处理：每个控制周期查询一次是否需要进行数据打包，若需要，则进行数据打包。",0,0,0,0,0,0,0,0,0,0,1
功能描述：帆板驱动机构切换。,0,0,0,0,0,0,0,1,0,0,0
"功能描述：星敏感器数据处理，安装偏差估计。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：CAN通信上行/下行数据的组帧和处理。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：遥测组帧、遥控接收、遥测帧头打包、遥测数据打包、下行：重要数据组帧、上行：数据指令处理、上行：模式转换指令处理、上行：软件标志字指令处理、上行：控制参数指令处理、上行：变轨和位保指令处理、上行：部件加断电指令处、上行：校时指令处理、上行：轨道注入指令处理、上行：部件数据转发指令处理、在轨维护指令处理、重要数据保存、重要数据恢复",0,0,0,0,0,0,0,0,0,0,1
"功能描述：计算正常飞行模式轮控所需电压。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据红外信息，作姿态滤波修正。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|给VIPPCU发送轮询和校时包|FREQ1.8.1|""无
""|校时等数据|在每个控制周期与VIPPCU通讯时，在“轮询与校时包”中发送本周期的控制UTC时间
|VIPPCU加电状态状态数据的采集与处理|FREQ1.8.2|""加电状态
""||CCU通过采集来自VIPPCU的 “VIPPCU A机加电状态”、“VIPPCU B机加电状态”两个0～5V模拟量，来确定VIPPCU的A、B机加电状态。
|给VIPPCU发送的下平台控制数据|FREQ1.8.3|无|控制数据|CCU给VIPPCU发送的下平台控制数据。
|给VIPPCU发送CCU的重要数据|FREQ1.8.5|无|CCU的重要数据|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|给VIPPCU发送VIPPCU的重要数据|FREQ1.8.6|无|VIPPCU的重要数据|给VIPPCU发送VIPPCU的重要数据
|转发VIPPCU上注指令参数块|FREQ1.8.7|无|VIPPCU上注指令参数块|需要时，转发VIPPCU上注指令参数块
|接收VIPPCU遥测数据|FREQ1.8.8|VIPPCU遥测数据|无|每个控制周期，接收VIPPCU遥测数据，解包成需要的数据
|接收CCU重要数据返回包|FREQ1.8.9|CCU重要数据|指令|上电/复位后应用软件首先从VIPPC恢复重要数据。
",0,0,0,0,0,0,0,0,1,0,0
"功能：利用星敏感器B 、C的测量，修正姿态四元数与估计角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用星敏感器和陀螺输出计算姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
在模式切换中以地面上行注入优先，所有模式都可以通过地面注入的模式运行类指令进行转换。下面主要分析自主转换换条件与过程，具体转换条件见用户需求4.1~4.11的模式转换条件。4.4姿态机动模式喷气机动转对地或保持的条件中姿态角控制量判据中由0.000262mΦM4改为0.0262mΦM4。    ",0,0,0,1,0,0,0,0,0,0,0
"软件需求名称：故障诊断和处理 
需求类别：其他 
软件需求描述：《用户需求》4.8。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.8.1|陀螺故障检测及选择|《用户需求》4.8.1|
FREQ12.3-R4.8.2|加计故障检测及选择|《用户需求》4.8.2|
FREQ12.3-R4.8.3|星敏感器故障检测及选择|《用户需求》4.8.3|
FREQ12.3-R4.8.4|帆板驱动机构故障检测及选择|《用户需求》4.8.4|
FREQ12.3-R4.8.5|动量轮故障检测及选择|《用户需求》4.8.5|
FREQ12.3-R4.8.6-K|推进系统故障检测及选择|《用户需求》4.8.6|
FREQ12.3-R4.8.7-K|系统故障检测及选择|《用户需求》4.8.7|
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。
功能编号|功能|引用文档
FREQ53|初始化|星敏协议
FREQ54|星敏使用要求|任务书
FREQ55|通信|星敏协议
FREQ56|通信故障处理|任务书
FREQ57|数据解包与转换|星敏协议
FREQ58|星敏数据有效性判断、处理|任务书
FREQ59|星敏模拟量采集、处理|任务书
FREQ60|部件在轨转发（在轨修改）|任务书

3）GPS高精度校时与星敏感器数据的使用
功能描述：根据GPS秒脉冲，秒脉冲广播，进行GPS高精度校时和星敏感器时标处理。
输入：地面遥控指令，GPS秒脉冲，秒脉冲广播，星敏感器数据。
输出：星时，时标，星敏感器数据广播。
处理：",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|轨道与星历|FREQ2.0|5.1.1|卫星轨道、太阳星历、地面站位置、地磁场强度等计算程序的主流程。
|卫星轨道计算|FREQ2.1|5.1.2|计算卫星当前轨道
|GPS轨道数据有效性判断|FREQ2.2|5.1.3|对GPS轨道数据的有效性进行判断
|GPS轨道版轨道计算|FREQ2.3|5.1.4|利用GPS轨道版数据进行GPS定轨程序
|近圆中低轨卫星轨道根数外推算法产品规范|FREQ2.5|/|规范化算法：
|近圆中低轨卫星GPS轨道计算算法算法产品规范|FREQ2.6|/|规范化算法：
|岁差章动矩阵计算算法算法产品规范|FREQ2.7|/|规范化算法：
|4阶星上地磁场计算方法算法产品规范|FREQ2.8|/|规范化算法：
|光行差计算算法产品规范|FREQ2.9|/|规范化算法：
|轨道、目标姿态预计算|FREQ2.10|5.1|完成下一控制周期的轨道星历与目标姿态计算。
",0,0,0,0,1,0,0,0,0,0,0
功能描述：轨控姿态机动模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：三轴稳定模式下的帆板控制。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送控制计算机指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,0,0,0,1
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|""5.2.1
""|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估对地姿态|FREQ3.3|5.2.3|根据陀螺测量输出，一步预估卫星姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|基于红外滤波的卫星姿态确定|FREQ3.6|5.2.6|根据陀螺预估结果和红外(和数字太阳)输出，确定卫星姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|红外与太阳双矢量定姿|FREQ3.9|5.2.9|利用红外、数字太阳敏感器确定姿态
|星敏感器相对基准标定|FREQ3.10|5.2.10|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.11.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.11.2|进行卫星姿态四元数的重置
|三轴欧拉姿态角预估算法产品规范|FREQ3.1.1|/|规范化算法：
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法算法产品规范|FREQ3.1.3|/|规范化算法：
|基于红外测量的红外滤波修正算法产品规范|FREQ3.1.4|/|规范化算法：
|基于单星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.6|/|规范化算法：
|基于红外与太阳矢量的双矢量定姿算法算法产品规范|FREQ3.1.7|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.2|
|正常、偏置飞行目标姿态计算|FREQ3.12.1|5.3.2.1|正常与偏置姿态飞行时的目标姿态计算
|点对点机动目标姿态计算|FREQ3.12.2|5.3.2.2|点对点机动目标姿态计算
|姿态预置过程目标姿态计算|FREQ3.12.3|5.3.2.3|姿态预置过程目标姿态计算
|非沿迹目标姿态计算|FREQ3.12.4|5.3.2.4|角速度建立过程目标姿态计算
|轨控目标姿态计算|FREQ3.12.5|5.3.2.5|轨控目标姿态计算
|轨控姿态机动轨迹初始化|FREQ3.12.6|5.3.1.4|轨控模式目标姿态计算初始化
|正弦轨迹规划算法算法产品规范|FREQ3.12.7|/|规范化算法：
|基于加速度导数为正弦函数的轨迹规划算法算法产品规范|FREQ3.12.8|/|规范化算法：
|点对点姿态机动初始化处理|FREQ3.13|5.3.1.1|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|非沿迹跟踪初始化|FREQ3.14|5.3.1.2|非沿迹跟踪初始化，计算地心张角和方向矢量
|计算多项式轨迹系数|FREQ3.15|5.3.3.1|根据轨迹规划时间，初始姿态/姿态角速度和目标姿态/姿态角速度计算基于多项式轨迹规划的轨迹系数
|姿态预置机动目标姿态确定|FREQ3.16|5.3.3.2|基于多项式曲线的轨迹规划，计算目标姿态
|非沿迹目标姿态角计算|FREQ3.17|5.3.4|根据所指定的扫描起始经纬度和末端点经纬度
|偏流角计算|FREQ3.18|5.3.5|适用于地球椭球模型，星体姿态描述为转序，计算基于星体光轴(与星本体＋Z轴平行)下的偏流角
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|增量式偏流角计算算法产品规范|FREQ3.21|/|规范化算法：
|凝视过程目标姿态计算|FREQ3.22|5.3.2.6|凝视过程中计算三轴目标姿态
|陀螺标定过程目标姿态计算|FREQ3.25.0|5.15.1|陀螺标定全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角
|目标姿态计算初始化|FREQ3.25.1|5.15.1.1|对陀螺标定过程中涉及到的两次机动过程进行机动姿态计算的初始化
|惯性姿态点对点机动轨迹规划|FREQ3.25.2|5.12.1.2|对陀螺标定过程所涉及到的两次点对点机动进行轨迹规划
|角速度起速保持与减速过程轨迹规划|FREQ3.25.3|5.12.1.3|对陀螺标定过程中的速度运行进行轨迹规划
|大角速度标定的分档确定|FREQ3.25.4|5.12.1.4|根据实现指向的4挡速度，根据当前的速度的幅值，确定所标定的陀螺刻度因子的位置
|惯性定向时转阶段处理|FREQ3.25.5|5.12.1.5|陀螺标定在第1段中完成惯性定向，并在此期间标定陀螺真实常漂。在惯性定向转速度运行结束时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等。
|速度运行时转阶段处理|FREQ3.25.6|5.12.1.6|SubMode= 2~9，陀螺按照规定的角速度完成起速、恒速运行、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等
|速度曲线规划|FREQ3.25.7|5.12.1.7|根据所选择的机动轨迹，规划出角速度变化曲线
|陀螺标定算法|FREQ3.26.0|5.12.2|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺常漂修正标志确定|FREQ3.26.1|5.12.2.1|对陀螺标定过程中，陀螺常漂的修正标志进行确定。当星体达到了规定的惯性角速度时，开始进行陀螺常漂估计
|基于星敏陀螺滤波的等效常漂估计|FREQ3.26.2|5.12.2.2|采用星敏陀螺滤波的方法对陀螺等效常漂进行估计
|星敏陀螺滤波的陀螺等效常漂记录|FREQ3.26.3|5.12.2.3|对陀螺等效常漂，选取稳态时的一段数据进行平均，得到各个角速度下的等效常漂和星体真实角速度的估计值
|小角速度时的陀螺安装误差和刻度因子误差估计|FREQ3.26.4|5.12.2.4|经过N次速度机动后，对陀螺的测量模型进行标定，给出标定结果
|大角速度时的陀螺标定算法|FREQ3.26.5|5.12.2.5|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺在轨标定时的控制量计算|FREQ3.27|5.12.3|对标定过程中的控制量进行计算
|陀螺安装误差标校结果引入|FREQ3.28|5.12.4|对陀螺完成标定后，待地面确认标定结果无误后，将陀螺的标定结果进行赋值。当地面注入FP__MountingCmp时执行本程序一次
|陀螺刻度因子误差标校结果引入|FREQ3.29|5.12.5|完成陀螺标定，待地面确认无误后，对陀螺的刻度因子进行在轨标校。标校时，取陀螺输出的角速度与与之最接近的两个已标定的特征角速度进行线性插值标校
|惯性定向期间目标姿态计算|FREQ3.30|5.3.2.7|""惯性调姿过程中的姿态机动目标姿态计算，当航天器从轨道系姿态进入时，首先进入submode0，进行轨道角速度的削除，之后进行惯性调姿。在转出时，若后续姿态为轨道系姿态，需要建立轨道角速度
""
|轨道角速度建立目标姿态计算|FREQ3.31|5.3.6|""在惯性定向与轨道系姿态保持之间切换时，进行轨道角速度的建立或削除 
""
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用A头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.10
STEP1：计算；FM3更改：若，则：，FSTD=1；
STEP2：计算，。的各项乘以，的各项乘以。
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,0,1,0,0,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
甚高陀螺通讯故障诊断|大量程通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
部件故障诊断与处理|确定各敏感器和执行机构故障诊断及处理
动量轮故障检测|检测工作中的大力矩飞轮的故障
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式7的系统故障诊断|在模式7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
磁力矩器数模一致性诊断|磁力矩器数模一致性诊断
DSS输出一致性诊断|DSS输出一致性诊断
ASS1输出一致性诊断|ASS1输出一致性诊断
ACU 1553B接收故障诊断及处理|由于卫星的执行机构控制均需通过ACU进行，当ACU接收控制指令内存区异常将导致卫星失去控制能力，因此有必要对ACU接收执行机构控制指令的正确性进行判断。在检测到执行机构控制指令接收校验和异常后CCU需要自主进行处理",0,0,0,0,0,0,1,0,0,0,0
功能描述：根据指令完成数传天线的指向控制。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：把陀螺数据测量值变换为星体三轴角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能编号：FREQ42
功能描述：为三轴姿态喷气控制选择喷管；并记录喷气时间等。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：确定轨道外推初值，并调用轨道计算。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令。
（2）向帆板LTU发完取数命令后，获得LTU返回数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。
（3）帆板LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
功能描述：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
功能描述：接收同步字,0,0,0,0,0,0,0,0,0,1,0
功能描述：根据陀螺输入，预估卫星惯性姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送姿态数据
处理：
AOCC每个控制周期（250ms）组织24个字节姿态数据，OBDH每500ms取1次姿态数据（48个字节）。每个数据包中的2个姿态的时标需按照时间顺序排列。",0,0,0,0,0,0,0,0,0,0,1
功能描述：计算太阳星历、红外补偿量及光行差计算。。,0,0,0,0,1,0,0,0,0,0,0
功能描述：计算光行差的修正参数，数字太阳敏感器输出角估值。,0,0,0,0,1,0,0,0,0,0,0
"软件需求名称：遥测打包 
需求类别：其他 
软件需求描述：打包内容见“遥测”。",0,0,0,0,0,0,0,0,0,0,1
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：按通讯协议要求进行设置
SpaceWire总线（外总线）初始化：按通讯协议要求进行设置
CAN总线（外总线）初始化：按通讯协议要求进行设置，
变量初始化""
|复位初始化|FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置
SpaceWire总线（外总线）初始化：按通讯协议要求进行设置
CAN总线（外总线）初始化：按通讯协议要求进行设置，
变量初始化""",1,0,0,0,0,0,0,0,0,0,0
"软件需求标识：FREQ18 
软件需求名称：模拟太敏数据处理 
需求类别：其他 
软件需求描述：模拟太敏数据处理。",0,0,0,0,0,0,0,0,1,0,0
功能描述：发送姿态控制数据包2,0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据陀螺输入，预估卫星惯性姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据需求，计算去往巡天模式机动过程中所需的目标姿态
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向帆板LTU发完取数命令后，获得LTU返回数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。具体参见LTU通讯协议件。
（3）帆板LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
功能描述：卫星丢失姿态后，利用红外地球敏感器直接捕获地球，建立正常对地姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：与星敏感器通讯，获得星敏感器数据。
处理：
在使用Astro10星敏感器之前需对星敏感器进行初始化，完成后向星敏感器发出R有效信号，并通过串行口得到星敏感器提供的数据。在AO与星敏感器通信过程中，AO始终处于主动状态。当AO发出R信号下降沿后星敏感器在5ms内返回数据，AO在接收完数据后把R信号置高电平，星敏感器在R信号的上升沿之后的1ms内停止发送数据。
tro10星敏感器通讯故障时，不使用Astro10星敏感器数据进行姿态修正。",0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：推进系统操作 
需求类别：其他 
软件需求描述：对自锁阀、推力器进行操作。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：根据红外信息，进行全姿态捕获
",0,0,1,0,0,0,0,0,0,0,0
功能描述：为三轴姿态喷气控制选择推力器。,0,1,0,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发动机关机中断信号处理                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：
应用软件处理发动机关机中断信号，信号源为3路伽玛关机信号，应用软件查到关机后，立触地关机标志有效，发7500N关机指令。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：卫星绕滚动轴转动，直到满足姿态角条件，进入下一阶段俯仰捕获。姿态确定由红外和陀螺。姿态控制是喷气控制
",0,0,1,0,0,0,0,0,0,0,0
功能描述：星上自主检测动量轮故障。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：更新地面遥控注入的可变地址参数并处理

处理：解包可变地址数据包，更新相应地址的参数。
可变地址参数注入时，星务分系统向GNCC送数采用8字节(有效使用1字节)帧格式，最多同时注入15个数据。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,0,0,0,1,0
"软件需求标识：FREQ15 
软件需求名称：光纤陀螺数据处理 
需求类别：其他 
软件需求描述：光纤陀螺数据处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据标志选择轨控发动机。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：计算三轴的轮控力矩。
处理：
STEP1:分别计算P,I,D项。，的限幅值可以通过内存修改；，的限幅值可以通过内存修改。计算公式见（1）；
STEP2:PID加补偿的控制律计算。若{BZ1≠8(侧摆机动)或（BZ1=8且ZT43(3)=1允许侧摆机动引入结构滤波器）}且ZT39(4)=1引入结构滤波器，则调用结构滤波器算法得到，。计算公式见（2）；
STEP3:若ZT8≤3姿控发动机可用，ZT2=2飞轮整星零动量控制模式，BZ1≠1（三轴稳定正常轨道运行姿态）或2（偏航机动并稳定运行）或8（侧摆机动）或9（侧摆角保持），则：
若或，则=0.01；
若或，则=0.01；
若或，则=0.01。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：检测动量轮的故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：接收地面指令，用星敏测量数据更新四元素。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：减小卫星的俯仰角。
输入：陀螺数据输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）、见太阳状态、故障标志IRES_FLAG
红外弦宽
红外数据处理（全姿态捕获）的输出，",0,0,1,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|功能描述|功能编号
0|主动段模式控制|FREQ6.1
1|入轨段消初偏模式控制|FREQ6.2
2|正飞模式控制|FREQ6.3
3|大角度机动模式控制|FREQ6.4
4|正常运行模式控制|FREQ6.5
5|轨控模式控制|FREQ6.6
6|SAR未展开模式控制|FREQ6.7
7|帆板未展开模式控制|FREQ6.8
8|偏置动量控制模式控制|FREQ6.9
9|全姿态捕获模式控制|FREQ6.10
A|应急安全模式控制|FREQ6.11
B|停控模式控制|FREQ6.12

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断见用户需求的3.3。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收总线指令
处理： 将接收总线指令存储地址中内容解包成总线指令的数据格式，根据不同的总线指令进行相应的处理。",0,0,0,0,0,0,0,0,0,1,0
功能描述：进行单轴相平面分区及控制规律计算。,0,1,0,0,0,0,0,0,0,0,0
功能描述：对动量轮、推力器和磁力矩器控制指令的处理 ,0,0,0,0,0,0,0,1,0,0,0
"功能描述：使用星敏感器A、C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：轨控姿态机动模式控制
",0,0,0,1,0,0,0,0,0,0,0
功能描述：接收BG与数传天线伺服控制器状态设置数据,0,0,0,0,0,0,0,0,0,1,0
"功能描述、输入、输出、计算公式见《用户需求》4.7.1~4.7.4。
序号|功能点编号|功能描述|说明
|FREQ3.4.9.1|轨控开关机|《用户需求》4.7.1
|FREQ3.4.9.2|轨控发动机选择A|《用户需求》4.7.2
|FREQ3.4.9.3|轨控发动机选择B|《用户需求》4.7.3
|FREQ3.4.9.4|轨控发动机选择C|《用户需求》4.7.4
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：与星敏感器通讯获得星敏感器数据是否可以用来定姿。
",0,0,0,0,0,0,0,0,1,0,0
功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移,0,0,1,0,0,0,0,0,0,0,0
功能描述：CMG启动模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：，
输出：保持角动量所需电压， 
      角动量偏差积分项：，
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：模式6切换方式。
处理：
if() 置WorkMode=5；若，若，WorkModeT=6；
if() 置WorkMode=5；若，若，WorkModeT=6；
若且且 ，置WorkMode＝7；
if(且且且且AutoPermission=1) 置WorkMode=5；WorkModeT=4；；//阴影区进入阳照区自主转对日定向；可注入修改，初值为1；
if(且且且且且AtuoPermission=1) 置WorkMode=5；WorkModeT=4；；//南纬60度强制转对日定向，为纬度系数，可注入修改，该条件优先于下一个条件
if( 且且且) 置WorkMode=5；WorkModeT=6；；；//程控指令自主转对地姿态
收到星务的“对日定向” 指令，置WorkMode=5；WorkModeT=4；；；//成像任务完成后指令转入对日定向，并清除辐射定标目标角
收到星务的“辐射定标”指令，置WorkMode=5，WorkModeT=6，；//辐射定标模式，为注入的辐射定标目标角
若FailureFlag=1，置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：用整星广播时间校正星上时间
处理：解包广播校时数据，
- 若为星务UTC校时，计算星务星箭分离星时；
- 若当前星时与星务星箭分离星时相差绝对值小于dt，则实施校时；否则不校时。
- 校时成功后，更新星敏、CCD、微波测距仪、可见光相机的同步信号基准时刻。
说明：上电/复位时，dt = 200秒；成功校时后，dt = 10秒",0,0,0,0,0,0,0,0,0,1,0
"功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：确定ASS21，ASS22，ASS31，ASS32 及帆板转角的信号选取。,0,0,0,0,0,0,1,0,0,0,0
"软件需求名称：动量轮使用及通信（5m不配置） 
需求类别：其他 
软件需求描述：与动量轮通信，输出本周期电压。采集动量轮电源状态、转速、模拟量等信息。
处理：
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
动量轮初始化|FREQ57|动量轮初始化|B|2
动量轮数据采集|FREQ58|动量轮数据采集|B|3
通信(DA输出、脉冲输入)|FREQ59|通信(DA输出、脉冲输入)|B|4
数据解包与转换|FREQ60|数据解包与转换|B|
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：根据陀螺输入，予估卫星对地姿态。

处理：
STEP1:计算；
STEP2:计算，区分工作模式BZ1=1（三轴稳定正常轨道运行姿态）或8（侧摆机动）或9（侧摆角保持），BZ1≠1和8和9两种情况；
STEP3:计算；
STEP4:若BZ1=1（三轴稳定正常轨道运行姿态）或2（偏航机动并稳定运行）或6（轨控期间），；
STEP5:若BZ1=1（三轴稳定正常轨道运行姿态），则；
STEP6:若BZ1=8（侧摆机动），则，；
STEP7:若BZ1=9（侧摆角保持），则，；
STEP8:若BZ1=B（入轨段控制模式）且(消初偏结束时刻)。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：使星体−Z 轴捕获太阳。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：估计各个加速度计零位漂移增量
",0,0,1,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0 |主动段|FREQ52
1|入轨段控制|FREQ53
2|巡天观测模式|FREQ54
3|定点观测模式|FREQ55
4|小天区扫描模式|FREQ56
5|姿态机动|FREQ57
6|轨控|FREQ58
7|捕获太阳并对日定姿模式|FREQ59
8|帆板未展开|FREQ60
9|无控|FREQ61
10|应急模式|FREQ62

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制见用户需求的4。主要模式的姿态确定调用流程的功能点如下：
序号|功能编号|功能描述|用户需求中对应章节
|FREQ53.1|对日定向姿态确定调用流程|5.2.1.1
|FREQ54.1|巡天模式姿态确定调用流程|5.2.1.2
|FREQ55.1|定点观测模式姿态确定调用流程|5.2.1.3
|FREQ56.1|小天区扫描模式姿态确定调用流程|5.2.1.4
|FREQ57.1|姿态机动模式姿态确定调用流程|5.2.1.5
|FREQ58.1|轨控模式姿态确定调用流程|5.2.1.6
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：决定利用星敏感器A、B、C单独或组合定姿的方式，调用相应姿态修正程序。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：计算速度增量关机喷气时间
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：判断陀螺的使用范围。
输入：	本控制周期内采样的陀螺角度增量 (量纲：弧度) （=,…,）
      	上周期陀螺数据
      	标志 N_GyroDiagnV
处理
对陀螺数据进行有效性判断。若某个陀螺故障或某个陀螺为新上电，则不进行有效性判断（陀螺不引入）。其中陀螺新加电有三种情况1、判断出陀螺故障且允许自主加电情况下，应用软件自主加电。2、数据指令加电。3、脉冲遥控指令加电。对于新加电陀螺，则在该陀螺加电时间小于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为0；当该陀螺加电时间大于等于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为1。
若SLTU陀螺不加电或该陀螺故障，不引入。当“允许使用电源状态诊断陀螺”时，应用软件根据与SLTU通讯得到的陀螺电源状态确定陀螺加断电状态；当“不允许使用电源状态诊断陀螺”时，应用软件只根据数据指令确定陀螺加断电状态。若SLTU得到的六个电源状态均断电，则不根据电源状态判断陀螺是否加电。",0,0,0,0,0,0,1,0,0,0,0
功能描述：接收数据指令注入块的模式运行类指令,0,0,0,0,0,0,0,0,0,1,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|主动段模式控制|FREQ44.0|3.3.0|主动段模式调用流程
|入轨消初偏模式控制|FREQ44.1|3.3.1|入轨消初偏模式调用流程
|红外引入对地粗定向模式控制|FREQ44.2|3.3.2|红外引入对地粗定向模式调用流程
|动量轮启动模式控制|FREQ44.3|3.3.3|动量轮启动模式调用流程
|正常轨道运行模式控制|FREQ44.4|3.3.4|正常轨道运行模式调用流程
|轨控模式1模式控制|FREQ44.5|3.3.5|轨控模式1模式调用流程
|由正常姿态进行姿态机动模式控制|FREQ44.6|3.3.6|由正常姿态进行姿态机动模式调用流程
|轨控模式2模式控制|FREQ44.7|3.3.7|轨控模式2模式调用流程
|由轨控姿态机动回正常轨道运行模式控制|FREQ44.8|3.3.8|由轨控姿态机动回正常轨道运行模式调用流程
|全姿态捕获模式控制|FREQ44.9|3.3.9|全姿态捕获模式调用流程
|应急安全模式模式控制|FREQ44.10|3.3.10|应急安全模式模式调用流程
|停控模式控制|FREQ44.11|3.3.11|停控模式调用流程
|帆板未展开模式控制|FREQ44.12|3.3.12|帆板未展开模式调用流程
|偏置动量控制模式控制|FREQ44.13|3.3.13|偏置动量控制模式调用流程

主动段模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的3。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据红外输出，估计卫星姿态与陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
