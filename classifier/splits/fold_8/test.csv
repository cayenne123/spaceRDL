Requirements Description,功能需求/初始化,功能需求/控制计算/姿态控制,功能需求/控制计算/姿态确定,功能需求/控制计算/模式管理,功能需求/控制计算/轨道计算,功能需求/控制计算/运行时保障/故障诊断和处理,功能需求/控制计算/运行时保障/数据有效性判断,功能需求/控制输出,功能需求/数据采集,功能需求/遥控,功能需求/遥测
"功能描述：根据指令完成数传天线的指向控制。
输入：
数传天线(j=1,2)跟踪地面站编号i，跟踪起始时刻ti，地面站i在惯性系指向，被数传天线(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线(j=1,2)跟踪的地面站i的矢量在本体系的表示。（i可为1~7）。",0,1,0,0,0,0,0,0,0,0,0
"应用软件共分15个工作模式，分别是主动段、入轨段控制模式、CMG启动模式、正常对地运行模式、姿态机动模式、机动姿态保持模式、轨控姿态机动模式、轨控模式、太阳全姿态捕获模式、地地全姿态捕获模式、偏航捕获模式、姿态无控模式、自旋模式、太阳帆板未展开模式、控制计算机应急模式。模式字和各模式的对应关系如下：
表26 工作模式
模式字|意义
0|主动段
1|入轨段控制模式
2|CMG启动模式
3|正常对地运行模式
4|姿态机动模式
5|机动姿态保持模式
6|轨控姿态机动模式
7|轨控模式
8|太阳全姿态捕获模式
9|地地全姿态捕获模式
A|偏航捕获模式
B|姿态无控模式
C|自旋模式
D|太阳帆板未展开模式
E|控制计算机应急模式
",0,0,0,1,0,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
部件故障诊断|对部件进行故障诊断
陀螺故障诊断|由平衡方程方法、星敏感器数据等对陀螺进行故障检测
CMG故障诊断|根据CMG输出数据和理论数据进行CMG故障检测
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止。
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式4、6、7的系统故障诊断|在模式4、6、7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理；BAPTAE进最小模式且不能自主切换后需要提“BAPTA故障”
红外通讯故障诊断|红外通讯故障诊断及处理
大量程陀螺通讯故障诊断|大量程通讯故障诊断及处理
CMG通讯故障诊断|CMG通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
CMG在轨跑合|自主跑合功能包含CMG跑合的执行序列、必要的安全处置策略，以及数据统计功能。",0,0,0,0,0,0,1,0,0,0,0
"功能描述：由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位。
处理：更动：去掉星敏粗姿态计算。",0,0,1,0,0,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
甚高陀螺通讯故障诊断|大量程通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
部件故障诊断与处理|确定各敏感器和执行机构故障诊断及处理
动量轮故障检测|检测工作中的大力矩飞轮的故障
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式7的系统故障诊断|在模式7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
磁力矩器数模一致性诊断|磁力矩器数模一致性诊断
DSS输出一致性诊断|DSS输出一致性诊断
ASS1输出一致性诊断|ASS1输出一致性诊断
ACU 1553B接收故障诊断及处理|由于卫星的执行机构控制均需通过ACU进行，当ACU接收控制指令内存区异常将导致卫星失去控制能力，因此有必要对ACU接收执行机构控制指令的正确性进行判断。在检测到执行机构控制指令接收校验和异常后CCU需要自主进行处理",0,0,0,0,0,0,1,0,0,0,0
"功能描述：输出喷气指令
处理：
（1）将喷气的喷管打开
（2）将喷气长度写入各自通道的定时器；",0,0,0,0,0,0,0,1,0,0,0
"控制计算机有实时遥测数据和延时遥测数据。包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包|FREQ7.3.1
|发送敏感器数据包1|FREQ7.3.2
|发送敏感器数据包2|FREQ7.3.3
|发送红外太阳修正数据包|FREQ7.3.4
|发送敏感器修正数据包|FREQ7.3.5
|发送姿态控制数据包|FREQ7.3.6
|发送轨道数据包|FREQ7.3.7
|发送天线数据包|FREQ7.3.8
|发送部件工作状态数据包|FREQ7.3.9
|发送星敏感器自检数据包|FREQ7.3.10
|发送系统工作状态包|FREQ7.3.11
|发送全姿态捕获模式状态数据包|FREQ7.3.12
|发送控制模拟量遥测数据包1|FREQ7.3.13
|发送控制模拟量遥测数据包2|FREQ7.3.14
|发送控制分系统延时遥测数据包|FREQ7.3.15

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：控制算法描述
",0,1,0,0,0,0,0,0,0,0,0
功能描述：发送红外太阳敏感器数据包,0,0,0,0,0,0,0,0,0,0,1
功能描述：接收同步字,0,0,0,0,0,0,0,0,0,1,0
"功能描述：推力器喷气时间累计
",0,0,0,0,0,1,0,0,0,0,0
功能描述：接收数据指令注入块的自主诊断允许类指令,0,0,0,0,0,0,0,0,0,1,0
"功能描述：使星体Z轴对日定向，适当时重捕地球。
处理过程：
(1)若星敏数据无效且FEA=0，则Ψ=0.12，调用“-Z轴对日定向”，BZ1=3；
(2)当FEA=0时；FM3②增加判断；
(3)当FEA=5时，其中姿态角的阀值增加调整系数。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：判断陀螺的使用范围。
处理
对陀螺数据进行有效性判断。若某个陀螺故障或某个陀螺为新上电，则不进行有效性判断（陀螺不引入）。其中陀螺新加电有三种情况1、判断出陀螺故障且允许自主加电情况下，应用软件自主加电。2、数据指令加电。3、脉冲遥控指令加电。对于新加电陀螺，则在该陀螺加电时间小于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为0；当该陀螺加电时间大于等于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为1。
若SLTU陀螺不加电或该陀螺故障，不引入。当“允许使用电源状态诊断陀螺”时，应用软件根据与SLTU通讯得到的陀螺电源状态确定陀螺加断电状态；当“不允许使用电源状态诊断陀螺”时，应用软件只根据数据指令确定陀螺加断电状态。若SLTU得到的六个电源状态均断电，则不根据电源状态判断陀螺是否加电。",0,0,0,0,0,0,1,0,0,0,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ98|初始化|任务书
FREQ99|磁力矩器使用要求|任务书
FREQ100|通信(DA)|任务书
FREQ101|通信故障处理|预留
FREQ102|数据解包与转换|预留
FREQ103|磁力矩器数据有效性处理|预留
FREQ104|磁力矩器硬件采集、处理|任务书
FREQ105|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"应用软件共分21个工作模式，分别是等待段、太阳定向、恒星定向2、惯性调姿、恒星定向4、轨控定向、着陆准备、主减速、快速调整、接近下降、悬停、避障、缓速下降、自主定位、起飞准备、垂直上升、上升调姿、轨道入射、星光环月、速率阻尼和无控。模式字和各模式的对应关系如下：
表5.2.4.4-1 工作模式
模式字|工作模式|使用场合
0|等待段|""加电之后，判出分离27s之前，
或复位之后，重要数据恢复之前。""
1|太阳定向|""组合体地月转移巡航和环月阶段正常运行状态；
上升器远程引导巡航""
2|恒星定向2|变轨建立点火姿态前
3|惯性调姿|变轨建立点火姿态
4|恒星定向4|变轨建立点火姿态后
5|轨控定向|""动力下降之前的轨控
月面上升之后的轨控""
6|着陆准备|建立着陆点火姿态
7|主减速|动力下降
8|快速调整|动力下降
9|接近下降|动力下降
10|悬停|动力下降
11|避障|动力下降
12|缓速下降|动力下降
13|自主定位|月面工作阶段
14|起飞准备|建立月面起飞初始状态
15|垂直上升|月面上升
16|上升调姿|月面上升
17|轨道入射|月面上升
18|星光环月|月球轨道交会对接自主段
19|速率阻尼|轨控姿态超差
20|无控|动力下降着陆、交会对接段轨道器最后逼近、故障
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：模式4切换方式。
处理：
if() 置WorkMode=5，WorkModeT=6，；//程控指令转对地
if(lipse=1且且AutoPermission=1) 置WorkMode＝5；WorkModeT=6；；；//进入阴影区自主转对地
if() 置WorkMode=5；若，若，；WorkModeT=6；
if() 置WorkMode=5；若，若，WorkModeT=6；
收到星务的“辐射定标”指令，置WorkMode=5，WorkModeT=6，；//辐射定标模式，为注入的辐射定标目标角
if(FailureFlag＝1) 置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：发送延时遥测数据
处理：
延时遥测数据格式内容具体见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
功能描述：将F_CMGValid指定工作的CMG框架角保持在标称框架位置。,0,1,0,0,0,0,0,0,0,0,0
功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档|备注
FREQ41|太敏初始化|太敏协议|B
FREQ42|太敏数据采集|任务书、太敏协议|A
FREQ43|数据解包与转换|数太协议|A
FREQ44|太敏数据有效性判断|任务书|A
FREQ45|太敏故障重构|任务书|A
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：减小卫星的俯仰角。
输入：陀螺数据输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）
红外数据处理（全姿态捕获）的输出，
上周期姿态角估值，
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据红外、太阳、星敏感器的输出数据判断陀螺故障。
输入：
      陀螺：		故障标志F_GyroDiagnV
本周期陀螺数据的输出 (量纲：弧度)
		   			陀螺等效漂移估值
      红外：  	故障标志IRES_FLAG，数据有效性F_IresValid
          			本周期红外数据处理输出， (单位：弧度)
      数字太阳：	故障标志DSS_FLAG
数据有效性F_Ds1Valid, F_Ds2Valid
          			本周期太阳输出,  (单位：弧度)
	  星敏感器： 	故障标志数组SS_FLAG[2]
数据可用标志F_SAValid, F_SBValid
本周期星敏感器A角速度输出, 
本周期星敏感器B角速度输出, (单位：弧度/秒)
星敏感器A安装矩阵
星敏感器B安装矩阵
本周期采样到的星敏感器A的有效输出(
本周期采样到的星敏感器B的有效输出(
轨道角速度
太阳星历计算输出
标志F_GyroDiagnIresDssORSS",0,0,0,0,0,1,0,0,0,0,0
"    各个模式切换的功能点列表如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ5.1.0|4|主动段模式切换条件判断及转出设置
|入轨段控制模式切换|FREQ5.1.1|4.1|入轨段控制模式切换条件判断及转出设置
|正常对地运行模式切换|FREQ5.1.2|4.2|正常对地运行模式切换条件判断及转出设置
|点对点机动模式切换|FREQ5.1.3|4.3|点对点机动模式切换条件判断及转出设置
|偏置飞行模式切换|FREQ5.1.5|4.4|偏置飞行模式切换条件判断及转出设置
|轨控模式切换|FREQ5.1.8|4.5|轨控模式切换条件判断及转出设置
|全姿态捕获模式切换|FREQ5.1.9|4.10|全姿态捕获模式切换条件判断及转出设置
|无控模式切换|FREQ5.1.10|4.11|无控模式切换条件判断及转出设置
|陀螺标定模式切换|FREQ5.1.11|4.8|陀螺标定模式切换条件判断及转出设置
|惯性定向模式切换|FREQ5.1.12|4.6|陀螺标定模式切换条件判断及转出设置

切换条件具体见用户需求4。CCU切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
OBDH重要数据有两块，大小共为128字节，AOCC不做任何改动保存在RAM中。如果AOCC发生复位，应利用方式代码请求服务，索取OBDH重要数据进行保存。若在大于0.256s的时间内仍未收到接收OBDH重要数据的指令，则重新请求服务，同时索要OBDH重要数据的计数器累加，若此计数器大于等于40，则不再索要OBDH重要数据。若索要OBDH重要数据成功，将此计数器清零。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：追踪器GPS数据有效性判断及处理 
处理：见《卫星GNC分系统GNC计算机应用软件用户需求》的P48-P49。",0,0,0,0,1,0,0,0,0,0,0
功能描述：对数传天线控制指令的处理 ,0,0,0,0,0,0,0,1,0,0,0
功能描述：秒脉冲信号处理。,0,0,0,0,0,0,0,1,0,0,0
"功能描述：以星敏感器X 为基准标定星敏感器Y。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量（动量轮角速度为1800r/min时的角动量为15Nms）。
（3）令（i = 1，2，… ，4）。为上一次轮子角动量值。",0,0,0,0,0,0,0,0,1,0,0
"功能模式：姿态机动目标姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.6.1~4.6.3。
序号|功能点编号|功能描述|说明
|FREQ3.4.8.1|喷气控制|《用户需求》4.6.1
|FREQ3.4.8.1.1|相平面姿控算法|《用户需求》4.6.1.1
|FREQ3.4.8.1.2|相平面法喷管选择|《用户需求》4.6.1.2
|FREQ3.4.8.1.3|脉冲调宽姿控算法|《用户需求》4.6.1.3
|FREQ3.4.8.1.4|脉冲调宽法喷管选择|《用户需求》4.6.1.4
|FREQ3.4.8.2|动量轮控制|《用户需求》4.6.2
|FREQ3.4.8.2.1|动量轮安装矩阵和电压分配矩阵|《用户需求》4.6.2.1
|FREQ3.4.8.2.2|动量轮摩擦补偿计算|《用户需求》4.6.2.2
|FREQ3.4.8.2.3|动量轮角动量保持的PI控制|《用户需求》4.6.2.3
|FREQ3.4.8.2.4|动量轮启动与保持|《用户需求》4.6.2.4
|FREQ3.4.8.2.5|正常飞行动量轮分配电压计算|《用户需求》4.6.2.5
|FREQ3.4.8.3|喷气卸载计算|《用户需求》4.6.3
|FREQ3.4.8.4|喷气动量轮联合控制|《用户需求》4.6.4
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。
输入：上周期姿态角估值
陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出：",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送姿态数据包3
",0,0,0,0,0,0,0,0,0,0,1
"功能描述：计算卫星对规划目标的姿态四元数和控制量。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：各模式控制量计算
序号|功能编号|功能简述|功能详述
|FREQ3.4.3.1|等待段调用流程|用户需求4.1.1【调用流程】
|FREQ3.4.3.2|太阳定向模式调用流程|用户需求4.1.2【调用流程】
|FREQ3.4.3.3|恒星定向2/4模式调用流程|用户需求4.1.3【调用流程】
|FREQ3.4.3.4|惯性调姿模式调用流程|用户需求4.1.5【调用流程】
|FREQ3.4.3.5|轨控定向模式调用流程|用户需求4.1.6【调用流程】
|FREQ3.4.3.6|着陆准备模式调用流程|用户需求4.1.7【调用流程】
|FREQ3.4.3.7|主减速模式调用流程|用户需求4.1.8【调用流程】
|FREQ3.4.3.8|快速调整模式调用流程|用户需求4.1.9【调用流程】
|FREQ3.4.3.9|接近下降模式调用流程|用户需求4.1.10【调用流程】
|FREQ3.4.3.10|悬停模式调用流程|用户需求4.1.11【调用流程】
|FREQ3.4.3.11|避障模式调用流程|用户需求4.1.12【调用流程】
|FREQ3.4.3.12|缓速下降模式调用流程|用户需求4.1.13【调用流程】
|FREQ3.4.3.13|自主定位模式调用流程|用户需求4.1.14【调用流程】
|FREQ3.4.3.14|起飞准备模式调用流程|用户需求4.1.15【调用流程】
|FREQ3.4.3.15|垂直上升模式调用流程|用户需求4.1.16【调用流程】
|FREQ3.4.3.16|上升调姿模式调用流程|用户需求4.1.17【调用流程】
|FREQ3.4.3.17|轨道入射模式调用流程|用户需求4.1.18【调用流程】
|FREQ3.4.3.18|星光环月模式调用流程|用户需求4.1.19【调用流程】
|FREQ3.4.3.19|速率阻尼模式调用流程|用户需求4.1.20【调用流程】
|FREQ3.4.3.20|无控模式调用流程|用户需求4.1.21【调用流程】
",0,0,0,1,0,0,0,0,0,0,0
功能描述： GPS定轨主程序，包括GPS数据有效、无效时的操作。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：将加计数据换算成卫星三轴加速度和速度增量
",0,0,1,0,0,0,0,0,0,0,0
功能描述：数传天线数据处理,0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据CMG输出数据和理论数据进行CMG故障检测。
",0,0,0,0,0,1,0,0,0,0,0
功能描述：对弦宽、基准与给定的范围进行比较，确定红外故障。若两红外数据均有效，则还可根据本周期与上周期红外姿态角确定红外故障。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：卫星丢失姿态后，使用红外地球敏感器直接捕获地球，建立正常对地姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送应急控制器重要数据。
处理：将应急控制器重要数据按照协议打包发送至发送应急控制器重要数据地址中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：轨控推进系统与加速度计联合诊断加计及轨控部件状态
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向帆板LTU发完取数命令后，获得LTU返回数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。具体参见LTU通讯协议件。
（3）帆板LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：输出CMG控制指令。
处理：
功能编号|功能|引用文档|备注
FREQ61|CMG初始化|CMG协议|B
FREQ62|CMG数据采集|任务书|B
FREQ63|CMG数据解包与转换|CMG协议|B
FREQ64|CMG指令输出|CMG协议|B
",0,0,0,0,0,0,0,1,0,0,0
将AOCC计算得出的星历数据打包后放到星历数据地址空间中。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据帆板角误差、控制帆板跟踪太阳。
处理：
左帆板的处理流程：
""||""|FF1|
——|——|=0.0105sgn(-)
——|——|=0.00524sgn(-)
——|——|=+0.0000875sgn(-)
[0, 0.0175]|——|=
(0.0175,∞)|1|=+0.0000875sgn(-)
(0.0524,∞)|——|=+0.0000875sgn(-)
[0, 0.0524]|0|=

若，则：FF1=0；
若，则：FF1=1。
右帆板的处理流程：
同左帆板，相应变量替换为右帆板的变量。",0,1,0,0,0,0,0,0,0,0,0
功能描述：ACU模拟量遥测 ,0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据红外信息绕滚动俯仰转动，进行滚动俯仰捕获
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：系统软件上电复位后，调用应用软件AppInit函数，并根据初始化内容，启动任务
处理：
OBC上电/复位后，由系统软件引导应用软件运行。首先进行初始化，包括系统软件初始化和系统软件调用应用软件提供的初始化函数（AppInit）。启动任务并开始进行任务调度管理。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：CAN通信上行/下行数据的组帧和解包。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：星务接收、星务发送、快帧遥测1打包、快帧遥测2打包、轨道参数注入快帧打包、内存下卸快帧打包、慢帧遥测1打包、慢帧遥测2打包、慢帧遥测3打包、姿控广播、热控温度广播、重要数据打包、上行:目标星轨道、上行:数据指令响应处理、上行:固定地址注入解包、上行:可变地址注入解包、上行:轨道注入解包、上行:程序注入、上行:内存下卸指令注入、上行:部件指令、上行:任务块、重要数据返回解包、GNSS定位广播解包、整星广播对时解包、GNSS高精度秒脉冲对时广播解包、CAN总线使用要求",0,0,0,0,0,0,0,0,0,0,1
功能描述：接收遥控固定参数注入块的中继天线系数,0,0,0,0,0,0,0,0,0,1,0
功能描述：单独使用星敏诊陀螺。,0,0,0,0,0,1,0,0,0,0,0
"软件需求名称：帆板控制算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.6.1|帆板控制策略|《用户需求》4.6.1|
FREQ12.3-R4.6.2|帆板控制量确定|《用户需求》4.6.2|
FREQ12.3-R4.6.3|帆板控制指令转速计算|《用户需求》4.6.3|
",0,1,0,0,0,0,0,0,0,0,0
"功能：利用估计的四元数转换姿态角，送给星敏感器的四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：搜索太阳，直到数字/模拟太阳敏感器有太阳信息
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的轨控参数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收遥控固定参数注入块的轨道参数
处理：
GPS无效判断的连续次数变量由1改为7。
调整序号14注入轨道根数有效性阀值、序号16~18岁差章动系数的初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器；并记录喷气时间和次数等。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：动量轮启动的程控指令
      实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：， ，",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据+Y帆板角误差控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：NSMU初始化
处理：
初始化类型|自主切换允许标志|NSMUState
上电|允许|主份，发主开备关
上电|允许|备份，发备开主关
上电|允许|主份，发主开及备关
上电|允许|空闲
",1,0,0,0,0,0,0,0,0,0,0
"    各个模式切换的功能点列表如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ5.1.0|4|主动段模式切换条件判断及转出设置
|初始速率阻尼模式切换|FREQ5.1.1|4.1|初始速率阻尼模式切换条件判断及转出设置
|正常对日巡航模式切换|FREQ5.1.2|4.2|正常对日巡航模式切换条件判断及转出设置
|点对点机动模式切换|FREQ5.1.3|4.3|点对点机动模式切换条件判断及转出设置
|姿态/角速度预置模式切换|FREQ5.1.4|4.4|姿态/角速度预置模式切换条件判断及转出设置
|对地定向模式切换|FREQ5.1.5|4.5|对地定向模式切换条件判断及转出设置
|匀地速跟踪模式切换|FREQ5.1.6|4.6|匀地速跟踪模式切换条件判断及转出设置
|轨控模式切换|FREQ5.1.9|4.9|轨控模式切换条件判断及转出设置
|太阳捕获模式切换|FREQ5.1.10|4.10|太阳捕获模式切换条件判断及转出设置
|无控模式切换|FREQ5.1.11|4.11|无控模式切换条件判断及转出设置
|凝视姿态跟踪模式切换|FREQ5.1.12|4.12|凝视姿态跟踪模式切换条件判断及转出设置

切换条件具体见用户需求4。CCU切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
功能描述：入轨段初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收发送AOCC重要数据
处理：
控制分系统重要数据保存在系统内ICU以及外系统的CTU，应用软件上电/复位后首先从ICU恢复重要数据，如果连续5个控制周期申请重要数据失败（帧头错误、校验和错误或者收到的数据为非法数据）则认为从ICU恢复重要数据失败。应用软件通过外部1553B总线向OBDH申请星上时间和重要数据，如果连续15个控制周期申请重要数据失败，则根据星箭分离状态进行模式转换，并清除服务请求和矢量字。若星箭已分离则设置模式字为“入轨段”，星箭未分离则设置模式字为“主动段”。
申请重要数据成功后，按照重要数据中保存的部件当班状态初始化各部件软件当班状态，对于光纤陀螺产品需根据重要数据中的当班状态进行恢复对于三浮陀螺则根据重要数据中的Fi_GyroSelt状态进行恢复，并统一根据Fi_GyroSelt和当班状态补发产品开指令；对于CMG、红外、星敏产品根据重要数据中的当班状态恢复状态；统一根据当班状态和选择标志补发产品开指令；针对三浮陀螺产品，陀螺开指令连续发送3个控制周期后，连续3个控制周期发送陀螺马达开指令
  申请重要数据失败后，对于陀螺产品则根据ACU提供的部件加电状态初始化陀螺的当班状态和Fi_GyroSelt状态，并根据Fi_GyroSelt状态和当班状态补发产品开指令；对于红外产品，则根据ACU提供的部件加电状态初始化红外的当班状态和Fi_IRESSelt状态，并根据Fi_IRESSelt和当班状态补发产品开指令；对于CMG，根据ACU提供的部件加电状态初始化CMG的当班状态和Fi_CMGSelt状态，并根据Fi_CMGSelt状态和当班状态补发产品开指令；对于星敏感器，软件当班状态仍保持“不当班”状态，等待地面指令设置相应部件当班状态；
重要数据恢复成功后，使用第二块重要数据中的q\q\q\ q恢复“星体在惯性系下的姿态四元数q1/qng1、q2/qng2、q3/qng3、q4/qng4”。
第二块重要数据增加保存星敏定姿方式下的卫星三轴姿态角估值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"计算机上电/复位后应用软件的工作流程如下。
图5-1应用软件初始化和复位处理流程",1,0,0,0,0,0,0,0,0,0,0
"功能描述：与动量轮通信，输出本周期电压。采集动量轮模拟量信息。
处理：
功能编号|功能|引用文档
FREQ102|初始化(加电)|任务书
FREQ103|动量轮使用要求(方向等)|任务书
FREQ104|通信(DA输出、脉冲输入)|任务书
FREQ105|通信故障处理|预留
FREQ106|数据解包与转换|任务书
FREQ107|处理动量轮数据有效性处理|任务书
FREQ108|动量轮模拟量采集、故障|任务书
FREQ109|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
功能描述：为三轴姿态喷气控制选择喷管；并记录喷气时间等。,0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|喷气开关逻辑相平面分区，喷气脉冲宽度计算|FREQ31|4.3.1.1|进行单轴相平面分区及控制规律计算
|三轴姿态喷气控制与推力器脉宽分配|FREQ32|4.3.1.3|为三轴姿态喷气控制选择推力器
|轨控发动机与其备份的使用|FREQ33|4.3.1.4|轨控模式时使用轨控发动机及其备份
|动量轮摩擦补偿计算|FREQ34|4.3.2.2|动量轮摩擦力矩的补偿电压计算
|动量轮角动量保持控制|FREQ35|4.3.2.3|计算将动量轮保持至标称角动量所需的电压
|动量轮的启动与保持|FREQ36|4.3.2.4|启动动量轮至标称角动量，并保持
|正常飞行模式动量轮分配电压计算|FREQ37|4.3.2.5|计算正常飞行模式轮控所需电压
|正常模式轮子保护与动量卸载|FREQ38|4.3.3.1|决定采用磁卸载还是喷气卸载方式，调用相应程序
|磁卸载计算|FREQ39|4.3.3.2|计算磁卸载所需的磁矩与磁力矩器工作电压
|结构滤波器计算|FREQ95|4.3.2.6|PID计算控制力矩经过结构滤波器后，改善姿态控制效果
|太阳定向主程序|FREQ40|4.4.3.3|搜索并捕获太阳，完成并保持帆板对太阳定向
|重捕地球与建立正常姿态（1）|FREQ41|4.4.4.1|在完成对日定向后，由地面指令转入重捕地球。在偏航捕获阶段，通过红外和太阳敏感器定姿，消除卫星的偏航角。在完成偏航捕获后，由红外地球敏感器测量信号进行计算得到俯仰角和滚动角，控制滚动、俯仰使其趋向于0
|捕获地球与建立正常姿态（2）|FREQ42|4.4.4.2|当红外敏感器故障时，在太阳定向完成后，利用数字太阳与星敏感器信息，进行全姿态捕获，并建立正常姿态。
|三轴等效角动量偏差|FREQ91|4.3.4.1|根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差
|俯仰通道轮控算法|FREQ92|4.3.4.2|根据俯仰角和俯仰通道角动量偏差信息实现俯仰轴姿态控制
|磁进动、章动阻尼及俯仰轮卸载控制|FREQ93|4.3.4.3|通过磁力矩器，实现滚动-偏航轴的进动控制及章动阻尼，并对俯仰飞轮进行磁卸载
|三轴轮控算法|FREQ94|4.3.4.4|偏置动量轮处于力矩模式，根据红外地球敏感器测量信息计算得到的滚动角和俯仰角实现三轴姿态控制。滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制
|帆板捕获及跟踪控制|FREQ102|4.3.5|根据地面指令或自主使帆板跟踪太阳
|干扰补偿控制算法及动量轮分配电压计算|FREQ95|任务书的4.1.15|计算有效载荷干扰补偿控制电压，以及计算动量轮分配电压
|全姿态捕获动量轮控制方式主程序|FREQ40.5|4.4.5|全姿态捕获动量轮控制方式主程序
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：处理地面遥控注入的内存下卸指令注入
处理：解包内存下卸指令注入，得到内存下卸起始地址用于第七类快帧数据打包。
说明： 遥测数据指令采用16字节(有效使用9字节)格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,0,0,0,1,0
功能描述：启动飞轮或动量保持控制。,0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|部件状态、双组元推进状态1、推进状态2、ACU工作状态|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|计算得到的喷气脉宽、磁力矩器电压|控制指令消息的输出|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
|部件加断电指令的处理|FREQ1.8.4|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.5|保存CCU的重要数据|接收CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.6|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|REQ1.8.7|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.8|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.9||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,0,0,0,1,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得DSS、ASS、LSS数据；根据ZT14（2）（1）确定进行通讯的太阳LTU，发送取数指令，具体如下表所示
ZT14(2)(1)的值|进行通讯的太阳LTU|发送的取数指令
01|与之前通讯太阳LTU1或太阳LTU2进行通讯|""33H或
43H""
10|与之前通讯太阳LTU1或太阳LTU2进行通讯|""33H或
43H""
00或11|根据LTU故障诊断的结果决定太阳LTU的选取。初始状态为太阳LTU1|33H或43H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的12个字节数据，将数据根据LTU通讯协议转换，、L11~L15,L21~25。
（3）太阳LTU数据采集过程中的故障处理见本文的.1。",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|CMG 1数据的采集与处理|FREQ1.9.1|""CMG 1
1553B取数指令
""|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 2数据的采集与处理|FREQ1.9.2|""CMG 2
1553B取数指令
""|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 3数据的采集与处理|FREQ1.3.3|""CMG 3
1553B取数指令
""|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 4数据的采集与处理|FREQ1.9.4|""CMG 4
1553B取数指令
""|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 5数据的采集与处理|FREQ1.9.5|""CMG 5
1553B取数指令
""|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 控制指令的输出处理|FREQ1.9.6|计算得到CMG的控制数据|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
|CMG的程序注入修改|FREQ1.9.8|从OBDH收到的CMG需修改程序内容|CMG需修改程序内容|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
|CMG的内存下传|FREQ1.9.9|从OBDH收到的CMG内存下传设置指令|内存下传设置指令|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：根据CMG所对应的期望角动量与CMG产生的实际角动量之差，自主诊断CMG的工作状态。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：使用星敏感器C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
甚高陀螺通讯故障诊断|大量程通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
部件故障诊断与处理|确定各敏感器和执行机构故障诊断及处理
陀螺故障检测|确定各敏感器和执行机构故障诊断及处理
动量轮故障检测|检测工作中的动量轮的故障
大力矩飞轮故障检测|检测工作中的大力矩飞轮的故障
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式7的系统故障诊断|在模式7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
磁力矩器数模一致性诊断|磁力矩器数模一致性诊断
DSS输出一致性诊断|DSS输出一致性诊断
ASS1输出一致性诊断|ASS1输出一致性诊断
ACU 1553B接收故障诊断及处理|由于卫星的执行机构控制均需通过ACU进行，当ACU接收控制指令内存区异常将导致卫星失去控制能力，因此有必要对ACU接收执行机构控制指令的正确性进行判断。在检测到执行机构控制指令接收校验和异常后CCU需要自主进行处理",0,0,0,0,0,0,1,0,0,0,0
"功能描述：各个模式的姿态和轨道控制。
处理：
定义星箭分离前为主动段工作模式（包括射前和主动段飞行状态），WorkMode=0。主动段工作模式下，应用软件进行下列工作：
星时计算；
数据采样，但无任何控制指令输出；
组帧遥测数据；
响应OBDH通讯命令；
在主动段查询星箭分离信号的有效性，确认依据为：读取2路星箭分离状态，若任意1路星箭分离为“已分离”状态，则认为本周期查到星箭已分离。如果在连续8个周期中至少6个周期都查到星箭已分离，则可确认为星箭已分离，进入入轨段模式，WorkMode =1。
通过注入在轨维护程序，实现部件测试功能。
模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。各个模式控制中调用流程和条件见用户需求4.1至4.14：",0,0,0,1,0,0,0,0,0,0,0
"功能描述：
  根据三轴姿态角和姿态角速度误差计算三轴控制力矩(功能编号：FReq-5)。
处理： 
控制器结构为PD控制，见下图。
图5-2  PID控制器
控制器输入计算和限幅：角度信息、角速度信息由5.2.2节获取；
用于计算控制力矩的角度信息限幅为[-5,5]度、角速度信息限幅1.0度/秒。
；
		；",0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收时间码
处理： OBDH分系统每1分钟给控制计算机校时一次。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：各模式初始化
序号|功能点编号|功能描述|说明
|FREQ3.4.2.1|等待段初始化|《用户需求》4.1.1【初始化】
|FREQ3.4.2.2|太阳定向模式初始化|《用户需求》4.1.2【初始化】
|FREQ3.4.2.3|恒星定向2初始化|《用户需求》4.1.3【初始化】
|FREQ3.4.2.4|惯性调姿模式初始化|《用户需求》4.1.4【初始化】
|FREQ3.4.2.5|恒星定向4初始化|《用户需求》4.1.5【初始化】
|FREQ3.4.2.6|轨控定向模式初始化|《用户需求》4.1.6【初始化】
|FREQ3.4.2.7|着陆准备模式初始化|《用户需求》4.1.7【初始化】
|FREQ3.4.2.8|主减速模式初始化|《用户需求》4.1.8【初始化】
|FREQ3.4.2.9|快速调整模式初始化|《用户需求》4.1.9【初始化】
|FREQ3.4.2.10|接近下降模式初始化|《用户需求》4.1.10【初始化】
|FREQ3.4.2.11|悬停模式初始化|《用户需求》4.1.11【初始化】
|FREQ3.4.2.12|避障模式初始化|《用户需求》4.1.12【初始化】
|FREQ3.4.2.13|缓速下降模式初始化|《用户需求》4.1.13【初始化】
|FREQ3.4.2.14|自主定位模式初始化|《用户需求》4.1.14【初始化】
|FREQ3.4.2.15|起飞准备模式初始化|《用户需求》4.1.15【初始化】
|FREQ3.4.2.16|垂直上升模式初始化|《用户需求》4.1.16【初始化】
|FREQ3.4.2.17|上升调姿模式初始化|《用户需求》4.1.17【初始化】
|FREQ3.4.2.18|轨道入射模式初始化|《用户需求》4.1.18【初始化】
|FREQ3.4.2.19|星光环月模式初始化|《用户需求》4.1.19【初始化】
|FREQ3.4.2.20|速率阻尼模式初始化|《用户需求》4.1.20【初始化】
|FREQ3.4.2.21|无控模式初始化|《用户需求》4.1.21【初始化】
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收发送OBDH重要数据
处理：数据不需要应用软件处理。",0,0,0,0,0,0,0,0,0,1,0
功能描述：决定磁卸载或喷气卸载方式,0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：部件数据处理及状态选择 
需求类别：其他 
软件需求描述：部件数据采集、剔野和选择处理。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据需求，计算去往小天区扫描模式机动过程中所需的目标姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：从SDC获取部件供电状态信息
处理：读入各部件加电状态信息并遥测打包。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据红外输入，计算滚动和俯仰角。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收数据指令注入块的部件开关类指令
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：星上自主检测推进系统故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：接收同步控制。
处理：根据应急线路同步字的编码内容进行相应的处理：
编码|相应的处理
28H|发送内存的数据区指针复位
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。。为保证帆板LTU线路归零指令的成功执行，要求应用软件连续3个周期对帆板LTU线路发送归零指令。",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|甚高陀螺数据的采集与处理|FREQ1.2.1|""甚高陀螺1553B取数指令（硬件同步信号或广播同步消息）
""|陀螺1-6的速度增量|在通讯允许的条件下（每个甚高陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|光纤陀螺数据的采集与处理|FREQ1.2.2|""光纤陀螺LTU取数指令
""|陀螺7-9的速度增量|在通讯允许的条件下（每个光纤陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是即为速度增量数据，直接乘当量就可以得到需要的结果；
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据红外数据计算卫星姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：轨道与星历计算。
",0,0,0,0,1,0,0,0,0,0,0
"    各个模式切换的功能点列表如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ5.1.0|4|主动段模式切换条件判断及转出设置
|入轨段控制模式切换|FREQ5.1.1|4.1|入轨段控制模式切换条件判断及转出设置
|正常对地运行模式切换|FREQ5.1.2|4.2|正常对地运行模式切换条件判断及转出设置
|点对点机动模式切换|FREQ5.1.3|4.3|点对点机动模式切换条件判断及转出设置
|姿态/角速度预置模式切换|FREQ5.1.4|4.4|姿态/角速度预置模式切换条件判断及转出设置
|偏置飞行模式切换|FREQ5.1.5|4.5|偏置飞行模式切换条件判断及转出设置
|匀地速跟踪模式切换|FREQ5.1.6|4.6|匀地速跟踪模式切换条件判断及转出设置
|角速度跟踪模式切换|FREQ5.1.7|4.7|角速度跟踪模式切换条件判断及转出设置
|轨控模式切换|FREQ5.1.8|4.9|轨控模式切换条件判断及转出设置
|全姿态捕获模式切换|FREQ5.1.9|4.10|全姿态捕获模式切换条件判断及转出设置
|无控模式切换|FREQ5.1.10|4.11|无控模式切换条件判断及转出设置
|测试与标定模式切换|FREQ5.1.11|4.8|测试与标定模式切换条件判断及转出设置

切换条件具体见用户需求4。CCU切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：利用星敏感器捕获地球分两个阶段。在第一阶段，60秒判断一次星敏感器姿态输出。如果星敏感器A、B、C均有姿态输出，且测量的光轴夹角满足一定条件，则利用星敏感器双矢量定姿确定姿态。若仅有A或仅有B或仅有C有姿态输出，则偏航转过小角度（3度），重复捕获。偏航转过3度后，若星敏感器A或B或C有姿态输出，且满足一定条件，利用星敏感器双矢量定姿。若三个星敏感器均无姿态输出或由输出但仍不满足一定的条件，进行偏航转动（45度）。若偏航转动1周天仍未捕获成功，则滚动转动90度。若全天球捕获成功，则当姿态角和姿态角速度满足一定条件，进入阶段2。在阶段2，利用四元数进行姿态确定（与姿态机动定姿相同）。喷气控制。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：星时获取 
需求类别：其他 
软件需求描述：计算星上星时。
处理：
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。 ",0,0,0,0,0,0,0,0,1,0,0
"功能描述：仅利用星敏感器A的测量，修正姿态四元数与姿态角速度移。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：初始化 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。
调用条件：上电/复位。
处理：依据“用户需求”、“任务书”、“上行注入”对非0变量进行初始化。 ",1,0,0,0,0,0,0,0,0,0,0
"功能描述：仅利用星敏感器A、C的测量，修正姿态四元数与姿态角速度移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的数传天线系数,0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入章节号|功能描述
|卫星轨道计算|FREQ8|4.1.1|星上实时计算卫星轨道
|GPS计算|FREQ9|4.1.1.2|将GPS轨道确定参数转换成控制系统中太阳星历和地磁场计算所需的19个轨道参数
|光行差的修正参数和数字太阳敏感器输出角估值计算|FREQ10|4.1.2|计算光行差的修正参数，数字太阳敏感器输出角估值
|地磁场模型计算|FREQ11|4.1.3|星上实时计算地磁场强度
",0,0,0,0,1,0,0,0,0,0,0
"软件需求名称：动量轮使用及通信（5m不配置） 
需求类别：其他 
软件需求描述：与动量轮通信，输出本周期电压。采集动量轮电源状态、转速、模拟量等信息。
处理：
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
动量轮初始化|FREQ57|动量轮初始化|B|2
动量轮数据采集|FREQ58|动量轮数据采集|B|3
通信(DA输出、脉冲输入)|FREQ59|通信(DA输出、脉冲输入)|B|4
数据解包与转换|FREQ60|数据解包与转换|B|
",0,0,0,0,0,0,0,1,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|对地数传天线1数据的采集与处理|FREQ1.7.1|""对地数传天线1 LTU控制指令
""|对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
|对地数传天线2数据的采集与处理|FREQ1.7.2|""对地数传天线2
LTU控制指令""|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
|中继天线数据的采集与处理|FREQ1.7.3|中继天线LTU控制指令|中继天线的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：根据陀螺输入，预估卫星惯性姿态四元数。,0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：遥测打包 
需求类别：其他 
软件需求描述：打包内容见“遥测”。",0,0,0,0,0,0,0,0,0,0,1
功能描述：根据红外、太阳、星敏感器的输出数据判断陀螺故障。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得9个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据，AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收GPS数据、接收积分时间、AOCC姿态数据、相机测温参数
处理：将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据和轨道数据的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：选择通讯的LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）甚高精度星敏共有1个LTU，AOCC每个控制周期根据注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中是否通讯的甚高精度星敏LTU发送取数指令。
（2）向甚高精度LTU发送完取数指令后，获得甚高精度星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：OBC在CAN总线中断中接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：选择三轴正负控制力矩
处理：根据推力器分支和追踪器构型设置控制力矩。。
说明：10种构型，2种分支共计20组控制力矩（每组包括正负三轴共6个）",0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的相平面参数
处理：
调整推力角加速度修正因子初装值。",0,0,0,0,0,0,0,0,0,1,0
功能描述：J2000年地心赤道惯性系中的速度增量计算,0,0,0,0,1,0,0,0,0,0,0
"软件需求标识：FREQ21 
软件需求名称：部件加断电指令处理 
需求类别：其他 
软件需求描述：部件加断电指令处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：姿态机动模式控制
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：发送姿态数据
处理：
AOCC每个控制周期（250ms）组织28个字节姿态数据，OBDH每500ms取1次姿态数据（56个字节）。每个数据包中的2个姿态的时标需按照时间顺序排列。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：发送延时遥测数据
处理：
遥测数据格式内容具体见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
功能描述：根据陀螺输入，预估卫星惯性姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，予估q及姿态角（在星测量回路中），等。。
处理：同用户需求的1.6。
STEP1:计算星敏预估角速度，。计算结果的限幅值是0.027。计算公式见1.6（1）。
STEP2:计算q,和，计算公式见1.6（2）。
STEP3:计算，。对于计算结果，当BZ1=8（侧摆机动）时，否则。对于计算结果，。对于计算结果，。计算公式见1.6（3）。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：重要数据保存
处理：回送重要数据
说明：上电/复位35秒内 或 主动段 或 任务超时 或 与LTU通讯连续失败20次且自主切换禁止，不保存重要数据。",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.4|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.3|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1|地面站赤经赤纬计算
|运行段帆板控制|FREQ4.12|5.5.1|三轴稳定模式下的帆板控制
|太阳帆板自主跟踪控制|FREQ4.13|5.5.2|根据帆板角误差、控制帆板跟踪太阳
|数传天线指向控制|FREQ4.14|5.6.2|根据指令完成数传天线的指向控制
|中继轨道计算|FREQ4.21|5.7.1|中继轨道计算
|中继天线指向控制|FREQ4.22|5.7.2和5.7.3|根据指令完成中继天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|双脉冲变轨|FREQ4.23|""任务书的
4.2.3""|根据地面注入的指令可实现两次轨控的功能
|3CMG框架角速度指令解算|FREQ4.24|5.4.2.6|当采用3CMG进行姿态控制时，根据控制器计算出的力矩，实现CMG的框架角速度指令解算
|CMG群角动量释放流程|FREQ4.25|5.4.2.7|CMG群角动量释放流程
|CMG标称框架角计算算法|FREQ4.26|5.4.2.8|根据外部标志及时间，计算CMG的标称框架角
",0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器1
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器1的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器2
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器2的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器3
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器3的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：实时计算地心矢量、太阳矢量在本体系下的表示，以及星体X轴指向的赤经、赤纬
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用B头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.11
STEP1：计算，将下标A换成B；FM3更改：若，则：，FSTD=1；
STEP2：计算。的各项乘以，的各项乘以。将下标A换成B；
STEP3：计算q
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算",0,0,1,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|主动段模式控制|FREQ44.0|3.3.0|主动段模式调用流程
|入轨消初偏模式控制|FREQ44.1|3.3.1|入轨消初偏模式调用流程
|红外引入对地粗定向模式控制|FREQ44.2|3.3.2|红外引入对地粗定向模式调用流程
|动量轮启动模式控制|FREQ44.3|3.3.3|动量轮启动模式调用流程
|正常轨道运行模式控制|FREQ44.4|3.3.4|正常轨道运行模式调用流程
|轨控模式1模式控制|FREQ44.5|3.3.5|轨控模式1模式调用流程
|由正常姿态进行姿态机动模式控制|FREQ44.6|3.3.6|由正常姿态进行姿态机动模式调用流程
|轨控模式2模式控制|FREQ44.7|3.3.7|轨控模式2模式调用流程
|由轨控姿态机动回正常轨道运行模式控制|FREQ44.8|3.3.8|由轨控姿态机动回正常轨道运行模式调用流程
|全姿态捕获模式控制|FREQ44.9|3.3.9|全姿态捕获模式调用流程
|应急安全模式模式控制|FREQ44.10|3.3.10|应急安全模式模式调用流程
|停控模式控制|FREQ44.11|3.3.11|停控模式调用流程
|帆板未展开模式控制|FREQ44.12|3.3.12|帆板未展开模式调用流程
|偏置动量控制模式控制|FREQ44.13|3.3.13|偏置动量控制模式调用流程

主动段模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的3。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内
    AOCC应用软件应对内存下卸的地址区域进行保护：当内存下卸指令中的首地址、末地址均在PROM硬件地址范围、RAM硬件地址范围、1553B总线接口芯片的RAM地址范围内，则应用软件按照内存下卸指令的要求下卸目标区域的数据；若内存下卸指令中的地址超出上述3个区域的地址范围，则应用软件不更新1553B总线接口芯片中内存下卸内容子地址中对应数据。",0,0,0,0,0,0,0,0,0,0,1
功能：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：完成运行段偏差姿态确定，（红外修正，太阳修正，星敏感器姿态确定，斜装陀螺定姿等）确定，。
处理：
（1）若BZ1 ≠ 8，9，ZT3≠F,A,B则调用姿态红外修正，调用q及s姿态予估器；若，则：，。
（2）若BZ1 = 8，则
① 根据轮子的工作状况，计算滚动轴最大控制力矩。
② 计算滚动轴角加速度。
③ 计算加速时间。
④ 侧摆喷气判断。
⑤ 计算滚动轴期望轨迹和。
（3）计算姿态角控制量。其中当BZ1≠8,9,ZT3=F或B时，滚动角和俯仰角的限幅值改为可内存修改系数，。红外+斜装陀螺增加偏流角计算。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收应急线路注入数据。
处理：应急线路的上行注入数据为姿控数据块，具体见上行注入文件。",0,0,0,0,0,0,0,0,0,1,0
功能描述：太阳全姿态捕获模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收记录AOCC时间指令
处理：CTU在需要恢复星上时间时，向AOCC发送“记录AOCC时间指令”，AOCC收到指令后立即记录AOCC时间并将时间数据写入发送AOCC时间指定的存储地址空间中。",0,0,0,0,0,0,0,0,0,1,0
功能描述：外推轨道计算主程序。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号的选取。
处理：同用户需求的5.1。
——5.1（2）；;",0,0,1,0,0,0,0,0,0,0,0
功能描述：由GPS得到轨道外推的16根数。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理： 
（1）CPU星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU星时时钟星时校时是通过OBDH校时，OBDH校时分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；",0,0,0,0,0,0,0,0,1,0,0
"功能描述：使用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：追踪器构型切换管理及质量设置
处理：根据构型设置追踪器质量及转动惯量
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：进行I/O板SpaceWire接口读入和输入数据的处理；由于不同敏感器输入的姿态角度信息的格式和量化单位都不相同，需要将它们进行格式转换。输入信息格式转换后的单位规定为：地球敏感器、太阳敏感器、陀螺积分的角度单位为弧度（rad），动量轮转速单位为（rpm） 
处理：
(1)  判断IO当班状态；
(2)  697控制双口RAM；
(3) 根据当班状态，选择SPACEWIRE相应通道，主份IO当班，从通道2读取双口RAM中的数据；备份IO当班，从通道3读取双口RAM中的数据；
(4) 对读取的双口RAM中的数据进行解包
(5) 输入数据处理；（包括：太敏、地敏、三浮、光纤、星敏、时间、ADU控制信息、IO状态信息等）。
接口输入功能
功能描述：进行接口数据的读取 
处理：输入功能具体见PM板与IO板接口。(1) 从双口RAM中读取I/O发送的数据；(2) 根据协议对接收的数据进行解包；
输入数据处理功能分解
接口输入后，根据通讯协议和数据格式进行数据处理，下表示输入数据处理的功能分解：
表5.2-4 输入数据处理功能分解1
序号|编号|功能说明|任务书中的章节号|功能描述
|FREQ10.1|太敏数据处理地敏数据处理|6.1.1|太阳敏感器数据进行解码，读入的偏移二进制码转换为控制计算用的浮点数格式；
|FREQ10.2|地敏数据处理|6.1.2|将从接口读入的ES数据转化为弧度值
|FREQ10.3|甚高三浮陀螺数据处理|6.1.3|将三浮陀螺在一个采样周期内的脉冲数转化为角度增量，并做限幅与剔野处理
|FREQ10.4|光纤陀螺数据处理|6.1.4|对光纤陀螺数据包进行解码，测量数据由定点数转换为控制计算用的浮点数格式；
|FREQ10.7.2|星敏曝光时刻计算|6.1.5|星敏曝光时刻计算

表5.2-5 输入数据处理功能分解2
序号|需求ID号|功能点说明|用户需求中章节号|功能描述
|FREQ10.3.1|三浮陀螺数据剔野|11.1.1|三浮陀螺数据剔野
|FREQ10.4.1|光纤陀螺数据剔野|11.1.1|光纤陀螺数据剔野
|FREQ10.5|陀螺的应用选择|11.1.1|控制分系统配置了9个陀螺，根据陀螺健康字和电源状态字确定陀螺状态字，计算分配矩阵。也可通过陀螺组合遥控指令处理，设置陀螺状态字，进而计算出分配矩阵。故障后通过地面遥控进行陀螺重新组合分配
|FREQ10.6|单独测量时的陀螺数据处理|11.1.1|根据陀螺测量值，得到三轴姿态角速度，用于姿态采用陀螺几分测量时
|FREQ10.7|星敏感器数据处理|11.1.2|对星敏数据进行解包、数据有效性判断、通讯故障判断、星敏数据剔野
|FREQ10.7.1|星敏数据剔野|11.1.2|星敏数据剔野
",0,0,0,0,0,0,0,0,1,0,0
功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：将陀螺有效输出数据，换算成卫星三轴角度增量。
",0,0,1,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
-Y帆板数据的采集与处理|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,0,0,0,1,0,0
功能描述：由数字太阳粗码得到数字太阳角、全开码、见太阳标志。,0,0,0,0,0,0,0,0,1,0,0
"功能描述：实时计算卫星轨道参数及太阳方位，太阳敏感器理论输出。
处理：同用户需求的4.2。为防止t-t0过大导致系统切机，在轨道计算中增加时间超差不调用轨道计算，仅外推轨道幅角；太阳星历的计算仍然调用。
STEP1：计算卫星轨道根数。计算公式见4.2(1)；
STEP2：计算太阳轨道和太阳敏感器理论输出，其中岁差补偿公式有更改，Cbo的计算公式改用红外定姿姿态。计算公式见4.2(2)；
STEP3：若FlagIresOrbSun=0，则FHSL=FHSR=1左右红外都不见太阳。FlagIresOrbSun是注入内存修改变量，若注入修改令FlagIresOrbSun=1，则引入红外软件见太阳保护。
STEP4：若计算的轨道半径r和相差以上，或计算的轨道角速度和0.001108rad/s相差0.00008以上，则判定轨道计算偏差太大，置BZ2=4，同时置r=6871，=0.001108，。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：估计各个加速度计零位漂移增量
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：计算速度增量关机喷气时间
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：选择通讯的数传天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）数传天线有四个LTU，天线1和2各有两个互为备份。应用软件初始上电时不与数传天线通讯，与数传天线开始通讯的条件为：收到数传天线预指或复位总线指令和数传天线加电。停止与数传天线通讯的条件为：收到数传天线停止总线指令和数传天线断电。其中数传天线加断电状态由1553B的接收BG与数传天线伺服控制器状态设置数据命令来确定。同时也根据这个命令确定参与通讯的LTU。初始为选择主份，收到主切备时切换到备份；在备份通讯时，收到备切主时切换到主份。
（2）向数传天线LTU发完取数命令后，获得数传天线LTU返回的数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，具体参见LTU通讯协议件。
（3）数传天线LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
"上电/复位后，系统软件进行相应的初始化工作，之后调用应用软件的AInit()函数进行应用软件的初始化。应用软件初始化工作主要包括硬件初始化、变量初始化、星箭分离查询、确定部件加断电状态状态。
硬件初始化的内容如下表所示：
表5-2 上电/复位后硬件初始化表
内  容|状  态
串口初始化|按前面要求进行设置
CANA、B总线初始化|按通讯协议要求进行设置

硬件初始化完成后应用软件需对初始值不为0的变量初始化（系统软件已对B段变量清零），相应变量的初始化值见《卫星控制分系统控制计算机应用软件用户需求》和《卫星控制分系统注入参数及数据指令的用户需求》。应用软件需读取一次星时计数器值。
硬件和变量初始化完成后，应用软件连续进行5次星箭分离查询，每次间隔大于1ms。若连续3次查到星箭分离，则认为星箭已分离，置当前控制模式为“复位进入模式”，设置星时为0.75秒；否则认为星箭未分离，进行主动段初始化工作。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺数据采集在BZ8=5（轨控模式轨控期间、帆板未展开模式和全姿态捕获模式太阳捕获期间）的采样周期为0.262秒，其余模式的采样周期为0.524秒。
（2）陀螺共有三个互为备份的LTU，通过每个LTU均可获得六个陀螺的数据；AOCC向陀螺LTU发送取数命令1和取数命令2来获得数据，其中取数命令1有两个字节，取数命令2有一个字节；只有取数命令1通讯不成功时才发取数命令2。AOCC根据ZT14（4）（3）来确定和哪个LTU进行通讯，同时确定通道选择号和取数命令1和取数命令2的第一个字节。 
ZT14(4)(3)的值|进行通讯的陀螺LTU|取数命令1和命令2
01|陀螺LTU1|53H和5CH
10|陀螺LTU2|63H和6CH
11|陀螺LTU3|73H和7CH
00|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1|53H（或63H或73H）和5CH（或6CH或7CH）

（3）AOCC根据ZT15、ZT16确定要采集哪几个陀螺的数据（加电的陀螺），即决定取数命令1中的第二个字节（工作陀螺编码字节）的低6位，。ZT15、ZT16与第二个字节的对应关系如下：
取数命令1的第二个字节
D0
ZT15（1）

（4）将陀螺LTU返回的数据根据LTU通讯协议中的计算公式转换为陀螺的角度增量（弧度）。根据ZT46、ZT47确定当前引入陀螺。
（5）陀螺LTU数据采集过程中的故障处理见本文的.1。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据轨道数据计算偏流角。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：进行部件通讯与选用、数据采集与处理、自检与校时。,0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：推进系统操作 
需求类别：其他 
软件需求描述：对自锁阀、推力器进行操作。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：用注入程序替代SRAM中对应程序块
处理：解包可变地址参数注入包，更新JumpSlot（下一周期软件根据JumpSlot中的ID转入JumpSlot指定的地址，运行替换后的注入代码）；
说明：JumpSlot是一结构数组，结构中的成员是被修改的模块的ID和注入模块的地址，定义如下：
struct OUMP_SLOT
{
unsigned int mole；
unsigned int *hr0；
unsigned int *hr1；
unsigned int *hr2；
}OSJump_Slot[8]",0,0,0,0,0,0,0,0,0,1,0
"功能描述：计算给控制器的姿态和角速度误差。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：检测红外HL、HR 的故障，并选取正确的红外信号。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：偏航捕获模式控制
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：轨控段喷气控制计算。
处理：同用户需求的
（1）各轴喷气参数设置如表36所示
表36：轨控段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|0.4 mθD04|0.4 mθD04|0.4 mθD04
|1.0 mθD13（注1）|1.0 mθD13（注1）|1.0 mθD13（注1）
|1.0 mθB36|1.0 mθB36|1.0 mθB36
|3.0 mθB33（注1）|3.0 mθB33（注1）|3.0 mθB33（注1）
|0.1|0.14|0.07
|0.2|0.2|0.2
|（注3）|（注3）|（注3）
|0.3|0.3|0.3
|0.43（注2）|0.43（注2）|0.43（注2）
|（注3）|（注3）|（注3）
KJ2(s)|2|2|2
aJS（/s2）|0.137|0.235|0.089

注1：在BZ1 =3、4的条件下
注2：在BZ1 =2的条件下
注3：在BZ1 =4的条件下
（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,1,0,0,0,0,0,0,0,0,0
"功能描述：使用星敏感器C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据注入轨道参数计算太阳轨道、方位与其他参数。,0,0,0,0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据标志选择轨控发动机。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：采集8路模拟太阳A\B码、监视码。
处理：
采集方法：连续采集8路，采集1路的操作步骤（以ASS1的电流1为例）：
向选通地址输出偏移地址：0x1200 0000 = 30H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果；",0,0,0,0,0,0,0,0,1,0,0
"功能：利用星敏感器B 、C的测量，修正姿态四元数与估计角速度。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：置卫星姿态无控，处于自由飞行状态。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
处理：
（1）读每路动量轮的转速脉冲数，将读到的上一个周期的计数器的值减去本周期的计数器的值（要进行计数器过零时的处理），将差值乘以系数0.0395784。
（2）读每路动量轮的转速方向。AOCC通过并行口（F2H）的D0～D5分别测量MW1～MW6的转动方向，测得0表示反转，1表示正转。
（3）将（1）和（2）的结果相乘得到六个动量轮的角动量，
，（Nms）
动量轮状态确定：根据BZ9、BZ10确定参与工作的动量轮标志FWH，FWH取值与BZ9、BZ10的逻辑关系如下表所示，具体见用户需求5.12，其中BZ9、BZ10由动量轮故障诊断确定。
    表33：动量轮状态确定
BZ9、BZ10的组合情况|FWH取值
BZ10（2）|FWH取值
1|0（动量轮无故障）
1|1（动量轮1故障）
1|2（动量轮2故障）
1|3（动量轮3故障）
1|4（动量轮4故障）
1|5（动量轮5故障）
0|6（动量轮6故障）
1|7（动量轮1、5故障）
1|8（动量轮2、5故障）
1|9（动量轮3、5故障）
1|10（动量轮4、5故障）
0|11（动量轮1、6故障）
0|12（动量轮2、6故障）
0|13（动量轮3、6故障）
0|14（动量轮4、6故障）
0|15（动量轮5、6故障）
1|16（动量轮1、2故障）
1|17（动量轮1、3故障）
1|18（动量轮1、4故障）
1|19（动量轮2、3故障）
1|20（动量轮2、4故障）
1|21（动量轮3、4故障）
其余组合|FWH值不变
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。
",0,1,0,0,0,0,0,0,0,0,0
