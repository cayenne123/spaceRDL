Requirements Description,功能需求/初始化,功能需求/控制计算/姿态控制,功能需求/控制计算/姿态确定,功能需求/控制计算/模式管理,功能需求/控制计算/轨道计算,功能需求/控制计算/运行时保障/故障诊断和处理,功能需求/控制计算/运行时保障/数据有效性判断,功能需求/控制输出,功能需求/数据采集,功能需求/遥控,功能需求/遥测
"功能描述：处理地面遥控注入的程序代码
处理：解包程序代码注入包，得到目的地址、注入内容长度；将注入内容放入目的地址内。
说明：星务分系统向GNCC送数采用256字节(有效使用249字节)帧格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,0,0,0,1,0
功能描述：为动量轮启动与保持模式姿态确定提供初始姿态。,0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：化学推进使用及通信 
需求类别：其他 
软件需求描述：与发动机通信，输出本周期喷气脉宽。
处理：
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
UPS初始化|FREQ52|UPS初始化|B|2
化学推进数据采集|FREQ53|化学推进数据采集|B|3
推力器脉冲输出|FREQ54|推力器脉冲输出|B|4
推力器健康字设置|FREQ55|推力器健康字设置|B|5
部件操作（程控490N点火，故障重构）|FREQ56|部件操作（程控490N点火，故障重构）|B|
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：利用数字太阳信息，进行太阳捕获，对太阳定向。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|给VIPPCU发送轮询和校时包|FREQ1.8.1|""无
""|校时等数据|在每个控制周期与VIPPCU通讯时，在“轮询与校时包”中发送本周期的控制UTC时间
|VIPPCU加电状态状态数据的采集与处理|FREQ1.8.2|""加电状态
""||CCU通过采集来自VIPPCU的 “VIPPCU A机加电状态”、“VIPPCU B机加电状态”两个0～5V模拟量，来确定VIPPCU的A、B机加电状态。
|给VIPPCU发送的下平台控制数据|FREQ1.8.3|无|控制数据|CCU给VIPPCU发送的下平台控制数据。
|给VIPPCU发送CCU的重要数据|FREQ1.8.5|无|CCU的重要数据|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|给VIPPCU发送VIPPCU的重要数据|FREQ1.8.6|无|VIPPCU的重要数据|给VIPPCU发送VIPPCU的重要数据
|转发VIPPCU上注指令参数块|FREQ1.8.7|无|VIPPCU上注指令参数块|需要时，转发VIPPCU上注指令参数块
|接收VIPPCU遥测数据|FREQ1.8.8|VIPPCU遥测数据|无|每个控制周期，接收VIPPCU遥测数据，解包成需要的数据
|接收CCU重要数据返回包|FREQ1.8.9|CCU重要数据|指令|上电/复位后应用软件首先从VIPPC恢复重要数据。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：处理地面遥控注入的用于替换EEPROM的代码
处理：
-  解包EEPROM代码注入包，得到帧号、源地址（SRAM）、目的地址（EEPROM）、注入内容长度；
- 以源地址为起始地址，将注入内容放入该SRAM区域
说明：星务分系统向GNCC送数采用256字节(有效使用249字节)帧格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,0,0,0,1,0
"功能描述：置卫星姿态无控，处于自由飞行状态。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：按指令值，控制星体三轴角速率。
处理：同用户需求的
（1）计算得到用于控制角速度偏差，计算公式见（1）；
（2）进行各轴喷气状态的设置，当ZT43[4]=1允许陀螺自主加电且FlagGyroAdd=1正在给陀螺加电时，设置===0，计算公式见（2）；
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令
（4）对是否转无控模式的计数值FWM进行处理：首先将FWM限幅到1和7E之间；然后判断是否满足下列条件之一，如果满足则FWM减1，否则FWM加1
三轴惯性角速度，的最大值大于0.0116弧度/秒",0,1,0,0,0,0,0,0,0,0,0
功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测,0,0,0,0,0,0,1,0,0,0,0
"功能描述：卫星搜索太阳使得数字/模拟太阳见太阳后，控制卫星，使数字卫星本体-z轴对准太阳(模拟太阳对日时偏置10度)，从而使帆板法线指向太阳，确保能源供应。
输入：DssStateFlag，TShadowTime；滚动数字太阳监视码，俯仰数字太阳监视码；滚动模拟太阳监视码，俯仰模拟太阳监视码，滚动数字太阳输出，俯仰数字太阳输出，滚动模拟太阳输出，俯仰模拟太阳输出",0,1,0,0,0,0,0,0,0,0,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。
功能编号|功能|引用文档
FREQ53|初始化|星敏协议
FREQ54|星敏使用要求|任务书
FREQ55|通信|星敏协议
FREQ56|通信故障处理|任务书
FREQ57|数据解包与转换|星敏协议
FREQ58|星敏数据有效性判断、处理|任务书
FREQ59|星敏模拟量采集、处理|任务书
FREQ60|部件在轨转发（在轨修改）|任务书

3）GPS高精度校时与星敏感器数据的使用
功能描述：根据GPS秒脉冲，秒脉冲广播，进行GPS高精度校时和星敏感器时标处理。
输入：地面遥控指令，GPS秒脉冲，秒脉冲广播，星敏感器数据。
输出：星时，时标，星敏感器数据广播。
处理：",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：星敏感器使用及通信 
需求类别：其他 
软件需求描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
星敏初始化|FREQ34|星敏初始化|B|2
星敏数据采集|FREQ35|星敏数据采集|A|3
数据解包与转换|FREQ36|数据解包与转换|A|4
星敏数据有效性判断|FREQ37|星敏数据有效性判断|A|5
星敏数据曝光时刻计算|FREQ38|星敏数据曝光时刻计算|A|6
星敏数据有效性判断、处理|FREQ39|星敏数据有效性判断、处理|A|7
星敏故障重构|FREQ40|星敏故障重构|C|
",0,0,0,0,0,0,0,0,1,0,0
"模式字定义如下，装订值为0：
模式字|工作模式描述
0|主动段
1|正常对地运行
2|偏航机动
3|全姿态捕获
4|对地捕获
5|帆板未展开
6|轨控
7|无控
8|侧摆机动
9| 侧摆保持
11|入轨段控制
12|自旋模式
13|应急模式
14|星敏全姿态捕获模式

工作模式的转换可分为以下二种情况：
按地面上行注入进行转换：通过注入姿控数据块中的模式字进行转换；
按应用软件用户需求给定的条件判别，由软件自主控制转换：自主转换分两种：一种为正常运行转换；一种为故障时转换。下面分别进行说明
正常转换图为：
正常运行自主转换如下表所示：条件标识原则：ZCCX—Y，其中ZCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。
标识|具体条件
ZCC0—B|星箭分离
ZCCB—1|Tin >4800 
ZCC1—2|
ZCC1—6|
ZCC1—8|且且且
ZCC2—1|
ZCC2—6|
ZCC4—1|FEA=A
ZCC6—1|
ZCC6—2|)且
ZCC8—1|""满足下列条件之一：
若动量轮侧摆且目标侧摆角为0，当姿态角误差小于0.5度，角速度误差小于0.01度/s连续次
若喷气侧摆且目标侧摆角为0，当姿态角误差小于1度，角速度误差小于0.015度/s连续次
若星时大于侧摆机动时间＋600秒且侧摆目标角为0""
ZCC8—9|""满足下列条件之一：
若动量轮侧摆且目标侧摆角不为0，当姿态角误差小于0.5度，角速度误差小于0.01度/s连续次
若喷气侧摆且目标侧摆角不为0，当姿态角误差小于1度，角速度误差小于0.015度/s连续次
若星时大于侧摆机动时间＋600秒且侧摆目标角不为0""
ZCC9—8|""满足下列条件之一：
且
""

故障自主转换如下表所示：条件标识原则：GCX—Y，其中GCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。其中进入应急模式的条件为读到应急线路加电，记为GCC-D。其余的自主故障切换如下图所示：
故障条件定义如下：
标识|具体条件
GCC1—3|FailureFlag=1并且WacqSunFlag =0并且ZT7属于[1，4]区间内
GCC1—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC1—E|FailureFlag=1并且WacqSunFlag=1并且ZT7属于[1，4]区间内
GCC3—7|FailureFlag＝4且AutoInStopNum<2
GCC3—E|SMODE＝3且TSMODE>8000（若ZT11=4则取值为32000）
GCC4—1|FEA=A
GCC4—3|WacqUseIresOrSTSFlag=1且TCOUNT>24000
GCC5—3|脉冲发完后
GCC6—1|FailureFlag＝2且无机动要求
GCC6—2|FailureFlag＝2且无机动要求
GCC7—3|>6900 且AutoInStopNum<2且WacqSunFlag =0
GCC7—E|>6900 且AutoInStopNum<2且WacqSunFlag =1
GCC8—1|FailureFlag=3
GCC9—3|FailureFlag=1并且WacqSunFlag=1并且ZT7属于[1，4]区间内
GCC9—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC9—E|FailureFlag=1并且WacqSunFlag=0并且ZT7属于[1，4]区间内
GCCB—3|FailureFlag=1并且ZT7属于[1，4]区间内
GCCB—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCCE—1|StarCatchFlag=1且(1-()<0.000685)且norm()<0.000875
GCCE—7|TCOUNT>31200或（FailureFlag＝4且AutoInStopNum<2）

AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
功能描述：检测红外的故障，并选取正确的红外信号。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：红外数据处理
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令。
处理：
软件设计时应注意保护Vm，保证此节使用的Vm未在周期性清0处理中被清除。",0,1,0,0,0,0,0,0,0,0,0
功能描述：根据CMG角动量及地磁场强度决定并输出磁棒控制电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：卫星绕俯仰轴转动，直到红外搜索到地球。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：发送模拟量遥测数据包2,0,0,0,0,0,0,0,0,0,0,1
"通讯串口
04H|波特率寄存器|RW|""波特率寄存器低位：0x04（115200）
0x18（19200）""
08H|波特率寄存器|RW|波特率寄存器高位：0x00
CAN总线初始化
寄存器名称|初始化内容|初始化意义
""CAN_ADDR        
(CAN总线地址)""|无。|无说明。
""控制寄存器
(Control Register)
""|0x07|""D7D6D5：保留。
D4：超载（接收设备不能按数据发送速率接收数据而造成的数据丢失）中断使能。
高：开放。低：禁止
D3：错误中断使能。
高：开放。低：禁止
D2：发送中断使能。
高：开放。低：禁止
D1：接收中断使能。
高：开放。低：禁止
D0：复位模式。
在初始化的时候，复位模式位置1，才可以进行初始化设置。""
命令寄存器(Command register)|0x=00001100|""D7D6D5：保留。必须。
D4：进入睡眠状态。
高：睡眠 。低：睡眠唤醒。
D3：清除超载状态。不产生超载中断。
高：清除。低：无动作。
D2：释放接收缓冲器。（读接收缓存器内容后，释放缓存器，以便其他报文立即可用）。
高：释放。低：无动作。
D1：夭折发送。
D0：发送请求。
高：报文即将发送。低：无动作。""
""验收代码寄存器
(Acceptance 
Code Register)""|0xa7=10100111|""当通过验收测试的报文被接收，且若存在空的接收缓存器，则各自的描述符和数据场被顺序存贮在空的缓存器中，在不存在空的接收缓存器的情况下，数据超载位被置位高(超载)，当完整的报文被正确接收，将出现下列操作：
接收缓存器状态位被置为高(满)
若接收中断开放位被置为高(开放)，接收中断被置为高(置位)
验收码位(AC.7~AC.0)和报文标识符的最高8位(ID.10~ID.3)必须等于由验收屏蔽位必须满足""
""验收屏蔽寄存器
((Acceptance 
Mask Register))""|0xf8|最后三位相关。
总线时序寄存器0(Bus Timing Register 0)|0x00|""总线时序寄存器的内容决定波特率预分频器(BRP)和同步跳转宽度(SJW)的数值。

通过总线定时器的内容，将波特率预分频器设置为2，即将输入的系统时钟二分频，由于输入的系统时钟已经是将计算机晶体频率14.7456MHz二分频，即7.3728MHz。所以这个时候时钟为3.6864 MHz。""
总线时序寄存器1(Bus Timing Register 1)|0x18|""采样（SAM）=1总线采样1次。
TSEG1和TSEG2确定每位周期的时钟周期数目和采样点位置：

由于一位周期是由

而

波特率＝""
""时钟分频器
(Clock Divider
register)""|0x40|""D7:CAN模式。
0：基本模式。
D5:1(旁路输入比较器，仅在复位模式下起作用)。""
""OCR
(output Control)""|0x|

在完成上述初始化后，要再次初始化控制寄存器。将最低位初始化为0。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：减小卫星的俯仰角。
输入：陀螺数据输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）
红外数据处理（全姿态捕获）的输出，
上周期姿态角估值，
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据帆板角误差、控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：CMG启动模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，予估q及姿态角（在星测量回路中），等。。
处理：同用户需求的1.6。
STEP1:计算星敏预估角速度，。计算结果的限幅值是0.027。计算公式见1.6（1）。
STEP2:计算q,和，计算公式见1.6（2）。
STEP3:计算，。对于计算结果，当BZ1=8（侧摆机动）时，否则。对于计算结果，。对于计算结果，。计算公式见1.6（3）。",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收遥控注入数据，收到遥控注入结束标识后传输结束。,0,0,0,0,0,0,0,0,0,1,0
"软件需求标识：FREQ4 
软件需求名称：星时计算 
软件需求描述：星时计算。见“任务书”4.1.3.1“星时计算”。",0,0,0,0,0,0,0,0,1,0,0
功能描述：三轴喷气姿态控制。,0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：星时获取 
需求类别：其他 
软件需求描述：计算星上星时。
处理：
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。 ",0,0,0,0,0,0,0,0,1,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
部件故障诊断|对部件进行故障诊断
陀螺故障诊断|由平衡方程方法、星敏感器数据等对陀螺进行故障检测
CMG故障诊断|根据CMG输出数据和理论数据进行CMG故障检测
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止。
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式4、6、7的系统故障诊断|在模式4、6、7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
大量程陀螺通讯故障诊断|大量程通讯故障诊断及处理
CMG通讯故障诊断|CMG通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理",0,0,0,0,0,0,1,0,0,0,0
"功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：当整星－Z 轴对日后，通过旋转Z 轴令目标矢量进入XOZ 平面
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：采集4路动量轮脉冲信息。,0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
|极高星敏感器数据的采集与处理|FREQ1.5.5|极高星敏感器1553B取数指令|极高星敏感器的四元素、角速度状态信息|在通讯允许的条件下（极高星敏感器的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：若连续3个周期判断出星箭分离信号为分离，则置初始速率阻尼模式，对卫星的角速度进行控制。
处理：
自主或指令进入此模式后，进行如下初始设置：
星时赋初值为0.375s；
连续2个周期发送“推进加电”指令；
根据自锁阀状态设置自锁阀1和/或自锁阀2开
发送6个陀螺加电指令，引入6个陀螺信息，且不需要陀螺等待时间
每个控制周期顺序调用用户需求中的逻辑：
轨道与星历；
部件故障检测与信号选取；
陀螺数据处理；
惯性姿态陀螺预估；
速率阻尼；
控制器输入量计算；
if((1<t <60|| t>80)且Flag_equation=0) 调用 相平面喷气脉宽；
模式转换条件：
若t >100，则WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：利用星敏感器B的测量，修正姿态四元数与估计角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送天线数据包
",0,0,0,0,0,0,0,0,0,0,1
"功能描述：系统软件上电复位后，调用应用软件AppInit函数，并根据初始化内容，启动任务
处理：
OBC上电/复位后，由系统软件引导应用软件运行。首先进行初始化，包括系统软件初始化和系统软件调用应用软件提供的初始化函数（AppInit）。启动任务并开始进行任务调度管理。",1,0,0,0,0,0,0,0,0,0,0
"功能编号|功能|引用文档
FREQ86|初始化|预留
FREQ87|模太使用要求|任务书
FREQ88|通信(AD)|任务书
FREQ89|通信故障处理|预留
FREQ90|数据解包与转换|任务书
FREQ91|模太硬件故障处理|预留
FREQ92|模太数据有效性处理|任务书
FREQ93|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：正常对地运行模式控制
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：处理星务返回的重要数据
处理：解包并更新重要数据",0,0,0,0,0,0,0,0,0,1,0
"功能描述：将加计数据换算成卫星三轴加速度和速度增量
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：在轮控机动模式下，轮控滚动/俯仰机动过程中规划目标姿态确定，确定机动力矩和轮子组合。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：
  读入串口数据，将太阳敏感器数据转化为浮点数，将陀螺数据转化为浮点数，结合陀螺故障顶替标志，计算姿态信息（功能编号：FReq-2）。
处理： 
考虑到可靠性，为便于地面观察，程控期间也遥测姿态信息，本节输入处理功能可于每个控制周期执行，运行模式的制约。
（1）DSS数据处理（太阳数据处理时，监视码门槛值取值为0x16）
根据粗码、细码信息，将太阳敏感器数据转化为浮点数，并计算姿态信息：
IF1 SP61/62 = 1
	 ELSE1
	IF2 bbMode = M（巡航）
	ELSE2
	END2
END1
对太敏S61和S62的输入数据进行跳数判断，并影响推力器判断，具体逻辑见任务书5.4.5.2节。
（2）陀螺角速度数据处理
将获取的陀螺角速度信息转化为浮点数，写入wx、wy、wz、ws
结合故障陀螺顶替（陀螺顶替标志bSrepXYZ由程控结束时的陀螺健康字以及陀螺故障诊断信息确定，初始化陀螺不需要顶替）信息，计算陀螺角速度。
如果顶替x轴陀螺
则  wx=wy+wz-1.732*ws
否则 如果顶替y轴陀螺
则  wy=wx-wz+1.732*ws
否则 如果顶替z轴陀螺
则  wz=wx-wy+1.732*ws
否则 不处理
计算陀螺角度积分,并限在(-360, 360)之间；
（3）解析动量轮转速、方向、加电状态等信息。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得9个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据， AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。具体如下表所示： 
GROLTUSeltFlag|进行通讯的陀螺LTU
01H|陀螺LTU1
02H|陀螺LTU2
03H|陀螺LTU3
其它|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1

取数指令由三个字节组成：
第一个字节为对陀螺LTU的命令设置，有四种命令格式：取数指令1、取数指令2、复位指令、地检模式指令，应用软件只自主发取数指令1和取数指令2两种格式，并由注入控制方式指定及LTU通信选择块中的陀螺LTU取数方式来切换，默认为取数指令1；其余两种格式（复位指令和地检模式指令）通过地面注入LTU命令块来设置。
第二个字节为对光纤陀螺的命令设置，有四种命令格式：测量模式1（有温度补偿）、测量模式2（无温度补偿）、地检模式1（只传地面数据）、地地检模式2（地面数据+头部测量数据），由注入控制方式指定及LTU通信选择块中的光纤陀螺指令切换方式字来切换这四种格式，默认为测量模式1（有温度补偿）。
第三个字节为前两个字节的累加和。
另外，每个控制周期AOCC还向选取的陀螺LTU发送取陀螺状态指令，指令为3字节指令（D5、AA、7F），得到的状态信息用于遥测。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式，具体参见LTU通讯协议。
（3）陀螺LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
"根据任务要求，上电或复位时应用软件进行1553B初始化、变量的初始化，功能点包括下表所示：
序号|功能描述|功能编号
|1553B总线（外总线）初始化|FREQ11. 1
|1553B总线（内总线）初始化|FREQ11.2
|变量及其余硬件初始化|FREQ11.3
上电/复位后，系统软件进行相应的初始化工作，之后调用应用软件的AppInit()函数进行应用软件的初始化。应用软件初始化工作主要包括硬件初始化、变量初始化。
硬件初始化的内容如下表所示：
内容|状态
1553B总线（外总线）|按通讯协议要求进行设置
1553B总线（内总线）|按通讯协议要求进行设置
ACU、ICU当班状态设置|见任务书的4.1.16.1

硬件初始化完成后应用软件需对初始值不为0的变量初始化，相应变量的初始化值详见《卫星控制分系统AOCC应用软件用户需求》和《卫星控制分系统上行注入文件》。",1,0,0,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.4|偏置飞行模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.5|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|陀螺标定模式控制|FREQ5.2.11|4.8|陀螺标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.12|4.6|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.4|偏置飞行模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.5|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|陀螺标定模式初始化|FREQ5.3.11|4.8|陀螺标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.12|4.6|惯性定向模式初始化设置

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：模式4切换方式。
处理：
if() 置WorkMode=5，WorkModeT=6，；//程控指令转对地
if(lipse=1且且AutoPermission=1) 置WorkMode＝5；WorkModeT=6；；；//进入阴影区自主转对地
if() 置WorkMode=5；若，若，；WorkModeT=6；
if() 置WorkMode=5；若，若，WorkModeT=6；
收到星务的“辐射定标”指令，置WorkMode=5，WorkModeT=6，；//辐射定标模式，为注入的辐射定标目标角
if(FailureFlag＝1) 置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"序|需求名称|编号|功能和处理描述
|滚动俯仰通道喷气中断服务程序|FREQ81|将滚动俯仰通道相应的推力器关掉
|偏航通道喷气中断服务程序|FREQ82|根据状态字关相应的推力器
|轨控发动机喷气中断服务程序|FREQ83|将轨控发动机关掉，如果有1N轨控则根据轨控状态字关相应的推力器
",0,0,0,0,0,0,0,1,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
功能编号|功能|引用文档
FREQ44|初始化|陀螺协议
FREQ45|陀螺使用要求|任务书
FREQ46|通信|陀螺协议
FREQ47|通信故障处理|任务书
FREQ48|数据解包与转换|陀螺协议
FREQ49|陀螺数据有效性判断、处理|任务书
FREQ50|陀螺模拟量采集、处理|任务书
FREQ51|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
"包括下表的功能点。
序号|功能描述|功能编号
|从ICU接收控制计算机重要数据|FREQ7.7.1
|从OBDH接收控制计算机重要数据|FREQ7.7.2

接收控制计算机重要数据的具体要求见重要数据文件。",0,0,0,0,0,0,0,0,0,1,0
功能描述：若AOCC与星敏感器通讯不成功，则记录星敏感器故障一次。若连续240次不成功，判断该星敏感器故障。若星敏感器连续2000次故障，需重新启动星敏感器。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：紧急撤离模式下，计算视速度增量关机时间长度
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：向LTU和星敏感器发送自检指令，获得自检信息
处理：
（1）每0.524秒对1个部件LTU进行自检，依次为选通的太阳、选通的陀螺、选通的左和右帆板，每4个0.524秒对4个LTU自检一次；
(2）对红外LTU的自检见.3；
(3) 每4秒（8个0.524秒）发送一次星敏感器自检命令数据包（HK1包），；
(4)根据遥测格式将返回的自检信息通过OBDH传至地面。",0,0,0,0,0,0,0,0,1,0,0
功能描述：模拟太阳故障状态。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压、、。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：使用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：发送姿态数据包,0,0,0,0,0,0,0,0,0,0,1
"功能描述：使星体-Z轴捕获太阳，并保持偏置10度的对日定向。
输入：， 陀螺数据处理的输出，；控制周期 (量纲：秒)；
		模拟太阳敏感器状态，LSS输出数据
		模拟太阳敏感器输出： (量纲：弧度)
		计时器",0,1,0,0,0,0,0,0,0,0,0
功能描述：发送模拟量遥测数据包1,0,0,0,0,0,0,0,0,0,0,1
"功能描述：通过注入轨道参数，实时计算卫星轨道参数。
处理： 
由地面注入轨道参数或GPS数据计算的轨道参数（如果GPS引入且数据验证有效），结合当前星时，通过外推公式计算出卫星轨道数据。",0,0,0,0,1,0,0,0,0,0,0
功能描述：对自锁阀进行开关处理。,0,0,0,0,0,0,0,1,0,0,0
"功能描述：设置2类慢帧遥测数据下传顺序
触发条件：模式字改变、数据指令",0,0,0,0,0,0,0,0,0,0,1
"功能描述：检测红外HL及HR故障，并选取正确的红外信号。

处理：
FM3——5.3（1）更改：若ZT35(3)=0，则：当HL通讯自检信号中表明见太阳，则HL = 0。若ZT35(3)=0，则：当HR通讯自检信号中表示见太阳，则HR = 0。
5.3（3）更改：若HL  HR = 1且HL的LTU中的特征位为“数据正常”，则：FHL  FHL + 1。若HL  HR = 1且HR的LTU中的特征位为“数据正常”，则：FHR  FHR + 1。
5.3（4）①更改： ZT5  4，{FHR < 6，HL =0}或{ FHL < 6，HR =0}
5.3（4）③更改： ZT5  4，HL = 1，HR = 0，FHL  6
5.3（4）④更改：ZT5  4，HR = 1，HL = 0， FHR  6
将红外数据有效性互检中的判断逻辑，扣除标称侧摆角度。",0,0,0,0,0,1,0,0,0,0,0
"功能描述：根据给定电压乘电压/力矩系数和角动量变化率之差判断轮子的故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：地垂线捕获后，捕获偏航角，建立对地三轴稳定。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：对帆板驱动装置1和帆板驱动装置2进行独立控制和诊断，一个帆板驱动装置失效不影响对另一个帆板驱动装置的控制与诊断。
",0,0,0,0,0,1,0,0,0,0,0
功能描述：根据CMG输出数据和理论数据进行CMG故障检测及处理。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：利用星敏感器C、D的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用太阳敏感器信息，进行太阳捕获，对太阳定向
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：自主对计算机进行切换。
处理：
AOCC的A机和B机满足一定的条件下，可以进行切换。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：接收遥控固定参数注入块的轨迹规划修正系数
",0,0,0,0,0,0,0,0,0,1,0
功能描述：决定磁卸载或喷气卸载方式,0,1,0,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
CMG 1数据的采集与处理|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 2数据的采集与处理|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 3数据的采集与处理|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 4数据的采集与处理|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 5数据的采集与处理|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 控制指令的输出处理|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
CMG的程序注入修改|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
CMG的内存下传|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,0,0,0,1,0,0
"软件需求标识：FREQ18 
软件需求名称：模拟太敏数据处理 
需求类别：其他 
软件需求描述：模拟太敏数据处理。",0,0,0,0,0,0,0,0,1,0,0
功能：姿态角、角速度与姿态四元数预估。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：与星敏感器通讯获得星敏感器数据状态，修改星敏感器程序。
输出：星敏感器命令包、星敏感器故障标志、定姿标志、位输出。
处理：
光行差修正的初始设置为：AOCC应用软件不对Astro10星敏信息进行补偿计算，而仅每150秒向星敏发送相对J2000的速度。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：实时计算卫星轨道参数及太阳方位，太阳敏感器理论输出。
处理：同用户需求的4.2。为防止t-t0过大导致系统切机，在轨道计算中增加时间超差不调用轨道计算，仅外推轨道幅角；太阳星历的计算仍然调用。
STEP1：计算卫星轨道根数。计算公式见4.2(1)；
STEP2：计算太阳轨道和太阳敏感器理论输出，其中岁差补偿公式有更改，Cbo的计算公式改用红外定姿姿态。计算公式见4.2(2)；
STEP3：若FlagIresOrbSun=0，则FHSL=FHSR=1左右红外都不见太阳。FlagIresOrbSun是注入内存修改变量，若注入修改令FlagIresOrbSun=1，则引入红外软件见太阳保护。
STEP4：若计算的轨道半径r和相差以上，或计算的轨道角速度和0.001108rad/s相差0.00008以上，则判定轨道计算偏差太大，置BZ2=4，同时置r=6871，=0.001108，。",0,0,0,0,1,0,0,0,0,0,0
"功能描述、输入、输出、。
序号|功能点编号|功能描述|说明
|FREQ3.4.4.1|加计数据处理|《用户需求》4.2.1
|FREQ3.4.4.2|陀螺数据处理|《用户需求》4.2.2
|FREQ3.4.4.3|陀螺的姿态预估|《用户需求》4.2.3
|FREQ3.4.4.4|星敏感器A姿态修正|《用户需求》4.2.4.1
|FREQ3.4.4.5|星敏感器B姿态修正|《用户需求》4.2.4.2
|FREQ3.4.4.6|星敏感器C姿态修正|《用户需求》4.2.4.3
|FREQ3.4.4.7|太阳捕获及对日定向|《用户需求》4.2.5
|FREQ3.4.4.8|轨控目标姿态角速度和四元数|《用户需求》4.2.6
|FREQ3.4.4.9|误差四元数计算|《用户需求》4.2.7
|FREQ3.4.4.10|陀螺在轨标定|《用户需求》4.2.8
|FREQ3.4.4.11|相对天东北系姿态计算|《用户需求》4.2.9
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
处理：
OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,0,0,0,1
"包括下表的功能点。
序号|功能描述|功能编号
|向ICU发送控制计算机重要数据|FREQ7.6.1
|向OBDH发送控制计算机重要数据|FREQ7.6.2

发送控制计算机重要数据的具体要求见重要数据文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：接收遥控固定参数注入块的姿态偏置系数
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：在完成对日定向后，。
输入：陀螺数据处理的输出 ，
太阳星历的输出，
数字太阳敏感器输出：, （量纲：弧度）
红外地球敏感器数据有效性标志F_IresValid（由数据有效性判据给出）
数字太阳敏感器数据有效性标志F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出），
红外数据有效性输出 ，
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的帆板参数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集高速转速、计算角动量偏差、合成角动量、CMG的Jacobi矩阵。
输入：CMG 高速的标称角动量Hwb[i]，CMG状态标志Fcmg[i]；(i=1~5)
输出：使用的CMG角动量sgH（Nms），为35 矩阵；
使用的CMG系统合成角动量H=[Hx，，Hz]T（Nms）；
实测角动量Hw[i]（Nms）；
CMG的Jacobi矩阵sgJ，为35 矩阵；
CMG的框架角度Sgang[i]（弧度）；
三轴角动量偏差，",0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示（十六进制）：
服务编码|发送的条件
58H|上电/复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次。
38H|每隔1分钟或模式改变时发送
96H|待定
69H|进入全姿态捕获模式后发送，收到确认字后停止发送
8CH|进入无控模式后发送，收到确认字后停止发送
C8H|BAPTA异常跟踪后发送，收到确认字后停止发送
",0,0,0,0,0,0,0,0,0,0,1
功能描述：计算得到的控制电压输出给动量轮。,0,0,0,0,0,0,0,1,0,0,0
"功能描述：追踪器GPS数据有效性判断及处理 
处理：见《卫星GNC分系统GNC计算机应用软件用户需求》的P48-P49。",0,0,0,0,1,0,0,0,0,0,0
功能描述：偏置动量轮处于力矩模式，根据红外或星敏测量信息计算得到的滚动角和俯仰角实现三轴姿态控制。滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制。,0,1,0,0,0,0,0,0,0,0,0
功能描述：接收OBDH时间数据,0,0,0,0,0,0,0,0,0,1,0
"功能描述：检测系统故障，给出故障标志。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
调用条件：有发送和接收OBDH重要数据命令字时
输入：OBDH重要数据地址中内容
输出：OBDH重要数据地址中内容。
处理：具体处理要求见与外总线通讯协议。",0,0,0,0,0,0,0,0,0,0,1
"太阳捕获控制的流程如下：
  if(WacFlag=2) 调用太阳搜索；
  else if(WacFlag=3) 调用对太阳定向；
  else if(WacFlag=4) 
{if (SSTCatchSuc＝0) 调用星敏感器对日定向；
else {  调用四元数陀螺预估；
调用、利用星敏感器的姿态确定；}
}
  else 调用速率阻尼。",0,1,0,0,0,0,0,0,0,0,0
功能描述：根据注入轨道参数计算太阳轨道、方位与其他参数。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：地面注入数据处理
说明：计算目标器GPS时，将输入、输出改为目标器的相应变量。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理：包括CPU内部星时时钟和CPU外部星时时钟的星时采集计算与校时。。
（1）CPU外部星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期星时锁存寄存器中读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU外部星时时钟星时校时包括OBDH校时和GPS高精度校时两种校时方式：
OBDH校时：也分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；
GPS高精度校时。
OBDH星时校时为系统默认使用的校时方式。GPS秒脉冲高精度时间是否引入系统由注入指令执行控制：若注入指令表示“使用GPS秒脉冲高精度校时时间”，则当满足GPS秒脉冲高精度校时条件时AOCC应用软件仅进行GPS秒脉冲高精度校时时间的计算，系统使用该时间。GPS秒脉冲高精度方式优先级高于OBDH星时校时，当GPS秒脉冲校时时不再进行OBDH星时校时。如果连续超过1分钟均不满足GPS秒脉冲高精度校时条件，则可进行OBDH星时校时。一旦再满足GPS秒脉冲高精度校时条件则继续采用GPS秒脉冲高精度校时。其中GPS秒脉冲高精度校时条件及校时计算具体见任务书中规定。
（2）CPU内部星时时钟的星时采集计算与校时
CPU内部星时时钟星时计算方法。同CPU外部星时时钟星时计算；CPU内部星时时钟星时校时只包括OBDH校时：分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时。
星时的选取
根据注入的姿控数据块2中的CPU星时时钟选用标志来实现内部星时时钟和外部星时时钟的切换，默认为CPU外部星时时钟
均匀校时
内部和外部时钟星时计算中在计算完本周期绝对星时后增加每周期修正量，并在计算前先将它限幅到1毫秒，每周期的修正量初始为0，通过内存修改来修改该修正量。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。
",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：星时校正 
需求类别：其他 
软件需求描述：校正星上星时。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：发送全姿态捕获模式数据包,0,0,0,0,0,0,0,0,0,0,1
"功能描述：太阳地球捕获主程序。
",0,0,1,0,0,0,0,0,0,0,0
OBDH重要数据有两块，大小共为128字节，AOCC不做任何改动保存在RAM中。如果AOCC发生复位，应利用方式代码请求服务，索取OBDH重要数据进行保存。若在大于0.256s的时间内仍未收到接收OBDH重要数据的指令，则重新请求服务，同时索要OBDH重要数据的计数器累加，若此计数器大于等于40，则不再索要OBDH重要数据。若索要OBDH重要数据成功，将此计数器清零。,0,0,0,0,0,0,0,0,0,0,1
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""",1,0,0,0,0,0,0,0,0,0,0
"功能描述：根据需求，计算去往巡天模式机动过程中所需的目标姿态
",0,0,1,0,0,0,0,0,0,0,0
功能描述：红外数据处理,0,0,0,0,0,0,0,0,1,0,0
"上行注入功能是地面干预星上运行状态的重要手段，主要是指OBDH通讯协议中定义的控制分系统“接收遥控注入数据”功能。上行注入数据块由地面发送到OBDH分系统，再由OBDH分系统通过B总线发送到AOCC执行。包括下表的功能点。
序号|功能描述|功能编号
|轨道数据块|FRE74
|姿控数据块1|FRE74.1
|姿控数据块2|FRE74.2
|LTU通信选择块|FRE74.3
|故障诊断标志块|FRE74.4
|星敏感器命令块|FRE74.5
|惯性调姿命令块|FRE74.6
|轨控命令块|FRE74.7
|SDC命令块|FRE74.8
|LTU命令块|FRE74.9
|内存修改块|FRE74.10
|应急控制器注入块|FRE74.11
|系统软件标志修改块|FRE74.12
|程序块|FRE74.13
|相平面系数块|FRE74.14
|轮控系数1及磁控系数|FRE74.15
|轮控系数块2|FRE74.16
|陀螺脉冲当量系数块|FRE74.17
|星敏修正系数块|FRE74.18
|条件判断、阀值和限幅相关数据块|FRE74.19

具体的内容见注入文件。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：当AOCC出现故障时，转入应急线路进行卫星姿态应急控制。
处理
在应急安全模式下，姿态控制工作交由M完成。
应用软件判断进入应急安全模式后，进行下列状态设置：
进入应急模式后，主备份ALTU被M断电，5个CMG的高速断电，低速框架当前位置保持；
	设置控制模式为“应急安全模式”；
	继续进行控制分系统星时计算；
	敏感器信息采集，继续进行轨道和姿态计算；
	磁力矩器和喷气控制量输出均为0，CMG输出全0无效指令，AOCC继续根据当班标志与ALTU 进行通信，并遥测每个控制周期通信状态，对通信失败次数进行循环累计，但不进行通讯故障诊断切换；
	停止对天线控制计算，通信；
	继续响应星务分系统的通信要求。
应用软件退出应急安全模式时，进行下列状态设置：
	发数据遥控指令“太阳捕获模式”，使AOCC退出应急安全模式，进入太阳捕获模式。
	确定ALTU通讯正常后，发星务直接遥控指令给断电；AOCC查询加电标志（地址见表3-3），进行3取2判断，若连续16个控制周期为断电状态且允许退出应急模式，AOCC退出应急安全模式，进入太阳捕获模式",0,0,0,1,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的外1533B接收子地址内存管理区,0,0,0,0,0,0,0,0,0,1,0
功能描述：对二次电源使用、故障切换。,0,0,0,0,0,0,0,1,0,0,0
"软件需求名称：推进系统操作 
需求类别：其他 
软件需求描述：对自锁阀、推力器进行操作。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：根据需求，计算去往定点观测模式机动过程中所需的目标姿态。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：利用陀螺确定出卫星对目标的姿态四元数。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：滚动通道喷气中断处理程序。
处理：将推力器1-8关掉",0,0,0,0,0,0,0,1,0,0,0
"软件需求名称：姿态确定算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.4.1|陀螺姿态预估|《用户需求》4.4.1|
FREQ12.3-R4.4.2|星敏感器陀螺确定惯性姿态|《用户需求》4.4.2|
FREQ12.3-R4.4.3|中继跟踪目标姿态计算|《用户需求》4.4.3|
FREQ12.3-R4.4.4-K|太阳捕获及太阳定向|《用户需求》4.4.4|
FREQ12.3-R4.4.5|轨控目标姿态计算|《用户需求》4.4.5|
FREQ12.3-R4.4.6|误差四元数计算|《用户需求》4.4.6|
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：视线目标的姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：帆板未展开模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：使星体−Z 轴对日定向，星体偏航姿态为零，适当时重捕地球。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：将F_CMGValid指定工作的CMG框架角保持在标称框架位置。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据地面指令ZT3,ZT42,ZT43，给无故障陀螺自主加电。
处理：同用户需求的。
（1）可以进行陀螺自主加电的条件：①或②
①{6个陀螺中至多只有1个有故障，即姿控数据块中ZT42的低4位和ZT43的低2位中至多只有1位等于1}且{加电陀螺不足5个，即姿控数据块中ZT15的低4位和ZT16的低2位中至多只有4位等于1}；
②{ZT3=A，即“星敏无陀螺定姿，且接入控制回路，整星零动量控制方式”或ZT3=B或ZT3=F}且{6个陀螺中至少有3个正常，即姿控数据块中ZT42的低4位和ZT43的低2位中至少有3位等于1}。
（2）陀螺自主加电的步骤：
STEP1:若满足条件(1)②，则根据ZT42,ZT43按陀螺1至6的升序开启3个正常陀螺，设置ZT15,ZT16相应位为1，并设置BZ3=ZT15，BZ4=ZT16；否则若满足(1)①，则{若ZT42,ZT43显示6个陀螺都正常，则开陀螺12356；否则根据ZT42,ZT43开启5个正常的陀螺}，设置ZT15,ZT16相应位为1。
STEP2:加电后设置陀螺正在加电标志FlagGyroAdd=1（正在加电）。令工作陀螺计分为0FH。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
在模式切换中以地面上行注入优先，所有模式都可以通过地面注入的模式运行类指令进行转换。下面主要分析自主转换换条件与过程，具体转换条件见用户需求4.1~4.11的模式转换条件。4.4姿态机动模式喷气机动转对地或保持的条件中姿态角控制量判据中由0.000262mΦM4改为0.0262mΦM4。    ",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收时间码
处理： OBDH分系统每1分钟给AOCC校时一次。",0,0,0,0,0,0,0,0,0,1,0
功能描述：单独使用星敏诊陀螺。,0,0,0,0,0,1,0,0,0,0,0
" 软件需求名称：轨道控制算法 
需求类别：其他 
软件需求描述：轨控速度增量计算及轨控发动机选择。《用户需求》4.7。 ",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：部件数据处理及状态选择 
需求类别：其他 
软件需求描述：部件数据采集、剔野和选择处理。",0,0,0,1,0,0,0,0,0,0,0
功能描述：检测推力器的泄露，必要时做相应的主备份切换。,0,0,0,0,0,1,0,0,0,0,0
功能描述：根据注入轨道参数计算地磁场强度。,0,0,0,0,1,0,0,0,0,0,0
功能描述：计算光行差的修正参数，数字太阳敏感器输出角估值。,0,0,0,0,1,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0|主动段|FREQ56
1|正常对地运行|FREQ57
2|偏航机动|FREQ58
3|全姿态捕获|FREQ59
4|对地捕获|FREQ60
5|帆板未展开|FREQ61
6|轨控|FREQ62
7|无控|FREQ63
8|侧摆机动|FREQ64
9| 侧摆保持|FREQ65
11|入轨段控制|FREQ66
12|自旋模式|FREQ67
13|应急模式|FREQ68
14|星敏全姿态捕获模式|FREQ69

主动段工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定和姿态和轨道控制的如下所示
|模式字
|E
卫星轨道外推计算|√
GPS轨道计算|√
太阳星历计算|√
地面站位置计算|√
岁差章动计算|√
地磁场计算|√
偏流角计算|
陀螺数据处理|√
惯性姿态陀螺预估|√
对地姿态陀螺预估|
四元数陀螺预估|
红外输出的数据处理|√
太阳输出的数据处理|√
红外的姿态修正|
红外与太阳双矢量定姿|
红外太阳姿态修正|
星敏感器数据处理|
星敏感器A姿态修正|
星敏感器B姿态修正|
星敏感器C姿态修正|
星敏感器A、B姿态修正|
星敏感器A、C姿态修正|
星敏感器B、C姿态修正|
对地姿态修正及星敏粗姿态计算|
仅星敏感器A的姿态修正|
仅星敏感器B的姿态修正|
仅星敏感器C的姿态修正|
仅星敏感器AB的姿态修正|
仅星敏感器AC的姿态修正|
仅星敏感器BC的姿态修正|
–Z轴捕获太阳及对日定向|
偏航捕获及转对地定向|
星敏感器全姿态捕获|√
侧摆目标姿态确定|
姿态控制量计算|√
相平面法|√
姿态喷气控制|√
动量轮摩擦补偿计算|√
动量轮角动量保持的PI控制|√
动量轮启动与保持|√
正常飞行动量轮分配电压计算|
结构滤波器计算|
 喷气卸载条件计算|
磁卸载控制|
运行段帆板控制|
太阳帆板自主跟踪控制|
无控模式下太阳帆板控制|
数传天线指向控制|
偏置动量轮分配电压计算|

在正常运行模式下主要有三种定姿方式：红外定姿、红外太阳定姿和星敏定姿。其中星敏定姿为高精度定姿方式。并可采用有陀螺和无陀螺方式，正常情况下为有陀螺。定姿方式的切换通过注入系统定姿方式字和系统故障诊断来实现切换。在模式2和6的初始化中删除了红外定姿的设置，调用流程中增加了星敏定姿的姿态角计算，可以在星敏定姿下变轨。太阳全姿态捕获模式(BZ1=3)和星敏感器全姿态捕获模式(BZ1=E)初始化中增加取消偏流角修正计算的操作。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：NSMU初始化
处理：
初始化类型|自主切换允许标志|NSMUState
上电|允许|主份，发主开备关
上电|允许|备份，发备开主关
上电|允许|主份，发主开及备关
上电|允许|空闲
",1,0,0,0,0,0,0,0,0,0,0
功能描述：由平衡方程方法进行陀螺的故障检测。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：仅利用星敏感器B的测量，修正姿态四元数与姿态角速度移。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.3|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.4|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1|地面站赤经赤纬计算
|运行段帆板控制|FREQ4.12|5.5.1|三轴稳定模式下的帆板控制
|太阳帆板自主跟踪控制|FREQ4.13|5.5.2|根据帆板角误差、控制帆板跟踪太阳
|数传天线指向控制|FREQ4.14|5.6.2|根据指令完成数传天线的指向控制
|中继轨道计算|FREQ4.21|5.7.1|根据指令完成数传天线的指向控制
|中继天线指向控制|FREQ4.22|5.7.2和5.7.3|根据指令完成中继天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|双脉冲变轨|FREQ4.21|""任务书的
4.2.3""|根据地面注入的指令可实现两次轨控的功能
|3CMG框架角速度 指令解算|FREQ4.22|5.4.2.6|当采用3CMG进行姿态控制时，根据控制器计算出的力矩，实现CMG的框架角速度解算。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：利用星敏感器B的测量，修正姿态四元数与估计角速度。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的轨道参数
处理：
GPS无效判断的连续次数变量由1改为7。
调整序号14注入轨道根数有效性阀值、序号16~18岁差章动系数的初装值。",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：自旋模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：使用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据-Y帆板角误差控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：与星敏感器通讯，获得星敏感器数据。
处理：
在使用Astro10星敏感器之前需对星敏感器进行初始化，完成后向星敏感器发出R有效信号，并通过串行口得到星敏感器提供的数据。在AO与星敏感器通信过程中，AO始终处于主动状态。当AO发出R信号下降沿后星敏感器在5ms内返回数据，AO在接收完数据后把R信号置高电平，星敏感器在R信号的上升沿之后的1ms内停止发送数据。
tro10星敏感器通讯故障时，不使用Astro10星敏感器数据进行姿态修正。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收时间码
处理： 记录收到时间码时对应的GPT的计数值和时间码值，并设置相应的标志。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：根据陀螺输入，预估卫星惯性姿态的变化。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：发送姿态机动过程参数包。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：计算给控制器的姿态和角速度误差。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：实现运行段姿态、帆板和天线的控制。
处理：
（1）Call  （飞轮控制）
（2）若ZT8  3，ZT9  3，ZT，ZT3  B ，{{BZ1 ≠ 8，{{FHU=A，ZT2=2，FWH ≠ 22}或ZT2≠ 2或FWH =22}}或{ BZ1 = 8，FRTS = 1}}，则：
Call  （运行段喷气姿态控制）
（若ZT3 = F，则每4秒Call  一次）（不调用喷气控制时确认电磁阀全关）
（3）若ZT7  8，则： 
Call  （运行段帆板控制）
若ZT7 = 0，则：发两翼帆板归零指令
若ZT7 = 3，则：发左翼为90度，右翼为 -90度指令
若ZT7 = 5，则：发左右皆为90度指令
若ZT7 = 7，则：发左右皆为180度指令
（4）Call  5.9（陀螺故障检测及选择）
（5）若BZ1 = 1或8或9，ZT40(4) = 1，则：
Call  1.7（数传天线捕获跟踪控制）",0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|各种状态数据|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|喷气脉宽、MW控制电压和磁力矩器控制脉宽|控制指令消息的输出|根据通讯协议，将计算得到的控制数据转换为消息需要的格式并输出。
|MW数据的采集与处理|FREQ1.8.4|""ACU的MW数据采集指令
""|MW的角动量|在通讯允许的条件下，每周期向ACU RT发MW数据采集指令，获得ACU数据并处理成对应的MW的角动量。
|部件加断电指令的处理|FREQ1.8.5|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.6|保存CCU的重要数据|接收CCU的重要数据|AOCC每三个控制周期将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.7|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|FREQ1.8.8|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.9|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.10||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令
",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|CMG 1数据的采集与处理|FREQ1.9.1|""CMG 1
1553B取数指令
""|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 2数据的采集与处理|FREQ1.9.2|""CMG 2
1553B取数指令
""|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 3数据的采集与处理|FREQ1.3.3|""CMG 3
1553B取数指令
""|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 4数据的采集与处理|FREQ1.9.4|""CMG 4
1553B取数指令
""|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 5数据的采集与处理|FREQ1.9.5|""CMG 5
1553B取数指令
""|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 控制指令的输出处理|FREQ1.9.6|计算得到CMG的控制数据|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
|CMG 6数据的采集与处理|FREQ1.9.7|""CMG 6
1553B取数指令
""|CMG 6的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 6的当班标志为1），每周期向CMG 6 RT发取数指令，获得CMG 6数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG的程序注入修改|FREQ1.9.8|从OBDH收到的CMG需修改程序内容|CMG需修改程序内容|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
|CMG的内存下传|FREQ1.9.9|从OBDH收到的CMG内存下传设置指令|内存下传设置指令|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发送AOCC内存数据块
处理：OBDH从遥控接收到AOCC内存数据下卸指令后，向AOCC发送内存设置命令，通知AOCC内存数据下卸的段地址、偏移量及下卸长度；OBDH发出内存设置命令后100ms，开始接收AOCC内存数据。其处理过程如下：
STEP1：AOCC应用程序接收到OBDH内存下卸的指令后，进入OBDH中断服务程序（INT1）；
STEP2：AOCC应用程序读出OBDH注入的段地址、偏移地址和数据长度；
STEP3：根据段地址，偏移地址计算下卸内容的地址，并进行合法性判别。
STEP4：根据计算出的下卸内容的起始地址和长度，将下卸内容放入OBDH规定的内存中 。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：利用数字太阳信息，进行太阳捕获，对太阳定向。
输入：5.2.17.2的输出 ， 
计时器TShadow，
数字太阳敏感器状态F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出），
数字太阳敏感器输出,（量纲：弧度）
上周期姿态角估值，",0,0,1,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.5|偏置飞行模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|匀角速度匀积分时间跟踪模式控制|FREQ5.2.7|4.7|一般轨迹跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.9|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|凝视姿态跟踪模式控制|FREQ5.2.11|4.12|凝视姿态跟踪模式控制调用流程
|测试与标定模式控制|FREQ5.2.12|4.8|测试与标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.13|4.13|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.5|偏置飞行模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|匀角速度匀积分时间跟踪模式初始化|FREQ5.3.7|4.7|一般轨迹跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.9|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|凝视姿态跟踪模式初始化|FREQ5.3.11|4.12|凝视姿态跟踪模式初始化设置
|测试与标定模式初始化|FREQ5.3.12|4.8|测试与标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.13|4.13|惯性定向模式初始化设置

主动段和无控工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：
处理
",0,0,0,0,0,0,1,0,0,0,0
功能描述：接收遥控固定参数注入块的系统轨控调姿及轨控姿态控制系数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：分支号与喷管对应选择

处理：
序号|分支状态|姿控分支标志|姿控发动机|轨控分支标志|轨控发动机
1|A、B、C分支都好|A|A1|BC|B1
1|A、B、C分支都好|A|A2|BC|B2+B3+C2+C3
1|A、B、C分支都好|A|A3|BC|B5
1|A、B、C分支都好|A|A4|BC|B4
1|A、B、C分支都好|A|A6|BC|B6+B7+C6+C7
1|A、B、C分支都好|A|A5|BC|B8+B9+C8+C9
2|A、B分支好|A|同A分支|B|同BC
2|A、B分支好|A|同A分支|B|B2+B3
2|A、B分支好|A|同A分支|B|同BC分支
2|A、B分支好|A|同A分支|B|同BC分支
2|A、B分支好|A|同A分支|B|B6+B7
2|A、B分支好|A|同A分支|B|B8+B9
3|A、C好|A|同上|C|C1+C10
3|A、C好|A|同上|C|C2+C3
3|A、C好|A|同上|C|C5
3|A、C好|A|同上|C|C4
3|A、C好|A|同上|C|C6+C7
3|A、C好|A|同上|C|C8+C9
4|B、C好|C|C6+C9|B|同B分支
4|B、C好|C|C7+C8|B|同B分支
4|B、C好|C|C1|B|同B分支
4|B、C好|C|C10|B|同B分支
4|B、C好|C|C2|B|同B分支
4|B、C好|C|C3|B|同B分支
5|A好|A|同A分支|0|无效
6|B好|0|无效|B|同B分支
7|C好|C|同C分支|0|无效",0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。
|红外2数据的采集与处理|FREQ1.3.2|""红外2
1553取数指令""|红外2的弦宽和前基|在通讯允许的条件下（红外2的当班标志为1），向红外2 RT发取数指令，获得红外2数据并处理成对应的弦宽和前基。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：判断陀螺的使用范围。
输入：	本控制周期内采样的陀螺角度增量 (量纲：弧度) （=,…,）
      	上周期陀螺数据
      	标志 N_GyroDiagnV
处理
对陀螺数据进行有效性判断。若某个陀螺故障或某个陀螺为新上电，则不进行有效性判断（陀螺不引入）。其中陀螺新加电有三种情况1、判断出陀螺故障且允许自主加电情况下，应用软件自主加电。2、数据指令加电。3、脉冲遥控指令加电。对于新加电陀螺，则在该陀螺加电时间小于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为0；当该陀螺加电时间大于等于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为1。
若SLTU陀螺不加电或该陀螺故障，不引入。当“允许使用电源状态诊断陀螺”时，应用软件根据与SLTU通讯得到的陀螺电源状态确定陀螺加断电状态；当“不允许使用电源状态诊断陀螺”时，应用软件只根据数据指令确定陀螺加断电状态。若SLTU得到的六个电源状态均断电，则不根据电源状态判断陀螺是否加电。",0,0,0,0,0,0,1,0,0,0,0
功能描述：计算定点观测模式下的目标姿态TI C 和帆板理论转角。,0,0,1,0,0,0,0,0,0,0,0
"    各个模式切换的功能点列表如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ5.1.0|4|主动段模式切换条件判断及转出设置
|入轨段控制模式切换|FREQ5.1.1|4.1|入轨段控制模式切换条件判断及转出设置
|正常对地运行模式切换|FREQ5.1.2|4.2|正常对地运行模式切换条件判断及转出设置
|点对点机动模式切换|FREQ5.1.3|4.3|点对点机动模式切换条件判断及转出设置
|姿态/角速度预置模式切换|FREQ5.1.4|4.4|姿态/角速度预置模式切换条件判断及转出设置
|偏置飞行模式切换|FREQ5.1.5|4.5|偏置飞行模式切换条件判断及转出设置
|匀地速跟踪模式切换|FREQ5.1.6|4.6|匀地速跟踪模式切换条件判断及转出设置
|匀角速度匀积分时间跟踪模式切换|FREQ5.1.7|4.7|一般轨迹跟踪模式切换条件判断及转出设置
|轨控模式切换|FREQ5.1.8|4.9|轨控模式切换条件判断及转出设置
|全姿态捕获模式切换|FREQ5.1.9|4.10|全姿态捕获模式切换条件判断及转出设置
|无控模式切换|FREQ5.1.10|4.11|无控模式切换条件判断及转出设置
|凝视姿态跟踪模式切换|FREQ5.1.11|4.12|凝视姿态跟踪模式切换条件判断及转出设置
|测试与标定模式切换|FREQ5.1.12|4.8|测试与标定模式切换条件判断及转出设置
|惯性定向模式切换|FREQ5.1.13|4.13|惯性定向模式切换条件判断及转出设置

切换条件具体见用户需求4。CCU切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
功能描述：由GPS得到轨道外推的16根数。,0,0,0,0,1,0,0,0,0,0,0
功能描述：根据方向余弦阵计算姿态角,0,0,1,0,0,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器。                                                                                                                                                                                                                                                                                                                                                                                                                                                       输入：标志F_JetGroup，F_SatStage
姿态角与角速度：
正常模式星敏感器与陀螺定姿输出(F_NoGyro=0或2) 
，(量纲：弧度)
，(量纲：弧度/秒)
或：正常模式星敏感器定姿输出(F_NoGyro=1或3时)
(量纲：弧度)
(量纲：弧度/秒)
或：机动与轨控模式姿态输出(无量纲)，(量纲：弧度/秒)
或：其它情形相应程序的输出
，(量纲：弧度)
，(量纲：弧度/秒)
，(量纲：度)
输出：	喷气状态，
各推力器分配脉宽，
累计三轴姿控正向喷气时间：，
累计三轴姿控负向喷气时间：，
=[，]T(量纲：弧度/秒2)",0,1,0,0,0,0,0,0,0,0,0
功能：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星对地姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送姿态数据包、红外太阳敏感器数据包、星敏感器数据包、姿态控制数据包、天线数据包、轨道数据包、部件工作状态数据包、系统工作状态数据包、全姿态捕获模式数据包、模拟量遥测数据包。
处理：数据内容见《卫星控制分系统数字量遥测数据格式定义》。
要求应用软件设计时，对角速度相关的遥测参数采取平滑处理，并将处理后的结果遥测输出（高精度数据包中记录的角速度相关数据不采用平滑处理），平滑处理要求为本周期输出的遥测值为最近8个控制周期该遥测参数的平均值。需采取平滑处理的遥测参数包括不同定姿方式下的三轴角速度遥测（dφ/dθ/dψ、//、/）以及角速度误差遥测（//）。",0,0,0,0,0,0,0,0,0,0,1
功能描述：太阳数据处理,0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：帆板控制算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.6.1|帆板控制策略|《用户需求》4.6.1|
FREQ12.3-R4.6.2|帆板控制量确定|《用户需求》4.6.2|
FREQ12.3-R4.6.3|帆板控制指令转速计算|《用户需求》4.6.3|
",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：接收总线指令 
需求类别：其他 
软件需求描述：接收并处理总线指令。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收遥控固定参数注入块的系统安全模式姿态控制器系数
处理：
调整安全模式偏航角偏差限幅的初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集3路模拟磁强计信息。
处理：
采集方法：连续采集3路，采集1路的操作步骤（以X通道磁强计模拟量）：
向选通地址输出偏移地址：0x1200 0000 = 15H；
等待至少100µs,启动A/D转换：0x1200 0040 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0040 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果； ",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收GPS数据
处理：将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据、定轨数据和GPS秒脉冲对应的整秒时刻的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用红外、数字太阳敏感器确定姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：轨控姿态机动模式控制
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0,0,0,0
功能描述： GPS定轨主程序，包括GPS数据有效、无效时的操作。,0,0,0,0,1,0,0,0,0,0,0
