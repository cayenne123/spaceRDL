Requirements Description,功能需求/初始化,功能需求/控制计算/姿态控制,功能需求/控制计算/姿态确定,功能需求/控制计算/模式管理,功能需求/控制计算/轨道计算,功能需求/控制计算/运行时保障/故障诊断和处理,功能需求/控制计算/运行时保障/数据有效性判断,功能需求/控制输出,功能需求/数据采集,功能需求/遥控,功能需求/遥测
"功能描述：红外数据处理
",0,0,0,0,0,0,0,0,1,0,0
功能描述：设置7类快帧遥测数据下传顺序,0,0,0,0,0,0,0,0,0,0,1
"功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。
",0,0,1,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
CMG 1数据的采集与处理|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 2数据的采集与处理|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 3数据的采集与处理|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 4数据的采集与处理|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 5数据的采集与处理|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 控制指令的输出处理|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
CMG的程序注入修改|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
CMG的内存下传|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：CMG奇异状态的判断及算法计算。
输入：采集得的各CMG的框架角Sgang[i]（弧度）；CMG有效性标志Lcmg[i]，Jacobi矩阵sgJ",0,1,0,0,0,0,0,0,0,0,0
功能描述：机械陀螺数据处理,0,0,0,0,0,0,0,0,1,0,0
"应用软件共分21个工作模式，分别是等待段、太阳定向、恒星定向2、惯性调姿、恒星定向4、轨控定向、着陆准备、主减速、快速调整、接近下降、悬停、避障、缓速下降、自主定位、起飞准备、垂直上升、上升调姿、轨道入射、星光环月、速率阻尼和无控。模式字和各模式的对应关系如下：
表5.2.4.4-1 工作模式
模式字|工作模式|使用场合
0|等待段|""加电之后，判出分离27s之前，
或复位之后，重要数据恢复之前。""
1|太阳定向|""组合体地月转移巡航和环月阶段正常运行状态；
上升器远程引导巡航""
2|恒星定向2|变轨建立点火姿态前
3|惯性调姿|变轨建立点火姿态
4|恒星定向4|变轨建立点火姿态后
5|轨控定向|""动力下降之前的轨控
月面上升之后的轨控""
6|着陆准备|建立着陆点火姿态
7|主减速|动力下降
8|快速调整|动力下降
9|接近下降|动力下降
10|悬停|动力下降
11|避障|动力下降
12|缓速下降|动力下降
13|自主定位|月面工作阶段
14|起飞准备|建立月面起飞初始状态
15|垂直上升|月面上升
16|上升调姿|月面上升
17|轨道入射|月面上升
18|星光环月|月球轨道交会对接自主段
19|速率阻尼|轨控姿态超差
20|无控|动力下降着陆、交会对接段轨道器最后逼近、故障
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ82|初始化|任务书
FREQ83|地检使用要求|任务书
FREQ84|通信(串口)|任务书
FREQ85|通信故障处理|任务书
FREQ86|数据解包与转换|任务书
FREQ87|地检数据有效性判断、处理|任务书
FREQ88|地检模拟量采集、处理|预留
FREQ89|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|甚高三浮陀螺数据的采集与处理|FREQ1.2.1|""甚高三浮陀螺1553B取数指令
""|陀螺1-6的速度增量|在通讯允许的条件下（每个甚高陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|甚高光纤陀螺数据的采集与处理|FREQ1.2.2|甚高光纤陀螺1553B取数指令|陀螺7-9的速度增量|在通讯允许的条件下（每个光纤陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是即为速度增量数据，直接乘当量就可以得到需要的结果；
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态。
输入：采样周期，陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出： ",0,0,1,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的功能。
序|需求名称|编号|输入章节号|功能描述
|主动段模式控制|FREQ5.2.0|4|主动段模式控制调用流程
|初始速率阻尼模式控制|FREQ5.2.1|4.1|初始速率阻尼模式控制调用流程
|正常对日巡航模式控制|FREQ5.2.2|4.2|正常对日巡航模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|对地定向模式控制|FREQ5.2.5|4.5|对地定向模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.9|4.9|轨控模式控制调用流程
|太阳捕获模式控制|FREQ5.2.10|4.10|太阳捕获模式控制调用流程
|无控模式控制|FREQ5.2.11|4.11|无控模式控制调用流程
|凝视姿态跟踪模式控制|FREQ5.2.12|4.12|凝视姿态跟踪模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式初始化|FREQ5.3.0|4|主动段模式初始化设置
|初始速率阻尼模式初始化|FREQ5.3.1|4.1|初始速率阻尼模式初始化设置
|正常对日巡航模式初始化|FREQ5.3.2|4.2|正常对日巡航模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|对地定向模式初始化|FREQ5.3.5|4.5|对地定向模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.9|4.9|轨控模式初始化设置
|太阳捕获模式初始化|FREQ5.3.10|4.10|太阳捕获模式初始化设置
|无控模式初始化|FREQ5.3.11|4.11|无控模式初始化设置
|凝视姿态跟踪模式初始化|FREQ5.3.12|4.12|凝视姿态跟踪模式初始化设置
",0,0,0,1,0,0,0,0,0,0,0
"有效性处理放在控制周期中断中采样数据后、定姿前处理；故障诊断放在控制周期中断中定姿与控制后处理。红外定姿时应同时将数字太阳和星敏感器的数据有效性标志置为无效。
需求名称|功能描述
陀螺数据有效性|确定陀螺数据的有效性
红外数据有效性|确定红外数据的有效性
数字太阳数据有效性|确定数字太阳数据的有效性
星敏感器数据有效性|确定星敏感器数据的有效性
动量轮角动量数据有效性|确定动量轮角动量数据的有效性
模拟太阳敏感器数据有效性|确定模拟太阳敏感器数据的有效性
红外自主故障诊断|星上自主检测红外故障
陀螺自主故障诊断|星上自主检测陀螺故障
星敏感器通讯故障|星上自主检测星敏感器故障
动量轮故障诊断|星上自主检测动量轮故障。
推进系统故障诊断|星上自主检测推进系统故障
帆板驱动机构故障诊断|星上自主检测帆板驱动机构故障
模拟太阳敏感器故障诊断|星上自主检测模拟太阳敏感器故障",0,0,0,0,0,0,1,0,0,0,0
"功能描述：发送控制计算机计算得出的星历数据
处理：将控制计算机计算得出的星历数据打包后放到星历数据地址空间中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：偏航通道喷气中断处理程序。
处理：将推力器9、10、11、12关掉",0,0,0,0,0,0,0,1,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。CCU应用软件取数消息与同步消息的发送时间间隔大于3ms
|红外2数据的采集与处理|FREQ1.3.2|""红外2
LTU取数指令""|红外2的数据|在通讯允许的条件下（红外2的当班标志为1），向红外2 LTU发取数指令，获得红外2数据并处理成对应的数据。
",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|数字太阳数据的采集与处理|FREQ1.1.1|""数字太阳LTU取数指令
""|数字太阳角度和视场码DSS1输出滚动方向角度，DSS2输出俯仰方向角度|在通讯允许的条件下（当班标志为1），每周期向数字太阳LTU发取数指令，获得数字太阳数据并处理成滚动方向和俯仰方向角度以及相应的视场码。
|模拟太阳数据的采集与处理|FREQ1.1.2|""模拟太阳LTU取数指令
""|模拟太阳角度和视场码|每周期无条件的向模拟太阳LTU发取数指令，获得模拟太阳数据并处理成对应的角度。 
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：
卫星异常情况进入停控模式的处理（功能编号：FReq-17）。
处理：
软件设置停控方式字（为三取二变量，可与太阳捕获方式共用），当判断为停控方式时，停止模式判断和处理，停止控制器计算，停止故障判断和处理，将5N推力器输出和开关脉冲输出口清零；
一旦软件进入停控方式，将无法自主恢复太阳捕获的控制方式。此时，如果想恢复正常控制，在确认部件工作状态后，地面遥控操作；
速率阻尼后，三轴中任意一轴角速度持续625个控制周期（80s）大于2.0°/s，转入停控方式，其中任意一轴角速度大于2.0°/s，实现为三轴角度绝对值的最大值大于2.0°/s； ",0,0,0,0,0,1,0,0,0,0,0
"功能：利用星敏感器B的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：当收到“停控”数据指令或满足自主进入停控模式的条件时，应用软件进入停控模式。
处理
关闭自锁阀1、2；
与ALTU继续通信，进行轨道与环境计算、采集信息，不进行定姿与控制，输出磁力矩器、推力器控制量为0，发送CMG1~5复位及高速断电指令；之后发送CMG无效0指令。
停止对天线控制计算、通信。",0,0,0,1,0,0,0,0,0,0,0
功能：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：完成卫星正常轨道运行期间的三轴稳定姿态，并进行偏流角修正控制，实现姿态指向精度、姿态稳定度等性能指标。
进入条件：
自主条件：从BZ1=B、2、4、6、8满足条件转入
退出条件：
满足下列条件之一：
自主条件：
满足ZT6  3（有偏航机动）且C1 = FFFF（轨控数据有效标志为有效）且（偏航机动开始时刻之前1800秒）（偏航回调机动开始时刻后600秒）转入BZ1=2
满足（轨控发动机开机时刻-60秒）（轨控发动机关机时刻+100秒）且C1 = FFFF（轨控数据有效标志为有效）且转入BZ1 = 6
满足FM=1（ZT35不等于0且收到侧摆命令块）转入BZ1=8
满足ZT226（系统故障自检有效，可自主切换工作模式）且FSY07（系统故障打分小于等于7）且ZT8  3，ZT9  3（姿轨控发动机可用）转入BZ1=3
满足ZT226（系统故障自检有效，可自主切换工作模式），FSY07（系统故障打分小于等于7），且（ZT8  4（姿控发动机不可用）或ZT9  4（轨控发动机不可用））转入BZ1=7
地面上行注入ZT1不等于1、4 
处理过程：过程如下：
STEP1：当ZT F且ZTA且ZT3B ，进行姿态预估，得到姿态角和角速度。
STEP2：进行运行段姿态确定，具体过程如下：
姿态红外修正（1）和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP3：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3（姿控发动机可用）且ZT9  3（轨控发动机可用）且ZT（不用红外+单个斜装陀螺定姿）时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
t的取值范围|处理
|""发姿轨控发动机加温指令
进行运行段姿态确定 
进行运行段控制""
|""发姿轨控发动机加温指令
发左右帆板归零指令
飞轮动量保持控制及飞轮启动
令，
 轨控段喷气姿态控制""
|""令 ，

轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令""
|""令，
轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令
""
|""红外数据采集及处理
红外故障检测及信号选取
姿态红外修正（2）
，
运行段喷气姿态控制
飞轮动量保持控制及飞轮启动
运行段帆板控制""
|BZ1 = 1，C1 = CCCC。

当ZT40(4) = 1（天线扫描捕获）时，进行数传天线捕获跟踪控制
STEP4：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：选择相平面参数、加速度
处理：根据工作模式设置相平面参数；根据推力器分支及追踪器构型设置加速度。
说明：4种构型，3种分支共计12组加速度（每组包括正负三轴共6个）；",0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送AOCC内存数据块
处理：OBDH从遥控接收到AOCC内存数据下卸指令后，向AOCC发送内存设置命令，通知AOCC内存数据下卸的段地址、偏移量及下卸长度；OBDH发出内存设置命令后100ms，开始接收AOCC内存数据。其处理过程如下：
STEP1：AOCC应用程序接收到OBDH内存下卸的指令后，进入OBDH中断服务程序（INT1）；
STEP2：AOCC应用程序读出OBDH注入的段地址、偏移地址和数据长度；
STEP3：根据段地址，偏移地址计算下卸内容的地址，并进行合法性判别。
STEP4：根据计算出的下卸内容的起始地址和长度，将下卸内容放入OBDH规定的内存中 。",0,0,0,0,0,0,0,0,0,0,1
"软件需求名称：接收总线指令 
需求类别：其他 
软件需求描述：接收并处理总线指令。",0,0,0,0,0,0,0,0,0,1,0
功能描述：轨控模式时使用轨控发动机及其备份。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
处理：
OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：已知扫描区域中心坐标和扫描范围后，计算扫描起点的目标姿态。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：计算CMG的框架角速度。                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：修改奇异规避算法。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送事件数据给OBDH保存
处理：将事件数据打包后放到事件数据内存地址空间中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：对星敏感器输出数据进行有效性判断。
输入：STSFailureDiagPermFlag, ZT6，星敏1 输出四元数，
星敏2输出四元数，星敏3输出四元数，预估四元数
t， t星A，t星B ，t星C ,  tmdts ,ZAR , ZBO Z , ZCR Z ,  ms ,  ms1 ,  ms2 ， ms3。
输出：ZA，XA，ZB，XB，ZC，XC，
星敏感器参与定姿标志FSTA，FSTB，FSTC，FSTD 。",0,0,0,0,0,0,1,0,0,0,0
"功能描述：计算星上星时。
处理：
应用软件的星上时是以星箭分离时刻作为“0”时刻。
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。",0,0,0,0,0,0,0,0,0,0,1
功能描述：根据指令完成数传天线的指向控制。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：利用陀螺确定出卫星对目标的姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：卫星处于应急状态
处理：
STEP1：进行姿态预估，得到姿态角和角速度
STEP2：令动量轮和磁力矩器的控制电压为0",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据红外信息，作姿态滤波修正。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据采集的1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：不使用陀螺数据时的姿态角、角速度与姿态四元数预估。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：由-Z面姿控发动机(A1/A2/A3/A4/+X/-X)进行变轨。
处理
有姿控发动机姿控加变轨方式见用户需求5.3.1.3和姿控发动机变轨，cmg姿控方式见5.3.1.，两种方式由地面选取。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：将S-84坐标系下的追踪器GPS原始数据转换成J地心天球坐标系下的数据，根据该数据与轨道计算数据的对比结果，给出GPS数据可用性标志
说明：计算目标器GPS时，将输入、输出改为目标器的相应变量。",0,0,0,0,1,0,0,0,0,0,0
功能描述：由平衡方程方法、星敏感器数据、红外/太阳数据，以及动力学输出对陀螺进行故障检测。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。
功能编号|功能|引用文档
FREQ53|初始化|星敏协议
FREQ54|星敏使用要求|任务书
FREQ55|通信|星敏协议
FREQ56|通信故障处理|任务书
FREQ57|数据解包与转换|星敏协议
FREQ58|星敏数据有效性判断、处理|任务书
FREQ59|星敏模拟量采集、处理|任务书
FREQ60|部件在轨转发（在轨修改）|任务书

3）GPS高精度校时与星敏感器数据的使用
功能描述：根据GPS秒脉冲，秒脉冲广播，进行GPS高精度校时和星敏感器时标处理。
输入：地面遥控指令，GPS秒脉冲，秒脉冲广播，星敏感器数据。
输出：星时，时标，星敏感器数据广播。
处理：",0,0,0,0,0,0,0,0,1,0,0
"功能描述：太阳定向完成后，利用数字太阳与红外信息，进行俯仰、滚动捕获，并建立正常姿态
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：选择视速度增量关机位置控制喷管
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理：
编码|相应的处理
28H|发送内存的数据区指针复位
",0,0,0,0,0,0,0,0,0,1,0
功能描述：J2000年地心赤道惯性系中的速度增量计算,0,0,0,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：进行单轴相平面喷气控制规律计算。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：模式3切换方式。
处理：
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：若地面指令转入对日定向运行模式或者太阳捕获模式，置CMGStartFlag=1。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据框架角偏差计算指令转速。
处理：主要处理过程如下：
当接收到由OBDH发送来的中继快扫到位指令,进入天线预置状态，令FAFP=1，预置的目标角为命令块中的-10对应时刻通过轨道计算得到的天线框架角。控制中继天线转动快扫到达目标位置。当时间大于-10后，退出预置状态令FAFP=0。
当接收到由OBDH发送来的中继复位指令,进入天线复位状态，令FARP=1。根据命令块中数据标志来确定天线要复位的位置。如果标志为55H，天线复位到命令块中指定的角度位置；如果标志为FFH，则天线复位到零位。
当地面上行注入ZT40（1）=1时，天线进入螺旋扫描状态。按照特定的步长控制天线转动，当螺旋扫描持续的时间超过注入的天线捕获扫描时间时，将ZT40(1) 置0退出螺旋扫描状态。
当接收到由OBDH发送来的中继程序跟踪停止指令，停止向中继捕获跟踪控制单元发送控制信息，并设定标志传到遥测。其余情况下天线处于程序跟踪状态。
卫星增加了侧摆中继时传的工作模式，快摆时工作时序见任务书.5。",0,1,0,0,0,0,0,0,0,0,0
"时间服务采用1s作为时间同步周期，BC使用子地址29发送时间消息，使用广播方式发送，A、B总线各广播一次。本型号选用“一步方式”，即仅发送时间消息而没有时间同步消息，时间数据消息在通信帧0末发出。对于接收硬件秒脉冲信号的用户，时间码的整秒部就是秒脉冲对应的整秒时刻。因此包含的功能点为两个：
序号|功能描述|功能编号|
|接收OBDH校时时刻|FREQ7.1.1|设置OBDH校时标志TimeFlg.RcvOBDH
|接收GPS秒脉冲时刻|FREQ7.1.2|设置GPS校时标志
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：根据姿轨控喷气规律计算结果，发出相应的喷气指令。
处理：同用户需求的。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。
输入：姿态角，姿态角速度，
实测飞轮角动量   =[，]T
标称角动量       =[，]T
      标志             UnLoadMode， F_WheelSaturation， F_AttrOutLmt",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据天线安装定义和地面站坐标，实时计算天线和地面站的夹角。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：在轮控机动模式下，轮控滚动/俯仰机动过程中规划目标姿态确定，确定机动力矩和轮子组合。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：为三轴姿态喷气控制选择推力器,0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：模式初始化 
需求类别：其他 
软件需求描述：见“用户需求”4.1和“任务书”4.1.10“工作模式要求”1）工作模式初始化。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.2-WMInit-1|太阳定向模式初始化|《用户需求》4.1.1【初始化】|
FREQ12.2-WMInit-2|恒星定向1模式初始化|《用户需求》4.1.2【初始化】|
FREQ12.2-WMInit-3|惯性调姿模式初始化|《用户需求》4.1.3【初始化】|
FREQ12.2-WMInit-4|恒星定向2模式初始化|《用户需求》4.1.4【初始化】|
FREQ12.2-WMInit-5|轨控定向模式初始化|""《用户需求》4.1.5【初始化】
《任务书》4.1.10""|
FREQ12.2-WMInit-6|中继跟踪模式初始化|《用户需求》4.1.6【初始化】|
FREQ12.2-WMInit-7|速率阻尼模式初始化|《用户需求》4.1.7【初始化】|
FREQ12.2-WMInit-8|无控模式初始化|《用户需求》4.1.8【初始化】|
",0,0,0,1,0,0,0,0,0,0,0
功能描述：将F_CMGValid指定工作的CMG框架角保持在标称框架位置。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：星上自主检测推进系统故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理",0,0,0,0,0,0,0,0,0,1,0
"功能：利用星敏感器B 、C的测量，修正姿态四元数与估计角速度。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：由模拟太阳A/B码、监视码得到模拟太阳角、见太阳标志。,0,0,0,0,0,0,0,0,1,0,0
功能描述：CMG数据处理。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收应急线路注入数据。
处理：应急线路的上行注入数据为姿控数据块，具体见上行注入文件。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档|备注
FREQ41|太敏初始化|太敏协议|B
FREQ42|太敏数据采集|任务书、太敏协议|A
FREQ43|数据解包与转换|数太协议|A
FREQ44|太敏数据有效性判断|任务书|A
FREQ45|太敏故障重构|任务书|A
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、；输入陀螺自检信号GDi（i = 1，…，6）。
处理：
用户需求的的6(1)：陀螺脉冲当量；
用户需求的的6(2)
STEP1:A阵计算；
STEP2:",0,0,1,0,0,0,0,0,0,0,0
功能描述：：检测工作中的动量轮的故障并设置BZ3。,0,0,0,0,0,1,0,0,0,0,0
功能描述：根据帆板角误差、控制帆板跟踪太阳。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：使用星敏感器B、C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：完成卫星入轨后一圈内的控制，完成卫星入轨后的初始姿态捕获，消除星箭分离和太阳帆板展开所产生的姿态扰动，进行动量轮启动和控制，建立对地定向三轴稳定的正常运行姿态
进入条件：
满足下列条件之一：
自主条件（满足下列条件之一）：
星箭分离后的应用软件累计运行时间（24位浮点数）且（0.524秒控制周期累计计数）
ZT1 = 0（入轨初模式）且ZT32 = A（ZT1不等于1）且
退出条件：
满足下列条件之一：
自主条件：满足转入BZ1=1（Z轴对地控制模式）
地面上行注入ZT1不等于（B 、0、1、4）
处理过程：过程如下：
STEP1：进行姿态预估（同用户需求的），得到姿态角和角速度，并赋给姿态角和角速度偏差
STEP2：根据入轨时间分别进行不同的处理：
当[0，5）秒时，先关LV2、4，再开LV1、3，分两个周期进行（第一个周期先关LV2、4，第二个周期再开LV1、3）。
当（1，80（消初偏结束时刻））秒时， 进行消初段喷气姿态控制。
当（80，95）秒时，不控直接退出。
当大于95秒时，进行运行段喷气姿态控制。
当大于120秒（红外接入时刻）时，姿态红外修正、陀螺故障检测及选择和运行段帆板控制。
当（4200（动量轮接入时刻），5400）秒时，如果左右帆板转角输出的绝对值都小于10度，则将ZT19、ZT20分别赋给BZ9、BZ10；如果ZT2不等于2，则置ZT2为1。
当大于4750秒时，如果ZT2等于1且三轴角动量偏差均小于1，则置ZT2为2。
当大于等于4800秒时，置BZ1=1，ZT1=1。
STEP3：根据ZT2的值进行飞轮控制。",0,0,0,1,0,0,0,0,0,0,0
功能描述：计算太阳星历、红外补偿量及光行差计算。,0,0,0,0,1,0,0,0,0,0,0
功能描述：利用星敏感器数据计算卫星对惯性的角速度在本体系的分量,0,0,0,0,0,1,0,0,0,0,0
功能描述：确定ASS21，ASS22，ASS31，ASS32 及帆板转角的信号选取。,0,0,0,0,0,0,1,0,0,0,0
功能描述：星上实时计算中继星的轨道。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：发送天线数据包
",0,0,0,0,0,0,0,0,0,0,1
功能描述：星上实时计算地磁场强度,0,0,0,0,1,0,0,0,0,0,0
"功能描述：利用红外太阳建立正常飞行姿态
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：决定利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：采集4路动量轮脉冲信息。,0,0,0,0,0,0,0,0,1,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.5|偏置飞行模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|角速度跟踪模式控制|FREQ5.2.7|4.7|角速度跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.9|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|测试与标定模式控制|FREQ5.2.11|4.8|测试与标定模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.5|偏置飞行模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|角速度跟踪模式初始化|FREQ5.3.7|4.7|角速度跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.9|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|测试与标定模式初始化|FREQ5.3.11|4.8|测试与标定模式初始化设置

主动段和无控工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,0,0,1,0,0,0,0,0,0,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的控制数据转换为消息需要的格式并输出。
MW数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发MW数据采集指令，获得ACU数据并处理成对应的MW的角动量。
部件加断电指令的处理|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每三个控制周期将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,0,0,0,1,0,0
"功能描述：利用星敏感器和陀螺输出计算姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送控制计算机指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,0,0,0,1
"功能描述：追踪器GPS数据有效性判断及处理 
处理：见《卫星GNC分系统GNC计算机应用软件用户需求》的P48-P49。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：判断陀螺的使用范围。
输入：	本控制周期内采样的陀螺角度增量 (量纲：弧度) （=,…,）
      	上周期陀螺数据
      	标志 N_GyroDiagnV
处理
对陀螺数据进行有效性判断。若某个陀螺故障或某个陀螺为新上电，则不进行有效性判断（陀螺不引入）。其中陀螺新加电有三种情况1、判断出陀螺故障且允许自主加电情况下，应用软件自主加电。2、数据指令加电。3、脉冲遥控指令加电。对于新加电陀螺，则在该陀螺加电时间小于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为0；当该陀螺加电时间大于等于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为1。
若SLTU陀螺不加电或该陀螺故障，不引入。当“允许使用电源状态诊断陀螺”时，应用软件根据与SLTU通讯得到的陀螺电源状态确定陀螺加断电状态；当“不允许使用电源状态诊断陀螺”时，应用软件只根据数据指令确定陀螺加断电状态。若SLTU得到的六个电源状态均断电，则不根据电源状态判断陀螺是否加电。",0,0,0,0,0,0,1,0,0,0,0
"AO在主动段初始化中进行如下工作：
星时清零；
工作模式为主动段；",1,0,0,0,0,0,0,0,0,0,0
"功能描述：利用B，C头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.9
STEP1：计算，将下标A换成C；FM3更改：若，则：，FSTD=1；
STEP2：计算，的各项乘以，的各项乘以。将下标A换成C；
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,0,1,0,0,0,0,0,0,0,0
功能描述：置卫星姿态无控，处于自由飞行状态,0,1,0,0,0,0,0,0,0,0,0
"    各个模式切换的功能点列表如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ5.1.0|4|主动段模式切换条件判断及转出设置
|入轨段控制模式切换|FREQ5.1.1|4.1|入轨段控制模式切换条件判断及转出设置
|正常对地运行模式切换|FREQ5.1.2|4.2|正常对地运行模式切换条件判断及转出设置
|点对点机动模式切换|FREQ5.1.3|4.3|点对点机动模式切换条件判断及转出设置
|姿态/角速度预置模式切换|FREQ5.1.4|4.4|姿态/角速度预置模式切换条件判断及转出设置
|偏置飞行模式切换|FREQ5.1.5|4.5|偏置飞行模式切换条件判断及转出设置
|匀地速跟踪模式切换|FREQ5.1.6|4.6|匀地速跟踪模式切换条件判断及转出设置
|匀角速度匀积分时间跟踪模式切换|FREQ5.1.7|4.7|一般轨迹跟踪模式切换条件判断及转出设置
|轨控模式切换|FREQ5.1.8|4.9|轨控模式切换条件判断及转出设置
|全姿态捕获模式切换|FREQ5.1.9|4.10|全姿态捕获模式切换条件判断及转出设置
|无控模式切换|FREQ5.1.10|4.11|无控模式切换条件判断及转出设置
|凝视姿态跟踪模式切换|FREQ5.1.11|4.12|凝视姿态跟踪模式切换条件判断及转出设置
|测试与标定模式切换|FREQ5.1.12|4.8|测试与标定模式切换条件判断及转出设置
|惯性定向模式切换|FREQ5.1.13|4.13|惯性定向模式切换条件判断及转出设置

切换条件具体见用户需求4。CCU切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：使星体-Z轴对日定向后，使用星敏感器重捕地球。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：计算地磁场矢量分量。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件进行1553B初始化、变量的初始化
处理：
GPS无效判断的连续次数变量由1改为7。
删除读取一次星时计数器的要求。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：发送实时遥测数据。
处理：应急线路实时帧数字量共一个数据包，共60字节，具体定义见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：使用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收OBDH时间数据,0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：发送全姿态捕获模式数据包,0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据任务要求，应用软件进行LTU初始化、1553B初始化、调用系统软件的StartStarTimer、变量的初始化
处理：
进行1553B初始化，处理过程见4.3.2的OBDH初始化功能
GPS秒脉冲信号接口寄存器初始化
设置3个星敏的 RTS信号为无效
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：接收遥控注入数据块1、2、3、4、5、6、7
处理：将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。如果128＜遥控注入数据块长度≤256字节，将数据不足256字节部分以AA16填充，按照“遥控注入数据块结构分为遥控注入数据块1～4，按照子地址（1～4）顺序向AOCC连续发送；如果64＜遥控注入数据块长度≤128字节，将数据不足128字节部分以AA16填充，按照“遥控注入数据块结构分为遥控注入数据块5、6，按照子地址（5、6）顺序向AOCC连续发送；如果遥控注入数据块长度≤64字节，将不足64字节部分以AA16填充，按照“遥控注入数据块结构通过子地址11将数据发送给AOCC；各个上行注入块的格式如表 44所示：
表 44：各个上行注入块的格式
块类型识别字|块类型名称|块长度（字节）|指令
1B H|AOCC程序块|256N|接收遥控注入数据块1、2、3、4
EB H|AOCC轨道数据块|128|接收遥控注入数据块5、6
27 H|AOCC姿控数据块|64|接收遥控注入数据块7
28 H|AOCC系数数据块|64|接收遥控注入数据块7
41 H|AOCC轨控命令块|64|接收遥控注入数据块7
4E H|AOCC太阳翼命令块|256|接收遥控注入数据块1、2、3、4
7D H|AOCC内存修改块|64|接收遥控注入数据块7
BEH|AOCC中继星轨道数据块|128|接收遥控注入数据块5、6
69H|AOCC结构滤波器系数数据块|128|接收遥控注入数据块5、6
C3H|AOCC中继天线安装修订系数块|64|接收遥控注入数据块7

根据上行注入块的大小，可以把上行注入块分成三种，分别为256字节，128字节和64字节。相应AOCC接收遥控注入的处理程序也分为三种，分别对应256字节，128字节和64字节的处理程序。
接收64字节遥控注入处理程序流程如下图所示
图17: 接收64字节遥控注入处理程序流程
2）接收128字节遥控注入处理程序流程如下图所示
图18: 接收128字节遥控注入处理程序流程
3）接收256字节遥控注入处理程序流程如下图所示
图19: 接收256字节遥控注入处理程序流程
若ZT8≠0，则BZ7=ZT8。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：发送AOCC姿态数据（含侧摆角度）
处理： OBDH在相机成像期间每500ms从AOCC接收一次姿态数据（含2字节侧摆角度值），AOCC在OBDH完成接收姿态数据后，将新的姿态数据（含2字节侧摆角度值）写入总线发送缓冲区。其处理过程如下：
STEP1：AOCC应用程序每0.524秒查询一次有无OBDH发送数据请求，如果有则转入第二步，否则退出；
STEP2：根据不同的数据装载模式，确定装载数据，并按照遥测要求进行格式转换；
STEP3：把遥测缓存区的内容放入OBDH定义的内存中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：接收遥测采集设置指令
处理：将接收遥测采集设置指令存储地址中内容解包成帧计数值，而AOCC则返回与帧计数值相对应的60字节DS遥测量。此指令与发送遥测数据块配合执行。",0,0,0,0,0,0,0,0,0,1,0
"功能：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器A修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,0,1,0,0,0,0,0,0,0,0
"软件需求标识：FREQ18 
软件需求名称：模拟太敏数据处理 
需求类别：其他 
软件需求描述：模拟太敏数据处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据姿态角和姿态角速度偏差数据进行系统故障的检测。
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。
轨控模式姿态角控制量超差阀值从0.077 mSYSS2改为0.0873 mSYSS2。
5.7.3（1）增加姿态超差判断。",0,0,0,0,0,1,0,0,0,0,0
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""",1,0,0,0,0,0,0,0,0,0,0
"软件需求标识：FREQ20 
软件需求名称：动量轮数据处理 
需求类别：其他 
软件需求描述：动量轮数据处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：使星体-Z轴捕获太阳。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据CMG角动量及地磁场强度决定并输出磁棒控制电压。,0,1,0,0,0,0,0,0,0,0,0
功能描述：对动量轮、推力器和磁力矩器控制指令的处理 ,0,0,0,0,0,0,0,1,0,0,0
"功能描述：计算速度增量关机喷气时间
",0,1,0,0,0,0,0,0,0,0,0
功能描述：红外数据处理,0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|""5.2.1
""|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估对地姿态|FREQ3.3|5.2.3|根据陀螺测量输出，一步预估卫星姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|基于红外滤波的卫星姿态确定|FREQ3.6|5.2.6|根据陀螺预估结果和红外(和数字太阳)输出，确定卫星姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|红外与太阳双矢量定姿|FREQ3.9|5.2.9|利用红外、数字太阳敏感器确定姿态
|星敏感器相对基准标定|FREQ3.10|5.2.10|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.11.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.11.2|进行卫星姿态四元数的重置
|三轴欧拉姿态角预估算法产品规范|FREQ3.1.1|/|规范化算法：
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法算法产品规范|FREQ3.1.3|/|规范化算法：
|基于红外测量的红外滤波修正算法产品规范|FREQ3.1.4|/|规范化算法：
|基于单星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.6|/|规范化算法：
|基于红外与太阳矢量的双矢量定姿算法算法产品规范|FREQ3.1.7|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.2|
|正常、偏置飞行目标姿态计算|FREQ3.12.1|5.3.2.1|正常与偏置姿态飞行时的目标姿态计算
|点对点机动目标姿态计算|FREQ3.12.2|5.3.2.2|点对点机动目标姿态计算
|姿态预置过程目标姿态计算|FREQ3.12.3|5.3.2.3|姿态预置过程目标姿态计算
|非沿迹目标姿态计算|FREQ3.12.4|5.3.2.4|角速度建立过程目标姿态计算
|轨控目标姿态计算|FREQ3.12.5|5.3.2.5|轨控目标姿态计算
|轨控姿态机动轨迹初始化|FREQ3.12.6|5.3.1.4|轨控模式目标姿态计算初始化
|正弦轨迹规划算法算法产品规范|FREQ3.12.7|/|规范化算法：
|基于加速度导数为正弦函数的轨迹规划算法算法产品规范|FREQ3.12.8|/|规范化算法：
|点对点姿态机动初始化处理|FREQ3.13|5.3.1.1|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|非沿迹跟踪初始化|FREQ3.14|5.3.1.2|非沿迹跟踪初始化，计算地心张角和方向矢量
|计算多项式轨迹系数|FREQ3.15|5.3.3.1|根据轨迹规划时间，初始姿态/姿态角速度和目标姿态/姿态角速度计算基于多项式轨迹规划的轨迹系数
|姿态预置机动目标姿态确定|FREQ3.16|5.3.3.2|基于多项式曲线的轨迹规划，计算目标姿态
|非沿迹目标姿态角计算|FREQ3.17|5.3.4|根据所指定的扫描起始经纬度和末端点经纬度
|偏流角计算|FREQ3.18|5.3.5|适用于地球椭球模型，星体姿态描述为转序，计算基于星体光轴(与星本体＋Z轴平行)下的偏流角
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|增量式偏流角计算算法产品规范|FREQ3.21|/|规范化算法：
|凝视过程目标姿态计算|FREQ3.22|5.3.2.6|凝视过程中计算三轴目标姿态
|陀螺标定过程目标姿态计算|FREQ3.25.0|5.15.1|陀螺标定全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角
|目标姿态计算初始化|FREQ3.25.1|5.15.1.1|对陀螺标定过程中涉及到的两次机动过程进行机动姿态计算的初始化
|惯性姿态点对点机动轨迹规划|FREQ3.25.2|5.12.1.2|对陀螺标定过程所涉及到的两次点对点机动进行轨迹规划
|角速度起速保持与减速过程轨迹规划|FREQ3.25.3|5.12.1.3|对陀螺标定过程中的速度运行进行轨迹规划
|大角速度标定的分档确定|FREQ3.25.4|5.12.1.4|根据实现指向的4挡速度，根据当前的速度的幅值，确定所标定的陀螺刻度因子的位置
|惯性定向时转阶段处理|FREQ3.25.5|5.12.1.5|陀螺标定在第1段中完成惯性定向，并在此期间标定陀螺真实常漂。在惯性定向转速度运行结束时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等。
|速度运行时转阶段处理|FREQ3.25.6|5.12.1.6|SubMode= 2~9，陀螺按照规定的角速度完成起速、恒速运行、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等
|速度曲线规划|FREQ3.25.7|5.12.1.7|根据所选择的机动轨迹，规划出角速度变化曲线
|陀螺标定算法|FREQ3.26.0|5.12.2|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺常漂修正标志确定|FREQ3.26.1|5.12.2.1|对陀螺标定过程中，陀螺常漂的修正标志进行确定。当星体达到了规定的惯性角速度时，开始进行陀螺常漂估计
|基于星敏陀螺滤波的等效常漂估计|FREQ3.26.2|5.12.2.2|采用星敏陀螺滤波的方法对陀螺等效常漂进行估计
|星敏陀螺滤波的陀螺等效常漂记录|FREQ3.26.3|5.12.2.3|对陀螺等效常漂，选取稳态时的一段数据进行平均，得到各个角速度下的等效常漂和星体真实角速度的估计值
|小角速度时的陀螺安装误差和刻度因子误差估计|FREQ3.26.4|5.12.2.4|经过N次速度机动后，对陀螺的测量模型进行标定，给出标定结果
|大角速度时的陀螺标定算法|FREQ3.26.5|5.12.2.5|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺在轨标定时的控制量计算|FREQ3.27|5.12.3|对标定过程中的控制量进行计算
|陀螺安装误差标校结果引入|FREQ3.28|5.12.4|对陀螺完成标定后，待地面确认标定结果无误后，将陀螺的标定结果进行赋值。当地面注入FP__MountingCmp时执行本程序一次
|陀螺刻度因子误差标校结果引入|FREQ3.29|5.12.5|完成陀螺标定，待地面确认无误后，对陀螺的刻度因子进行在轨标校。标校时，取陀螺输出的角速度与与之最接近的两个已标定的特征角速度进行线性插值标校
|惯性定向期间目标姿态计算|FREQ3.30|5.3.2.7|""惯性调姿过程中的姿态机动目标姿态计算，当航天器从轨道系姿态进入时，首先进入submode0，进行轨道角速度的削除，之后进行惯性调姿。在转出时，若后续姿态为轨道系姿态，需要建立轨道角速度
""
|轨道角速度建立目标姿态计算|FREQ3.31|5.3.6|""在惯性定向与轨道系姿态保持之间切换时，进行轨道角速度的建立或削除 
""
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：消除星体角速度，并使星体Z 轴指向太阳
",0,1,0,0,0,0,0,0,0,0,0
功能描述：利用红外、数字/太阳敏感器确定姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：向LTU和星敏感器发送自检指令，获得自检信息
处理：
（1）每0.524秒对1个部件LTU进行自检，依次为选通的太阳、选通的陀螺、选通的左和右帆板，每4个0.524秒对4个LTU自检一次；
(2）对红外LTU的自检见.3；
(3) 每4秒（8个0.524秒）发送一次星敏感器自检命令数据包（HK1包），；
(4)根据遥测格式将返回的自检信息通过OBDH传至地面。",0,0,0,0,0,0,0,0,1,0,0
功能描述：根据星敏感器故障标志、星敏感器有效数据判断标志（由星敏感器数据包给出，（包括状态字b27、同步脉冲计数值、数据产生相对时间、姿态四元数信息等）），判断星敏感器数据有效性。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：发送应急线路指定内存内容。
处理：
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,0,0,0,1
"功能描述：在完成对日定向后，由地面指令转入地球捕获。通过红外和数字太阳敏感器定姿，消除卫星的偏航角。
输入：陀螺数据处理的输出 ，
数字太阳敏感器数据有效性标志F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出），数字太阳敏感器输出： （量纲：弧度）
红外地球敏感器数据有效性标志F_IresValid（由数据有效性判据给出）
上周期姿态角估值，
太阳星历的输出，
",0,0,1,0,0,0,0,0,0,0,0
功能：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：决定利用星敏感器A、B、C单独或组合定姿的方式，调用相应姿态修正程序。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：无控模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收应急控制器重要数据。
处理：应急线路加电后与OBDH通信，获得陀螺和推力器状态，若连续3个控制周期都没有成功取得重要数据，默认陀螺使用7、8、9号，推力器使用主备份推力器，模拟式太阳敏感器使用ASS1和ASS21。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：数传天线数据处理
",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|对地数传天线1数据的采集与处理|FREQ1.7.1|""对地数传天线1 LTU控制指令
""|对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
|对地数传天线2数据的采集与处理|FREQ1.7.2|""对地数传天线2
LTU控制指令""|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：判断陀螺故障，并选取可用的陀螺。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：减小卫星的俯仰角。
输入：陀螺数据输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）、见太阳状态、故障标志IRES_FLAG
红外弦宽
红外数据处理（全姿态捕获）的输出，",0,0,1,0,0,0,0,0,0,0,0
"功能：计算给控制器的姿态和角速度误差。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：三轴稳定模式下，检测系统故障。
处理：
（1）基本处理
将系统故障打分FSY限幅到[7，]。
（2）FSY加减分
条件|FSY的处理
（红外输出有效），ZT3≠C(用星敏感器+陀螺定姿，且接入控制回路)，ZT3≠A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式)，|FSY加一分
（红外输出有效），ZT3≠C(用星敏感器+陀螺定姿，且接入控制回路)，ZT3≠A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式),{或}|FSY减一分
（红外输出有效），ZT3=C(用星敏感器+陀螺定姿，且接入控制回路)或ZT3=A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式)，|FSY加一分
（红外输出有效），ZT3=C(用星敏感器+陀螺定姿，且接入控制回路)或ZT3=A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式),{，}|FSY减一分
或或，FGF=1|FSY减一分
或或，FGF≠1|FSY减4分
，FSTD>1，且{（且）或ZT5=0}|FSY加4分

处理FSY,ZT3,AttTurnFlag和
条件|FSY的处理
C，A，BZ5连续239次为0|FSY=1
，FSTD连续954次为1,ZT5=0|FSY=1
，FSTD连续954次为1,|""FSY=
ZT3=3,；AttTurnFlag=1""
A，FSTD连续250次为1|FSY=1
，FSTD≠1|AttTurnFlag=0
FSY≤64H,ZT3=C,ZT5≠0|""FSY=
ZT3=3,；AttTurnFlag=1""
，AttTurnFlag=1，ZT41[2]=1允许自主由红外转回星敏定姿时，若连续120次(且，且)|，AttTurnFlag=0

(4) 若ZT226，FSY07，ZT8 =F，ZT9 =F，则ZT8=0,ZT9=0,BZ7=Jeti2。
（5）根据FSY的结果和ZT22、ZT8、ZT9对BZ1进行处理
条件|BZ1的处理
ZT226，FSY07且ZT8  3，ZT9  3|BZ1 = 3
ZT226，FSY07且ZT8  4或ZT9  4|BZ1 = 7

（6）根据FSY的结果和ZT22、ZT8、ZT9以及BZ7重置BZ7
条件|BZ7的处理
ZT226，FSY07且ZT8 = 0（可自主切换主备份姿控发动机），BZ7=1（可用姿轨控主份推力器）|BZ7 = 2
ZT226，FSY07且ZT8 = 0，BZ7=3（可用姿轨控主份及备份推力器）|BZ7 = 2
ZT226，FSY07且ZT8 = 0，BZ7=2（可用姿轨控备份推力器）|BZ7 = 1

（7）若ZT226，FSY07，ZT43[4]=1允许自主给陀螺加电，则陀螺自主加电。
（8）若ZT226，FSY07，ZT44[4]=0，FlagWHCtl=A或ZT3=B，则FlagWHCtl=5;ZT3=3;ZT8=0;BZ7=Jeti;陀螺漂移赋值；Ix,Iy,Iz,Ihx,Ihz清0。
（9）指定FlagAttTurnIres=0后，系统不使用红外进行姿态监视，仅根据有效红外进行姿态修正。",0,0,0,0,0,1,0,0,0,0,0
"“复位进入模式”中应用软件进行如下初始化工作：
置星时为2100秒；
置“向星务分系统申请重要数据”标志。
在“复位进入模式”中AO进行如下工作：
控制量输出均为0。部件开关设置为“不进行任何操作”。
响应星务分系统遥测轮询、数据遥控指令、数据注入、程序注入并进行相应处理，但不响应星务重要数据的轮询。
在“复位进入模式”中AO不进行控制律计算。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：俯仰通道喷气中断处理程序。
处理：将推力器1-8关掉",0,0,0,0,0,0,0,1,0,0,0
"序|需求名称|编号|功能及处理描述
|星敏感器1数据的采集与处理|FREQ4.1|选择通讯的星敏1LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|星敏感器2数据的采集与处理|FREQ4.2|选择通讯的星敏2LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：太阳全姿态捕获模式初始化,0,0,0,1,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：利用数字太阳信息，进行太阳捕获，对太阳定向；,0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理：",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|功能及处理描述
|星时的采集和计算|FREQ6.1|对星时进行计算和处理
|星时校正|FREQ6.2|OBDH每隔8分钟向AOCC发送一次校时命令，校正AOCC星上时间。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收带数据字的同步                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      处理：根据同步字的编码内容进行相应的处理：
编码|相应的处理
11|数据发送开始
12|数据发送结束
EE|数据接收开始
EB|数据接收结束
bit4～bit0|数据发送/接收子地址
bit7～bit5|0
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ110|初始化|任务书
FREQ111|磁力矩器使用要求|任务书
FREQ112|通信(DA)|任务书
FREQ113|通信故障处理|预留
FREQ114|数据解包与转换|预留
FREQ115|磁力矩器数据有效性处理|预留
FREQ116|磁力矩器硬件采集、处理|任务书
FREQ117|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量。
（3）令（i = 1，2，… ，6）。为上一次轮子角动量值。",0,0,0,0,0,0,0,0,1,0,0
功能描述：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|功能描述|功能编号
0|主动段模式控制|FREQ6.1
1|入轨段消初偏模式控制|FREQ6.2
2|正飞模式控制|FREQ6.3
3|大角度机动模式控制|FREQ6.4
4|正常运行模式控制|FREQ6.5
5|轨控模式控制|FREQ6.6
6|SAR未展开模式控制|FREQ6.7
7|帆板未展开模式控制|FREQ6.8
8|偏置动量控制模式控制|FREQ6.9
9|全姿态捕获模式控制|FREQ6.10
A|应急安全模式控制|FREQ6.11
B|停控模式控制|FREQ6.12

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断见用户需求的3.3。",0,0,0,1,0,0,0,0,0,0,0
根据同步字的编码内容进行相应的处理：,0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收数传天线状态数据
处理： 将接收数传天线状态存储地址中内容解包成数传天线状态的数据格式，根据不同的数传天线状态设置对应数传天线的加断电状态。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：发送AOCC重要数据给OBDH保存
处理：将重要数据打包后放到AOCC重要数据内存地址空间中。重要数据的内容具体见重要数据文件。",0,0,0,0,0,0,0,0,0,0,1
功能描述：接收遥控固定参数注入块的系统轨控调姿及轨控姿态控制系数,0,0,0,0,0,0,0,0,0,1,0
"功能描述、输入、输出、计算公式见《用户需求》4.7.1~4.7.4。
序号|功能点编号|功能描述|说明
|FREQ3.4.9.1|轨控开关机|《用户需求》4.7.1
|FREQ3.4.9.2|轨控发动机选择A|《用户需求》4.7.2
|FREQ3.4.9.3|轨控发动机选择B|《用户需求》4.7.3
|FREQ3.4.9.4|轨控发动机选择C|《用户需求》4.7.4
",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：推进系统操作 
需求类别：其他 
软件需求描述：对自锁阀、推力器进行操作。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：完成运行段偏差姿态确定，（红外修正，太阳修正，星敏感器姿态确定，斜装陀螺定姿等）确定，。
处理：
（1）若BZ1 ≠ 8，9，ZT3≠F,A,B则调用姿态红外修正，调用q及s姿态予估器；若，则：，。
（2）若BZ1 = 8，则
① 根据轮子的工作状况，计算滚动轴最大控制力矩。
② 计算滚动轴角加速度。
③ 计算加速时间。
④ 侧摆喷气判断。
⑤ 计算滚动轴期望轨迹和。
（3）计算姿态角控制量。其中当BZ1≠8,9,ZT3=F或B时，滚动角和俯仰角的限幅值改为可内存修改系数，。红外+斜装陀螺增加偏流角计算。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：卫星丢失姿态后，使用红外地球敏感器直接捕获地球，建立正常对地姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：与CAN通讯获得上行/下行数据。
调用条件：AOCC被动接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通讯，交换数据，以实现星地联系和对卫星的人工干预。主要完成下列功能：
AOCC向星务分系统发送数据（中断接收星务分系统命令，依据命令发送各类遥测参数）；
发送快帧遥测；
发送慢帧遥测；
将AOCC为星务保存的重要数据发送给星务分系统；
发送星敏感器和姿态辅助数据；
有内存下卸要求时，发送AOCC指定内存内容；
AOCC接收星务分系统数据（中断方式）包括接收固定地址参数注入；接收可变地址参数注入；接收轨道参数数据；接收程序注入；接收数据指令；接收重要数据返回；接收整星对时广播数据；接收GPS高精度秒脉冲对时广播；接收GPS导航数据等。
如果应用软件4s收不到星务分系统信息或连续100秒未收到符合通信协议的正确数据，对CAN总线控制器重新初始化。",0,0,0,0,0,0,0,0,0,0,1
功能：利用星敏感器和陀螺或者仅利用星敏感器的输出计算卫星欧拉角和四元数。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：星敏感器数据处理。
处理：同用户需求的5.11。
(1)获得FSTA,FSTB,FSTC
条件|FSTA|FSTB|FSTC
ZT23=0|0|0|0
ZT23=6,|1|0|0
ZT23=6,|0|0|0
ZT23=9,|1|*|*
ZT23=9,|0|*|*
ZT23=9,|*|1|*
ZT23=9,|*|0|*
ZT23=9,|*|*|1
ZT23=9,|*|*|0
ZT23=A,|0|1|0
ZT23=A,|0|0|0
ZT23=B,|0|0|1
ZT23=B,|0|0|0
ZT23=C,|0|1|*
ZT23=C,|0|0|*
ZT23=C,|0|*|1
ZT23=C,|0|*|0
ZT23=D,|1|0|*
ZT23=D,|0|0|*
ZT23=D,|*|0|1
ZT23=D,|*|0|0
ZT23=E,|1|*|0
ZT23=E,|0|*|0
ZT23=E,|*|1|0
ZT23=E,|*|0|0

(2)修订FSTA,FSTB,FSTC
若ZT41[3]=1允许星敏数据有效性判断且BZ13全姿态捕获对日定向姿态且BZ14重捕地球转三轴稳定运行且BZ1≠7无控则进行如下诊断：
若FSTA = 1，FSTC = 1，（或）则FSTA = 0，FSTC = 0；
若FSTA = 1，FSTB = 1，（或）则FSTA = 0，FSTB = 0；
若FSTB = 1，FSTC = 1，（或）则FSTB= 0；FSTC = 0。
(3)获得FSTD
FSTA|FSTB|FSTC|ZT12|BZ2|FSTD
1|1|*|1或9或8|≤2|2
1|*|1|1或9或D|≤2|3
*|1|1|1或9或E|≤2|4
1|*|*|6或9|≤2|5
*|1|*|7或9|≤2|6
*|*|1|B或9|≤2|7
不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|1

(4)当BZ1=1(三轴稳定正常运行轨道姿态)或9(侧摆角保持)时，进行星敏感器数据修正。公式见5.11(9)。
(4)当BZ1=1(三轴稳定正常运行轨道姿态)时，根据ZT40(3)是否为1（引入星敏在轨标定）进行星敏感器在轨标定。公式见5.11(10)。",0,0,1,0,0,0,0,0,0,0,0
功能描述：星上实时计算卫星轨道。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：星敏感器数据处理，安装偏差估计。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收总线指令
处理： 将接收总线指令存储地址中内容解包成总线指令的数据格式，根据不同的总线指令进行相应的处理。其中侧摆指令仅在在模式1或9下响应。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理：
（1）AOCC的星上时钟是由一片54-4的通道0和1组成的32位计数器，输入脉冲速率为976.5625Hz。AOCC从54-4中读取32位时间（最小码位当量为1.024毫秒），将该时间转换为32位定点数并保存在THDT（LSB=1/8秒）、40位定点数并保存在THDT40（LSB=1/256秒）中。
（2）OBDH通过1553B总线每10分钟给AOCC校时一次（校时误差＜20ms），OBDH所产生的卫星时间为标准北京时间，其时间原点位于北京时间的毫秒的起点。卫星时间由6字节构成（如下表所示），其中高4字节为32比特的二进制的秒数，低2字节为亚秒部，最小码位当量为25微秒。将这个时间转换为LSB=1/8秒并保存在32位定点数TT0、TTS0和40位定点数TT040中，转换为36位定点LSB=1/128秒保存在OBQT36中。
47||     |0
秒（32位）|毫秒（16位）|秒（32位）|毫秒（16位）

（3）对0.524秒控制周期进行时间累计将结果保存在32位定点数TSDT（LSB=1/8秒）
（4）计算32位定点数星时TT（TTH=TT0+THDT、TTS=TTS0+TSDT，TT等于两者之一：默认为TTH，当OBDH星时与TTS的差小于等于1秒且TTH与TTS之差大于8秒选择为TTS或当8254出现故障，软时钟与OBDH的时间比较接近时，采用软时钟TTS）和40位定点数星时TT40（TT040+THDT40 ）
（5）AOCC要将接收到的OBDH时间与AOCC中当前时间TT进行比对，如果相差8秒以上应申请OBDH立即重新校时一次。如果再次相差8秒则校时有效。
（6）将TT转换为如下格式的48位遥测时间并通过OBDH遥测下传：
47||     |0
秒（32位）|毫秒（16位）|秒（32位）|毫秒（16位）

（7）接收OBDH注入的轨道数据块、中继卫星轨道数据块、轨控命令块、帆板命令块中时间（40位定点数，最小码位当量为秒）。根据用户需求用TT40和这些时间进行运算。
（8）接收OBDH每4s向AOCC发送一次GPS定位数据，根据用户需求用TT40和其中的40位定点数，当量为秒的GPS时间进行运算。
（9）接收OBDH的中继快扫到位指令，记中继快扫到位指令中的时间（格式为32位定点数，当量为1秒）。将TT转换为当量为1秒的时间和这个时间进行计算。：
31||0
32位，最小码位当量为1秒|32位，最小码位当量为1秒|32位，最小码位当量为1秒

（10）接收OBDH的整星侧摆指令，将其中两字节相对时间（数据格式是16位无符号定点数，最小码当量1s）转换为24位浮点数并保存在DTM中。记录接收OBDH的整星侧摆指令的时间并保存在（32位定点数，LSB=1/8秒）
整星侧摆指令中的时间格式为：
15||0
16位，最小码位当量为1秒|16位，最小码位当量为1秒|16位，最小码位当量为1秒

（11）将TT转换为36位定点数，LSB=1/128秒的数据格式并保存在QT36中。
（12）将星敏取数返回数据中的相对时间（16位有符号数，码当量1ms，最高位为符号位，负数用补码表示）和校时时刻TT-STSA、TT-STSB、TT-STSC（三个时间格式为精度高于秒的时间）进行运算，将结果转换为32位浮点数并保存在t星A、t星B、t星C中。
（13）校时
定时校时，即OBDH每10分钟向AO发送一次校时指令；
当软钟与OBDH时间差大于8秒，则重新申请一次校时；如果还大于8秒，接授OBDH时间；
当AO发生复位和切机后需要重新校时；
如果计算机软件直接通过非屏蔽软件有系统软件引导到应用软件，也需要校时。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收遥控固定参数注入块的系统正常姿态控制器系数
处理：
调整部分零动量稳态、机动PID系数和正常模式偏航角偏差限幅的初装值。",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|部件状态、双组元推进状态1、推进状态2、ACU工作状态|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|计算得到的喷气脉宽、磁力矩器电压|控制指令消息的输出|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
|部件加断电指令的处理|FREQ1.8.4|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.5|保存CCU的重要数据|接收CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.6|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|FREQ1.8.7|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.8|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.9||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发动机关机中断信号处理                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：
应用软件处理发动机关机中断信号，信号源为3路伽玛关机信号，应用软件查到关机后，立触地关机标志有效，发7500N关机指令。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：根据姿态角计算方向余弦阵
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：各个模式的姿态和轨道控制。
处理：
定义星箭分离前为主动段工作模式（包括射前和主动段飞行状态），WorkMode=0。主动段工作模式下，应用软件进行下列工作：
星时计算；
数据采样，但无任何控制指令输出；
组帧遥测数据；
响应OBDH通讯命令；
在主动段查询星箭分离信号的有效性，确认依据为：读取2路星箭分离状态，若任意1路星箭分离为“已分离”状态，则认为本周期查到星箭已分离。如果在连续8个周期中至少6个周期都查到星箭已分离，则可确认为星箭已分离，进入入轨段模式，WorkMode =1。
通过注入在轨维护程序，实现部件测试功能。
模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。各个模式控制中调用流程和条件见用户需求4.1至4.14：",0,0,0,1,0,0,0,0,0,0,0
"功能描述：对自锁阀进行开关处理。
处理：
控制分系统共有两个自锁阀，分别是姿控A套自锁阀(自锁阀1)、姿控B套自锁阀(自锁阀2)。
在星箭分离后，分离开关有效，1秒“分离停控”内；或由“初始速率阻尼”指令退出主动段时，应用软件通过与ALTU通讯发送自锁阀1和自锁阀2开指令。
只有一个自锁阀开时，选择相应的发动机组，两个自锁阀都开时，选择第一组发动机组（A套）。若地面注入修改时，选择注入的发动机组。
复位后若取回重要数据中的模式是对地、对日定向模式、应急和停控模式则不对自锁阀进行操作，否则按重要数据中的自锁阀状态设置自锁阀1、2的开关；否则，根据重要数据中自锁阀的状态发送自锁阀开指令。
自主或遥控进入“停控模式”时，需要发送两个自锁阀关指令。
应用软件通过星务分系统接收自锁阀开关的数据指令，与ALTU通讯，控制自锁阀的开关。",0,0,0,0,0,0,0,1,0,0,0
将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据和定轨数据的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。,0,0,0,0,0,0,0,0,0,1,0
功能描述：检测推力器的泄露，必要时做相应的主备份切换。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：接收数据指令注入块的部件开关类指令
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：卫星绕俯仰轴转动，直到红外搜索到地球。
",0,0,1,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.4|偏置飞行模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.5|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|陀螺标定模式控制|FREQ5.2.11|4.8|陀螺标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.12|4.6|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.4|偏置飞行模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.5|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|陀螺标定模式初始化|FREQ5.3.11|4.8|陀螺标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.12|4.6|惯性定向模式初始化设置

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：采集28路数字太阳粗码、细码。
处理：
采集方法：连续采集28路，采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,0,0,0,1,0,0
功能描述：计算将动量轮保持至标称角动量所需的电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据地面指令ZT3,ZT42,ZT43，给无故障陀螺自主加电。
处理：同用户需求的。
（1）可以进行陀螺自主加电的条件：①或②
①{6个陀螺中至多只有1个有故障，即姿控数据块中ZT42的低4位和ZT43的低2位中至多只有1位等于1}且{加电陀螺不足5个，即姿控数据块中ZT15的低4位和ZT16的低2位中至多只有4位等于1}；
②{ZT3=A，即“星敏无陀螺定姿，且接入控制回路，整星零动量控制方式”或ZT3=B或ZT3=F}且{6个陀螺中至少有3个正常，即姿控数据块中ZT42的低4位和ZT43的低2位中至少有3位等于1}。
（2）陀螺自主加电的步骤：
STEP1:若满足条件(1)②，则根据ZT42,ZT43按陀螺1至6的升序开启3个正常陀螺，设置ZT15,ZT16相应位为1，并设置BZ3=ZT15，BZ4=ZT16；否则若满足(1)①，则{若ZT42,ZT43显示6个陀螺都正常，则开陀螺12356；否则根据ZT42,ZT43开启5个正常的陀螺}，设置ZT15,ZT16相应位为1。
STEP2:加电后设置陀螺正在加电标志FlagGyroAdd=1（正在加电）。令工作陀螺计分为0FH。",0,0,1,0,0,0,0,0,0,0,0
功能描述：动量轮摩擦力矩的补偿电压计算。,0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：星历与轨道 
需求类别：其他 
软件需求描述：日月星轨道计算“计算太阳、月球、卫星位置矢量在地心J2000.0惯性系下的表示”；中继目标轨道计算“计算中继目标轨道”。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.3.1|日月星轨道计算|《用户需求》4.3.1|
FREQ12.3-R4.3.2|中继目标轨道计算|《用户需求》4.3.2|
",0,0,0,0,1,0,0,0,0,0,0
功能描述：动量轮状态确定。,0,1,0,0,0,0,0,0,0,0,0
