Requirements Description,功能需求/初始化,功能需求/控制计算/姿态控制,功能需求/控制计算/姿态确定,功能需求/控制计算/模式管理,功能需求/控制计算/轨道计算,功能需求/控制计算/运行时保障/故障诊断和处理,功能需求/控制计算/运行时保障/数据有效性判断,功能需求/控制输出,功能需求/数据采集,功能需求/遥控,功能需求/遥测
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.4|偏置飞行模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.5|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|陀螺标定模式控制|FREQ5.2.11|4.8|陀螺标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.12|4.6|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.4|偏置飞行模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.5|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|陀螺标定模式初始化|FREQ5.3.11|4.8|陀螺标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.12|4.6|惯性定向模式初始化设置

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：每4.192秒运行一次的主程序。
处理： 
STEP1：记录当前的星时、数字太阳敏感器输出、四元数和星敏数据、星敏姿态角及惯性角速度：
，
FSTAVD = FSTAVD05，FSTBVD = FSTBVD05，FSTCVD = FSTCVD05
t星A = t星A05，t星B = t星B05，t星C = t星C05
=，=，=，=，=，=
，；
STEP2：若指定星敏诊断陀螺故障，则：对工作陀螺，
STEP3：进行外推轨道计算和中继卫星轨道计算；
STEP4：重要数据打包，进行数据校正和红外故障检测及信号选取；
STEP5：当BZ1 为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，如果没有喷气则进行光行差修正量计算及加速计零位估计；
STEP6：进行星敏感器数据处理；
STEP7：当BZ1为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，进行下列操作：
当BZ1= 1（三轴稳定正常轨道运行姿态）且BZ2 = 1（已有遥控轨道数据注入）且BZ6 = 3（姿态确定用红外、陀螺和数字太阳）且C1 = 0000（轨控数据有效标志为无效）且ZT3≠F（用红外+单个斜装陀螺定姿，且接入控制回路）且ZT3≠A（星敏无陀螺定姿，且接入控制回路，整星零动量控制方式）时进行姿态太阳修正。
当C1 = CCCC（轨控关机后或偏航机动结束后）时令星敏修正时间；否则
进行S姿态的q修正及光轴方位计算（由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位）
当时令，=，=，=，=，
若C1=0，则根据FSTD（星敏参与定姿的标志）的取值进行相应的星敏修正并令
FSTD取值|处理
2|用A，B头测量修正q
3|用A，C头测量修正q
4|用B，C头测量修正q
5|用A头测量修正q
6|用B头测量修正q
7|用C头测量修正q

当满足ZT4  0（用磁力矩器）且BZ2  2（有遥控注入过）且ZT2  2（飞轮启动保持或零动量控制方式）时进行地磁场计算和飞轮磁卸载；否则令磁力矩器的输出电压为0；
STEP8：当BZ1 = 1或9或 { BZ1 = 3，FSA≥5 } 或 { BZ1 = B，}，则进行推进系统故障检测及切换；
STEP9：若BZ1 = 1或9或 { BZ1 = B，}，则：系统故障检测；否则系统故障检测中的连续时间计数；
STEP10：若ZT17≥4，ZT18≥7，则：帆板故障检测及切换；
STEP11：当ZT38 = F（0.524主程序中插入帆板未展开模式）时，进行帆板未展开模式处理；
STEP12：当BZ1  1，8，9（入轨段控制模式、偏航机动模式、全姿态捕获、重
捕地球、轨控模式、姿态无控模式、自旋模式）时，令不用星敏定姿；
STEP13：若BZ1  1，8，9，B，则：FSY = ；
STEP14：当ZT4 = 0（不用磁力矩器时）或BZ1  （1、9）时，令磁力矩器的电压为0；
STEP15：当ZT2  6时，令动量轮的电压为0；
STEP16：设置，；
STEP17：记录数据， ；
STEP18：进行中帧、慢帧的遥测数据和黑匣子数据的打包。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：处理星务返回的重要数据
处理：解包并更新重要数据",0,0,0,0,0,0,0,0,0,1,0
"功能描述：实现CMGs的PD/PID控制。
输入：姿态角误差，角速度误差，；，系统合成角动量（Nms）；Jacobi矩阵sgJ，矩阵sgF；CMG使用标志Lcmg[i]；奇异回避向量，奇异测度JD，机动补偿力矩，(陀螺切除用)",0,1,0,0,0,0,0,0,0,0,0
"功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：对帆板驱动装置1和帆板驱动装置2进行独立控制和诊断，一个帆板驱动装置失效不影响对另一个帆板驱动装置的控制与诊断。
",0,0,0,0,0,1,0,0,0,0,0
"软件需求名称：应用软件初始化 
需求类别：其他 
软件需求描述：初始化函数为void AppInit(void )。在上电/复位时，系统软件调用此函数来完成应用软件的初始化。见“任务书”4.1.2.1“初始化函数”。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。",0,0,0,0,0,0,0,0,0,0,1
功能描述：轨控姿态机动模式初始化,0,0,0,1,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的光纤红外控制命令参数,0,0,0,0,0,0,0,0,0,1,0
功能描述：偏置动量处于力矩模式，根据滚动红外敏感器弦宽测量计算得到的滚动角，俯仰角的信息实现三轴姿态控制滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送AOCC内存数据块
处理：OBDH从遥控接收到AOCC内存数据下卸指令后，向AOCC发送内存设置命令，通知AOCC内存数据下卸的段地址、偏移量及下卸长度；OBDH发出内存设置命令后100ms，开始接收AOCC内存数据。其处理过程如下：
STEP1：AOCC应用程序接收到OBDH内存下卸的指令后，进入OBDH中断服务程序（INT1）；
STEP2：AOCC应用程序读出OBDH注入的段地址、偏移地址和数据长度；
STEP3：根据段地址，偏移地址计算下卸内容的地址，并进行合法性判别。
STEP4：根据计算出的下卸内容的起始地址和长度，将下卸内容放入OBDH规定的内存中 。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：采集28路数字太阳粗码、细码。
处理：
采集方法：连续采集28路，采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：实现卫星星上自主或地面遥控下的自旋。为了节省内存，将此模式的代码从PROM中去掉。若需要此模式，则通过在轨注入的方式，将此模式引入控制。
处理过程：过程如下：
STEP1：进行姿态预估，得到姿态角和角速度
STEP2：令动量轮和磁力矩器的控制电压为0
STEP3：当ZT1 = D且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

根据ZT12向偏航和滚动发控制脉冲，处理完置ZT12为0
ZT12取值|处理
3|发偏航正脉冲0.5秒
C|发偏航负脉冲0.5秒
5|当时发滚动正脉冲0.5秒
A|当时发滚动正脉冲0.1秒
F|当L11 + L21 = 1时发滚动正脉冲0.5秒

STEP4：当ZT1 = F且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

确定的符号",0,0,0,1,0,0,0,0,0,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输出：数字太阳敏感器输出；模拟太阳敏感器输出；模拟式太阳敏感器视场码；0-1式太阳敏感器的信号（0或1）；数字太阳敏感器视场码。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得数字太阳、模拟太阳、0-1太阳数据；每个控制周期根据DSSLTUSeltFlag确定进行通讯的太阳LTU，发送取数指令。
（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：动量轮启动的程控指令
      实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：， ，",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：部件加断电 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。",0,0,0,0,0,0,0,1,0,0,0
"时间服务采用1s作为时间同步周期，BC使用子地址29发送时间消息，使用广播方式发送，A、B总线各广播一次。本型号选用“一步方式”，即仅发送时间消息而没有时间同步消息，时间数据消息在通信帧0末发出。对于接收硬件秒脉冲信号的用户，时间码的整秒部就是秒脉冲对应的整秒时刻。因此包含的功能点为两个：
序号|功能描述|功能编号|
|接收OBDH校时时刻|FREQ7.1.1|设置OBDH校时标志TimeFlg.RcvOBDH
|接收GPS秒脉冲时刻|FREQ7.1.2|设置GPS校时标志
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用星敏感器A、B的测量，估计姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能：计算给控制器的姿态和角速度误差。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用B头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.11
STEP1：计算，将下标A换成B；FM3更改：若，则：，FSTD=1；
STEP2：计算。的各项乘以，的各项乘以。将下标A换成B；
STEP3：计算q
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算",0,0,1,0,0,0,0,0,0,0,0
"功能：利用星敏感器A、C的测量，修正姿态四元数与姿态角速度。
调用条件：见用户需求5.2.6节。
周期：0.125秒
输入：WorkMode， ， 。
输出：，
处理
见用户需求5.2.6.11。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送遥测数据
处理：
遥测数据分为实时遥测数据和延时遥测数据。
实时遥测数据格式包含5种格式：发射模式、正常模式、变轨模式、全姿态捕获模式、停控模式/应急模式。对于AOCS分系统而言，发射模式和正常模式的处理方式相同。若AOCS分系统出现模式转换则需通过方式代码的服务申请，请求OBDH变化遥测格式。
OBDH在收到地面指令或者在接收到AOCS的服务请求后，在125ms的时间内给AOCC发送对应的‘同步’方式代码。若AOCC在服务请求后大于0.25s的时间内未收到对应的‘同步’方式代码，则再次申请改变模式，若同一次申请的申请次数大于40次，则停止本次的申请。遥测数据格式内容具体见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：与动量轮通信，输出本周期电压。采集动量轮模拟量信息。
处理：
功能编号|功能|引用文档
FREQ102|初始化(加电)|任务书
FREQ103|动量轮使用要求(方向等)|任务书
FREQ104|通信(DA输出、脉冲输入)|任务书
FREQ105|通信故障处理|预留
FREQ106|数据解包与转换|任务书
FREQ107|处理动量轮数据有效性处理|任务书
FREQ108|动量轮模拟量采集、故障|任务书
FREQ109|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|喷气开关逻辑相平面分区，喷气脉冲宽度计算|FREQ31|4.3.1.1|进行单轴相平面分区及控制规律计算
|三轴姿态喷气控制与推力器脉宽分配|FREQ32|4.3.1.3|为三轴姿态喷气控制选择推力器
|轨控发动机与其备份的使用|FREQ33|4.3.1.4|轨控模式时使用轨控发动机及其备份
|动量轮摩擦补偿计算|FREQ34|4.3.2.2|动量轮摩擦力矩的补偿电压计算
|动量轮角动量保持控制|FREQ35|4.3.2.3|计算将动量轮保持至标称角动量所需的电压
|动量轮的启动与保持|FREQ36|4.3.2.4|启动动量轮至标称角动量，并保持
|正常飞行模式动量轮分配电压计算|FREQ37|4.3.2.5|计算正常飞行模式轮控所需电压
|正常模式轮子保护与动量卸载|FREQ38|4.3.3.1|决定采用磁卸载还是喷气卸载方式，调用相应程序
|磁卸载计算|FREQ39|4.3.3.2|计算磁卸载所需的磁矩与磁力矩器工作电压
|结构滤波器计算|FREQ95|4.3.2.6|PID计算控制力矩经过结构滤波器后，改善姿态控制效果
|太阳定向主程序|FREQ40|4.4.3.3|搜索并捕获太阳，完成并保持帆板对太阳定向
|重捕地球与建立正常姿态（1）|FREQ41|4.4.4.1|在完成对日定向后，由地面指令转入重捕地球。在偏航捕获阶段，通过红外和太阳敏感器定姿，消除卫星的偏航角。在完成偏航捕获后，由红外地球敏感器测量信号进行计算得到俯仰角和滚动角，控制滚动、俯仰使其趋向于0
|捕获地球与建立正常姿态（2）|FREQ42|4.4.4.2|当红外敏感器故障时，在太阳定向完成后，利用数字太阳与星敏感器信息，进行全姿态捕获，并建立正常姿态。
|三轴等效角动量偏差|FREQ91|4.3.4.1|根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差
|俯仰通道轮控算法|FREQ92|4.3.4.2|根据俯仰角和俯仰通道角动量偏差信息实现俯仰轴姿态控制
|磁进动、章动阻尼及俯仰轮卸载控制|FREQ93|4.3.4.3|通过磁力矩器，实现滚动-偏航轴的进动控制及章动阻尼，并对俯仰飞轮进行磁卸载
|三轴轮控算法|FREQ94|4.3.4.4|偏置动量轮处于力矩模式，根据红外地球敏感器测量信息计算得到的滚动角和俯仰角实现三轴姿态控制。滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制
|帆板捕获及跟踪控制|FREQ102|4.3.5|根据地面指令或自主使帆板跟踪太阳
|干扰补偿控制算法及动量轮分配电压计算|FREQ95|任务书的4.1.15|计算有效载荷干扰补偿控制电压，以及计算动量轮分配电压
|全姿态捕获动量轮控制方式主程序|FREQ40.5|4.4.5|全姿态捕获动量轮控制方式主程序
",0,1,0,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.5|偏置飞行模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|匀角速度匀积分时间跟踪模式控制|FREQ5.2.7|4.7|一般轨迹跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.9|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|凝视姿态跟踪模式控制|FREQ5.2.11|4.12|凝视姿态跟踪模式控制调用流程
|测试与标定模式控制|FREQ5.2.12|4.8|测试与标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.13|4.13|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.5|偏置飞行模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|匀角速度匀积分时间跟踪模式初始化|FREQ5.3.7|4.7|一般轨迹跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.9|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|凝视姿态跟踪模式初始化|FREQ5.3.11|4.12|凝视姿态跟踪模式初始化设置
|测试与标定模式初始化|FREQ5.3.12|4.8|测试与标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.13|4.13|惯性定向模式初始化设置

主动段和无控工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理： 
（1）CPU星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU星时时钟星时校时是通过OBDH校时，OBDH校时分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；",0,0,0,0,0,0,0,0,1,0,0
功能描述：计算太阳星历及光行差计算。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：秒脉冲信号处理。,0,0,0,0,0,0,0,1,0,0,0
"功能描述：置卫星姿态无控，处于自由飞行状态。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送姿态数据包3
",0,0,0,0,0,0,0,0,0,0,1
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续三个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是A090H或者校验和错误或者未收到重要数据），则应用软件按照重要数据的初始值运行。",0,0,0,0,0,0,0,0,0,1,0
功能描述：发送姿态控制数据包1,0,0,0,0,0,0,0,0,0,0,1
"功能描述：复位模式初始化
处理：
- StarTime（星上时间）：0.0；
- 向星务分系统申请重要数据；",1,0,0,0,0,0,0,0,0,0,0
功能描述：使用GPS通道版数据进行GPS定轨。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：模式9切换方式。
处理：
由地面干预发送指令完成；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内
    AOCC应用软件应对内存下卸的地址区域进行保护：当内存下卸指令中的首地址、末地址均在PROM硬件地址范围、RAM硬件地址范围、1553B总线接口芯片的RAM地址范围内，则应用软件按照内存下卸指令的要求下卸目标区域的数据；若内存下卸指令中的地址超出上述3个区域的地址范围，则应用软件不更新1553B总线接口芯片中内存下卸内容子地址中对应数据。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：追踪器构型切换管理及质量设置
处理：根据构型设置追踪器质量及转动惯量
",0,1,0,0,0,0,0,0,0,0,0
"应用软件共分21个工作模式，分别是等待段、太阳定向、恒星定向2、惯性调姿、恒星定向4、轨控定向、着陆准备、主减速、快速调整、接近下降、悬停、避障、缓速下降、自主定位、起飞准备、垂直上升、上升调姿、轨道入射、星光环月、速率阻尼和无控。模式字和各模式的对应关系如下：
表5.2.4.4-1 工作模式
模式字|工作模式|使用场合
0|等待段|""加电之后，判出分离27s之前，
或复位之后，重要数据恢复之前。""
1|太阳定向|""组合体地月转移巡航和环月阶段正常运行状态；
上升器远程引导巡航""
2|恒星定向2|变轨建立点火姿态前
3|惯性调姿|变轨建立点火姿态
4|恒星定向4|变轨建立点火姿态后
5|轨控定向|""动力下降之前的轨控
月面上升之后的轨控""
6|着陆准备|建立着陆点火姿态
7|主减速|动力下降
8|快速调整|动力下降
9|接近下降|动力下降
10|悬停|动力下降
11|避障|动力下降
12|缓速下降|动力下降
13|自主定位|月面工作阶段
14|起飞准备|建立月面起飞初始状态
15|垂直上升|月面上升
16|上升调姿|月面上升
17|轨道入射|月面上升
18|星光环月|月球轨道交会对接自主段
19|速率阻尼|轨控姿态超差
20|无控|动力下降着陆、交会对接段轨道器最后逼近、故障
",0,0,0,1,0,0,0,0,0,0,0
功能描述：启动动量轮至标称角动量，并保持。,0,1,0,0,0,0,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计角速度。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
输入：
数传天线(j=1,2)跟踪地面站编号i，跟踪起始时刻ti，地面站i在惯性系指向，被数传天线(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线(j=1,2)跟踪的地面站i的矢量在本体系的表示。（i可为1~7）。
输出：
数传天线1和2的指令转角，指令转速，或者复位及保持控制指令。",0,1,0,0,0,0,0,0,0,0,0
功能描述：星上实时计算中继星的轨道。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：选择星敏感器有效数据进行几何姿态确定，并在星敏无效情况下并采用陀螺数据进行姿态预估。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收对应秒脉冲的整秒时刻
处理： 将接收对应秒脉冲的整秒时刻存储地址中内容解包成对应秒脉冲的整秒时刻的数据格式。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：在完成偏航捕获后，由红外地球敏感器测量信号进行计算得到俯仰角和滚动角，控制滚动、俯仰使其趋向于0。
输入：	陀螺数据处理的输出 ；
数字太阳输出 ，
卫星外推轨道的输出	
太阳星历的输出	
姿态角估值	",0,0,1,0,0,0,0,0,0,0,0
功能描述：实时计算卫星轨道参数。,0,0,0,0,1,0,0,0,0,0,0
功能描述：接收PVT数据,0,0,0,0,0,0,0,0,0,1,0
"功能描述：发送遥测数据
处理：
CTU从AOCC接收遥测数据后，向AOCC发送“当前”的实时遥测帧计数，AOCC随后组织“下一帧”62字节遥测数据并将数据放到相应的子地址（更新总线缓存）。数字量遥测数据格式内容具体见数字量遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：判断陀螺的使用范围。
输入：	本控制周期内采样的陀螺角度增量 (量纲：弧度) （=,…,）
      	上周期陀螺数据
      	标志 N_GyroDiagnV
处理
对陀螺数据进行有效性判断。若某个陀螺故障或某个陀螺为新上电，则不进行有效性判断（陀螺不引入）。其中陀螺新加电有三种情况1、判断出陀螺故障且允许自主加电情况下，应用软件自主加电。2、数据指令加电。3、脉冲遥控指令加电。对于新加电陀螺，则在该陀螺加电时间小于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为0；当该陀螺加电时间大于等于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为1。
若SLTU陀螺不加电或该陀螺故障，不引入。当“允许使用电源状态诊断陀螺”时，应用软件根据与SLTU通讯得到的陀螺电源状态确定陀螺加断电状态；当“不允许使用电源状态诊断陀螺”时，应用软件只根据数据指令确定陀螺加断电状态。若SLTU得到的六个电源状态均断电，则不根据电源状态判断陀螺是否加电。",0,0,0,0,0,0,1,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：，
输出：保持角动量所需电压，
      角动量偏差积分项：，",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
输入：数传天线j (j=1,2)，预置指令，跟踪开始指令，跟踪结束指令，地面站i在惯性系指向，被数传天线j(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线j(j=1,2)跟踪的地面站i的矢量在本体系的表示，数传天线收到的预置角度
输出：数传天线1和2的指令转角",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：上电和复位初始化 
需求类别：其他 
软件需求描述：系统软件上电复位后，调用应用软件AppInit函数，并根据初始化内容，启动任务
处理：
OBC上电/复位后，由系统软件引导应用软件运行。首先进行初始化，包括系统软件初始化和系统软件调用应用软件提供的初始化函数（AppInit）。启动任务并开始进行任务调度管理。 ",1,0,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
|OBDH校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|两种校时方式的切换|FREQ Q1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：采集22路数字太阳粗码、监视码和全开码。
处理：
采集方法：连续采集28路（中间有细码信息，处理时略过），采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：与CAN通讯获得上行/下行数据。
调用条件：AOCC被动接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通讯，交换数据，以实现星地联系和对卫星的人工干预。主要完成下列功能：
AOCC向星务分系统发送数据（中断接收星务分系统命令，依据命令发送各类遥测参数）；
发送快帧遥测；
发送慢帧遥测；
将AOCC为星务保存的重要数据发送给星务分系统；
发送星敏感器和姿态辅助数据；
有内存下卸要求时，发送AOCC指定内存内容；
AOCC接收星务分系统数据（中断方式）包括接收固定地址参数注入；接收可变地址参数注入；接收轨道参数数据；接收程序注入；接收数据指令；接收重要数据返回；接收整星对时广播数据；接收GPS高精度秒脉冲对时广播；接收GPS导航数据等。
如果应用软件4s收不到星务分系统信息或连续100秒未收到符合通信协议的正确数据，对CAN总线控制器重新初始化。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
在模式切换中以地面上行注入优先，所有模式都可以通过地面注入的模式运行类指令进行转换。下面主要分析自主转换换条件与过程，具体转换条件见用户需求4.1~4.11的模式转换条件。4.4姿态机动模式喷气机动转对地或保持的条件中姿态角控制量判据中由0.000262mΦM4改为0.0262mΦM4。    ",0,0,0,1,0,0,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得9个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据， AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。具体如下表所示： 
GROLTUSeltFlag|进行通讯的陀螺LTU
01H|陀螺LTU1
02H|陀螺LTU2
03H|陀螺LTU3
其它|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1

取数指令由三个字节组成：
第一个字节为对陀螺LTU的命令设置，有四种命令格式：取数指令1、取数指令2、复位指令、地检模式指令，应用软件只自主发取数指令1和取数指令2两种格式，并由注入控制方式指定及LTU通信选择块中的陀螺LTU取数方式来切换，默认为取数指令1；其余两种格式（复位指令和地检模式指令）通过地面注入LTU命令块来设置。
第二个字节为对光纤陀螺的命令设置，有四种命令格式：测量模式1（有温度补偿）、测量模式2（无温度补偿）、地检模式1（只传地面数据）、地地检模式2（地面数据+头部测量数据），由注入控制方式指定及LTU通信选择块中的光纤陀螺指令切换方式字来切换这四种格式，默认为测量模式1（有温度补偿）。
第三个字节为前两个字节的累加和。
另外，每个控制周期AOCC还向选取的陀螺LTU发送取陀螺状态指令，指令为3字节指令（D5、AA、7F），得到的状态信息用于遥测。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式，具体参见LTU通讯协议。
（3）陀螺LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
功能描述：利用轨道外推的计算结果，计算其他待用参数。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据陀螺输入，预估卫星对地姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用星敏感器B的测量，修正姿态四元数与估计角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：陀螺数据处理。
处理：
每个惯性姿态敏感器组件中，单个陀螺输出包括1个加速脉冲信号和1个减速脉冲信号。每个信号由1个19位计数器完成对信号的计数。计数器采用加计数方式，当脉冲数超过524287时，计数器清零，重新计数，应用软件判断计数器溢出，使用说明见表3-7。数据为无符号数据。
本周期陀螺n（n＝1～6）加（减）速脉冲计数值(个)=（本周期加（减）脉冲数 － 上周期加（减）脉冲数）；
陀螺n角度增量( º)＝ （陀螺n加速脉冲计数值 – 陀螺n减速脉冲计数值）×陀螺脉冲当量，陀螺脉冲当量为：5×10-5 度。
FREQ65|陀螺数据采集|
FREQ66|陀螺加电状态判断|
",0,0,0,0,0,0,0,0,1,0,0
功能描述：CMG数据处理。,0,1,0,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：三轴喷气姿态控制。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：帆板未展开模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位。
处理：更动：去掉星敏粗姿态计算。",0,0,1,0,0,0,0,0,0,0,0
功能描述：帆板故障检测，切换帆板LTU。,0,0,0,0,0,1,0,0,0,0,0
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续64个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是D090H或者校验和错误或者未收到重要数据），上电或者复位后的前126个周期内，连续79个控制周期星箭分离信号均有效，则卫星自主转全捕对日模式；否则应用软件按照重要数据的初始值运行。则应用软件按照重要数据的初始值运行。应用软件只有在判断到星上时间为超过1257秒时，以及重要数据均正确的情况下，才使用重要数据恢复模式。若取到的重要数据正确，但取到的星时小于1257s，则需按重要数据文件要求取星时错误的要求进行模式恢复。,0,0,0,0,0,0,0,0,0,1,0
"功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：发送姿态数据包,0,0,0,0,0,0,0,0,0,0,1
功能描述：将GPS轨道确定参数转换成控制系统中太阳星历和地磁场计算所需的19个轨道参数,0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据天线安装定义和地面站坐标，实时计算天线和地面站的夹角。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ77|初始化|任务书
FREQ78|地检使用要求|任务书
FREQ79|通信(串口)|任务书
FREQ80|通信故障处理|任务书
FREQ81|数据解包与转换|任务书
FREQ82|地检数据有效性判断、处理|任务书
FREQ83|地检模拟量采集、处理|预留
FREQ84|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：检测推力器的微漏，必要时作相应的主备份切换。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：模式3切换方式。
处理：
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：若地面指令转入对日定向运行模式或者太阳捕获模式，置CMGStartFlag=1。",0,0,0,1,0,0,0,0,0,0,0
功能描述：若某个模拟太阳故障，则模拟太阳数据无效。若某个模拟太阳不见太阳标志，则该模拟太阳无效。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：在红外太阳定姿方式下计算四元数，在其余定姿方式下计算欧拉角。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求标识：FREQ4 
软件需求名称：星时计算 
软件需求描述：星时计算。见“任务书”4.1.3.1“星时计算”。",0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：接收上行注入数据指令 
需求类别：其他 
软件需求描述：接收并处理上行注入数据指令。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：
 128ms周期计时（功能编号：FReq-13）。
处理： 设置128ms控制周期中断标志，计数器值为0时产生中断，不需要显示的重新装载。",0,0,0,0,0,0,0,1,0,0,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
部件加断电指令的处理|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,0,0,0,1,0,0
"功能描述：为机动过程姿态确定提供初始姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：与发动机通信，输出本周期喷气脉宽。
处理：
功能编号|功能|引用文档
FREQ94|初始化|任务书
FREQ95|推力器使用要求(自锁阀和发动机组的选择)|任务书
FREQ96|通信(脉冲输出)|任务书
FREQ097|通信故障处理|预留
FREQ098|数据解包与转换|预留
FREQ099|推力器数据有效性处理|预留
FREQ100|推力器模拟量采集、处理|任务书
FREQ101|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：完成卫星在失去姿态基准情况下的全姿态捕获，对日定向功能。
处理过程：过程如下：
分两个过程：
第一步捕获太阳（BZ1=3且FSA=0）（在0.262秒中断中完成）
STEP1：进行姿态预估（4），得到姿态角和角速度。
STEP2：进行Z轴捕获太阳的处理过程
发左右帆板归零指令
设定三轴捕获的角速度，（见用户需求）
进行速率喷气控制（见用户需求）
如果ZT2 = 2且FWi  C对工作的飞轮成立，则进行飞轮动量保持控制及飞轮启动；如果ZT2  2或FWi < C 对某一工作的飞轮成立，则将六个轮子的控制电压置为0
满足下列两个条件时，设置FSA=5：
ZT13  4（用0-1太阳捕获）且且指定的敏感器见太阳
ZT13 = 4（用数字太阳捕获）且两个数字太阳均在视场内
第二步太阳定向（BZ1=3且FSA不等于0）
STEP1：进行红外数据采集及处理并将磁力矩器的输出电压设置为0。
STEP2：进行Z轴对日定向和陀螺故障检测及选择：
STEP3：根据ZT7的取值，进行相应的帆板控制。
在BZ1=3中，FSA有三中状态分别为0、5、A，这三个状态的转换关系如图12和表41所示：
图 12： FSA的状态转移图
表 40： FSA状态转换的条件
条件|具体说明
条件1|""ZT13  4（用0-1太阳捕获）且且指定的敏感器见太阳
ZT13 = 4（用数字太阳捕获）且两个数字太阳均在视场内""
条件2|""ZT13  4（用0-1太阳捕获）且且Ls = 1且指定的敏感器不见太阳
ZT13 = 4（用数字太阳捕获）且且 ""
条件3|""ZT13  4（用0-1太阳捕获）且且Ls = 1且
ZT13 = 4（用数字太阳捕获）且且且""
条件4|""ZT13  4（用0-1太阳捕获）且且Ls = 1且指定的敏感器不见太阳
ZT13 = 4（用数字太阳捕获）且且 ""
",0,0,0,1,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的数传天线系数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收遥控可变地址注入块
处理：软件设计时需要判断地址是否对齐，若未对齐，则不执行此注入块。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：卫星绕俯仰轴转动，直到满足姿态角条件，进入下一阶段偏航捕获。姿态确定由红外和陀螺。姿态控制是喷气控制
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。CCU应用软件取数消息与同步消息的发送时间间隔大于3ms
|红外2数据的采集与处理|FREQ1.3.2|""红外2
LTU取数指令""|红外2的数据|在通讯允许的条件下（红外2的当班标志为1），向红外2 LTU发取数指令，获得红外2数据并处理成对应的数据。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：使用红外、星敏、太阳定姿时，计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：利用数字太阳信息，进行太阳捕获，对太阳定向。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：置卫星姿态无控处于自由飞行
处理过程：过程如下：
STEP1：进行姿态预估（见用户需求），得到姿态角和角速度
STEP2：当ZT7为0、7、3、5时，发相应的帆板控制指令：
ZT7取值|处理
ZT7 = 0|发左右帆板转角均为0度的指令
ZT7 = 7|发左右帆板转角均为180度的指令
ZT7 = 3|发左为90度，右为 -90指令
ZT7 = 5|发左右均为90度指令

STEP3：关自锁阀LV-1，LV-2，LV-3，LV-4，关推力器J1，J2，… ，J16。
STEP4：如果ZT7 ≥ 8，则每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值发相应的指令一次
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

STEP5：置六个动量轮的电压为0",0,0,0,1,0,0,0,0,0,0,0
"功能描述：模拟量遥测 
",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|给VIPPCU发送轮询和校时包|FREQ1.8.1|""无
""|校时等数据|在每个控制周期与VIPPCU通讯时，在“轮询与校时包”中发送本周期的控制UTC时间
|VIPPCU加电状态状态数据的采集与处理|FREQ1.8.2|""加电状态
""||CCU通过采集来自VIPPCU的 “VIPPCU A机加电状态”、“VIPPCU B机加电状态”两个0～5V模拟量，来确定VIPPCU的A、B机加电状态。
|给VIPPCU发送的下平台控制数据|FREQ1.8.3|无|控制数据|CCU给VIPPCU发送的下平台控制数据。
|给VIPPCU发送CCU的重要数据|FREQ1.8.5|无|CCU的重要数据|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|给VIPPCU发送VIPPCU的重要数据|FREQ1.8.6|无|VIPPCU的重要数据|给VIPPCU发送VIPPCU的重要数据
|转发VIPPCU上注指令参数块|FREQ1.8.7|无|VIPPCU上注指令参数块|需要时，转发VIPPCU上注指令参数块
|接收VIPPCU遥测数据|FREQ1.8.8|VIPPCU遥测数据|无|每个控制周期，接收VIPPCU遥测数据，解包成需要的数据
|接收CCU重要数据返回包|FREQ1.8.9|CCU重要数据|指令|上电/复位后应用软件首先从VIPPC恢复重要数据。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：以1s为采样周期，计算角速度。。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：为姿态机动提供的目标轨迹参考数据
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收总线指令                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     处理： 将接收总线指令存储地址中内容解包成总线指令的数据格式，根据不同的总线指令进行相应的处理。 ,0,0,0,0,0,0,0,0,0,1,0
"功能描述：根据红外信息绕滚动俯仰转动，进行滚动俯仰捕获
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：重要数据保存
处理：回送重要数据
说明：上电/复位35秒内 或 主动段 或 任务超时 或 与LTU通讯连续失败20次且自主切换禁止，不保存重要数据。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收AOCC系统注入参数
处理：
当收到接收遥控注入结束标识消息后，将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。只有当某个块类型的所有数据都收到，且每块数据的校验和都正确时，才能使用此种类型的注入数据。注入的数据具体见上行注入文件。需要注意的是：地面注入ZT9时：若ZT9中为1的个数小于3个，则不改变星上ZT9的取值；应用软件不响应ZT1=2、ZT1=6、ZT1=8的注入指令。",0,0,0,0,0,0,0,0,0,1,0
"功能模式：姿态机动目标姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：星上实时计算地磁场强度。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：使用红外、数字太阳敏感器确定姿态。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：确定星敏感器数据的有效性。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：利用A头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.10
STEP1：计算；FM3更改：若，则：，FSTD=1；
STEP2：计算，。的各项乘以，的各项乘以。
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,0,1,0,0,0,0,0,0,0,0
功能描述：由数字太阳粗码得到数字太阳角、全开码、见太阳标志。,0,0,0,0,0,0,0,0,1,0,0
功能描述：在CMG控制期间按照一定算法对磁力矩器施加控制电压，所产生磁矩与实际地磁场相互作用产生磁控力矩对CMG进行卸载。,0,1,0,0,0,0,0,0,0,0,0
"功能：利用星敏感器C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
功能：利用星敏感器A 、C的测量，修正姿态四元数与估计角速度。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据星敏感器的输入，计算姿态偏差，角速度等。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：确定陀螺数据的有效性。,0,0,0,0,0,0,1,0,0,0,0
功能描述：利用星敏感器数据进行卫星姿态捕获。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号的选取。
处理：同用户需求的5.1。
——5.1（2）；;",0,0,1,0,0,0,0,0,0,0,0
"软件需求标识：FREQ19 
软件需求名称：星敏数据处理 
需求类别：其他 
软件需求描述：星敏数据处理。",0,0,0,0,0,0,0,0,1,0,0
光行差修正的初始设置为：AOCC应用软件对APS星敏信息进行补偿计算，不向星敏发送相对J2000的时间和速度。,0,0,0,0,0,0,0,0,1,0,0
功能描述：对星敏感器输出数据进行有效性判断,0,0,0,0,0,0,1,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。。为保证帆板LTU线路归零指令的成功执行，要求应用软件连续3个周期对帆板LTU线路发送归零指令。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据-Y帆板角误差控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：搜索太阳，直到数字太阳敏感器有太阳信息。,0,0,1,0,0,0,0,0,0,0,0
功能描述：抖动帆板。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：轨控模式初始化
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续60个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是A090H或者校验和错误或者未收到重要数据），则应用软件按照重要数据的初始值运行。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理：包括CPU内部星时时钟和CPU外部星时时钟的星时采集计算与校时。。
（1）CPU外部星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期星时锁存寄存器中读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU外部星时时钟星时校时包括OBDH校时和GPS高精度校时两种校时方式：
OBDH校时：也分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；
GPS高精度校时。
OBDH星时校时为系统默认使用的校时方式。GPS秒脉冲高精度时间是否引入系统由注入指令执行控制：若注入指令表示“使用GPS秒脉冲高精度校时时间”，则当满足GPS秒脉冲高精度校时条件时AOCC应用软件仅进行GPS秒脉冲高精度校时时间的计算，系统使用该时间。GPS秒脉冲高精度方式优先级高于OBDH星时校时，当GPS秒脉冲校时时不再进行OBDH星时校时。如果连续超过1分钟均不满足GPS秒脉冲高精度校时条件，则可进行OBDH星时校时。一旦再满足GPS秒脉冲高精度校时条件则继续采用GPS秒脉冲高精度校时。其中GPS秒脉冲高精度校时条件及校时计算具体见任务书中规定。
（2）CPU内部星时时钟的星时采集计算与校时
CPU内部星时时钟星时计算方法。同CPU外部星时时钟星时计算；CPU内部星时时钟星时校时只包括OBDH校时：分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时。
星时的选取
根据注入的姿控数据块2中的CPU星时时钟选用标志来实现内部星时时钟和外部星时时钟的切换，默认为CPU外部星时时钟
均匀校时
内部和外部时钟星时计算中在计算完本周期绝对星时后增加每周期修正量，并在计算前先将它限幅到1毫秒，每周期的修正量初始为0，通过内存修改来修改该修正量。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发送事件数据给OBDH保存
处理：将事件数据打包后放到事件数据内存地址空间中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：处理地面遥控注入的固定地址参数
处理：
128-135：注入参数乘修正系数
515：全量校时处理：星时=全量校时星时
516：增量校时处理星时=星时+增量校时量
其它：更新注入的参数",0,0,0,0,0,0,0,0,0,1,0
功能描述：检测工作中的动量轮的故障并设置BZ3。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：陀螺数据处理。
处理：
每个惯性姿态敏感器组件中，单个陀螺输出包括1个加速脉冲信号和1个减速脉冲信号。每个信号由1个20位计数器完成对信号的计数。计数器采用加计数方式，当脉冲数超过1048575时，计数器清零，重新计数，应用软件判断计数器溢出，数据为无符号数据。
本周期陀螺n（n＝1～6）加（减）速脉冲计数值(个)=（本周期加（减）脉冲数 － 上周期加（减）脉冲数）；
陀螺n角度增量( º)＝ （陀螺n加速脉冲计数值 – 陀螺n减速脉冲计数值）×陀螺脉冲当量。
对于陀螺n的脉冲数N需要分段处理：要求将每个陀螺量程范围-2.8º/s ~ +2.8º/s分为5段，每段使用不同的标度因数K，分段情况具体见任务书4.1.5.3节要求，当脉冲数超出范围时，则使用±2.8º/s时的标度因数",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|轨道与星历|FREQ2.0|5.1.1|卫星轨道、太阳星历、地面站位置、地磁场强度等计算程序的主流程。
|卫星轨道计算|FREQ2.1|5.1.2|计算卫星当前轨道
|GPS轨道数据有效性判断|FREQ2.2|5.1.3|对GPS轨道数据的有效性进行判断
|GPS轨道版轨道计算|FREQ2.3|5.1.4|利用GPS轨道版数据进行GPS定轨程序
|轨道、目标姿态预计算|FREQ2.4|5.1|完成控制周期的轨道星历与目标姿态预先计算
|近圆中低轨卫星轨道根数外推算法产品规范|FREQ2.5|/|规范化算法：
|近圆中低轨卫星GPS轨道计算算法算法产品规范|FREQ2.6|/|规范化算法：
|岁差章动矩阵计算算法算法产品规范|FREQ2.7|/|规范化算法：
|4阶星上地磁场计算方法算法产品规范|FREQ2.8|/|规范化算法：
|光行差计算算法产品规范|FREQ2.9|/|规范化算法：
",0,0,0,0,1,0,0,0,0,0,0
功能描述：星敏感器数据处理，安装偏差估计。,0,0,1,0,0,0,0,0,0,0,0
功能描述：接收内存读出地址及长度，发送内存读出数据包。                                                                                                                                                                                                                                                                                                                                                                                                                    处理：将接收内存地址及长度存储地址中内容的解包成需下传的内存首地址和长度，并判断需下传内容是否在内1553RAM有效地址范围内。若在范围内，则将需下传的内容放到指定地址中。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据姿态角和姿态角速度偏差数据进行系统故障的检测。
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。
轨控模式姿态角控制量超差阀值从0.077 mSYSS2改为0.0873 mSYSS2。
5.7.3（1）增加姿态超差判断。",0,0,0,0,0,1,0,0,0,0,0
"功能描述：入轨后或太阳丢失后，搜索太阳并捕获太阳。
处理：
自主或指令转入该模式，进行如下设置。
根据自锁阀状态设置自锁阀1和/或自锁阀2开。
系统诊断出故障后进入该模式，100秒内不控，具体要求见用户需求。
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
if(CMGStartFlag=1) 调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
	调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；
调用目标姿态确定；
调用控制器输入量计算；
喷气卸载条件计算
if(CMGStartFlag=1) 调用CMG奇异状态的判断及算法计算；
	if(CMGInControlFlag=1 且UnLoadMode=0)
{ 调用CMG的控制；
if(SSTCatchSuc＝1) 调用 磁卸载控制； }
else { if(CMGStartFlag=1) 调用 CMG启动与保持；
if(TimeStopC<=0且Flag_equation=0) 
{调用 相平面喷气脉宽； }
else {置喷气脉宽为0；SpeedControlTime=0；WacFlag=1；}
}
	调用 系统故障诊断；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：选择视速度增量关机位置控制喷管
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据框架角偏差计算指令转速。
处理：主要处理过程如下：
当接收到由OBDH发送来的中继快扫到位指令,进入天线预置状态，令FAFP=1，预置的目标角为命令块中的-10对应时刻通过轨道计算得到的天线框架角。控制中继天线转动快扫到达目标位置。当时间大于-10后，退出预置状态令FAFP=0。
当接收到由OBDH发送来的中继复位指令,进入天线复位状态，令FARP=1。根据命令块中数据标志来确定天线要复位的位置。如果标志为55H，天线复位到命令块中指定的角度位置；如果标志为FFH，则天线复位到零位。
当地面上行注入ZT40（1）=1时，天线进入螺旋扫描状态。按照特定的步长控制天线转动，当螺旋扫描持续的时间超过注入的天线捕获扫描时间时，将ZT40(1) 置0退出螺旋扫描状态。
当接收到由OBDH发送来的中继程序跟踪停止指令，停止向中继捕获跟踪控制单元发送控制信息，并设定标志传到遥测。其余情况下天线处于程序跟踪状态。
卫星增加了侧摆中继时传的工作模式，快摆时工作时序见任务书.5。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：选择通讯的红外LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）红外共有两个LTU（正俯仰红外LTU和负俯仰红外LTU），AOCC每个控制周期向注入文件中的ZT5和IresLTUSeltFlag的最大组合中指定的和加电的红外LTU发送取数指令
（2）向选择的红外LTU发送完取数指令，获得红外LTU返回的数据，将数据转换为所需的数据格式。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：利用红外太阳建立正常飞行姿态
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：使用星敏感器A、C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送控制计算机计算得出的星历数据
处理：将控制计算机计算得出的星历数据打包后放到星历数据地址空间中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：选择通讯的天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
  （1）加电状态的判断：OBDH在给捕跟分系统发送加电命令的同时，将该命令发送给AOCC。AOCC根据命令字的内容，记录加电状态和工作的主备状态。当第一次得到加电指令时，如果没有主备命令，默认工作在主份；当没有加电，但是发送了主备切换命令，切换有效。中继捕跟分系统断电，再加电后，保留中继上次加电工作状态；当AOCC发生复位、NMI和切机时，保留中继上次加电工作状态。
（2）数据通讯：当接收到中继快扫命令，并且AOCC判断中继捕获跟踪分系统加电状态下，AOCC每个0.524秒控制周期，向GDA发送一次天线驱动机构双轴指向数据。并接收GDA传回的X、Y轴测量角度信号和两轴的偏差角度（X轴框架角、Y轴框架角、X轴偏差角、Y轴偏差角、X轴框架角速度、Y轴框架角速度）。当接收到中继停止命令或判断中继不加电，则停止通讯。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据姿态估值与数字太阳输出，计算量测的一步预测与新息，建立数字太阳输出的可用性标志。
输入： 5.2.14.3输出的
       姿态估值 
       数字太阳数据有效性标志F_Ds1Valid， F_Ds2Valid（由有效性判据给出）
      	  数字太阳敏感器输出：, (量纲：弧度)",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件进行1553B初始化、变量的初始化
处理：
GPS无效判断的连续次数变量由1改为7。
删除读取一次星时计数器的要求。",1,0,0,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的控制数据转换为消息需要的格式并输出。
MW数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发MW数据采集指令，获得ACU数据并处理成对应的MW的角动量。
部件加断电指令的处理|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每三个控制周期将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,0,0,0,1,0,0
"功能描述：卫星绕x轴转动，使红外搜索地球。
输入：	陀螺数据处理的输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）
故障标志IRES_Flag，计时器TES
红外数据有效性输出 ，",0,0,1,0,0,0,0,0,0,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.6.1~4.6.3。
序号|功能点编号|功能描述|说明
|FREQ3.4.8.1|喷气控制|《用户需求》4.6.1
|FREQ3.4.8.1.1|相平面姿控算法|《用户需求》4.6.1.1
|FREQ3.4.8.1.2|相平面法喷管选择|《用户需求》4.6.1.2
|FREQ3.4.8.1.3|脉冲调宽姿控算法|《用户需求》4.6.1.3
|FREQ3.4.8.1.4|脉冲调宽法喷管选择|《用户需求》4.6.1.4
|FREQ3.4.8.2|动量轮控制|《用户需求》4.6.2
|FREQ3.4.8.2.1|动量轮安装矩阵和电压分配矩阵|《用户需求》4.6.2.1
|FREQ3.4.8.2.2|动量轮摩擦补偿计算|《用户需求》4.6.2.2
|FREQ3.4.8.2.3|动量轮角动量保持的PI控制|《用户需求》4.6.2.3
|FREQ3.4.8.2.4|动量轮启动与保持|《用户需求》4.6.2.4
|FREQ3.4.8.2.5|正常飞行动量轮分配电压计算|《用户需求》4.6.2.5
|FREQ3.4.8.3|喷气卸载计算|《用户需求》4.6.3
|FREQ3.4.8.4|喷气动量轮联合控制|《用户需求》4.6.4
",0,1,0,0,0,0,0,0,0,0,0
功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。,0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：接收遥控固定参数注入块的地面站位置信息功能区数据,0,0,0,0,0,0,0,0,0,1,0
"功能描述：星敏感器数据处理。
处理：同用户需求的5.11。
(1)获得FSTA,FSTB,FSTC
条件|FSTA|FSTB|FSTC
ZT23=0|0|0|0
ZT23=6,|1|0|0
ZT23=6,|0|0|0
ZT23=9,|1|*|*
ZT23=9,|0|*|*
ZT23=9,|*|1|*
ZT23=9,|*|0|*
ZT23=9,|*|*|1
ZT23=9,|*|*|0
ZT23=A,|0|1|0
ZT23=A,|0|0|0
ZT23=B,|0|0|1
ZT23=B,|0|0|0
ZT23=C,|0|1|*
ZT23=C,|0|0|*
ZT23=C,|0|*|1
ZT23=C,|0|*|0
ZT23=D,|1|0|*
ZT23=D,|0|0|*
ZT23=D,|*|0|1
ZT23=D,|*|0|0
ZT23=E,|1|*|0
ZT23=E,|0|*|0
ZT23=E,|*|1|0
ZT23=E,|*|0|0

(2)修订FSTA,FSTB,FSTC
若ZT41[3]=1允许星敏数据有效性判断且BZ13全姿态捕获对日定向姿态且BZ14重捕地球转三轴稳定运行且BZ1≠7无控则进行如下诊断：
若FSTA = 1，FSTC = 1，（或）则FSTA = 0，FSTC = 0；
若FSTA = 1，FSTB = 1，（或）则FSTA = 0，FSTB = 0；
若FSTB = 1，FSTC = 1，（或）则FSTB= 0；FSTC = 0。
(3)获得FSTD
FSTA|FSTB|FSTC|ZT12|BZ2|FSTD
1|1|*|1或9或8|≤2|2
1|*|1|1或9或D|≤2|3
*|1|1|1或9或E|≤2|4
1|*|*|6或9|≤2|5
*|1|*|7或9|≤2|6
*|*|1|B或9|≤2|7
不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|1

(4)当BZ1=1(三轴稳定正常运行轨道姿态)或9(侧摆角保持)时，进行星敏感器数据修正。公式见5.11(9)。
(4)当BZ1=1(三轴稳定正常运行轨道姿态)时，根据ZT40(3)是否为1（引入星敏在轨标定）进行星敏感器在轨标定。公式见5.11(10)。",0,0,1,0,0,0,0,0,0,0,0
"控制计算机实时遥测包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包1|FRE65
|发送姿态数据包3|FRE65.1
|星敏感器姿态数据包|FRE65.2
|星敏感器自检数据包|FRE65.3
|姿态控制数据包|FRE65.4
|轨道数据包|FRE65.5
|LTU自检数据包|FRE65.6
|AOCC及状态数据包|FRE65.7
|发送星敏修正数据包|FRE65.8
|发送对日定向数据包|FRE65.9
|数传天线地面夹角数据|FRE65.10

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
功能描述：使用红外、星敏、太阳定姿时，计算正常飞行轮控所需电压。,0,1,0,0,0,0,0,0,0,0,0
"上电/复位后，系统软件进行相应的初始化工作，之后调用应用软件的AInit()函数进行应用软件的初始化。应用软件初始化工作主要包括硬件初始化、变量初始化、星箭分离查询、确定部件加断电状态状态。
硬件初始化的内容如下表所示：
表5-2 上电/复位后硬件初始化表
内  容|状  态
串口初始化|按前面要求进行设置
CANA、B总线初始化|按通讯协议要求进行设置

硬件初始化完成后应用软件需对初始值不为0的变量初始化（系统软件已对B段变量清零），相应变量的初始化值见《卫星控制分系统控制计算机应用软件用户需求》和《卫星控制分系统注入参数及数据指令的用户需求》。应用软件需读取一次星时计数器值。
硬件和变量初始化完成后，应用软件连续进行5次星箭分离查询，每次间隔大于1ms。若连续3次查到星箭分离，则认为星箭已分离，置当前控制模式为“复位进入模式”，设置星时为0.75秒；否则认为星箭未分离，进行主动段初始化工作。",1,0,0,0,0,0,0,0,0,0,0
功能描述：由平衡方程方法进行陀螺的故障检测。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：发送和接收OBDH重要数据1、2、3
处理：软件初始化后不用做处理，应用软件只需在初始化时为它指定存储的地址空间即可。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：轨控推进系统与加速度计联合诊断加计及轨控部件状态
",0,0,0,0,0,1,0,0,0,0,0
功能描述：数传天线数据处理,0,0,0,0,0,0,0,0,1,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量。
输入：动量轮的转速方向和脉冲计量、上一次轮子角动量值。
输出：动量轮的角动量。
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量（动量轮角速度为1800r/min时的角动量为15Nms）。
（3）令（i = 1，2，… ，6）。为上一次轮子角动量值。（i = 1，2，… ，6）。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：定义AOCC初始上电至星箭分离为主动段工作模式。
处理：
定义星箭分离前为主动段工作模式，应用软件在控制周期任务函数中进行下列工作：
	星时计算。
	采集部件（太阳敏感器、陀螺、星敏、CMG）信息。
	采集部件、线路遥测模拟量。
	响应主动段测试指令和“运行初始速率阻尼模式”指令。
	对ALTU当班状态判断，并与当班ALTU通讯。
	响应星务分系统轮询、数据遥控指令、数据注入、程序注入、秒脉冲校时等，并进行相应处理。
	星箭分离的确认依据为：一个控制周期内对星箭分离状态位读5次，若连续3次以上读入为“1”，则认为本周期查到星箭已分离，每次读的时间间隔要求大于1ms。如果在连续3个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入初始速率阻尼模式。
	此外，通过地面遥控指令进行以下起飞前设置：
5个CMG加电，并将框架角均转到0度保持、锁定；
6个陀螺加电。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：
每次中断到来，向TM串口5(US[5])写入8字节的数据（功能编号：FReq-12）。
处理：发送DPRU由RT变为BC的使能请求，每次中断到来，通过同步串口US[5]发出8字节，首先复位FIFO，然后发送指令码为：0x1A、0xCF、0xFC、0x1D、0xBF、0xC0、0xA6、0xED
同步串口5模式寄存器设置为02，帧长设置为128字节。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ82|初始化|任务书
FREQ83|地检使用要求|任务书
FREQ84|通信(串口)|任务书
FREQ85|通信故障处理|任务书
FREQ86|数据解包与转换|任务书
FREQ87|地检数据有效性判断、处理|任务书
FREQ88|地检模拟量采集、处理|预留
FREQ89|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
功能描述：利用GPS通道板数据进行GPS定轨程序。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：星上自主检测陀螺故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器B修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,0,1,0,0,0,0,0,0,0,0
功能描述：采集4路动量轮脉冲信息。,0,0,0,0,0,0,0,0,1,0,0
功能描述：为三轴姿态喷气控制选择推力器。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收GPS数据
处理：将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度、轨道数据的数据格式。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：
 从1553B接收遥控指令数据，进行指令处理（FReq-7）。
处理：根据收到的遥控指令执行按照、ISUA、ISUC进行分类处理，实现指令的处理或者转发。
指令转发前，进行指令的校验，校验通过后，方可转发。指令子单元的分类标识全为立即指令。
指令校验的原则是：校验和、RT地址、RT子地址、指令总长度、注入指令单元的类型识别字、指令序号、注入指令子单元的子单元类型识别字、分类标识、长度均正确；
遥控指令包含三种类型，具体如下：
（1） 切换ISU-C模块指令
指令功能：用于向ISU-C发送切换模块指令。
类型标识字：C300H
指令码长度：216bit
指令码定义及说明：指令码高有效字在前，指令码低有效字在后。
ISU-C注入间接指令32位指令码定义
序号|指令名称|32位指令码
序号|指令名称|功能数据
序号|指令名称|D23～D0（16进制表示）
序号|指令名称|D11～D0
|SADP-A开|0X 000
|SADP-A关|0X 001
|SADP-B开|0X 002
|SADP-B关|0X 003
|MTP-A开|0X 004
|MTP-A关|0X 005
|MTP-B开|0X 006
|MTP-B关|0X 007
|MPSDP-A接A份电源|0X 008
|MPSDP-A接B份电源|0X 009
|MPSDP-B接A份电源|0X 00A
|MPSDP-B接B份电源|0X 00B
|MPSDP-A关|0X 00C
|MPSDP-B关|0X 00D
|LV1开|0X 00E
|LV1关|0X 00F
|LV2开|0X 010
|LV2关|0X 011
|ISU-A DC/DC1加电|0X 012
|ISU-A DC/DC1断电|0X 013
|ISU-A DC/DC2加电|0X 014
|ISU-A DC/DC2断电|0X 015
|ISU-A 主供电接DC/DC1备供电接DC/DC2|0X 016
|ISU-A 主供电接DC/DC2备供电接DC/DC1|0X 017
|ISU-A甲机复位|0X 018
|ISU-A乙机复位|0X 019

类别：01代表指令当量为16ms；10代表指令当量为64ms，MEO卫星指令类型全为01。
脉宽：指令实际脉冲宽度=（脉宽数值+1）*指令当量；
MEO卫星离散开关指令脉冲宽度默认为7（128ms）；指令宽度可随实际需要更改。
指令码高有效字对应上表D31~D16；指令码低有效字对应上表D15~D0。
（2） 切换控制部件指令
指令功能：用于向ISU-A发送切换控制部件指令。
类型标识字：C311H
指令码长度：116bit
指令码定义及说明：
定义
D7~D0
指令码

此指令专门用于CMU应用软件转发的开关控制分系统部件的时标指令。文中的8位指令码定义如下：
表4-8 ISU-A注入间接指令码列表
序号|指令名称|指令码
|地球敏感器A开|0x 50
|地球敏感器A关|0x 4F
|地球敏感器B开|0x 52
|地球敏感器B关|0x 51
|Z2陀螺开|0x 31
|Z2陀螺关|0x 32
|Z3陀螺开|0x 33
|Z3陀螺关|0x 34
|GX电源开|0x 35
|GX电源关|0x 36
|GY电源开|0x 37
|GY电源关|0x 38
|GZ电源开|0x 39
|GZ电源关|0x 3A
|GS电源开|0x 3B
|GS电源关|0x 3C
|反作用轮A开|0x 2E
|反作用轮A关|0x 2F
|反作用轮B开|0x 49
|反作用轮B关|0x 4A
|反作用轮C开|0x 4B
|反作用轮C关|0x 4C
|反作用轮D开|0x 4D
|反作用轮D关|0x 4E
|ISU-C 驱动线路主份电源开|0x 67
|ISU-C 驱动线路主份电源关|0x 68
|ISU-C 驱动线路备份电源开|0x 61
|ISU-C 驱动线路备份电源关|0x 62
|ISU-C CIP主份线路电源开|0x 65
|ISU-C CIP主份线路电源关|0x 66
|ISU-C CIP备份线路电源开|0x 63
|ISU-C CIP备份线路电源关|0x 64
|CMU SPE-A开|0x 57
|CMU SPE-A关|0x 58
|CMU SPE-B开|0x 59
|CMU SPE-B关|0x 5A

说明：此36条指令脉宽均为128ms，脉宽由ISUA保证。
（3） 控制模式转换指令
指令功能：此指令用于控制模式转换。
类型标识字：C322H
指令码长度：116
指令码定义及说明：
指令码|定义
方式字|定义
00H|捕获模式——速率阻尼方式
04H|停控模式

（4） 5N推力器健康状态设置指令
指令功能：设置5N推力器健康状态
类型标识字：C333H
指令码长度：216
指令码定义及说明：
推力器健康状态设置高16位D31~D16在前，
推力器健康状态设置低16位D15~D0在后。
D31~ D0定义如下：
D31|D30|D29|D28|D27|D26|D25|D24
0|0|0|0|0|0|0|0
D23|D22|D21|D20|D19|D18|D17|D16
0|0|JK-6A|JK-5A|JK-4A|JK-3A|JK-2A|JK-1A
D15|D14|D13|D12|D11|D10|D9|D8
0|0|0|0|0|0|0|0
D7|D6|D5|D4|D3|D2|D1|D0
0|0|JK-6B|JK-5B|JK-4B|JK-3B|JK-2B|JK-1B

注：健康标志位为0表示对应推力器健康，健康标志位为1表示对应推力器不健康。将推力器设置为健康，可以使其上线；将推力器设为不健康，可以使其离线。推力器上线后方可被开启，推力器离线后不能被开启。当接收到此指令时，须同时把上述信息以MPS配置信息的形式发送给ISU-C（通过DPRU转发）。
（5） 控制部件健康字设置指令
指令功能：更改部件健康字
类型标识字：C344H
指令码长度：216
指令码定义及说明： 设置状态在前，部件标识在后。
设置状态：取值为0x0000时设置为健康，取值为0x5A5A时设置为不健康；
部件名称及标识见下表分配值：特别当编号为0xFFFF时，表示选择下表所有部件。例如，当设置状态为0x0000，部件编号为0xFFFF时，设置下表所有部件健康。
序号|部件名称|标识|部件编号
1|X陀螺|GA-X|0x0101
2|Y陀螺|GA-Y|0x0202 
3|Z陀螺|GA-Z|0x0303 
4|S陀螺|GA-S|0x0404 
5|喷气控制线路主份|MPSDP-A|0x0707 
6|喷气控制线路备份|MPSDP-B|0x0808 

(6) 控制标志字设置指令
指令功能：设置部件或者控制标志字	
类型标识字：C355H
指令码长度：216
指令码定义及说明： 
标志字识别码在前，标志字指令内容在后。
更改的标志字的内容16位二进制码，具体内容定义：
序号|标志字识别码|指令内容定义|对应符号
标志字1|0x0101|""0：S陀螺顶替X陀螺；
1：S陀螺顶替Y陀螺；  
2：S陀螺顶替Z陀螺；
3：禁止顶替。""|
标志字2|0x0202|""0：A分支推力器工作；
1：B分支推力器工作；  
2：双分支推力器工作。""|
标志字3|0x0303|""0：不允许推力器故障判断；
A：允许推力器故障判断。""|
标志字4|0x0404|""0：不允许二浮陀螺故障判断；
A：允许二浮陀螺故障判断。""|
标志字5|0x0505|""0：设置推力器未发生切换；
A：设置推力器已发生切换。""|任务书中推力器故障诊断中的 flgSwitch
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用估计的四元数转换姿态角。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用红外数据自主诊断红外部件状态
",0,0,0,0,0,1,0,0,0,0,0
