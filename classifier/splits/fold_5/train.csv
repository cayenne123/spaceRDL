Requirements Description,功能需求/初始化,功能需求/控制计算/姿态控制,功能需求/控制计算/姿态确定,功能需求/控制计算/模式管理,功能需求/控制计算/轨道计算,功能需求/控制计算/运行时保障/故障诊断和处理,功能需求/控制计算/运行时保障/数据有效性判断,功能需求/控制输出,功能需求/数据采集,功能需求/遥控,功能需求/遥测
将重要数据打包后放到AOCC重要数据内存地址空间中。AOCC共三块重要数据，每块重要数据均有校验和，校验和占4个字节。校验和的计算方法为：将60个字节按双字进行异或计算。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：在完成对日定向后，由地面指令转入地球捕获。通过红外和数字太阳敏感器定姿，消除卫星的偏航角。
输入：陀螺数据处理的输出 ，
数字太阳敏感器数据有效性标志F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出），数字太阳敏感器输出： （量纲：弧度）
红外地球敏感器数据有效性标志F_IresValid（由数据有效性判据给出）
上周期姿态角估值，
太阳星历的输出，
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用星敏感器C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
在模式切换中以地面上行注入优先，所有模式都可以通过地面注入的模式运行类指令进行转换。下面主要分析自主转换换条件与过程，具体转换条件见用户需求4.1~4.11的模式转换条件。4.4姿态机动模式喷气机动转对地或保持的条件中姿态角控制量判据中由0.000262mΦM4改为0.0262mΦM4。    ",0,0,0,1,0,0,0,0,0,0,0
功能描述：使用红外、星敏、太阳定姿时，计算正常飞行轮控所需电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：已知扫描区域中心坐标和扫描范围后，计算扫描起点的目标姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据需求，计算去往巡天模式机动过程中所需的目标姿态
",0,0,1,0,0,0,0,0,0,0,0
"上行注入功能是地面干预星上运行状态的重要手段，主要是指OBDH通讯协议中定义的控制分系统“接收遥控注入数据”功能。上行注入数据块由地面发送到OBDH分系统，再由OBDH分系统通过B总线发送到AOCC执行。包括下表的功能点。
序号|功能描述|功能编号
|轨道数据块|FRE74
|姿控数据块1|FRE74.1
|姿控数据块2|FRE74.2
|LTU通信选择块|FRE74.3
|故障诊断标志块|FRE74.4
|星敏感器命令块|FRE74.5
|惯性调姿命令块|FRE74.6
|轨控命令块|FRE74.7
|SDC命令块|FRE74.8
|LTU命令块|FRE74.9
|内存修改块|FRE74.10
|应急控制器注入块|FRE74.11
|系统软件标志修改块|FRE74.12
|程序块|FRE74.13
|相平面系数块|FRE74.14
|轮控系数1及磁控系数|FRE74.15
|轮控系数块2|FRE74.16
|陀螺脉冲当量系数块|FRE74.17
|星敏修正系数块|FRE74.18
|条件判断、阀值和限幅相关数据块|FRE74.19

具体的内容见注入文件。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：与推进线路盒通信，输出本周期喷气脉宽。
处理：
见通信协议。
功能编号|功能|引用文档
FREQ85|初始化|任务书
FREQ86|推力器使用要求|任务书
FREQ87|通信|任务书
FREQ88|通信故障处理|预留
FREQ89|数据解包与转换|预留
FREQ90|推力器数据有效性处理|预留
FREQ91|推力器模拟量采集、处理|任务书
FREQ92|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：为三轴姿态喷气控制选择喷管；并记录喷气时间等。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送AOCC内存数据块
处理：OBDH从遥控接收到AOCC内存数据下卸指令后，向AOCC发送内存设置命令，通知AOCC内存数据下卸的段地址、偏移量及下卸长度；OBDH发出内存设置命令后100ms，开始接收AOCC内存数据。其处理过程如下：
STEP1：AOCC应用程序接收到OBDH内存下卸的指令后，进入OBDH中断服务程序（INT1）；
STEP2：AOCC应用程序读出OBDH注入的段地址、偏移地址和数据长度；
STEP3：根据段地址，偏移地址计算下卸内容的地址，并进行合法性判别。
STEP4：根据计算出的下卸内容的起始地址和长度，将下卸内容放入OBDH规定的内存中 。",0,0,0,0,0,0,0,0,0,0,1
功能描述：由数字太阳粗码得到数字太阳角、全开码、见太阳标志。,0,0,0,0,0,0,0,0,1,0,0
功能：利用红外、数字太阳敏感器确定姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据姿态角和姿态角速度偏差数据进行系统故障的检测。
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。
轨控模式姿态角控制量超差阀值从0.077 mSYSS2改为0.0873 mSYSS2。
5.7.3（1）增加姿态超差判断。",0,0,0,0,0,1,0,0,0,0,0
"功能描述：地面站赤经赤纬计算
处理：同用户需求的",0,0,0,0,1,0,0,0,0,0,0
"功能描述：
 太阳捕获功能主要实现速率阻尼、俯仰搜索、滚动搜索、巡航等功能，使卫星由任意姿态进入保持对日定向巡航姿态运行。太阳捕获功能分为速率阻尼、俯仰搜索、滚动搜索和巡航四种方式（FReq-6）。
                        表5-2 方式字定义
名称|方式字定义|说明
RDSM|0|速率阻尼方式.(默认方式，程控结束后进入)
PASM|1|俯仰搜索方式
RASM|2|滚动搜索方式
CSM|3|巡航运行方式

处理： 
  （1） 模块初始化设置
   程序结束后，根据任务书5.4.5.3.1节进行模块初始化设置。考虑到地面遥控指令可以重新进入太阳捕获模式（速率阻尼初始化置陀螺故障诊断不允许），软件对模块初始化中的变量分为2个部分，其中以下部分为程控结束后只设置一次的变量：   
推力器输出状态清零；
CleNum = 0;  
采用MRE板数据设置陀螺顶替标志；（考虑S陀螺健康时才进行相应顶替）。
若有飞轮的电源状态为开，则允许飞轮进行转速控制WheelCon＝TRUE；
部分软件自身使用的变量。
（2）在太阳捕获中需要进行动量轮刹车控制以及方式控制：
动量轮刹车控制详见5.2.17节。（有动量轮加电，则进行动量轮刹车控制。）
（3）方式控制如下：
(I) 对卫星进行速率阻尼，连续35个控制周期三轴角速度绝对值（实际取最大值即可）小于0.14°/s，进入俯仰搜索方式；或者进入速率阻尼方式的时间超过2000个控制周期（256秒）后，进入俯仰搜索，开始搜索太阳。
(II)进入俯仰搜索方式，使卫星以+/-0.5/s（速率阻尼结束后进入时根据SPz13选择极性)绕Y轴转动，若5625个控制周期（720秒）后没有捕获到太阳，进入滚动搜索方式。进入滚动搜索方式后，使卫星以0.5°/s绕X轴转动。
(III) 若(II)中滚动搜索方式经过6250个控制周期（800秒）后还未见到太阳则再重复俯仰搜索和滚动搜索，则再次进入（II），即俯仰捕获方式（这种情况下b＝-0.5/s）。其中滚动搜索不成功的故障处理逻辑见5.2.14节。
(IV) 在(II)(III)过程中一旦捕获到太阳且持续时间大于2.048秒(16个控制周期)，则进入巡航方式。进入巡航模式后，控制SADA归零。
说明：捕获太阳时，对于持续时间大于2.048秒的判断，太阳连续可见（SP61/62 = 1）的条件下，俯仰搜索时，俯仰角绝对值大于1°的累计时间；滚动搜索时，滚动角绝对值大于1°的累计时间。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：模式1切换方式。
处理：
若t >100，则WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收星箭分离信号及天线状态数据
处理：控制计算机在收到星箭分离指令并且判断数据正确后，即认为星箭分离有效，通过方式代码的服务请求，申请OBDH停止发送星箭分离信号。天线状态的数据具体见与外总线通讯协议。",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.3|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.4|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据轨控需求和姿控推力器使用情况，开推力器进行轨道控制
|轨道控制喷气|FREQ4.3|5.4.6|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1.1|地面站赤经赤纬计算
|数传天线指向控制|FREQ4.14|5.6.1|根据指令完成数传天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|基于三轴角动量反馈的偏置动量控制方法产品规范|FREQ4.21|/|规范化算法：
|数传天线指向目标角计算|FREQ4.14.2|5.6.1.2|根据指定跟踪数传天线与其被指定跟踪站的方位，计算其跟踪转角
",0,1,0,0,0,0,0,0,0,0,0
功能描述：根据陀螺输入，预估卫星惯性姿态四元数。,0,0,1,0,0,0,0,0,0,0,0
功能描述：启动飞轮或动量保持控制。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：为机动过程姿态确定提供初始姿态。
输入：	机动起始时刻本体对轨道估计姿态角()
输出：	机动目标相对轨道的姿态四元数
变换矩阵
本体对目标坐标系的姿态四元数",0,0,1,0,0,0,0,0,0,0,0
功能描述：将F_CMGValid指定工作的CMG框架角保持在标称框架位置。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：计算机动模式轮控所需电压。
输入：本体相对目标姿态的四元数
      本体相对目标坐标系转速的估值
      陀螺角速度估值    ，
      实测飞轮角动量    ，
      ，",0,1,0,0,0,0,0,0,0,0,0
"功能描述：仅利用星敏感器B的测量，修正姿态四元数与姿态角速度移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据数字太阳见太阳标志（SLTU给出）和故障标志（地面给）判断数字太阳数据的有效性。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：为机动过程姿态确定提供初始姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能：在不使用陀螺数据时，对姿态角、角速度与姿态四元数预估。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|平台陀螺数据的采集与处理|FREQ1.2.1|""平台陀螺1553B取数指令
""|陀螺1-4的速度增量|在通讯允许的条件下（每个陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|测微陀螺数据的采集与处理|FREQ1.2.2|""
遥测数据""|陀螺5-8的速度增量|从遥测数据中，获得陀螺数据并处理成对应的速度增量。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理：
编码|相应的处理
28H|发送内存的数据区指针复位
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。
",0,0,1,0,0,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
甚高陀螺通讯故障诊断|大量程通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
部件故障诊断与处理|确定各敏感器和执行机构故障诊断及处理
动量轮故障检测|检测工作中的大力矩飞轮的故障
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式7的系统故障诊断|在模式7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
磁力矩器数模一致性诊断|磁力矩器数模一致性诊断
DSS输出一致性诊断|DSS输出一致性诊断
ASS1输出一致性诊断|ASS1输出一致性诊断
ACU 1553B接收故障诊断及处理|由于卫星的执行机构控制均需通过ACU进行，当ACU接收控制指令内存区异常将导致卫星失去控制能力，因此有必要对ACU接收执行机构控制指令的正确性进行判断。在检测到执行机构控制指令接收校验和异常后CCU需要自主进行处理",0,0,0,0,0,0,1,0,0,0,0
"通讯串口
04H|波特率寄存器|RW|波特率寄存器低位：0x04（115200）
08H|波特率寄存器|RW|波特率寄存器高位：0x00

CAN总线初始化
寄存器名称|初始化内容|初始化意义
""CAN_ADDR        
(CAN总线地址)""|无。|无说明。
""控制寄存器
(Control Register)
""|0x03|""D7D6D5：保留。
D4：超载（接收设备不能按数据发送速率接收数据而造成的数据丢失）中断使能。
高：开放。低：禁止
D3：错误中断使能。
高：开放。低：禁止
D2：发送中断使能。
高：开放。低：禁止
D1：接收中断使能。
高：开放。低：禁止
D0：复位模式。
在初始化的时候，复位模式位置1，才可以进行初始化设置。""
命令寄存器(Command register)|0x=00001100|""D7D6D5：保留。必须。
D4：进入睡眠状态。
高：睡眠 。低：睡眠唤醒。
D3：清除超载状态。不产生超载中断。
高：清除。低：无动作。
D2：释放接收缓冲器。（读接收缓存器内容后，释放缓存器，以便其他报文立即可用）。
高：释放。低：无动作。
D1：夭折发送。
D0：发送请求。
高：报文即将发送。低：无动作。""
""验收代码寄存器
(Acceptance 
Code Register)""|0x87= 10000111|""当通过验收测试的报文被接收，且若存在空的接收缓存器，则各自的描述符和数据场被顺序存贮在空的缓存器中，在不存在空的接收缓存器的情况下，数据超载位被置位高(超载)，当完整的报文被正确接收，将出现下列操作：
接收缓存器状态位被置为高(满)
若接收中断开放位被置为高(开放)，接收中断被置为高(置位)
验收码位(AC.7~AC.0)和报文标识符的最高8位(ID.10~ID.3)必须等于由验收屏蔽位必须满足""
""验收屏蔽寄存器
((Acceptance 
Mask Register))""|0xf8|最后三位相关。
总线时序寄存器0(Bus Timing Register 0)|0x00|""总线时序寄存器的内容决定波特率预分频器(BRP)和同步跳转宽度(SJW)的数值。

通过总线定时器的内容，将波特率预分频器设置为2，即将输入的系统时钟二分频，由于输入的系统时钟已经是将计算机晶体频率14.7456MHz二分频，即7.3728MHz。所以这个时候时钟为3.6864 MHz。""
总线时序寄存器1(Bus Timing Register 1)|0x18|""采样（SAM）=1总线采样1次。
TSEG1和TSEG2确定每位周期的时钟周期数目和采样点位置：

由于一位周期是由

而

波特率＝""
""时钟分频器
(Clock Divider
register)""|0x40|""D7:CAN模式。
0：基本模式。
D5:1(旁路输入比较器，仅在复位模式下起作用)。""
""OCR
(output Control)""|0x|

在完成上述初始化后，要再次初始化控制寄存器。将最低位初始化为0。
说明：地址表上“CAN总线地址”实际是一个写信号的地址，完成对CAN总线控制芯片的选择。因为CAN总线控制芯片的分时复用地址/数据总线（AD7~AD0）实际是和的数据线(D0~D7)接在一起的，该分时复用地址实际是选择控制寄存器用的。这样对于端口寄存器的选择，必须通过数据的写入来完成。对“CAN总线地址”的写入，起到选通CAN控制芯片的作用，而写入的内容，就是对端口寄存器的选择。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。
处理：
STEP1:滚动通道滤波；
STEP2:俯仰通道滤波；
STEP3:偏航通道滤波。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，予估q及姿态角（在星测量回路中），等。。
处理：同用户需求的1.6。
STEP1:计算星敏预估角速度，。计算结果的限幅值是0.027。计算公式见1.6（1）。
STEP2:计算q,和，计算公式见1.6（2）。
STEP3:计算，。对于计算结果，当BZ1=8（侧摆机动）时，否则。对于计算结果，。对于计算结果，。计算公式见1.6（3）。",0,0,1,0,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.5|偏置飞行模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|匀角速度匀积分时间跟踪模式控制|FREQ5.2.7|4.7|一般轨迹跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.9|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|凝视姿态跟踪模式控制|FREQ5.2.11|4.12|凝视姿态跟踪模式控制调用流程
|测试与标定模式控制|FREQ5.2.12|4.8|测试与标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.13|4.13|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.5|偏置飞行模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|匀角速度匀积分时间跟踪模式初始化|FREQ5.3.7|4.7|一般轨迹跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.9|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|凝视姿态跟踪模式初始化|FREQ5.3.11|4.12|凝视姿态跟踪模式初始化设置
|测试与标定模式初始化|FREQ5.3.12|4.8|测试与标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.13|4.13|惯性定向模式初始化设置

主动段和无控工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,0,0,1,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：推力器喷气时间累计
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：检测系统故障，给出故障标志。
",0,0,0,0,0,1,0,0,0,0,0
功能描述：机械陀螺数据处理,0,0,0,0,0,0,0,0,1,0,0
"功能描述：使星体-Z轴捕获太阳，并保持偏置10度的对日定向。
输入：， 陀螺数据处理的输出，；控制周期 (量纲：秒)；
		模拟太阳敏感器状态，LSS输出数据
		模拟太阳敏感器输出： (量纲：弧度)
		计时器",0,1,0,0,0,0,0,0,0,0,0
"功能描述：内总线指令处理
处理：
内总线指令设置、控制等操作。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：将S-84坐标系下的追踪器GPS原始数据转换成J地心天球坐标系下的数据，根据该数据与轨道计算数据的对比结果，给出GPS数据可用性标志
说明：计算目标器GPS时，将输入、输出改为目标器的相应变量。",0,0,0,0,1,0,0,0,0,0,0
功能描述：利用星敏感器和陀螺输出计算卫星欧拉角和四元数。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得DSS、ASS、LSS数据；根据ZT14（2）（1）确定进行通讯的太阳LTU，发送取数指令，具体如下表所示
ZT14(2)(1)的值|进行通讯的太阳LTU|发送的取数指令
01|与之前通讯太阳LTU1或太阳LTU2进行通讯|""33H或
43H""
10|与之前通讯太阳LTU1或太阳LTU2进行通讯|""33H或
43H""
00或11|根据LTU故障诊断的结果决定太阳LTU的选取。初始状态为太阳LTU1|33H或43H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的12个字节数据，将数据根据LTU通讯协议转换，、L11~L15,L21~25。
（3）太阳LTU数据采集过程中的故障处理见本文的.1。",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|喷气开关逻辑相平面分区，喷气脉冲宽度计算|FREQ31|4.3.1.1|进行单轴相平面分区及控制规律计算
|三轴姿态喷气控制与推力器脉宽分配|FREQ32|4.3.1.3|为三轴姿态喷气控制选择推力器
|轨控发动机与其备份的使用|FREQ33|4.3.1.4|轨控模式时使用轨控发动机及其备份
|动量轮摩擦补偿计算|FREQ34|4.3.2.2|动量轮摩擦力矩的补偿电压计算
|动量轮角动量保持控制|FREQ35|4.3.2.3|计算将动量轮保持至标称角动量所需的电压
|动量轮的启动与保持|FREQ36|4.3.2.4|启动动量轮至标称角动量，并保持
|正常飞行模式动量轮分配电压计算|FREQ37|4.3.2.5|计算正常飞行模式轮控所需电压
|正常模式轮子保护与动量卸载|FREQ38|4.3.3.1|决定采用磁卸载还是喷气卸载方式，调用相应程序
|磁卸载计算|FREQ39|4.3.3.2|计算磁卸载所需的磁矩与磁力矩器工作电压
|结构滤波器计算|FREQ95|4.3.2.6|PID计算控制力矩经过结构滤波器后，改善姿态控制效果
|太阳定向主程序|FREQ40|4.4.3.3|搜索并捕获太阳，完成并保持帆板对太阳定向
|重捕地球与建立正常姿态（1）|FREQ41|4.4.4.1|在完成对日定向后，由地面指令转入重捕地球。在偏航捕获阶段，通过红外和太阳敏感器定姿，消除卫星的偏航角。在完成偏航捕获后，由红外地球敏感器测量信号进行计算得到俯仰角和滚动角，控制滚动、俯仰使其趋向于0
|捕获地球与建立正常姿态（2）|FREQ42|4.4.4.2|当红外敏感器故障时，在太阳定向完成后，利用数字太阳与星敏感器信息，进行全姿态捕获，并建立正常姿态。
|三轴等效角动量偏差|FREQ91|4.3.4.1|根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差
|俯仰通道轮控算法|FREQ92|4.3.4.2|根据俯仰角和俯仰通道角动量偏差信息实现俯仰轴姿态控制
|磁进动、章动阻尼及俯仰轮卸载控制|FREQ93|4.3.4.3|通过磁力矩器，实现滚动-偏航轴的进动控制及章动阻尼，并对俯仰飞轮进行磁卸载
|三轴轮控算法|FREQ94|4.3.4.4|偏置动量轮处于力矩模式，根据红外地球敏感器测量信息计算得到的滚动角和俯仰角实现三轴姿态控制。滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制
|帆板捕获及跟踪控制|FREQ102|4.3.5|根据地面指令或自主使帆板跟踪太阳
|干扰补偿控制算法及动量轮分配电压计算|FREQ95|任务书的4.1.15|计算有效载荷干扰补偿控制电压，以及计算动量轮分配电压
|全姿态捕获动量轮控制方式主程序|FREQ40.5|4.4.5|全姿态捕获动量轮控制方式主程序
",0,1,0,0,0,0,0,0,0,0,0
功能描述：为三轴姿态喷气控制选择喷管；并记录喷气时间等。,0,1,0,0,0,0,0,0,0,0,0
功能描述：确定陀螺数据转换矩阵A及B；计算漂移。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据需求，计算去往定点观测模式机动过程中所需的目标姿态。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压，。,0,1,0,0,0,0,0,0,0,0,0
"软件需求标识：FREQ13 
软件需求名称：采集时序 
软件需求描述：
              不再要求“不论部件是否通讯，均进行延时计数。”",0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：部件加断电 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。",0,0,0,0,0,0,0,1,0,0,0
功能描述：在CMG控制过程中判断CMG是否饱和而需喷气卸载；在喷气卸载过程中判断CMG是否卸载完毕。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：追踪器GPS数据有效性判断及处理 
处理：见《卫星GNC分系统GNC计算机应用软件用户需求》的P48-P49。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：卫星搜索太阳使得数字/模拟太阳见太阳后，控制卫星，使数字卫星本体-z轴对准太阳(模拟太阳对日时偏置10度)，从而使帆板法线指向太阳，确保能源供应。
输入：DssStateFlag，TShadowTime；滚动数字太阳监视码，俯仰数字太阳监视码；滚动模拟太阳监视码，俯仰模拟太阳监视码，滚动数字太阳输出，俯仰数字太阳输出，滚动模拟太阳输出，俯仰模拟太阳输出",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：模式初始化 
需求类别：其他 
软件需求描述：见“用户需求”4.1和“任务书”4.1.10“工作模式要求”1）工作模式初始化。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.2-WMInit-1|太阳定向模式初始化|《用户需求》4.1.1【初始化】|
FREQ12.2-WMInit-2|恒星定向1模式初始化|《用户需求》4.1.2【初始化】|
FREQ12.2-WMInit-3|惯性调姿模式初始化|《用户需求》4.1.3【初始化】|
FREQ12.2-WMInit-4|恒星定向2模式初始化|《用户需求》4.1.4【初始化】|
FREQ12.2-WMInit-5|轨控定向模式初始化|""《用户需求》4.1.5【初始化】
《任务书》4.1.10""|
FREQ12.2-WMInit-6|中继跟踪模式初始化|《用户需求》4.1.6【初始化】|
FREQ12.2-WMInit-7|速率阻尼模式初始化|《用户需求》4.1.7【初始化】|
FREQ12.2-WMInit-8|无控模式初始化|《用户需求》4.1.8【初始化】|
",0,0,0,1,0,0,0,0,0,0,0
功能描述：计算CMG群的合成角动量标称值。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：，
输出：保持角动量所需电压，
      角动量偏差积分项：，",0,1,0,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的星敏间基准修正与有效性判断修正系数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：选择通讯的天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
  （1）加电状态的判断：OBDH在给捕跟分系统发送加电命令的同时，将该命令发送给AOCC。AOCC根据命令字的内容，记录加电状态和工作的主备状态。当第一次得到加电指令时，如果没有主备命令，默认工作在主份；当没有加电，但是发送了主备切换命令，切换有效。中继捕跟分系统断电，再加电后，保留中继上次加电工作状态；当AOCC发生复位、NMI和切机时，保留中继上次加电工作状态。
（2）数据通讯：当接收到中继快扫命令，并且AOCC判断中继捕获跟踪分系统加电状态下，AOCC每个0.524秒控制周期，向GDA发送一次天线驱动机构双轴指向数据。并接收GDA传回的X、Y轴测量角度信号和两轴的偏差角度（X轴框架角、Y轴框架角、X轴偏差角、Y轴偏差角、X轴框架角速度、Y轴框架角速度）。当接收到中继停止命令或判断中继不加电，则停止通讯。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：轨控段喷气控制计算。
处理：同用户需求的
（1）各轴喷气参数设置如表36所示
表36：轨控段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|0.4 mθD04|0.4 mθD04|0.4 mθD04
|1.0 mθD13（注1）|1.0 mθD13（注1）|1.0 mθD13（注1）
|1.0 mθB36|1.0 mθB36|1.0 mθB36
|3.0 mθB33（注1）|3.0 mθB33（注1）|3.0 mθB33（注1）
|0.1|0.14|0.07
|0.2|0.2|0.2
|（注3）|（注3）|（注3）
|0.3|0.3|0.3
|0.43（注2）|0.43（注2）|0.43（注2）
|（注3）|（注3）|（注3）
KJ2(s)|2|2|2
aJS（/s2）|0.137|0.235|0.089

注1：在BZ1 =3、4的条件下
注2：在BZ1 =2的条件下
注3：在BZ1 =4的条件下
（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,1,0,0,0,0,0,0,0,0,0
功能描述：利用星敏感器B的测量，修正姿态四元数与估计角速度。,0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：姿态控制算法 
需求类别：其他 
软件需求描述： 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.5.1|相平面和动量轮联合控制|《用户需求》4.5.1|
FREQ12.3-R4.5.2|喷气姿态控制|《用户需求》4.5.2|
FREQ12.3-R4.5.2.1|相平面姿控算法|《用户需求》4.5.2.1|
FREQ12.3-R4.5.2.2|相平面喷管选择|《用户需求》4.5.2.2|
FREQ12.3-R4.5.2.3|脉冲调宽姿控算法|《用户需求》4.5.2.3|
FREQ12.3-R4.5.2.4|脉冲调宽喷管选择|《用户需求》4.5.2.4|
FREQ12.3-R4.5.3|动量轮控制|《用户需求》4.5.3|
FREQ12.3-R4.5.3.1|动量轮启动与保持|《用户需求》4.5.3.1|
FREQ12.3-R4.5.3.2|动量轮姿态控制|《用户需求》4.5.3.2|
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：采集28路数字太阳粗码、细码。
处理：
采集方法：连续采集28路，采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：在Z轴已捕获太阳的条件下，完成对日定向及绕Z轴转动。
对日定向下，若在阳照区若连续3000秒无法对日成功，则根据地面指令，进行模拟太阳和数字太阳的自主切换，重新进行太搜，并将地面允许标志置为不允许。
进入条件：
偏航捕获及转对地定向，或{，FEA = 0}；
星敏感器全姿态捕获，星敏感器数据无效，或{FEA = 0，ZT3 = C}条件不成立
全姿态捕获，FSA0, { ZT1 = 3或BZ1 = 3 }
退出条件：
偏航捕获及转对地定向， FEA 0；
星敏感器全姿态捕获，星敏感器数据有效且{FEA = 0，ZT3 = C}条件成立
全姿态捕获，FSA＝0,或ZT1 3且BZ1  3 
处理过程：同用户需求的。
STEP1:FlagFSA=5
STEP2:调用姿态预估器(3)
STEP3:若ZT13≠4，使用模拟太阳定向
STEP4:若ZT13=4，使用数字太阳定向
STEP5:若BZ1 = 3，则调用运行段喷气姿态控制
STEP6:若BZ1 = 4，则调用轨控段喷气姿态控制
STEP7:若ZT2 = 2，FWi  C对工作的飞轮成立，则调用飞轮控制
STEP8:若ZT2  2或FWi<C对某一工作的飞轮成立，则输出控制电压清0。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：完成整星绕滚动轴的姿态侧摆机动
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP2：进行运行段姿态确定，具体过程如下：
进行红外数据采集及处理和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
根据轮子的工作状况，计算滚动轴最大控制力矩
计算滚动轴角加速度、加速时间
设置侧摆标志FRTS的值，0为通过轮控进行侧摆，1为通过喷气进行侧摆，设置的条件如下表所示：
条件|FRTS的取值
ZT35(2) = 1，|1
其余情况|0

计算滚动轴期望轨迹和
得到输入控制律的姿态角和角速度，
STEP3：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3（姿控发动机可用）且ZT9  3（轨控发动机可用）且FRTS = 1（用喷气进行侧摆）且ZT（不用红外+单个斜装陀螺定姿）时，进行轨控段喷气姿态控制
进行陀螺故障检测及选择
当ZT40(4) = 1时，进行数传天线捕获跟踪控制
STEP4：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据轨道数据计算偏流角。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：进行单轴相平面分区及控制规律计算。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。                                                                                                                                                                                                                                                                                                                                                                                                                    处理：
在AOCC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ66|初始化|与一体化太阳通信协议
FREQ67|数太使用要求|任务书、数太协议
FREQ68|通信|任务书、数太协议
FREQ69|通信故障处理|任务书
FREQ70|数据解包与转换|数太协议
FREQ71|数太数据有效性判断、处理|任务书
FREQ72|数太模拟量采集、处理|预留
FREQ73|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.5|偏置飞行模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|角速度跟踪模式控制|FREQ5.2.7|4.7|角速度跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.9|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|测试与标定模式控制|FREQ5.2.11|4.8|测试与标定模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.5|偏置飞行模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|角速度跟踪模式初始化|FREQ5.3.7|4.7|角速度跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.9|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|测试与标定模式初始化|FREQ5.3.11|4.8|测试与标定模式初始化设置

主动段和无控工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,0,0,1,0,0,0,0,0,0,0
"时间服务用于CCU的校时，卫星时间服务为1s时间同步周期进行一次，BC采用子地址29广播消息发送至各RT。同时实现了OBDH校时时刻和GPS秒脉冲时刻的发送。CCU的处理中，整个的时间为OBDH校时时刻（包括秒部和微妙部），其中的秒部为GPS秒脉冲时刻。因此包含的功能点为两个：
序号|功能描述|功能编号|
|接收OBDH校时时刻|FREQ7.1.1|设置OBDH校时标志TimeFlg.RcvOBDH
|接收GPS秒脉冲时刻|FREQ7.1.2|设置GPS校时标志
",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：根据注入轨道参数计算地磁场强度。,0,0,0,0,1,0,0,0,0,0,0
功能描述：实时计算卫星轨道参数。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：定义AOCC初始上电至星箭分离为主动段工作模式。
处理：
定义星箭分离前为主动段工作模式，应用软件在控制周期任务函数中进行下列工作：
	星时计算。
	采集部件（太阳敏感器、陀螺、星敏、CMG）信息。
	采集部件、线路遥测模拟量。
	响应主动段测试指令和“运行初始速率阻尼模式”指令。
	对ALTU当班状态判断，并与当班ALTU通讯。
	响应星务分系统轮询、数据遥控指令、数据注入、程序注入、秒脉冲校时等，并进行相应处理。
	星箭分离的确认依据为：一个控制周期内对星箭分离状态位读5次，若连续3次以上读入为“1”，则认为本周期查到星箭已分离，每次读的时间间隔要求大于1ms。如果在连续3个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入初始速率阻尼模式。
	此外，通过地面遥控指令进行以下起飞前设置：
5个CMG加电，并将框架角均转到0度保持、锁定；
6个陀螺加电。",0,0,0,1,0,0,0,0,0,0,0
"软件需求标识：FREQ4 
软件需求名称：星时计算 
软件需求描述：星时计算。见“任务书”4.1.3.1“星时计算”。",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.3|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.4|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1|地面站赤经赤纬计算
|运行段帆板控制|FREQ4.12|5.5.1|三轴稳定模式下的帆板控制
|太阳帆板自主跟踪控制|FREQ4.13|5.5.2|根据帆板角误差、控制帆板跟踪太阳
|数传天线指向控制|FREQ4.14|5.6.2|根据指令完成数传天线的指向控制
|中继轨道计算|FREQ4.21|5.7.1|根据指令完成数传天线的指向控制
|中继天线指向控制|FREQ4.22|5.7.2和5.7.3|根据指令完成中继天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|双脉冲变轨|FREQ4.21|""任务书的
4.2.3""|根据地面注入的指令可实现两次轨控的功能
|3CMG框架角速度 指令解算|FREQ4.22|5.4.2.6|当采用3CMG进行姿态控制时，根据控制器计算出的力矩，实现CMG的框架角速度解算。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、；输入陀螺自检信号GDi（i = 1，…，6）。
处理：
用户需求的的6(1)：陀螺脉冲当量；
用户需求的的6(2)
STEP1:A阵计算；
STEP2:",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
处理：
OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：三轴稳定模式下的帆板控制。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据注入轨道参数计算地磁场强度。
处理：
由星时和外推轨道数据星上实时计算地磁场强度。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：使用星敏感器C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：每4.192秒运行一次的主程序。
处理： 
STEP1：记录当前的星时、数字太阳敏感器输出、四元数和星敏数据、星敏姿态角及惯性角速度：
，
FSTAVD = FSTAVD05，FSTBVD = FSTBVD05，FSTCVD = FSTCVD05
t星A = t星A05，t星B = t星B05，t星C = t星C05
=，=，=，=，=，=
，；
STEP2：若指定星敏诊断陀螺故障，则：对工作陀螺，
STEP3：进行外推轨道计算和中继卫星轨道计算；
STEP4：重要数据打包，进行数据校正和红外故障检测及信号选取；
STEP5：当BZ1 为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，如果没有喷气则进行光行差修正量计算及加速计零位估计；
STEP6：进行星敏感器数据处理；
STEP7：当BZ1为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，进行下列操作：
当BZ1= 1（三轴稳定正常轨道运行姿态）且BZ2 = 1（已有遥控轨道数据注入）且BZ6 = 3（姿态确定用红外、陀螺和数字太阳）且C1 = 0000（轨控数据有效标志为无效）且ZT3≠F（用红外+单个斜装陀螺定姿，且接入控制回路）且ZT3≠A（星敏无陀螺定姿，且接入控制回路，整星零动量控制方式）时进行姿态太阳修正。
当C1 = CCCC（轨控关机后或偏航机动结束后）时令星敏修正时间；否则
进行S姿态的q修正及光轴方位计算（由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位）
当时令，=，=，=，=，
若C1=0，则根据FSTD（星敏参与定姿的标志）的取值进行相应的星敏修正并令
FSTD取值|处理
2|用A，B头测量修正q
3|用A，C头测量修正q
4|用B，C头测量修正q
5|用A头测量修正q
6|用B头测量修正q
7|用C头测量修正q

当满足ZT4  0（用磁力矩器）且BZ2  2（有遥控注入过）且ZT2  2（飞轮启动保持或零动量控制方式）时进行地磁场计算和飞轮磁卸载；否则令磁力矩器的输出电压为0；
STEP8：当BZ1 = 1或9或 { BZ1 = 3，FSA≥5 } 或 { BZ1 = B，}，则进行推进系统故障检测及切换；
STEP9：若BZ1 = 1或9或 { BZ1 = B，}，则：系统故障检测；否则系统故障检测中的连续时间计数；
STEP10：若ZT17≥4，ZT18≥7，则：帆板故障检测及切换；
STEP11：当ZT38 = F（0.524主程序中插入帆板未展开模式）时，进行帆板未展开模式处理；
STEP12：当BZ1  1，8，9（入轨段控制模式、偏航机动模式、全姿态捕获、重
捕地球、轨控模式、姿态无控模式、自旋模式）时，令不用星敏定姿；
STEP13：若BZ1  1，8，9，B，则：FSY = ；
STEP14：当ZT4 = 0（不用磁力矩器时）或BZ1  （1、9）时，令磁力矩器的电压为0；
STEP15：当ZT2  6时，令动量轮的电压为0；
STEP16：设置，；
STEP17：记录数据， ；
STEP18：进行中帧、慢帧的遥测数据和黑匣子数据的打包。",0,0,0,1,0,0,0,0,0,0,0
"软件需求名称：故障诊断和处理 
需求类别：其他 
软件需求描述：《用户需求》4.8。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.8.1|陀螺故障检测及选择|《用户需求》4.8.1|
FREQ12.3-R4.8.2|加计故障检测及选择|《用户需求》4.8.2|
FREQ12.3-R4.8.3|星敏感器故障检测及选择|《用户需求》4.8.3|
FREQ12.3-R4.8.4|帆板驱动机构故障检测及选择|《用户需求》4.8.4|
FREQ12.3-R4.8.5|动量轮故障检测及选择|《用户需求》4.8.5|
FREQ12.3-R4.8.6-K|推进系统故障检测及选择|《用户需求》4.8.6|
FREQ12.3-R4.8.7-K|系统故障检测及选择|《用户需求》4.8.7|
",0,0,0,0,0,1,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|部件状态、双组元推进状态1、推进状态2、ACU工作状态|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|计算得到的喷气脉宽、磁力矩器电压|控制指令消息的输出|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
|部件加断电指令的处理|FREQ1.8.4|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.5|保存CCU的重要数据|接收CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.6|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|REQ1.8.7|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.8|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.9||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,0,0,0,1,0,0
"功能描述：选择三轴正负控制力矩
处理：根据推力器分支和追踪器构型设置控制力矩。。
说明：10种构型，2种分支共计20组控制力矩（每组包括正负三轴共6个）",0,1,0,0,0,0,0,0,0,0,0
"功能描述：在完成偏航捕获后，由红外地球敏感器测量信号进行计算得到俯仰角和滚动角，控制滚动、俯仰使其趋向于0。
输入：	陀螺数据处理的输出 ；
数字太阳输出 ，
卫星外推轨道的输出	
太阳星历的输出	
姿态角估值	",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收数据指令注入块的系统状态设置类指令	
处理：
序号13允许CMG高速自主启动和序号34禁止CMG高速自主启动初值更改，改为默认允许。序号29允许自主喷气保护和序号34禁止自主喷气保护初值更改，改为默认允许。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：为三轴姿态喷气控制选择推力器
输入：JetFlagXP_A、JFN_A、JFP_A 、JFN_A、JFgZP_A 、JFgZN_A（6个姿控分支标志），F_SatStage（卫星构型状态字）、，（星敏感器与陀螺定姿输出的姿态角及角速度）或，、，（其它定姿方式下输出的姿态角及角速度）、，、（协调控制力矩）、(机械臂运动产生的干扰力矩)、，（目标姿态角）
输出：X, Y, Z, FJX, , FJZ（喷气状态），、 
TJAi (i=1~6), TJCi (i=1~10)（A分支6个、C分支10个推力器脉宽）、
Ai (i=1~6), Ci (i=1~10)（A分支6个、C分支10个推力器开关标志）、（累计三轴姿控正/反向喷气时间）",0,1,0,0,0,0,0,0,0,0,0
"功能描述：自主对计算机进行切换。
处理：
OBC的A机和B机满足一定的条件下，可以进行切换。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：根据地面指令ZT3,ZT42,ZT43，给无故障陀螺自主加电。
处理：同用户需求的。
（1）可以进行陀螺自主加电的条件：①或②
①{6个陀螺中至多只有1个有故障，即姿控数据块中ZT42的低4位和ZT43的低2位中至多只有1位等于1}且{加电陀螺不足5个，即姿控数据块中ZT15的低4位和ZT16的低2位中至多只有4位等于1}；
②{ZT3=A，即“星敏无陀螺定姿，且接入控制回路，整星零动量控制方式”或ZT3=B或ZT3=F}且{6个陀螺中至少有3个正常，即姿控数据块中ZT42的低4位和ZT43的低2位中至少有3位等于1}。
（2）陀螺自主加电的步骤：
STEP1:若满足条件(1)②，则根据ZT42,ZT43按陀螺1至6的升序开启3个正常陀螺，设置ZT15,ZT16相应位为1，并设置BZ3=ZT15，BZ4=ZT16；否则若满足(1)①，则{若ZT42,ZT43显示6个陀螺都正常，则开陀螺12356；否则根据ZT42,ZT43开启5个正常的陀螺}，设置ZT15,ZT16相应位为1。
STEP2:加电后设置陀螺正在加电标志FlagGyroAdd=1（正在加电）。令工作陀螺计分为0FH。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据红外数据计算卫星姿态。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求标识：FREQ19 
软件需求名称：星敏数据处理 
需求类别：其他 
软件需求描述：星敏数据处理。",0,0,0,0,0,0,0,0,1,0,0
功能描述：星上实时计算地磁场强度。,0,0,0,0,1,0,0,0,0,0,0
功能描述：确定红外数据的有效性,0,0,0,0,0,0,1,0,0,0,0
"功能描述：接收数据指令注入块的部件开关类指令
",0,0,0,0,0,0,0,0,0,1,0
"表格工作项|软件需求标识|软件需求名称|
FREQ23.1|固定地址参数|见“上行注入”5|
FREQ23.2|可变地址参数|见“上行注入”6|
FREQ23.3|轨道参数|见“上行注入”7|
FREQ23.4|程序注入|见“上行注入”8|
FREQ23.5|内存下卸|见“上行注入”9|
FREQ23.6|星敏部件控制注入|见“上行注入”10|
FREQ23.7|中继目标轨道|见“上行注入”11|
FREQ23.8|轨控命令|见“上行注入”12|
FREQ23.9|间接指令|见“上行注入”13|
FREQ23.10|固定地址|见“上行注入”14|
",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|功能及处理描述
|-Y帆板数据的采集与处理|FREQ7.3|选择通讯的-Y帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|+Y帆板数据的采集与处理|FREQ7.4|选择通讯的+Y帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|-Y帆板控制指令的输出处理|FREQ7.5|选择通讯的帆板-Y LTU，发送的控制指令。
|+Y帆板控制指令的输出处理|FREQ7.6|选择通讯的+Y帆板LTU，发送的控制指令。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：复位取回重要数据初始化
处理：
- 若取回模式为Mode1、2、3、4、6、12、13、14、15、16，更新模式字；若为模式4、6、12、13，从子模式0开始运行；
- 若取回模式为Mode5，切换至Mode3（动量轮启动模式）；
- 若取回模式为Mode7、8、9、10、11，切换至Mode16（紧急撤离模式），SubMode1。
- 按保存的重要数据更新其它变量；
- 陀螺：根据陀螺引入标志，发陀螺开指令、设置陀螺引入；
- 自锁阀：根据自锁阀状态设置自锁阀开关，再根据自锁阀开关设置喷管选择；
- LTU自主切换标志：更新ALTU、NSMU、微波、可见光、机械手分系统自主切换标志；
- LTU当班标志：更新NSMU、星敏A、星敏B、CCD相机A、CCD相机B、微波、可见光、机械手当班标志；
- LTU加电：对当班LTU（ALTU、NSMU、星敏A、星敏B、CCD相机A、CCD相机B、微波、可见光）补发加电指令；
- 更新磁力矩器线路俯仰通道主、备选择标志；
- 红外数字太阳定姿（非星敏定姿），禁止星务校时；",1,0,0,0,0,0,0,0,0,0,0
功能描述：三浮陀螺数据处理,0,0,0,0,0,0,0,0,1,0,0
功能描述：利用轨道外推的计算结果，计算其他待用参数。,0,0,0,0,1,0,0,0,0,0,0
功能描述：星敏感器数据处理,0,0,0,0,0,0,0,0,1,0,0
"功能描述：陀螺数据处理。
处理：
每个惯性姿态敏感器组件中，单个陀螺输出包括1个加速脉冲信号和1个减速脉冲信号。每个信号由1个19位计数器完成对信号的计数。计数器采用加计数方式，当脉冲数超过524287时，计数器清零，重新计数，应用软件判断计数器溢出，使用说明见表3-7。数据为无符号数据。
本周期陀螺n（n＝1～6）加（减）速脉冲计数值(个)=（本周期加（减）脉冲数 － 上周期加（减）脉冲数）；
陀螺n角度增量( º)＝ （陀螺n加速脉冲计数值 – 陀螺n减速脉冲计数值）×陀螺脉冲当量，陀螺脉冲当量为：5×10-5 度。
FREQ65|陀螺数据采集|
FREQ66|陀螺加电状态判断|
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：陀螺数据处理。
处理：
每个惯性姿态敏感器组件中，单个陀螺输出包括1个加速脉冲信号和1个减速脉冲信号。每个信号由1个20位计数器完成对信号的计数。计数器采用加计数方式，当脉冲数超过1048575时，计数器清零，重新计数，应用软件判断计数器溢出，数据为无符号数据。
本周期陀螺n（n＝1～6）加（减）速脉冲计数值(个)=（本周期加（减）脉冲数 － 上周期加（减）脉冲数）；
陀螺n角度增量( º)＝ （陀螺n加速脉冲计数值 – 陀螺n减速脉冲计数值）×陀螺脉冲当量。
对于陀螺n的脉冲数N需要分段处理：要求将每个陀螺量程范围-2.8º/s ~ +2.8º/s分为5段，每段使用不同的标度因数K，分段情况具体见任务书4.1.5.3节要求，当脉冲数超出范围时，则使用±2.8º/s时的标度因数",0,0,0,0,0,0,0,0,1,0,0
功能描述：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
功能描述：计算定点观测模式下的目标姿态TI C 和帆板理论转角。,0,0,1,0,0,0,0,0,0,0,0
功能描述：星上实时计算中继星的轨道。,0,0,0,0,1,0,0,0,0,0,0
功能描述：对陀螺进行剔野、限幅处理，并根据平衡方程满足情况对陀螺数据的有效性进行判断。,0,0,0,0,0,0,1,0,0,0,0
功能描述：地地全姿态捕获模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：遥测数据打包
处理： 
序号|功能点编号|功能描述
|FREQ4.2.1|四器巡航模式
|FREQ4.2.2|四器变轨模式
|FREQ4.2.3|组合体分离模式
|FREQ4.2.4|着上巡航模式
|FREQ4.2.5|着上轨控模式
|FREQ4.2.6|着上下降模式
|FREQ4.2.7|月面工作模式
|FREQ4.2.8|上升准备模式
|FREQ4.2.9|上升器巡航模式
|FREQ4.2.10|上升器轨控模式
",0,0,0,0,0,0,0,0,0,0,1
"功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。
输入：前两个周期、上个周期得到的，
红外处理数据，
红外常值偏差估值，（量纲：弧度）
红外数据有效性标志F_IresValid(由有效性判据给出)
红外工作周期（=0.75s）
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|CMG 1数据的采集与处理|FREQ1.9.1|""CMG 1
1553B取数指令
""|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 2数据的采集与处理|FREQ1.9.2|""CMG 2
1553B取数指令
""|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 3数据的采集与处理|FREQ1.3.3|""CMG 3
1553B取数指令
""|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 4数据的采集与处理|FREQ1.9.4|""CMG 4
1553B取数指令
""|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 5数据的采集与处理|FREQ1.9.5|""CMG 5
1553B取数指令
""|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 控制指令的输出处理|FREQ1.9.6|计算得到CMG的控制数据|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
|CMG的程序注入修改|FREQ1.9.8|从OBDH收到的CMG需修改程序内容|CMG需修改程序内容|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
|CMG的内存下传|FREQ1.9.9|从OBDH收到的CMG内存下传设置指令|内存下传设置指令|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：检测推力器的微漏，必要时作相应的主备份切换。
处理：
Ix=Iy=Iz=0",0,0,0,0,0,1,0,0,0,0,0
"功能描述：利用星敏感器C、D的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能：在不使用陀螺数据时，对姿态角、角速度与姿态四元数预估。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：仅利用星敏感器A的测量，修正姿态四元数与姿态角速度移。
",0,0,1,0,0,0,0,0,0,0,0
"功能：在完成对日定向后，由地面指令转入地球捕获。当两个地球红外敏感器同时故障时，使用数字太阳敏感器和星敏感器定姿建立正常姿态。
输入：	陀螺数据处理输出 ，标志Flag_SS
数字太阳敏感器状态F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出）
数字太阳敏感器输出： （量纲：弧度）
星敏感器A数据有效标志F_SAValid（1:有效，0:无效）
星敏感器B数据有效标志F_SBValid（1:有效，0:无效）
星敏感器输出的，
本周期采样到的星敏感器A的有效输出（i=1,2）
本周期采样到的星敏感器B的有效输出（i=1,2）",0,0,1,0,0,0,0,0,0,0,0
功能描述：释放CMG群积累的角动量。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：计算磁卸载所需的磁矩与磁力矩器工作电压。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：利用星敏感器数据计算卫星对惯性的角速度在本体系的分量,0,0,0,0,0,1,0,0,0,0,0
"功能描述：实现CMGs的PD/PID控制。
输入：姿态角误差，角速度误差，；，系统合成角动量（Nms）；Jacobi矩阵sgJ，矩阵sgF；CMG使用标志Lcmg[i]；奇异回避向量，奇异测度JD，机动补偿力矩，(陀螺切除用)",0,1,0,0,0,0,0,0,0,0,0
功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压、、。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书附录1时序。
功能编号|功能|引用文档|备注
FREQ33|陀螺接口初始化|陀螺协议|B
FREQ34|陀螺数据采集|陀螺协议|A
FREQ35|数据解包与转换|陀螺协议|A
FREQ36|陀螺数据有效性判断、处理|任务书|A
FREQ37|陀螺故障重构|任务书|C
",0,0,0,0,0,0,0,0,1,0,0
功能描述：接收BG与数传天线伺服控制器状态设置数据,0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收对应秒脉冲的整秒时刻
处理： 将接收对应秒脉冲的整秒时刻存储地址中内容解包成对应秒脉冲的整秒时刻的数据格式。",0,0,0,0,0,0,0,0,0,1,0
"功能：利用星敏感器A的测量，修正姿态四元数与估计角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送姿态数据
处理：
AOCC每个控制周期（250ms）组织28个字节姿态数据，OBDH每500ms取1次姿态数据（56个字节）。每个数据包中的2个姿态的时标需按照时间顺序排列。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：利用加速度计数据诊断加速度计部件状态
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：发送高精度姿态数据
处理：每个控制周期查询一次是否需要进行数据打包，若需要，则进行数据打包。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：使用星敏感器B的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：主动段模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的轨道参数
处理：
GPS无效判断的连续次数变量由1改为7。
调整序号14注入轨道根数有效性阀值、序号16~18岁差章动系数的初装值。",0,0,0,0,0,0,0,0,0,1,0
功能描述：进行单轴相平面喷气控制规律计算。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：计算正常飞行模式轮控所需电压。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的在轨维护功能参数设置区数据
处理：
调整程序替换区模块代号1~8的初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：轨道数据解包及处理
处理：依据地面注入轨道种类，追踪器轨道平根数、目标器轨道平根数、追踪器J2000坐标系轨道参数、目标器J2000坐标系轨道参数，更新相应轨道数据。
说明：星务分系统向GNCC送数采用128字节(有效使用1字节)帧格式。注入数据格式见《卫星GNC分系统GN与星务分系统通讯协议》，注入内容见《卫星控制分系统注入参数及数据指令》",0,0,0,0,0,0,0,0,0,1,0
"软件需求名称：上电和复位初始化 
需求类别：其他 
软件需求描述：系统软件上电复位后，调用应用软件AppInit函数，并根据初始化内容，启动任务
处理：
OBC上电/复位后，由系统软件引导应用软件运行。首先进行初始化，包括系统软件初始化和系统软件调用应用软件提供的初始化函数（AppInit）。启动任务并开始进行任务调度管理。 ",1,0,0,0,0,0,0,0,0,0,0
功能描述：由平衡方程方法进行陀螺的故障检测。,0,0,0,0,0,0,1,0,0,0,0
将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据和定轨数据的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。,0,0,0,0,0,0,0,0,0,1,0
功能描述： CMG控制,0,1,0,0,0,0,0,0,0,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理： 
（1）CPU星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU星时时钟星时校时是通过OBDH校时，OBDH校时分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；",0,0,0,0,0,0,0,0,1,0,0
功能描述：计算岁差章动矩阵。,0,0,0,0,1,0,0,0,0,0,0
功能描述：利用红外、数字/太阳敏感器确定姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件进行LTU初始化、1553B初始化、调用系统软件的StartStarTimer、变量的初始化
处理：
进行1553B初始化，处理过程见4.3.2的OBDH初始化功能
GPS秒脉冲信号接口寄存器初始化
设置3个星敏的 RTS信号为无效
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用星敏感器捕获地球分两个阶段。在第一阶段，60秒判断一次星敏感器姿态输出。如果星敏感器A、B、C均有姿态输出，且测量的光轴夹角满足一定条件，则利用星敏感器双矢量定姿确定姿态。若仅有A或仅有B或仅有C有姿态输出，则偏航转过小角度（3度），重复捕获。偏航转过3度后，若星敏感器A或B或C有姿态输出，且满足一定条件，利用星敏感器双矢量定姿。若三个星敏感器均无姿态输出或由输出但仍不满足一定的条件，进行偏航转动（45度）。若偏航转动1周天仍未捕获成功，则滚动转动90度。若全天球捕获成功，则当姿态角和姿态角速度满足一定条件，进入阶段2。在阶段2，利用四元数进行姿态确定（与姿态机动定姿相同）。喷气控制。
",0,0,1,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
部件加断电指令的处理|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|5.2.1|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估对地姿态|FREQ3.3|5.2.3|根据陀螺测量输出，一步预估卫星姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|基于红外滤波的卫星姿态确定|FREQ3.6|5.2.6|根据陀螺预估结果和红外(和数字太阳)输出，确定卫星姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|红外与太阳双矢量定姿|FREQ3.9|5.2.9|利用红外、数字太阳敏感器确定姿态
|星敏感器相对基准标定|FREQ3.10|5.2.10|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.11.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.11.2|进行卫星姿态四元数的重置
|三轴欧拉姿态角预估算法产品规范|FREQ3.1.1|/|规范化算法：
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法产品规范|FREQ3.1.3|/|规范化算法：
|基于红外测量的红外滤波修正算法产品规范|FREQ3.1.4|/|规范化算法：
|基于单星敏感器测量矢量点乘信息的滤波修正算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量点乘信息的滤波修正算法产品规范|FREQ3.1.6|/|规范化算法：
|基于红外与太阳矢量的双矢量定姿算法产品规范|FREQ3.1.7|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.1|""计算模式的目标姿态
""
|点对点机动目标姿态计算|FREQ3.12.1|5.3.1.1|点对点机动目标姿态计算
|轨控目标姿态计算|FREQ3.12.2|5.3.1.2|轨控目标姿态计算
|姿态机动初始化|FREQ3.12.3|5.3.2|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|""理论偏流角计算
""|FREQ3.12.4.1|5.3.3.1|""适用于地球椭球模型，基于星体姿态描述为1-2-3 转序计算基于星体+Z 轴或基于指定基准轴（该轴应在XOZ 平面内）情况下的偏流角。
""
|偏流角平滑及偏流角速度计算|FREQ3.12.4.2|5.3.3.2|对偏流角修正启动与停止过程中的偏流角进行平滑处理，并计算偏流角速度。
|太阳高度角计算|FREQ3.12.4.3|5.3.3.3|根据偏流角修正基准计算太阳高度角
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|陀螺标定过程目标姿态计算|FREQ3.25.0|5.11.1|陀螺标定全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角
|目标姿态计算初始化|FREQ3.25.1|5.11.1.1|对陀螺标定过程中涉及到的两次机动过程进行机动姿态计算的初始化
|惯性姿态点对点机动轨迹规划|FREQ3.25.2|5.11.1.2|对陀螺标定过程所涉及到的两次点对点机动进行轨迹规划
|角速度起速保持与减速过程轨迹规划|FREQ3.25.3|5.11.1.3|对陀螺标定过程中的速度运行进行轨迹规划
|惯性定向时转阶段处理|FREQ3.25.5|5.11.1.5|陀螺标定在第1段中完成惯性定向，并在此期间标定陀螺真实常漂。在惯性定向转速度运行结束时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等。
|速度运行时转阶段处理|FREQ3.25.6|5.11.1.6|SubMode= 2~9，陀螺按照规定的角速度完成起速、恒速运行、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等
|速度曲线规划|FREQ3.25.7|5.11.1.7|根据所选择的机动轨迹，规划出角速度变化曲线
|陀螺标定算法|FREQ3.26.0|5.11.2|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺常漂修正标志确定|FREQ3.26.1|5.11.2.1|对陀螺标定过程中，陀螺常漂的修正标志进行确定。当星体达到了规定的惯性角速度时，开始进行陀螺常漂估计
|基于星敏陀螺滤波的等效常漂估计|FREQ3.26.2|5.11.2.2|采用星敏陀螺滤波的方法对陀螺等效常漂进行估计
|星敏陀螺滤波的陀螺等效常漂记录|FREQ3.26.3|5.11.2.3|对陀螺等效常漂，选取稳态时的一段数据进行平均，得到各个角速度下的等效常漂和星体真实角速度的估计值
|小角速度时的陀螺安装误差和刻度因子误差估计|FREQ3.26.4|5.11.2.4|经过N次速度机动后，对陀螺的测量模型进行标定，给出标定结果
|陀螺在轨标定时的控制量计算|FREQ3.27|5.11.3|对标定过程中的控制量进行计算
|陀螺安装误差标校结果引入|FREQ3.28|5.11.4|对陀螺完成标定后，待地面确认标定结果无误后，将陀螺的标定结果进行赋值。当地面注入FP__MountingCmp时执行本程序一次
|惯性姿态预处理初始化|FREQ3.29.1.1|5.12.1.1|计算惯性定向及扫描的机动参数
|相机扫描速度建立参数计算|FREQ3.29.1.2|5.12.1.2|计算由建立扫描速度初始姿态到建立恒定速度的时间，以及扫描结束后星体静止后的惯性姿态。
|星体阻尼结束至惯性定向姿态建立参数计算|FREQ3.29.1.3|5.12.1.3|计算星体阻尼结束后的姿态调整到凝视标定的惯性定向姿态，或天区扫描速度建立前所需初始惯性姿态
|惯性目标姿态计算|FREQ3.29.2.0|5.12.2|全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角。
|惯性定向轨迹规划|FREQ3.29.2.1|5.12.2.1|对惯性再定向过程进行轨迹规划
|惯性定向转阶段处理|FREQ3.29.2.2|5.12.2.2|惯性再定向转换处理
|惯性空间扫描轨迹规划|FREQ3.29.2.3|5.12.2.3|对惯性空间扫描过程进行轨迹规划
|惯性扫描转阶段处理|FREQ3.29.2.4|5.12.2.4|SubMode = 2，按照规定的角速度完成角速度的建立、恒速扫描、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化
|目标姿态计算初始化|FREQ3.29.2.5|5.12.2.5|对SubMode=1/10子模式进行机动姿态计算的初始化
|惯性定向姿态控制量计算|FREQ3.29.3|5.12.3|对惯性定向过程中的控制量进行计算
|星敏感器的粗姿态计算|FREQ3.30|5.2.14|计算提供给星敏感器的粗姿态
",0,0,1,0,0,0,0,0,0,0,0
功能模式：姿态机动的初始化计算。,0,0,1,0,0,0,0,0,0,0,0
功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。    ,0,1,0,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的外1533B接收子地址内存管理区,0,0,0,0,0,0,0,0,0,1,0
将AOCC计算得出的星历数据打包后放到星历数据地址空间中。,0,0,0,0,0,0,0,0,0,0,1
功能描述：根据红外、太阳、星敏感器的输出数据判断陀螺故障。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：自主对计算机进行切换。
处理：
AOCC的A机和B机满足一定的条件下，可以进行切换。",0,0,0,0,0,0,0,1,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
|OBDH校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|两种校时方式的切换|FREQ Q1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ82|初始化|任务书
FREQ83|地检使用要求|任务书
FREQ84|通信(串口)|任务书
FREQ85|通信故障处理|任务书
FREQ86|数据解包与转换|任务书
FREQ87|地检数据有效性判断、处理|任务书
FREQ88|地检模拟量采集、处理|预留
FREQ89|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：追踪器构型切换管理及质量设置
处理：根据构型设置追踪器质量及转动惯量
",0,1,0,0,0,0,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：利用陀螺确定出卫星对目标的姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求标识：FREQ25 
软件需求名称：地检数据采集处理 
需求类别：其他 
软件需求描述：地检数据采集处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：俯仰通道喷气中断处理程序。
处理：将推力器1-8关掉",0,0,0,0,0,0,0,1,0,0,0
功能描述：将动量轮保持至标称角动量所需的电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入预估卫星对地姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送星敏陀螺数据
处理：将星敏陀螺数据打包后放到发送星敏陀螺数据存储地址中
AOCC每个控制周期（250ms）组织128个字节星敏陀螺数据，OBDH每500ms取1次星敏陀螺数据（256个字节）。其中前128字节数据对应小星时的星敏陀螺数据，后128字节数据对应大星时的星敏陀螺数据。",0,0,0,0,0,0,0,0,0,1,0
"模式字定义如下，装订值为0：
模式字|工作模式描述
0|主动段
1|正常对地运行
2|偏航机动
3|全姿态捕获
4|对地捕获
5|帆板未展开
6|轨控
7|无控
8|侧摆机动
9| 侧摆保持
11|入轨段控制
12|自旋模式
13|应急模式
14|星敏全姿态捕获模式

工作模式的转换可分为以下二种情况：
按地面上行注入进行转换：通过注入姿控数据块中的模式字进行转换；
按应用软件用户需求给定的条件判别，由软件自主控制转换：自主转换分两种：一种为正常运行转换；一种为故障时转换。下面分别进行说明
正常转换图为：
正常运行自主转换如下表所示：条件标识原则：ZCCX—Y，其中ZCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。
标识|具体条件
ZCC0—B|星箭分离
ZCCB—1|Tin >4800 
ZCC1—2|
ZCC1—6|
ZCC1—8|且且且
ZCC2—1|
ZCC2—6|
ZCC4—1|FEA=A
ZCC6—1|
ZCC6—2|)且
ZCC8—1|""满足下列条件之一：
若动量轮侧摆且目标侧摆角为0，当姿态角误差小于0.5度，角速度误差小于0.01度/s连续次
若喷气侧摆且目标侧摆角为0，当姿态角误差小于1度，角速度误差小于0.015度/s连续次
若星时大于侧摆机动时间＋600秒且侧摆目标角为0""
ZCC8—9|""满足下列条件之一：
若动量轮侧摆且目标侧摆角不为0，当姿态角误差小于0.5度，角速度误差小于0.01度/s连续次
若喷气侧摆且目标侧摆角不为0，当姿态角误差小于1度，角速度误差小于0.015度/s连续次
若星时大于侧摆机动时间＋600秒且侧摆目标角不为0""
ZCC9—8|""满足下列条件之一：
且
""

故障自主转换如下表所示：条件标识原则：GCX—Y，其中GCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。其中进入应急模式的条件为读到应急线路加电，记为GCC-D。其余的自主故障切换如下图所示：
故障条件定义如下：
标识|具体条件
GCC1—3|FailureFlag=1并且WacqSunFlag =0并且ZT7属于[1，4]区间内
GCC1—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC1—E|FailureFlag=1并且WacqSunFlag=1并且ZT7属于[1，4]区间内
GCC3—7|FailureFlag＝4且AutoInStopNum<2
GCC3—E|SMODE＝3且TSMODE>8000（若ZT11=4则取值为32000）
GCC4—1|FEA=A
GCC4—3|WacqUseIresOrSTSFlag=1且TCOUNT>24000
GCC5—3|脉冲发完后
GCC6—1|FailureFlag＝2且无机动要求
GCC6—2|FailureFlag＝2且无机动要求
GCC7—3|>6900 且AutoInStopNum<2且WacqSunFlag =0
GCC7—E|>6900 且AutoInStopNum<2且WacqSunFlag =1
GCC8—1|FailureFlag=3
GCC9—3|FailureFlag=1并且WacqSunFlag=1并且ZT7属于[1，4]区间内
GCC9—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC9—E|FailureFlag=1并且WacqSunFlag=0并且ZT7属于[1，4]区间内
GCCB—3|FailureFlag=1并且ZT7属于[1，4]区间内
GCCB—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCCE—1|StarCatchFlag=1且(1-()<0.000685)且norm()<0.000875
GCCE—7|TCOUNT>31200或（FailureFlag＝4且AutoInStopNum<2）

AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收应急控制器重要数据。
处理：应急线路加电后与OBDH通信，获得陀螺和推力器状态，若连续3个控制周期都没有成功取得重要数据，默认陀螺使用7、8、9号，推力器使用主备份推力器，模拟式太阳敏感器使用ASS1和ASS21。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：模式4切换方式。
处理：
if() 置WorkMode=5，WorkModeT=6，；//程控指令转对地
if(lipse=1且且AutoPermission=1) 置WorkMode＝5；WorkModeT=6；；；//进入阴影区自主转对地
if() 置WorkMode=5；若，若，；WorkModeT=6；
if() 置WorkMode=5；若，若，WorkModeT=6；
收到星务的“辐射定标”指令，置WorkMode=5，WorkModeT=6，；//辐射定标模式，为注入的辐射定标目标角
if(FailureFlag＝1) 置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ98|初始化|任务书
FREQ99|磁力矩器使用要求|任务书
FREQ100|通信(DA)|任务书
FREQ101|通信故障处理|预留
FREQ102|数据解包与转换|预留
FREQ103|磁力矩器数据有效性处理|预留
FREQ104|磁力矩器硬件采集、处理|任务书
FREQ105|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：接收内存设置命令
处理：将内存设置命令存储地址中内容的解包成需下传的内存首地址和长度。此处理在中断中进行。",0,0,0,0,0,0,0,0,0,1,0
功能描述：帆板未展开模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：减小卫星的俯仰角。
输入：陀螺数据输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）、见太阳状态、故障标志IRES_FLAG
红外弦宽
红外数据处理（全姿态捕获）的输出，",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据红外信息，作姿态滤波修正。
处理：同用户需求的",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据姿态角计算方向余弦阵
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用B，C头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.9
STEP1：计算，将下标A换成C；FM3更改：若，则：，FSTD=1；
STEP2：计算，的各项乘以，的各项乘以。将下标A换成C；
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据CMG输出数据和理论数据进行CMG故障检测及处理。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：规划串口数据接收发送。
处理：
功能编号|功能|引用文档
FREQ101|初始化|任务书
FREQ102|规划串口使用要求|任务书
FREQ103|通信|任务书
FREQ104|通信故障处理|任务书
FREQ105|数据解包与转换|任务书
FREQ106|规划串口数据有效性处理|任务书
FREQ107|规划串口硬件采集、处理|预留
FREQ108|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：当收到“停控”数据指令或满足自主进入停控模式的条件时，应用软件进入停控模式。
处理
关闭自锁阀1、2；
与ALTU继续通信，进行轨道与环境计算、采集信息，不进行定姿与控制，输出磁力矩器、推力器控制量为0，发送CMG1~5复位及高速断电指令；之后发送CMG无效0指令。
停止对天线控制计算、通信。",0,0,0,1,0,0,0,0,0,0,0
功能描述：发送矢量字,0,0,0,0,0,0,0,0,0,0,1
"功能描述：与星敏感器通讯获得星敏感器数据是否可以用来定姿。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：数传天线数据处理,0,0,0,0,0,0,0,0,1,0,0
"功能描述：减小卫星的俯仰角。
输入：陀螺数据输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）
红外数据处理（全姿态捕获）的输出，
上周期姿态角估值，
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理",0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量。
输入：动量轮的转速方向和脉冲计量、上一次轮子角动量值。
输出：动量轮的角动量。
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量（动量轮角速度为1800r/min时的角动量为15Nms）。
（3）令（i = 1，2，… ，6）。为上一次轮子角动量值。（i = 1，2，… ，6）。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：由数字太阳粗细码得到数字太阳角、全开码、见太阳标志。
处理：
每个数字太阳敏感器包括7道粗码（C1～C7）、4道细码（F1～F4）、2道监视码（M1、M2）和1道全开码（T），数字太阳敏感器的第8道粗码(C8)与第1道细码(F1)合为一道码。所有14道码均由电路处理为电压信号，量纲为伏。
在数字太阳敏感器中，8道粗码以格雷码形式编码，探头输出的信号为原始的光电流信号，进行I/V变换放大后为模拟电压信号，再经A/D转换为数字量信号。粗码与格雷码的对应关系见表5-4所示：
表5-4 粗码与格雷码对应关系
粗  码|C1|C2|C3|C4|C5|C6|C7|C8(F1)
格雷码|G7|G6|G5|G4|G3|G2|G1|G0

首先，对粗码进行二值化处理，以全开码输出的一半作为阈值，当高于阈值时，对应的格雷码输出为“1”，否则为“0”。
其次，对数字太阳粗码角度部分从格雷码向二进制码进行转换。格雷码向二进制码转换时，最高位不变，其后的几位按下列规律转换：
二进制码第i位(i=0～6)： ，式中是异或功能逻辑符。
再次，细码角度（几何角）部分可由下列公式得到：
      F1=A/2 [1-cos（180×α）]	（1）
      F2=A/2 [1-（180×α）]	（2）
      F3=A/2 [1+cos（180×α）]	（3）
      F4=A/2 [1+（180×α）] 	（4）
式中是细码角度（几何角）， 量纲为度，细码角度范围为0～2º，最小码当量为0.78125º；F1～F4的量纲为伏；A表示信号幅值。
	在0～0.5º范围内时，由式（1）～（4）可以得到：
               α=a()      
，通过粗细码同步处理进行补偿。粗细码同步处理原则如下：
当细码最高两位都为0，且粗码最低两位都为1时，将粗码加1。
当细码最高两位都为1，且粗码最低两位都为0时，将粗码减1。
其余情况不作任何处理。
粗细码角度同步处理完毕之后，所得到的角度为偏移二进制码，偏移量为64度，然后将偏移二进制码转换成原码形式。
每个数字太阳敏感器数据处理后的为：2字节原码，D15：“0”表示见太阳，“1”表示未见太阳；D14：“0”表示负角度，“1”表示正角度；D13~D1为有效数据；D0：恒为0。
数字太阳敏感器视场有效性判断：以0.28太阳常数（34H，对应电压值为1.02V）作为监视码的固定门槛值，用采集到的监视码M1和M2分别与其比较，仅当监视码M1和M2的值均高于固定门槛值时，数字太阳敏感器视场为视场内，否则为视场外。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：消除星体角速度，并使星体Z 轴指向太阳
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：
 完成推力器判断和处理功能（功能编号：FReq-15）。

处理：进行推力器喷气量过量的故障诊断，仿真推力器堵漏、安装错误等故障。诊断出一份故障后等待1000个周期，再进行另一份推力器故障诊断的要求。具体判断与处理逻辑详见任务书，任务书中cntwaitWTF的相关操作实际无效，软件可自主实现其相关操作。
根据推力器故障诊断逻辑，综合考虑了推力器的工作分支、太阳可见标志SP61/62、太阳数据跳数等相关因素。",0,0,0,0,0,1,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0|主动段|FREQ56
1|正常对地运行|FREQ57
2|偏航机动|FREQ58
3|全姿态捕获|FREQ59
4|对地捕获|FREQ60
5|帆板未展开|FREQ61
6|轨控|FREQ62
7|无控|FREQ63
8|侧摆机动|FREQ64
9| 侧摆保持|FREQ65
11|入轨段控制|FREQ66
12|自旋模式|FREQ67
13|应急模式|FREQ68
14|星敏全姿态捕获模式|FREQ69

主动段工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定和姿态和轨道控制的如下所示
|模式字
|E
卫星轨道外推计算|√
GPS轨道计算|√
太阳星历计算|√
地面站位置计算|√
岁差章动计算|√
地磁场计算|√
偏流角计算|
陀螺数据处理|√
惯性姿态陀螺预估|√
对地姿态陀螺预估|
四元数陀螺预估|
红外输出的数据处理|√
太阳输出的数据处理|√
红外的姿态修正|
红外与太阳双矢量定姿|
红外太阳姿态修正|
星敏感器数据处理|
星敏感器A姿态修正|
星敏感器B姿态修正|
星敏感器C姿态修正|
星敏感器A、B姿态修正|
星敏感器A、C姿态修正|
星敏感器B、C姿态修正|
对地姿态修正及星敏粗姿态计算|
仅星敏感器A的姿态修正|
仅星敏感器B的姿态修正|
仅星敏感器C的姿态修正|
仅星敏感器AB的姿态修正|
仅星敏感器AC的姿态修正|
仅星敏感器BC的姿态修正|
–Z轴捕获太阳及对日定向|
偏航捕获及转对地定向|
星敏感器全姿态捕获|√
侧摆目标姿态确定|
姿态控制量计算|√
相平面法|√
姿态喷气控制|√
动量轮摩擦补偿计算|√
动量轮角动量保持的PI控制|√
动量轮启动与保持|√
正常飞行动量轮分配电压计算|
结构滤波器计算|
 喷气卸载条件计算|
磁卸载控制|
运行段帆板控制|
太阳帆板自主跟踪控制|
无控模式下太阳帆板控制|
数传天线指向控制|
偏置动量轮分配电压计算|

在正常运行模式下主要有三种定姿方式：红外定姿、红外太阳定姿和星敏定姿。其中星敏定姿为高精度定姿方式。并可采用有陀螺和无陀螺方式，正常情况下为有陀螺。定姿方式的切换通过注入系统定姿方式字和系统故障诊断来实现切换。在模式2和6的初始化中删除了红外定姿的设置，调用流程中增加了星敏定姿的姿态角计算，可以在星敏定姿下变轨。太阳全姿态捕获模式(BZ1=3)和星敏感器全姿态捕获模式(BZ1=E)初始化中增加取消偏流角修正计算的操作。",0,0,0,1,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的陀螺漂移系数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用星敏感器D的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，予估卫星对地姿态。

处理：
STEP1:计算；
STEP2:计算，区分工作模式BZ1=1（三轴稳定正常轨道运行姿态）或8（侧摆机动）或9（侧摆角保持），BZ1≠1和8和9两种情况；
STEP3:计算；
STEP4:若BZ1=1（三轴稳定正常轨道运行姿态）或2（偏航机动并稳定运行）或6（轨控期间），；
STEP5:若BZ1=1（三轴稳定正常轨道运行姿态），则；
STEP6:若BZ1=8（侧摆机动），则，；
STEP7:若BZ1=9（侧摆角保持），则，；
STEP8:若BZ1=B（入轨段控制模式）且(消初偏结束时刻)。",0,0,1,0,0,0,0,0,0,0,0
功能描述：实现正常模式及侧摆模式下的偏流角计算。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：姿态角速度与姿态四元数的预估，包括使用陀螺数据和不使用陀螺数据的姿态四元数预估。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：检测工作中的动量轮的故障并切换。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：与动量轮通信，输出本周期电压。采集动量轮模拟量信息。
处理：
功能编号|功能|引用文档
FREQ102|初始化(加电)|任务书
FREQ103|动量轮使用要求(方向等)|任务书
FREQ104|通信(DA输出、脉冲输入)|任务书
FREQ105|通信故障处理|预留
FREQ106|数据解包与转换|任务书
FREQ107|处理动量轮数据有效性处理|任务书
FREQ108|动量轮模拟量采集、故障|任务书
FREQ109|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
功能描述：喷气卸载进入和退出条件计算。,0,1,0,0,0,0,0,0,0,0,0
功能描述：根据CMG角动量及地磁场强度决定并输出磁棒控制电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：伴飞模式下，计算视速度增量关机时间长度
",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：太阳敏感器使用及通信 
需求类别：其他 
软件需求描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
太敏初始化|FREQ41|太敏初始化|B|2
太敏数据采集|FREQ42|太敏数据采集|A|3
数据解包与转换|FREQ43|数据解包与转换|A|4
太敏数据有效性判断|FREQ44|太敏数据有效性判断|A|5
太敏故障重构|FREQ45|太敏故障重构|C|
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据GNC控制量对动量轮、星敏防尘机构及推进线路盒进行控制。执行顺序要求：先对DM发送控制指令，后对上升器推进线路盒发送控制指令，最后对着陆器推进线路盒发送控制指令
序号|功能点编号|功能描述|说明
|FREQ3.5.1|动量轮|通过串口向DM发送动量轮的控制电压信号
|FREQ3.5.2|星敏防尘机构|通过串口向DM发送星敏防尘机构开关指令
|FREQ3.5.3|推力器|通过串口向推进线路盒发出姿控推力器控制脉宽，7500N变推力发动机及3000N发动机的控制指令
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：选择通讯的数传天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）数传天线有四个LTU，天线1和2各有两个互为备份。应用软件初始上电时不与数传天线通讯，与数传天线开始通讯的条件为：收到数传天线预指或复位总线指令和数传天线加电。停止与数传天线通讯的条件为：收到数传天线停止总线指令和数传天线断电。其中数传天线加断电状态由1553B的接收数传天线伺服控制器状态设置数据命令来确定。同时也根据这个命令确定参与通讯的LTU。初始为选择主份，收到主切备时切换到备份；在备份通讯时，收到备切主时切换到主份。
（2）向数传天线LTU发完取数命令后，获得数传天线LTU返回的数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
功能描述：计算太阳星历、红外补偿量及光行差计算。。,0,0,0,0,1,0,0,0,0,0,0
功能描述：若AOCC与星敏感器通讯不成功，则记录星敏感器故障一次。若连续240次不成功，判断该星敏感器故障。若星敏感器连续2000次故障，需重新启动星敏感器。,0,0,0,0,0,1,0,0,0,0,0
功能描述：绕本体俯仰轴转动，进行俯仰捕获。,0,0,1,0,0,0,0,0,0,0,0
功能描述：为正常模式姿态确定提供初始姿态。,0,0,1,0,0,0,0,0,0,0,0
功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：
处理
",0,0,0,0,0,0,1,0,0,0,0
"序|需求名称|编号|功能和处理描述
|滚动俯仰通道喷气中断服务程序|FREQ81|将滚动俯仰通道相应的推力器关掉
|偏航通道喷气中断服务程序|FREQ82|根据状态字关相应的推力器
|轨控发动机喷气中断服务程序|FREQ83|将轨控发动机关掉，如果有1N轨控则根据轨控状态字关相应的推力器
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：选择通讯的星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输入：ZT6、inAPSLTUSeltFlag、星敏LTU返回的数据。
输出：星敏输出的四元数、相对时间和数据有效性标志。
处理：
（1）星敏共有两个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的星敏LTU发送取数指令。
（2）向选择的星敏LTU发送完取数指令后，获得星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收总线指令
处理： 将接收总线指令存储地址中内容解包成总线指令的数据格式，根据不同的总线指令进行相应的处理。其中侧摆指令仅在在模式1或9下响应。",0,0,0,0,0,0,0,0,0,1,0
"软件需求标识：FREQ16 
软件需求名称：加速度计数据处理 
需求类别：其他 
软件需求描述：加速度计数据处理。",0,0,0,0,0,0,0,0,1,0,0
功能描述：计算太阳星历及光行差计算。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：接收时间码
处理： OBDH分系统每1分钟给AOCC校时一次。",0,0,0,0,0,0,0,0,0,1,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计角速度。
输入：星敏感器A、B修正新息，四元数、无陀螺时估计的角速度
输出：修正四元数、陀螺常漂
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：星上自主检测陀螺故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：地球-地球全姿态捕获模式捕获过程

说明：地地全姿态捕获分五个步骤，其中速率阻尼和太地相同",0,0,1,0,0,0,0,0,0,0,0
"功能描述：选择相平面参数、加速度
处理：根据工作模式设置相平面参数；根据推力器分支及追踪器构型设置加速度。
说明：4种构型，3种分支共计12组加速度（每组包括正负三轴共6个）；",0,1,0,0,0,0,0,0,0,0,0
功能描述：将GPS轨道确定参数转换成控制系统中太阳星历和地磁场计算所需的19个轨道参数,0,0,0,0,1,0,0,0,0,0,0
功能描述：利用估计的四元数转换姿态角。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收地面指令，用星敏测量数据更新四元素。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|均匀校时|FREQ1.4.5|""本周期的绝对星时；
均匀校时补偿量""|""本周期的绝对星时；
""|应用软件每次进行星时计算时，将计算后的绝对星时加上均匀校时补偿量作为本周期的补偿后的绝对星时。
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发送AOCC时间
处理：
CTU加电或复位后通过子地址12（T/R＝0）向AOCC发送“接收记录AOCC时间数据”消息，消息内容为5555H。AOCC收到该消息后应在0.1s内准备好AOCC 时间数据，然后OBDH通过子地址12（T/R＝1）取走AOCC时间数据。",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|功能及处理描述
|动量轮角动量的采集与处理|FREQ5.1|采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
|动量轮控制电压的处理|FREQ5.2|将动量轮控制电压通过D/A输出
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：卫星绕滚动轴转动，直到满足姿态角条件，进入下一阶段俯仰捕获。姿态确定由红外和陀螺。姿态控制是喷气控制
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：实时计算地心矢量、太阳矢量在本体系下的表示，以及星体X轴指向的赤经、赤纬
",0,0,1,0,0,0,0,0,0,0,0
功能描述：采集3路模拟磁强计信息得到磁场强度。,0,0,0,0,0,0,0,0,1,0,0
功能描述：根据太阳矢量在帆板2法平面内投影与帆板法线之间的夹角，通过帆板驱动机构2控制帆板2，使帆板2能捕获及跟踪太阳。,0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：部件数据处理及状态选择 
需求类别：其他 
软件需求描述：部件数据采集、剔野和选择处理。",0,0,0,1,0,0,0,0,0,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.6.1~4.6.3。
序号|功能点编号|功能描述|说明
|FREQ3.4.8.1|喷气控制|《用户需求》4.6.1
|FREQ3.4.8.1.1|相平面姿控算法|《用户需求》4.6.1.1
|FREQ3.4.8.1.2|相平面法喷管选择|《用户需求》4.6.1.2
|FREQ3.4.8.1.3|脉冲调宽姿控算法|《用户需求》4.6.1.3
|FREQ3.4.8.1.4|脉冲调宽法喷管选择|《用户需求》4.6.1.4
|FREQ3.4.8.2|动量轮控制|《用户需求》4.6.2
|FREQ3.4.8.2.1|动量轮安装矩阵和电压分配矩阵|《用户需求》4.6.2.1
|FREQ3.4.8.2.2|动量轮摩擦补偿计算|《用户需求》4.6.2.2
|FREQ3.4.8.2.3|动量轮角动量保持的PI控制|《用户需求》4.6.2.3
|FREQ3.4.8.2.4|动量轮启动与保持|《用户需求》4.6.2.4
|FREQ3.4.8.2.5|正常飞行动量轮分配电压计算|《用户需求》4.6.2.5
|FREQ3.4.8.3|喷气卸载计算|《用户需求》4.6.3
|FREQ3.4.8.4|喷气动量轮联合控制|《用户需求》4.6.4
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：串口各部件数据采集和处理
处理：
对于有自检需求的LTU部件，在发送自检指令前将自检应答数据初始化为0xFF（微波测距测速敏感器自检数据初始化为0）。发送前应答数据有初始化要求的自检或遥测获取指令类型：包括图像处理单元自检、激光测距敏感器遥测参数获取、激光测速敏感器校时及遥测参数获取、三维成像敏感器自检和三维成像敏感器遥测参数获取等。CCU上电初始化时默认进行部件自检或校时指令通讯。
序号|功能点编号|功能描述|说明
|FREQ3.2.2.10|部件数据采集顺序|异步串口1数据采集顺序为：DM取数；激光IMU取数；光纤IMU取数；星敏1取数；星敏2取数；微波雷达(a)应答机取数。 异步串口2数据采集顺序为：异步串口2数据采集顺序为：自检及校时指令，LRF取数，LVS取数，星敏3取数，微波雷达(b)应答机取数，RVS取数
",0,0,0,0,0,0,0,0,1,0,0
功能：利用星敏感器A的测量，修正姿态四元数与估计角速度。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：使星体-Z轴对日定向后，使用星敏感器重捕地球。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据加在CMG框架上的指令角速度而产生的期望角度与CMG框架产生的实际角度之差，自主诊断CMG框架的工作状态。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：检测动量轮的故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：校正星上星时。
输入：星上星时变量、均匀校时间隔、均匀校时时间、全量校时时间、增量校时时间、星务校时时间、相关数据指令。
输出：校正后的星上当前星时变量。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：由模拟太阳A/B码、监视码得到模拟太阳角、见太阳标志。,0,0,0,0,0,0,0,0,1,0,0
功能描述：检测推力器的泄露，必要时做相应的主备份切换。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：星敏感器数据处理。
处理：同用户需求的5.11。
(1)获得FSTA,FSTB,FSTC
条件|FSTA|FSTB|FSTC
ZT23=0|0|0|0
ZT23=6,|1|0|0
ZT23=6,|0|0|0
ZT23=9,|1|*|*
ZT23=9,|0|*|*
ZT23=9,|*|1|*
ZT23=9,|*|0|*
ZT23=9,|*|*|1
ZT23=9,|*|*|0
ZT23=A,|0|1|0
ZT23=A,|0|0|0
ZT23=B,|0|0|1
ZT23=B,|0|0|0
ZT23=C,|0|1|*
ZT23=C,|0|0|*
ZT23=C,|0|*|1
ZT23=C,|0|*|0
ZT23=D,|1|0|*
ZT23=D,|0|0|*
ZT23=D,|*|0|1
ZT23=D,|*|0|0
ZT23=E,|1|*|0
ZT23=E,|0|*|0
ZT23=E,|*|1|0
ZT23=E,|*|0|0

(2)修订FSTA,FSTB,FSTC
若ZT41[3]=1允许星敏数据有效性判断且BZ13全姿态捕获对日定向姿态且BZ14重捕地球转三轴稳定运行且BZ1≠7无控则进行如下诊断：
若FSTA = 1，FSTC = 1，（或）则FSTA = 0，FSTC = 0；
若FSTA = 1，FSTB = 1，（或）则FSTA = 0，FSTB = 0；
若FSTB = 1，FSTC = 1，（或）则FSTB= 0；FSTC = 0。
(3)获得FSTD
FSTA|FSTB|FSTC|ZT12|BZ2|FSTD
1|1|*|1或9或8|≤2|2
1|*|1|1或9或D|≤2|3
*|1|1|1或9或E|≤2|4
1|*|*|6或9|≤2|5
*|1|*|7或9|≤2|6
*|*|1|B或9|≤2|7
不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|1

(4)当BZ1=1(三轴稳定正常运行轨道姿态)或9(侧摆角保持)时，进行星敏感器数据修正。公式见5.11(9)。
(4)当BZ1=1(三轴稳定正常运行轨道姿态)时，根据ZT40(3)是否为1（引入星敏在轨标定）进行星敏感器在轨标定。公式见5.11(10)。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示（十六进制）：
服务编码|发送的条件
58H|上电/复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次。
38H|每隔1分钟或模式改变时发送
96H|待定
69H|进入全姿态捕获模式后发送，收到确认字后停止发送
8CH|进入无控模式后发送，收到确认字后停止发送
C8H|BAPTA异常跟踪后发送，收到确认字后停止发送
",0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。                                                                                                                                                                                                                                                                                                                                                                                                                              输入：上周期姿态角估值
陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出：",0,0,1,0,0,0,0,0,0,0,0
"功能描述：使用红外、星敏、太阳定姿时，计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：将CMG启动到标称转数。
处理：
发送指令“运行CMG启动模式”进入CMG启动模式。
	根据地面数据指令，设置CMG引入状态；
	应用软件连续5个控制周期给引入的CMG加电；
	根据自锁阀状态设置自锁阀1和/或自锁阀2开；
	上述动作完成后，自主控制引入的4或5个CMG框架角转到标称位置；
	当框架角度达到要求值后，地面发“CMG高速启动”指令，应用软件连续5个控制周期自主向引入的4或5个CMG发送“CMG高速启动”指令，令4或5个CMG的高速转速达到6000rpm；（本步骤也可通过地面指令完成）
	CMG高速启动时间为10~15分钟
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；//在有星敏和无星敏时均可启动CMG
调用目标姿态确定；
调用控制器输入量计算；
调用CMG奇异状态的判断及算法计算；
调用CMG启动与保持；
if(CMGStartComm =1) 给CMG发启动指令；
if(Flag_equation=0)调用相平面喷气脉宽；
调用系统故障诊断；",0,0,0,1,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0|主动段|FREQ56
1|正常对地运行|FREQ57
2|偏航机动|FREQ58
3|全姿态捕获|FREQ59
4|对地捕获|FREQ60
5|帆板未展开|FREQ61
6|轨控|FREQ62
7|无控|FREQ63
8|侧摆机动|FREQ64
9| 侧摆保持|FREQ65
11|入轨段控制|FREQ66
12|自旋模式|FREQ67
13|应急模式|FREQ68
14|星敏全姿态捕获模式|FREQ69
10|CMG启动模式|FREQ107

主动段工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定和姿态和轨道控制的如下所示
|模式字
|E
卫星轨道外推计算|√
GPS轨道计算|√
太阳星历计算|√
地面站位置计算|√
地磁场计算|√
偏流角计算|
岁差章动计算|√
陀螺数据处理|√
惯性姿态陀螺预估|√
对地姿态陀螺预估|
四元数陀螺预估|
红外输出的数据处理|√
太阳输出的数据处理|√
红外的姿态修正|
红外与太阳双矢量定姿|
红外太阳姿态修正|
星敏感器数据处理|
星敏感器A姿态修正|
星敏感器B姿态修正|
星敏感器C姿态修正|
星敏感器A、B姿态修正|
星敏感器A、C姿态修正|
星敏感器B、C姿态修正|
对地姿态修正及星敏粗姿态计算|
仅星敏感器A的姿态修正|
仅星敏感器B的姿态修正|
仅星敏感器C的姿态修正|
仅星敏感器AB的姿态修正|
仅星敏感器AC的姿态修正|
仅星敏感器BC的姿态修正|
侧摆目标姿态确定|
–Z轴捕获太阳及对日定向|
偏航捕获及转对地定向|
星敏感器全姿态捕获|√
姿态控制量计算|√
相平面法|√
姿态喷气控制|√
动量轮摩擦补偿计算|√
动量轮角动量保持的PI控制|√
动量轮启动与保持|√
正常飞行动量轮分配电压计算|
结构滤波器计算|
喷气卸载条件计算|
磁卸载控制|
CMG数据处理|√
CMG控制|
运行段帆板控制|
自主跟踪控制|
无控模式下太阳帆板控制|
数传天线指向控制|
偏置动量轮分配电压计算|
正常模式1N变轨|

在正常运行模式下主要有三种定姿方式：红外定姿、红外太阳定姿和星敏定姿。其中星敏定姿为高精度定姿方式。并可采用有陀螺和无陀螺方式，正常情况下为有陀螺。定姿方式的切换通过注入系统定姿方式字和系统故障诊断来实现切换。",0,0,0,1,0,0,0,0,0,0,0
功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测,0,0,0,0,0,0,1,0,0,0,0
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""
|复位初始化|FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""
",1,0,0,0,0,0,0,0,0,0,0
功能描述： 对部件电源加断电,0,0,0,0,0,0,0,1,0,0,0
"功能描述：设置2类慢帧遥测数据下传顺序
触发条件：模式字改变、数据指令",0,0,0,0,0,0,0,0,0,0,1
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。。为保证帆板LTU线路归零指令的成功执行，要求应用软件连续3个周期对帆板LTU线路发送归零指令。",0,0,0,0,0,0,0,0,1,0,0
功能：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
功能描述：在正常模式中，利用1N推力器实现小推力变轨功能。,0,1,0,0,0,0,0,0,0,0,0
"控制计算机有实时遥测数据和延时遥测数据。包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包|FREQ7.3.1
|发送敏感器数据包1|FREQ7.3.2
|发送敏感器数据包2|FREQ7.3.3
|发送红外太阳修正数据包|FREQ7.3.4
|发送敏感器修正数据包|FREQ7.3.5
|发送姿态控制数据包|FREQ7.3.6
|发送轨道数据包|FREQ7.3.7
|发送天线数据包|FREQ7.3.8
|发送部件工作状态数据包|FREQ7.3.9
|发送星敏感器自检数据包|FREQ7.3.10
|发送系统工作状态包|FREQ7.3.11
|发送全姿态捕获模式状态数据包|FREQ7.3.12
|发送控制模拟量遥测数据包1|FREQ7.3.13
|发送控制模拟量遥测数据包2|FREQ7.3.14
|发送控制分系统延时遥测数据包|FREQ7.3.15

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：选择星敏感器有效数据进行几何姿态确定，并在星敏无效情况下并采用陀螺数据进行姿态预估。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：OBC在CAN总线中断中接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,0,0,0,1
"功能：利用星敏感器A、B的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
轨道计算包括卫星轨道和太阳方位计算、中继卫星轨道计算；GPS计算包括GPS数据转换为轨道平根数计算、GPS平根数数据转换为外推轨道数据计算；地磁场计算为通过轨道外推数据计算地磁场矢量分量。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：发送AOCC时间
处理：
CTU复位后需要从AOCC恢复重要数据和星上时间。首先CTU发送“接收用于做时间差值的时间码”指令，将CTU目前的时间发送给AOCC。AOCC将星上时间和接收到的CTU时间做差值处理，将AOCC时间-CTU时间保存。CTU在1s后发送“发送时间差值”指令，AOCC将保存的时间差值发送给CTU。",0,0,0,0,0,0,0,0,0,1,0
功能描述：根据给定电压乘电压/力矩系数和角动量变化率之差判断轮子的故障。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：判断陀螺的使用范围。
",0,0,0,0,0,0,1,0,0,0,0
功能描述：检测红外的故障，并选取正确的红外信号。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：利用太阳敏感器信息，进行太阳捕获，对太阳定向
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据CMG输出数据和理论数据进行CMG故障检测。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
输入：
数传天线(j=1,2)跟踪地面站编号i，跟踪起始时刻ti，地面站i在惯性系指向，被数传天线(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线(j=1,2)跟踪的地面站i的矢量在本体系的表示。（i可为1~7）。",0,1,0,0,0,0,0,0,0,0,0
OBDH分系统每8分钟给AOCC校时一次。,0,0,0,0,0,0,0,0,0,1,0
功能描述：接收OBDH时间数据,0,0,0,0,0,0,0,0,0,1,0
"功能描述、输入、输出、计算公式见《用户需求》4.7.1~4.7.4。
序号|功能点编号|功能描述|说明
|FREQ3.4.9.1|轨控开关机|《用户需求》4.7.1
|FREQ3.4.9.2|轨控发动机选择A|《用户需求》4.7.2
|FREQ3.4.9.3|轨控发动机选择B|《用户需求》4.7.3
|FREQ3.4.9.4|轨控发动机选择C|《用户需求》4.7.4
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如表 43所示：
表 43：对应矢量字各个请求编码的条件
服务编码|发送的条件
0000|无服务请求
bit0=1|申请传送AOCC重要数据
bit0=0|无AOCC重要数据服务请求
bit1=1|申请传送OBDH时间
bit1=0|无OBDH时间服务请求
bit2=1|AOCS应急控制标志有效
bit2=0|AOCS应急控制标志无效
bit3=1|AOCC硬件状态数据状态准备好
bit3=0|AOCC硬件状态数据状态未准备好
bit4=1|AOCC内存数据状态为准备好
bit4=0|AOCC内存数据状态为未准备好
bit8=1|AOCC黑匣子数据状态为准备好
bit8=0|AOCC黑匣子数据状态为未准备好
",0,0,0,0,0,0,0,0,0,0,1
光行差修正的初始设置为：AOCC应用软件对APS星敏信息进行补偿计算，不向星敏发送相对J2000的时间和速度。,0,0,0,0,0,0,0,0,1,0,0
功能描述：三轴喷气姿态控制。,0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""",1,0,0,0,0,0,0,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）AOCC有四个帆板LTU，左右各两个，互为备份。根据ZT17选择要参与通讯的帆板LTU，向选择的帆板LTU发送取数指令。
ZT17|帆板LTU|取数指令
0（左右帆板驱动电机都用主份）|帆板2主份LTU|93H
0（左右帆板驱动电机都用主份）|帆板1主份LTU|B3H
1（左用主份，右用备份）|帆板2主份LTU|93H
1（左用主份，右用备份）|帆板1备份LTU|C3H
2（左用备份，右用主份）|帆板2备份LTU|A3H
2（左用备份，右用主份）|帆板1主份LTU|B3H
3（左右都用备份）|帆板2备份LTU|A3H
3（左右都用备份）|帆板1备份LTU|C3H
4（根据LTU故障诊断的结果自主选取）|初始为帆板2主份LTU，帆板1主份LTU|93H（或A3H）和B3H（或C3H）

其中上行注入中左右帆板、LTU协议中的帆板1、2LTU、用户需求中转角，和+Y、-Y轴上的帆板的对应关系如下：
上行注入|LTU通讯协议|用户需求
左|帆板2|-Y
右|帆板1|+Y

（2）获得帆板LTU返回的3字节数据，将数据根据LTU通讯协议转换帆板转角，。
（3）帆板LTU数据采集过程中的故障处理见本文的.1。",0,0,0,0,0,0,0,0,1,0,0
功能描述：发送控制系统星历数据。,0,0,0,0,0,0,0,0,0,0,1
"功能：利用星敏感器B的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：计算地磁场矢量分量。,0,0,0,0,1,0,0,0,0,0,0
"软件需求名称：接收总线指令 
需求类别：其他 
软件需求描述：接收并处理总线指令。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得9个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据，AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|功能及处理描述
|数字太阳数据的采集与处理|FREQ1.1|""选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
""
|模拟太阳数据的采集与处理|FREQ1.2|""选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
""
|01太阳数据的采集与处理|FREQ1.3|""选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
""
",0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：星时获取 
需求类别：其他 
软件需求描述：计算星上星时。
处理：
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。 ",0,0,0,0,0,0,0,0,1,0,0
功能描述：发送姿态控制数据包1,0,0,0,0,0,0,0,0,0,0,1
"    各个模式切换的功能点列表如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ5.1.0|4|主动段模式切换条件判断及转出设置
|入轨段控制模式切换|FREQ5.1.1|4.1|入轨段控制模式切换条件判断及转出设置
|正常对地运行模式切换|FREQ5.1.2|4.2|正常对地运行模式切换条件判断及转出设置
|点对点机动模式切换|FREQ5.1.3|4.3|点对点机动模式切换条件判断及转出设置
|姿态/角速度预置模式切换|FREQ5.1.4|4.4|姿态/角速度预置模式切换条件判断及转出设置
|偏置飞行模式切换|FREQ5.1.5|4.5|偏置飞行模式切换条件判断及转出设置
|匀地速跟踪模式切换|FREQ5.1.6|4.6|匀地速跟踪模式切换条件判断及转出设置
|角速度跟踪模式切换|FREQ5.1.7|4.7|角速度跟踪模式切换条件判断及转出设置
|轨控模式切换|FREQ5.1.8|4.9|轨控模式切换条件判断及转出设置
|全姿态捕获模式切换|FREQ5.1.9|4.10|全姿态捕获模式切换条件判断及转出设置
|无控模式切换|FREQ5.1.10|4.11|无控模式切换条件判断及转出设置
|测试与标定模式切换|FREQ5.1.11|4.8|测试与标定模式切换条件判断及转出设置

切换条件具体见用户需求4。CCU切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：
  读入串口数据，将太阳敏感器数据转化为浮点数，将陀螺数据转化为浮点数，结合陀螺故障顶替标志，计算姿态信息（功能编号：FReq-2）。
处理： 
考虑到可靠性，为便于地面观察，程控期间也遥测姿态信息，本节输入处理功能可于每个控制周期执行，运行模式的制约。
（1）DSS数据处理（太阳数据处理时，监视码门槛值取值为0x16）
根据粗码、细码信息，将太阳敏感器数据转化为浮点数，并计算姿态信息：
IF1 SP61/62 = 1
	 ELSE1
	IF2 bbMode = M（巡航）
	ELSE2
	END2
END1
对太敏S61和S62的输入数据进行跳数判断，并影响推力器判断，具体逻辑见任务书5.4.5.2节。
（2）陀螺角速度数据处理
将获取的陀螺角速度信息转化为浮点数，写入wx、wy、wz、ws
结合故障陀螺顶替（陀螺顶替标志bSrepXYZ由程控结束时的陀螺健康字以及陀螺故障诊断信息确定，初始化陀螺不需要顶替）信息，计算陀螺角速度。
如果顶替x轴陀螺
则  wx=wy+wz-1.732*ws
否则 如果顶替y轴陀螺
则  wy=wx-wz+1.732*ws
否则 如果顶替z轴陀螺
则  wz=wx-wy+1.732*ws
否则 不处理
计算陀螺角度积分,并限在(-360, 360)之间；
（3）解析动量轮转速、方向、加电状态等信息。",0,0,0,0,0,0,0,0,1,0,0
功能描述：入轨段初始化,0,0,0,1,0,0,0,0,0,0,0
功能描述：将GPS轨道参数转换成16个轨道参数,0,0,0,0,1,0,0,0,0,0,0
功能描述：计算得到的控制电压输出给动量轮。,0,0,0,0,0,0,0,1,0,0,0
"功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：三轴稳定模式下，检测系统故障。
处理：
（1）基本处理
将系统故障打分FSY限幅到[7，]。
（2）FSY加减分
条件|FSY的处理
（红外输出有效），ZT3≠C(用星敏感器+陀螺定姿，且接入控制回路)，ZT3≠A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式)，|FSY加一分
（红外输出有效），ZT3≠C(用星敏感器+陀螺定姿，且接入控制回路)，ZT3≠A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式),{或}|FSY减一分
（红外输出有效），ZT3=C(用星敏感器+陀螺定姿，且接入控制回路)或ZT3=A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式)，|FSY加一分
（红外输出有效），ZT3=C(用星敏感器+陀螺定姿，且接入控制回路)或ZT3=A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式),{，}|FSY减一分
或或，FGF=1|FSY减一分
或或，FGF≠1|FSY减4分
，FSTD>1，且{（且）或ZT5=0}|FSY加4分

处理FSY,ZT3,AttTurnFlag和
条件|FSY的处理
C，A，BZ5连续239次为0|FSY=1
，FSTD连续954次为1,ZT5=0|FSY=1
，FSTD连续954次为1,|""FSY=
ZT3=3,；AttTurnFlag=1""
A，FSTD连续250次为1|FSY=1
，FSTD≠1|AttTurnFlag=0
FSY≤64H,ZT3=C,ZT5≠0|""FSY=
ZT3=3,；AttTurnFlag=1""
，AttTurnFlag=1，ZT41[2]=1允许自主由红外转回星敏定姿时，若连续120次(且，且)|，AttTurnFlag=0

(4) 若ZT226，FSY07，ZT8 =F，ZT9 =F，则ZT8=0,ZT9=0,BZ7=Jeti2。
（5）根据FSY的结果和ZT22、ZT8、ZT9对BZ1进行处理
条件|BZ1的处理
ZT226，FSY07且ZT8  3，ZT9  3|BZ1 = 3
ZT226，FSY07且ZT8  4或ZT9  4|BZ1 = 7

（6）根据FSY的结果和ZT22、ZT8、ZT9以及BZ7重置BZ7
条件|BZ7的处理
ZT226，FSY07且ZT8 = 0（可自主切换主备份姿控发动机），BZ7=1（可用姿轨控主份推力器）|BZ7 = 2
ZT226，FSY07且ZT8 = 0，BZ7=3（可用姿轨控主份及备份推力器）|BZ7 = 2
ZT226，FSY07且ZT8 = 0，BZ7=2（可用姿轨控备份推力器）|BZ7 = 1

（7）若ZT226，FSY07，ZT43[4]=1允许自主给陀螺加电，则陀螺自主加电。
（8）若ZT226，FSY07，ZT44[4]=0，FlagWHCtl=A或ZT3=B，则FlagWHCtl=5;ZT3=3;ZT8=0;BZ7=Jeti;陀螺漂移赋值；Ix,Iy,Iz,Ihx,Ihz清0。
（9）指定FlagAttTurnIres=0后，系统不使用红外进行姿态监视，仅根据有效红外进行姿态修正。",0,0,0,0,0,1,0,0,0,0,0
"功能描述：利用数字太阳敏感器修正姿态，估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：内存下传 
需求类别：其他 
软件需求描述：依据指令下传指定内存数据。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：视线目标的姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星对地姿态。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|数字太阳数据的采集与处理|FREQ1.1.1|""数字太阳LTU取数指令
""|数字太阳角度和视场码DSS1输出滚动方向角度，DSS2输出俯仰方向角度|在通讯允许的条件下（当班标志为1），每周期向数字太阳LTU发取数指令，获得数字太阳数据并处理成滚动方向和俯仰方向角度以及相应的视场码。
|模拟太阳数据的采集与处理|FREQ1.1.2|""模拟太阳LTU取数指令
""|模拟太阳角度和视场码|每周期无条件的向模拟太阳LTU发取数指令，获得模拟太阳数据并处理成对应的角度。 
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：利用估计的四元数转换姿态角，送给星敏感器的四元数。

",0,0,1,0,0,0,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得9个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据， AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。具体如下表所示： 
GROLTUSeltFlag|进行通讯的陀螺LTU
01H|陀螺LTU1
02H|陀螺LTU2
03H|陀螺LTU3
其它|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1

取数指令由三个字节组成：
第一个字节为对陀螺LTU的命令设置，有四种命令格式：取数指令1、取数指令2、复位指令、地检模式指令，应用软件只自主发取数指令1和取数指令2两种格式，并由注入控制方式指定及LTU通信选择块中的陀螺LTU取数方式来切换，默认为取数指令1；其余两种格式（复位指令和地检模式指令）通过地面注入LTU命令块来设置。
第二个字节为对光纤陀螺的命令设置，有四种命令格式：测量模式1（有温度补偿）、测量模式2（无温度补偿）、地检模式1（只传地面数据）、地地检模式2（地面数据+头部测量数据），由注入控制方式指定及LTU通信选择块中的光纤陀螺指令切换方式字来切换这四种格式，默认为测量模式1（有温度补偿）。
第三个字节为前两个字节的累加和。
另外，每个控制周期AOCC还向选取的陀螺LTU发送取陀螺状态指令，指令为3字节指令（D5、AA、7F），得到的状态信息用于遥测。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式，具体参见LTU通讯协议。
（3）陀螺LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：选择通讯的LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）甚高精度星敏共有1个LTU，AOCC每个控制周期根据注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中是否通讯的甚高精度星敏LTU发送取数指令。
（2）向甚高精度LTU发送完取数指令后，获得甚高精度星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
功能描述：进行部件通讯与选用、数据采集与处理、自检与校时。,0,0,0,0,0,0,0,0,1,0,0
"功能描述：采集22路数字太阳粗码、监视码和全开码。
处理：
采集方法：连续采集28路（中间有细码信息，处理时略过），采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,0,0,0,1,0,0
功能描述：AOCC收到CTU发来的“记录AOCC时间数据”消息后应在900ms内准备好AOCC 时间数据。CTU发出“记录AOCC时间数据”1s后读取该数据。,0,0,0,0,0,0,0,0,0,0,1
"序|需求名称|编号|功能及处理描述
|加电状态的采集与处理|FREQ7.1|从SDC获取部件供电状态信息
|切换指令的处理|FREQ7.2|发送SDC指令。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在AOCC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ61|初始化|与一体化太阳通信协议
FREQ62|数太使用要求|任务书、数太协议
FREQ63|通信|任务书、数太协议
FREQ64|通信故障处理|任务书
FREQ65|数据解包与转换|数太协议
FREQ66|数太数据有效性判断、处理|任务书
FREQ67|数太模拟量采集、处理|预留
FREQ68|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
功能描述：根据方向余弦阵计算姿态角,0,0,1,0,0,0,0,0,0,0,0
"功能描述：进行模式初始化。
处理：
（1）置帆板归零； 
（2）置 ===0；=0;= 0；",0,0,0,1,0,0,0,0,0,0,0
功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：接收GPS数据、接收积分时间、AOCC姿态数据、相机测温参数
处理：将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据和轨道数据的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。",0,0,0,0,0,0,0,0,0,1,0
功能描述：确定陀螺数据的有效性。,0,0,0,0,0,0,1,0,0,0,0
功能描述：根据太阳矢量在帆板1法平面内投影与帆板法线之间的夹角，通过帆板驱动机构1控制帆板1，使帆板1能捕获及跟踪太阳。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：与动量轮通信，输出本周期电压。采集动量轮电源状态、转速、模拟量等信息。
处理：
功能编号|功能|引用文档|备注
FREQ57|动量轮初始化|任务书|B
FREQ58|动量轮数据采集|任务书|B
FREQ59|通信(DA输出、脉冲输入)|任务书|B
FREQ60|数据解包与转换|任务书|B
",0,0,0,0,0,0,0,1,0,0,0
功能描述：根据位置速度计算轨道参数,0,0,0,0,1,0,0,0,0,0,0
"功能描述：利用磁强计定姿数据进行卫星姿态捕获，恢复正常姿态。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据星敏感器故障标志、星敏感器有效数据判断标志（由星敏感器数据包给出，（包括状态字b27、同步脉冲计数值、数据产生相对时间、姿态四元数信息等）），判断星敏感器数据有效性。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：利用星敏感器B的测量，修正姿态四元数与估计角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：仅利用星敏感器B、C的测量，修正姿态四元数与姿态角速度移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据红外信息，将卫星控制在正常飞行姿态
",0,0,1,0,0,0,0,0,0,0,0
功能描述： GPS定轨主程序，包括GPS数据有效、无效时的操作。,0,0,0,0,1,0,0,0,0,0,0
功能描述：帆板未展开模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：确定ASS21,ASS22,ASS31,ASS32及帆板角度传感器等的信号选取。",0,0,0,0,0,0,1,0,0,0,0
功能描述：校正星上星时。,0,0,0,0,0,0,0,0,1,0,0
"|需求名称|编号|输入章节号|功能描述
|卫星轨道参数外推计算|FREQ2.0|5.1.1|实时计算卫星轨道参数。
|轨道外推根数获取与星历计算|FREQ2.1|5.1.2|岁差章动计算、GPS 轨道数据判断、太阳星历、地面站位置、地磁场强度计算
|GPS轨道数据有效性判断|FREQ2.2|5.1.2.2|对GPS轨道数据的有效性进行判断
|GPS 通道版和轨道版轨道计算|FREQ2.3|5.1.2.2.1和5.1.2.2.2|利用GPS 通道版和轨道版数据进行GPS 定轨程序
| 系的卫星位置及速度计算|FREQ2.4|5.1.2.5|将J2000 系的卫星位置与速度转换为WGS84 系的位置和速度
|近圆中低轨卫星轨道根数外推算法产品规范|FREQ2.5|/|规范化算法：
|近圆中低轨卫星GPS轨道计算算法产品规范|FREQ2.6|/|规范化算法：
|岁差章动矩阵计算算法产品规范|FREQ2.7|/|规范化算法：
|4阶星上地磁场计算方法算法产品规范|FREQ2.8|/|规范化算法：
|光行差计算算法产品规范|FREQ2.9|/|规范化算法：
|自主轨控计算及发送请求|FREQ2.10.0|5.1.2.6|根据实际与标称轨道参数计算轨控参数，并进行轨控申请
|自主轨控计算初始化|FREQ2.10.1|5.1.2.6.1|进行自主轨控远地点选取和轨控时间计算
|发送自主轨控请求|FREQ2.10.2|5.1.2.6.2|发送轨控加温请求，判断是否可以进行自主轨控
",0,0,0,0,1,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|功能描述|功能编号
0|主动段模式控制|FREQ6.1
1|入轨段消初偏模式控制|FREQ6.2
2|正飞模式控制|FREQ6.3
3|大角度机动模式控制|FREQ6.4
4|正常运行模式控制|FREQ6.5
5|轨控模式控制|FREQ6.6
6|SAR未展开模式控制|FREQ6.7
7|帆板未展开模式控制|FREQ6.8
8|偏置动量控制模式控制|FREQ6.9
9|全姿态捕获模式控制|FREQ6.10
A|应急安全模式控制|FREQ6.11
B|停控模式控制|FREQ6.12

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断见用户需求的3.3。",0,0,0,1,0,0,0,0,0,0,0
功能描述：模拟太阳故障状态。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：对磁力矩器电压一阶滤波。
",0,1,0,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
CMG 1数据的采集与处理|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 2数据的采集与处理|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 3数据的采集与处理|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 4数据的采集与处理|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 5数据的采集与处理|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 控制指令的输出处理|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
CMG的程序注入修改|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
CMG的内存下传|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,0,0,0,1,0,0
功能描述：发送红外太阳敏感器数据包,0,0,0,0,0,0,0,0,0,0,1
功能描述：星敏感器数据处理，安装偏差估计。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：执行偏航机动及返调至运行姿态
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP2：根据当前星时t的取值进行不同的处理：
STEP3：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：动量轮摩擦力矩的补偿电压计算
",0,1,0,0,0,0,0,0,0,0,0
"    各个模式切换的功能点列表如下： 
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ43.0|3.3.0|主动段模式切换条件判断及转出设置
|入轨消初偏模式切换|FREQ43.1|3.3.1|入轨消初偏模式切换条件判断及转出设置
|红外引入对地粗定向模式切换|FREQ43.2|3.3.2|红外引入对地粗定向模式切换条件判断及转出设置
|动量轮启动模式切换|FREQ43.3|3.3.3|动量轮启动模式切换条件判断及转出设置
|正常轨道运行模式切换|FREQ43.4|3.3.4|正常轨道运行模式切换条件判断及转出设置
|轨控模式1模式切换|FREQ43.5|3.3.5|轨控模式1模式切换条件判断及转出设置
|由正常姿态进行姿态机动模式切换|FREQ43.6|3.3.6|由正常姿态进行姿态机动模式切换条件判断及转出设置
|轨控模式2模式切换|FREQ43.7|3.3.7|轨控模式2模式切换条件判断及转出设置
|由轨控姿态机动回正常轨道运行模式切换|FREQ43.8|3.3.8|由轨控姿态机动回正常轨道运行模式切换条件判断及转出设置
|全姿态捕获模式切换|FREQ43.9|3.3.9|全姿态捕获模式切换条件判断及转出设置
|应急安全模式模式切换|FREQ43.10|3.3.10|应急安全模式模式切换条件判断及转出设置
|停控模式切换|FREQ43.11|3.3.11|停控模式切换条件判断及转出设置
|帆板未展开模式切换|FREQ43.12|3.3.12|帆板未展开模式切换条件判断及转出设置
|偏置动量控制模式切换|FREQ43.13|3.3.13|偏置动量控制模式切换条件判断及转出设置

切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据红外输初，计算太阳在本体坐标系中方位、姿态偏差、弦宽误差估计与量测新息。
输入：姿态估值 
	   红外数据有效性输出 ，
      红外常值偏差估值 ， (量纲：弧度)
红外数据有效性标志F_IresValid（由有效性判据给出）
输出的太阳方位",0,0,1,0,0,0,0,0,0,0,0
功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收AOCC系统注入参数
处理：
当收到接收遥控注入结束标识消息后，将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。只有当某个块类型的所有数据都收到，且每块数据的校验和都正确时，才能使用此种类型的注入数据。注入的数据具体见上行注入文件。需要注意的是：地面注入ZT9时：若ZT9中为1的个数小于3个，则不改变星上ZT9的取值；应用软件不响应ZT1=2、ZT1=6、ZT1=8的注入指令。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：各个模式的姿态和轨道控制。
处理：
定义星箭分离前为主动段工作模式（包括射前和主动段飞行状态），WorkMode=0。主动段工作模式下，应用软件进行下列工作：
星时计算；
数据采样，但无任何控制指令输出；
组帧遥测数据；
响应OBDH通讯命令；
在主动段查询星箭分离信号的有效性，确认依据为：读取2路星箭分离状态，若任意1路星箭分离为“已分离”状态，则认为本周期查到星箭已分离。如果在连续8个周期中至少6个周期都查到星箭已分离，则可确认为星箭已分离，进入入轨段模式，WorkMode =1。
通过注入在轨维护程序，实现部件测试功能。
模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。各个模式控制中调用流程和条件见用户需求4.1至4.14：",0,0,0,1,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ12|4.2.1|将陀螺有效输出数据，换算成卫星三轴角度增量
|欧拉角姿态预估|FREQ13|4.2.2|根据陀螺输出，预估卫星姿态和姿态角速度
|红外输出的数据处理|FREQ14|4.2.3.1|根据红外输入，计算姿态偏差、弦宽误差估计与量测新息
|太阳输出的数据处理|FREQ15|4.2.3.2|根据姿态估值与数字太阳输出，计算量测的一步预测与新息
|红外的姿态修正|FREQ16|4.2.4.1|根据红外输出，估计卫星姿态与陀螺漂移
|红外与数字太阳双矢量滤波姿态修正|FREQ17|4.2.4.2|利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差
|正常模式姿态四元数预估|FREQ18|4.2.5.1|姿态角速度与姿态四元数的预估，包括使用陀螺数据和不使用陀螺数据的姿态四元数预估
|星敏感器数据预处理与姿态修正|FREQ19|4.2.5.2|利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序
|星敏感器A、B姿态修正|FREQ20|4.2.5.3|利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移
|星敏感器A姿态修正|FREQ21|4.2.5.4|利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移
|星敏感器B姿态修正|FREQ22|4.2.5.5|利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移
|正常飞行模式的姿态角估计|FREQ23|4.2.5.9|利用估计的四元数转换姿态角
|由正常模式机动起始时刻的姿态四元数|FREQ24|4.2.6.1|为机动过程姿态确定提供初始姿态
|从偏置机动回正常模式时机动起始时刻的姿态四元数|FREQ25|4.2.6.2|为该机动过程姿态确定提供初始姿态
|机动过程与轨控模式的姿态确定|FREQ26|4.2.6.3|利用陀螺确定出卫星对目标的姿态四元数
|从偏置飞行机动回正常模式后的初始姿态换算|FREQ27|4.2.6.4|为正常模式姿态确定提供初始姿态
|计算星敏感器定姿需要的初始姿态|FREQ28|4.2.7|为星敏感器定姿提供初始的相对惯性的姿态四元数。
|红外与数字太阳双矢量定姿|FREQ29|4.2.8|利用红外、数字/太阳敏感器确定姿态
|星敏感器双矢量定姿|FREQ30|4.2.9|利用星敏感器A、B的测量，估计姿态
|不使用陀螺数据的星敏感器A、B姿态修正|FREQ87|4.2.5.6|利用星敏感器A、B的测量，修正姿态四元数
|不使用陀螺数据的星敏感器A姿态修正|FREQ88|4.2.5.7|利用星敏感器A的测量，修正姿态四元数
|不使用陀螺数据的星敏感器B姿态修正|FREQ89|4.2.5.8|利用星敏感器B的测量，修正姿态四元数
|红外差分姿态确定算法|FREQ90|4.2.10|无陀螺时用红外估计滚动、俯仰姿态角及角速度信息
|卫星跟踪姿态及对地表定向目标角计算|FREQ90.1|""4.2.13
4.2.13.1""|计算卫星正常对地跟踪姿态及对地表定向目标角
|偏航目标角计算|FREQ90.2|4.2.13.2|计算偏航跟踪目标姿态，实现帆板对日定向
",0,0,1,0,0,0,0,0,0,0,0
功能描述：姿态机动模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：卫星正常运行模式之一，完成在阳照区和非任务区的对日功能，保证星上能源。
处理：
该模式卫星正常在轨工作模式，入轨期间，CMG启动在满足一定的姿态条件后，由地面指令“允许转入对日定向模式”指令，控制星上模式由CMG启动模式转入对日定向模式。之后控制分系统按照地面规划的指令在轨道A、B、C、D四个点进行姿态机动来完成日地、地日、地地之间的姿态转换。辐射标定模式下的姿态固定，由数据指令控制进入标定模式。
在该模式下，控制系统根据数据块指令提供的开始和结束时间，开始、停止对指定天线控制角度进行计算，并0.5秒向天线发送一次控制指令每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺的数据处理；
调用四元数陀螺预估；
调用星敏感器数据处理；
调用利用星敏感器的姿态确定；
调用中继天线捕获跟踪控制；
调用对地数传天线捕获跟踪控制；
调用目标姿态确定；
调用控制器输入量计算；
调用喷气卸载条件计算；
调用CMG奇异状态的判断及算法计算；
if(UnLoadMode=0)
{调用CMG的控制；调用磁卸载控制；}
else {调用CMG启动与保持；
if(Flag_equation=0且TimeStopC<=0)调用相平面喷气脉宽；}
调用系统故障诊断；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内
    AOCC应用软件应对内存下卸的地址区域进行保护：当内存下卸指令中的首地址、末地址均在PROM硬件地址范围、RAM硬件地址范围、1553B总线接口芯片的RAM地址范围内，则应用软件按照内存下卸指令的要求下卸目标区域的数据；若内存下卸指令中的地址超出上述3个区域的地址范围，则应用软件不更新1553B总线接口芯片中内存下卸内容子地址中对应数据。",0,0,0,0,0,0,0,0,0,0,1
功能描述：根据帆板角误差、控制帆板跟踪太阳。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：利用估计的四元数转换姿态角。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：模式0切换方式。
处理：
一个控制周期内对星箭分离状态位读5次，若连续3次以上读入为“1”，则认为本周期查到星箭已分离，每次读的时间间隔要求大于1ms。如果在连续3个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入初始速率阻尼模式。
在主动段收到地面指令进入初始速率阻尼，进入初始速率阻尼模式。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：模式9切换方式。
处理：
由地面干预发送指令完成；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：动量轮启动的程控指令
      实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：， ，",0,1,0,0,0,0,0,0,0,0,0
"功能描述：当红外敏感器故障时，在太阳定向完成后，利用数字太阳与星敏感器信息，进行全姿态捕获，并建立正常姿态
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据框架角偏差计算指令转速。
处理：主要处理过程如下：
当接收到由OBDH发送来的中继快扫到位指令,进入天线预置状态，令FAFP=1，预置的目标角为命令块中的-10对应时刻通过轨道计算得到的天线框架角。控制中继天线转动快扫到达目标位置。当时间大于-10后，退出预置状态令FAFP=0。
当接收到由OBDH发送来的中继复位指令,进入天线复位状态，令FARP=1。根据命令块中数据标志来确定天线要复位的位置。如果标志为55H，天线复位到命令块中指定的角度位置；如果标志为FFH，则天线复位到零位。
当地面上行注入ZT40（1）=1时，天线进入螺旋扫描状态。按照特定的步长控制天线转动，当螺旋扫描持续的时间超过注入的天线捕获扫描时间时，将ZT40(1) 置0退出螺旋扫描状态。
当接收到由OBDH发送来的中继程序跟踪停止指令，停止向中继捕获跟踪控制单元发送控制信息，并设定标志传到遥测。其余情况下天线处于程序跟踪状态。
卫星增加了侧摆中继时传的工作模式，快摆时工作时序见任务书.5。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：选择通讯的星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。                                                                                                                                                                                                                                                                                                                                               处理：
（1）星敏共有三个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的星敏LTU发送取数指令。
（2）向选择的星敏LTU发送完取数指令后，获得星敏LTU返回的数据，将数据转换为所需的数据格式，具体参见星敏通讯协议
（3）星敏LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
功能描述：发送遥测数据,0,0,0,0,0,0,0,0,0,0,1
"功能描述：修正光行差量的计算。
处理：同用户需求的4.13。
STEP1：计算",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。CCU应用软件取数消息与同步消息的发送时间间隔大于3ms
|红外2数据的采集与处理|FREQ1.3.2|""红外2
LTU取数指令""|红外2的数据|在通讯允许的条件下（红外2的当班标志为1），向红外2 LTU发取数指令，获得红外2数据并处理成对应的数据。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据CMG输出数据和理论数据进行CMG故障检测。
处理：推力器喷气异常检测的阈值由10*mp改为20*mp。软件设计时应注意故障计数器值的设置和清除。喷管切换时不要清120秒累计喷气时间计数。",0,0,0,0,0,1,0,0,0,0,0
"功能描述：接收OBDH时间
处理：按接收OBDH时间命令存储地址中内容的数据格式处理成星时的数据格式。此处理在中断中进行。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：发动机关机中断信号处理                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：
应用软件处理发动机关机中断信号，信号源为3路伽玛关机信号，应用软件查到关机后，立触地关机标志有效，发7500N关机指令。",0,0,0,0,0,0,0,1,0,0,0
功能描述：发送模拟量遥测数据包2,0,0,0,0,0,0,0,0,0,0,1
功能描述：发送星敏感器数据包,0,0,0,0,0,0,0,0,0,0,1
"功能：姿态机动目标姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：完成遇有单翼帆板未展开时，抖动星体帮助帆板展开的功能。为了节省内存，将此模式的代码从PROM中去掉。若需要此模式，则通过在轨注入的方式，将此模式引入控制。
处理过程：过程如下：
STEP1：如果ZT1 = 5且ZT32 = A且C1 = A1则进行下列处理：
滚动通道每个采样周期中发喷气脉冲（主备份同时发）。其脉冲宽度序列为+0.131，-0.262，+0.262，-0.262，… ，-0.262，+0.262，-0.131，共计120个脉冲。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。
STEP2：如果ZT1 = 5且ZT32 = A且C1 = A2则进行下列处理：
俯仰通道每个采样周期中发喷气脉冲（主备份同时发）。其脉冲宽度序列为+0.131，-0.262，+0.262，-0.262，… ，-0.262，+0.262，-0.131，共计120个脉冲。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。
STEP3：如果ZT1 = 5且ZT32 = A且C1 = A3则进行下列处理：
偏航通道每个采样周期中发喷气脉冲（主备份同时发）。其脉冲宽度序列为+0.131，-0.262，+0.262，-0.262，… ，-0.262，+0.262，-0.131，共计120个脉冲。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。
STEP4：如果ZT1 = 5且ZT32 = A且C1 = FFFF则进行下列处理：
发四个轨控喷管同时工作的脉冲序列：脉冲宽度为0.262，0，0.262，0，… ，0.262，0，共计120个（包括宽度为0的脉冲）。。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：部件通讯选通
处理：
详见“任务书”5.1.2.2串口数据采集和处理的（一）部件通讯与选用。",0,0,0,0,0,0,0,0,1,0,0
功能描述：中继卫星轨道确定。,0,0,0,0,1,0,0,0,0,0,0
"模式字定义如下，装订值为0：
模式字|工作模式描述
0|主动段
1|正常对地运行
2|偏航机动
3|全姿态捕获
4|对地捕获
5|帆板未展开
6|轨控
7|无控
8|侧摆机动
9| 侧摆保持
10|CMG启动模式
11|入轨段控制
12|自旋模式
13|应急模式
14|星敏全姿态捕获模式

定义星箭分离前为主动段工作模式（包括射前和主动段飞行状态），BZ1=0。主动段工作模式下，应用软件进行下列工作：
星时计算；
数据采样，但无任何控制指令输出；
组帧遥测数据；
响应OBDH通讯命令；
仅在主动段查询星箭分离信号的有效性，确认依据为：一个控制周期读取3路星箭分离状态位，若3路中的2路读入为“1”，则认为本周期查到星箭已分离。如果在连续5个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入入轨段模式，BZ1=B。
通过注入在轨维护程序，实现部件测试功能，此功能仅在主动段模式下有效。
判别星箭分离后，应用软件开自锁阀3、5及1N推力器短期加温，并进入入轨段模式。
工作模式的转换可分为以下二种情况：
按地面上行注入进行转换：通过注入姿控数据块中的模式字进行转换；
按应用软件用户需求给定的条件判别，由软件自主控制转换：自主转换分两种：一种为正常运行转换；一种为故障时转换。下面分别进行说明
正常运行转换如下图所示：
正常运行自主转换如下表所示：条件标识原则：ZCCX—Y，其中ZCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。
标识|具体条件
ZCC0—B|星箭分离
ZCCB—1|Tin >4800 
ZCC1—2|
ZCC1—6|
ZCC1—8|且且且且
ZCC2—1|
ZCC2—6|
ZCC4—1|FEA=A
ZCC6—1|
ZCC6—2|)且
ZCC8—1|""满足下列条件之一：
且CBStyleFlag<2且且(
且连续次
且CBStyleFlag>1且且且)连续次
且""
ZCC8—9|""满足下列条件之一：
且CBStyleFlag<2且且
(
且)连续次
且CBStyleFlag>1且且且)连续次
且""
ZCC9—8|""满足下列条件之一：
且
""
ZCCA—1|""CMG_NewFault
且(max()<
且 ()<0.000262且 ()<0.017)连续次""

故障自主转换如下表所示：条件标识原则：GCX—Y，其中GCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。其中进入应急模式的条件为读到应急线路加电，记为GCC-D。其余的自主故障切换如下图所示：
故障条件定义如下：
标识|具体条件
GCC1—3|FailureFlag=1并且WacqSunorSTSModeFlag =0并且ZT7属于[1，4]区间内
GCC1—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC1—A|CMG_NewFault0且 1ZT14
GCC1—E|FailureFlag=1并且WacqSunorSTSModeFlag =1并且ZT7属于[1，4]区间内
GCC3—7|FailureFlag＝4且AutoInStopNum<2
GCC3—E|SMODE＝3且TSMODE>8000（若ZT11=4则取值为32000）
GCC4—1|FEA=A
GCC4—3|WacqUseIresOrSTSFlag=1且TCOUNT>24000
GCC5—3|脉冲发完后
GCC6—1|FailureFlag＝2且无机动要求
GCC6—2|FailureFlag＝2且无机动要求
GCC7—3|>6900 且AutoInStopNum<2且WacqSunFlag =0
GCC7—E|>6900 且AutoInStopNum<2且WacqSunFlag =1
GCC8—1|FailureFlag=3
GCC8—A|""满足下列条件之一：
CBStyleFlag=0，且CMG通讯故障计数器CMGComFailCnt[i] (i=1,2,3) >CMGErapolationNum为ZT14选定的CMG之一
CMG_NewFault且 1ZT14""
GCC9—3|FailureFlag=1并且WacqSunorSTSModeFlag =0并且ZT7属于[1，4]区间内
GCC9—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC9—A|CMG_NewFault且 1ZT14
GCC9—E|FailureFlag=1并且WacqSunorSTSModeFlag =1并且ZT7属于[1，4]区间内
GCCA—1|""满足下列条件之一：
>400且max()>0.08连续次
CMG_NewFault且>6000""
GCCB—3|FailureFlag=1并且ZT7属于[1，4]区间内
GCCB—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCCE—1|StarCatchFlag=1且(1-()<0.000685)且norm()<0.000875
GCCE—7|TCOUNT>31200或（FailureFlag＝4且AutoInStopNum<2）

AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据红外信息，作姿态滤波修正。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：处理广播的GPS数据
处理：解包广播的GPS数据，更新追踪器绝对GPS数据、目标器绝对GPS数据、追踪器和目标器的相对GPS数据",0,0,0,0,0,0,0,0,0,1,0
"功能描述：地地全姿态捕获模式控制
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：使用星敏感器B、C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续三个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是A090H或者校验和错误或者未收到重要数据），则应用软件按照重要数据的初始值运行。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：发送事件数据给OBDH保存
处理：将事件数据打包后放到事件数据内存地址空间中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：使用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：为三轴姿态喷气控制选择推力器,0,1,0,0,0,0,0,0,0,0,0
"功能描述：滚动通道喷气中断处理程序。
处理：将推力器1-8关掉",0,0,0,0,0,0,0,1,0,0,0
"软件需求名称：推力器控制 
需求类别：其他 
软件需求描述：根据控制律计算结果，驱动推力器，进行姿态控制。",0,0,0,0,0,0,0,1,0,0,0
功能描述：对弦宽、基准与给定的范围进行比较，同时根据太阳星历输出进行见太阳判断，确定红外输出的有效性。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：根据需求，计算去往小天区扫描模式机动过程中所需的目标姿态。
",0,0,1,0,0,0,0,0,0,0,0
CCU控制周期为125ms，对于BC端50ms通信同步服务，应用软件采用轮询方式查询帧序号，作为循环缓冲区子地址指针复位时判断使用。,0,0,0,0,0,0,0,0,0,1,0
功能描述：接收遥控固定参数注入块的中继天线系数,0,0,0,0,0,0,0,0,0,1,0
功能描述：自旋模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：发送星敏感器数据
处理：OBDH在每个遥测格式的第0帧，从AOCC接收8字节星敏感器数据。其处理过程如下：
STEP1：AOCC应用程序每0.524秒查询一次有无OBDH发送数据请求，如果有则转入第二步，否则退出；
STEP2：判别是否此时星上正在取新的星图，如果是则此次发送8字节固定数4444444444444444，否则转第三步；
STEP3：判别8颗星图（每个星图32字节）数据是否取完，如果没取完，则将取星图数据计数器加1，从规定的星图数据缓存区中取8个字节的数据放入OBDH规定的内存中；否则转第四步。
STEP4：将取星图数据计数器清0，星上开始取新的星图数据 。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：CAN通信上行/下行数据的组帧和解包。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：星务接收、星务发送、快帧遥测1打包、快帧遥测2打包、轨道参数注入快帧打包、内存下卸快帧打包、慢帧遥测1打包、慢帧遥测2打包、慢帧遥测3打包、姿控广播、热控温度广播、重要数据打包、上行:目标星轨道、上行:数据指令响应处理、上行:固定地址注入解包、上行:可变地址注入解包、上行:轨道注入解包、上行:程序注入、上行:内存下卸指令注入、上行:部件指令、上行:任务块、重要数据返回解包、GNSS定位广播解包、整星广播对时解包、GNSS高精度秒脉冲对时广播解包、CAN总线使用要求",0,0,0,0,0,0,0,0,0,0,1
"功能描述：使星体Z轴对日定向，适当时重捕地球。
处理过程：
(1)若星敏数据无效且FEA=0，则Ψ=0.12，调用“-Z轴对日定向”，BZ1=3；
(2)当FEA=0时；FM3②增加判断；
(3)当FEA=5时，其中姿态角的阀值增加调整系数。",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：CMG使用及通信 
需求类别：其他 
软件需求描述：输出CMG控制指令。
处理： 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
CMG初始化|FREQ61|CMG初始化|B|2
CMG数据采集|FREQ62|CMG数据采集|B|3
CMG数据解包与转换|FREQ63|CMG数据解包与转换|B|4
CMG指令输出|FREQ64|CMG指令输出|B|
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议。
功能编号|功能|引用文档
FREQ45|初始化|陀螺协议
FREQ46|陀螺使用要求|任务书
FREQ47|通信|陀螺协议
FREQ48|通信故障处理|任务书
FREQ49|数据解包与转换|陀螺协议
FREQ50|陀螺数据有效性判断、处理|任务书
FREQ51|陀螺模拟量采集、处理|任务书
FREQ52|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：与CMG通信，控制CMG并获得CMG数据。
处理：
功能编号|功能|引用文档
FREQ69|初始化|与CMG通讯协议
FREQ70|CMG使用要求|任务书
FREQ71|通信(串口)|与CMG通讯协议
FREQ72|通信故障处理|任务书
FREQ73|数据解包与转换|与CMG通讯协议
FREQ74|帆板数据有效性判断、处理|任务书
FREQ75|帆板模拟量采集、处理|任务书
FREQ76|部件在轨转发（在轨修改）|任务书
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：动量轮启动的程控指令
      实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：， ，
",0,1,0,0,0,0,0,0,0,0,0
"功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器B修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送应急控制器重要数据。
处理：将应急控制器重要数据按照协议打包发送至发送应急控制器重要数据地址中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测。
",0,0,0,0,0,0,1,0,0,0,0
"功能描述：使用星敏感器A、B的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：置卫星姿态无控，处于自由飞行状态。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送AOCC重要数据包
处理： AOCC在接收注入的重要数据快的同时将其存放在OBDH规定的内存中，AOCC不再进行单独处理。",0,0,0,0,0,0,0,0,0,0,1
"此章节01星为“发送AOCC中继事件数据”，现删除，替换为“发送AOCC数据段黑匣子数据”
功能描述：发送AOCC数据段黑匣子数据",0,0,0,0,0,0,0,0,0,0,1
CTU复位后需要从AOCC恢复重要数据和星上时间。首先CTU发送“接收用于做时间差值的时间码”指令，将CTU目前的时间发送给AOCC。AOCC将星上时间和接收到的CTU时间做差值处理，将AOCC时间-CTU时间保存。CTU在1s后发送“发送时间差值”指令，AOCC将保存的时间差值发送给CTU。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：计算小天区扫描模式下的目标姿态，并给出当前的扫描阶段：行扫中，转弯等。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：速率阻尼。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
",0,1,0,0,0,0,0,0,0,0,0
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续64个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是D090H或者校验和错误或者未收到重要数据），上电或者复位后的前126个周期内，连续79个控制周期星箭分离信号均有效，则卫星自主转全捕对日模式；否则应用软件按照重要数据的初始值运行。则应用软件按照重要数据的初始值运行。应用软件只有在判断到星上时间为超过1257秒时，以及重要数据均正确的情况下，才使用重要数据恢复模式。若取到的重要数据正确，但取到的星时小于1257s，则需按重要数据文件要求取星时错误的要求进行模式恢复。,0,0,0,0,0,0,0,0,0,1,0
"功能描述：模拟量遥测 
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：
  软件初始化结束后，开始进行各控制部件的初始化状态设置。
处理：（部件的开关 根据部件当前的加电状态、健康字进行，具体开关逻辑如下：） 
表5-1 程控流程
Ts周期（128ms）|操作内容|说明
""第0～78 Ts
(10s)""|""不控（10s）；
读取各部件加电状态及MRE重要数据；
判断ISU-C通讯状态：
累计健康次数大于等于5次，认为健康；否则为不健康；
说明：UPS健康字也在此期间读取，可进行滤波。""|""连续发送切换DPRU标志遥测数据；
等待DPRU通过1553B发送ISU-A、ISU-C的遥测数据；""
""第79～87Ts：
(1.024s)
""|""读取MRE重要数据(软件在程控期间读取2次即可)和模块加电状态：
发送SPE开关指令；
说明：为增加可靠性，软件中“发送SPE开关指令”操作2次。""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第88～198 Ts
(14.08s)""|""根据MRE重要数据和DPRU与当前份ISU-C通讯状态：（通过1553B总线向ISU-A发送下述指令）
开3+1S二浮陀螺X、Y、Z、S线路指令（无条件）；
2）开ISU-C指令（CIP）
（如果ISU-C通讯状态为不健康，则先关CIP-A/B，再根据MRE上CIP的健康状态，切换CIP）；""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第199～309 Ts：
(14.08s)""|""根据MRE重要数据和DPRU与当前份ISU-C通讯状态：（通过1553B总线向ISU-A发送下述指令）
开3+1S二浮陀螺X、Y、Z、S线路指令（无条件）；
2）开ISU-C指令（CIP）；
（如果ISU-C通讯状态为不健康，则先关CIP-A/B，再根据MRE上CIP的健康状态，切换CIP）；""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第310～419 Ts：
(14.08s)""|""根据MRE重要数据和ADIP、MPSDP、SADP的电源状态；（通过1553B总线向ISU-C发送下述指令）
开SADP指令；
开MPSDP指令；
说明：开SADP之前，先切换ADIP（根据供电关系）""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第420～529Ts：
(14.08s )""|""根据MRE重要数据和ADIP、MPSDP、SADP的电源状态；（通过1553B总线向ISU-C发送下述指令）
开SADP指令；
开MPSDP指令；
说明：开SADP之前，先切换ADIP（根据供电关系）""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第530～569Ts：
(5s)""|""根据MPSDP的电源状态；（通过1553B总线向ISU-C发送下述指令）
LV1/2开关指令；
MPSDP-A加电：开LV1；
MPSDP-B加电：开LV2；
双份加电：开LV1/2；
双份不加电：不操作""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第570～609s：
(5s)""|""根据MPSDP的电源状态；（通过1553B总线向ISU-C发送下述指令）
LV1/2开关指令；
MPSDP-A加电：开LV1；
MPSDP-B加电：开LV2；
双份加电：开LV1/2；
双份不加电：不操作""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；
""
第610～Ts：|空|
""第3910Ts：
（约500s）""|""置程控结束标志flgPCRun为TRUE；
模式初始化设置。""|参数设置

1）通用部件切换原则：A份健康开A份，A份不健康开B份；
2）MPSDP切换特殊原则：
      软件初始化5N推力器健康字时，是根据ISU-C送过来的5N推力器健康字来进行初始化；如果之后地面发送了设置5N推力器健康字遥控指令，则根据遥控指令来设置软件状态，同时将5N推力器健康字发送给ISU-C；
当两份MPSDP均健康时，根据5N推力器健康字状态：
如果两份健康字中有一份存在不健康的推力器，则开另一份；
如果两份健康字中均存在不健康的推力器，需要双份MPSDP加电。
3）MPSDP当班逻辑：
    MPSDP当班的逻辑在任务书的基础上进行适当完善：
如果两份健康字中均存在不健康的推力器，则A/B均当班；
单份加电，谁加电谁当班；
双分加电，默认A当班；	
若上电后双份均未加电，则按照MPSDP切换过程中开谁谁当班的原则。
4）ADIDP切换原则：
A份健康开A份，A份不健康开B份；
原则上不发ADIP关指令，如果双份均健康，则根据需要进行双份加电。
5）部件电源状态判断原则见任务书。
6）ISU-C二次电源供电：
ADIP-A供电给SADP-A、MPSDP-A、MPSDP-B；
ADIP-B供电给SADP-B、MPSDP-A、MPSDP-B；
7）程控期间，动量轮控制电压输出0V（数字量0x800）。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：根据姿态估值与数字太阳输出，计算量测的一步预测与新息，建立数字太阳输出的可用性标志。
输入： 5.2.14.3输出的
       姿态估值 
       数字太阳数据有效性标志F_Ds1Valid， F_Ds2Valid（由有效性判据给出）
      	  数字太阳敏感器输出：, (量纲：弧度)",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送星敏陀螺数据给OBDH保存
处理：将星敏陀螺数据打包后放到星敏陀螺数据内存地址空间中。
星敏陀螺数据组帧时，对本周期未取到星敏数据、陀螺数据的处理，以及校验和的计算方法与《 卫星控制分系统AOCC与数传分系统数据处理器通讯协议》文件中向数传分系统发送的星敏陀螺数据要求一致。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：
 从1553B接收遥控指令数据，进行指令处理（FReq-7）。
处理：根据收到的遥控指令执行按照、ISUA、ISUC进行分类处理，实现指令的处理或者转发。
指令转发前，进行指令的校验，校验通过后，方可转发。指令子单元的分类标识全为立即指令。
指令校验的原则是：校验和、RT地址、RT子地址、指令总长度、注入指令单元的类型识别字、指令序号、注入指令子单元的子单元类型识别字、分类标识、长度均正确；
遥控指令包含三种类型，具体如下：
（1） 切换ISU-C模块指令
指令功能：用于向ISU-C发送切换模块指令。
类型标识字：C300H
指令码长度：216bit
指令码定义及说明：指令码高有效字在前，指令码低有效字在后。
ISU-C注入间接指令32位指令码定义
序号|指令名称|32位指令码
序号|指令名称|功能数据
序号|指令名称|D23～D0（16进制表示）
序号|指令名称|D11～D0
|SADP-A开|0X 000
|SADP-A关|0X 001
|SADP-B开|0X 002
|SADP-B关|0X 003
|MTP-A开|0X 004
|MTP-A关|0X 005
|MTP-B开|0X 006
|MTP-B关|0X 007
|MPSDP-A接A份电源|0X 008
|MPSDP-A接B份电源|0X 009
|MPSDP-B接A份电源|0X 00A
|MPSDP-B接B份电源|0X 00B
|MPSDP-A关|0X 00C
|MPSDP-B关|0X 00D
|LV1开|0X 00E
|LV1关|0X 00F
|LV2开|0X 010
|LV2关|0X 011
|ISU-A DC/DC1加电|0X 012
|ISU-A DC/DC1断电|0X 013
|ISU-A DC/DC2加电|0X 014
|ISU-A DC/DC2断电|0X 015
|ISU-A 主供电接DC/DC1备供电接DC/DC2|0X 016
|ISU-A 主供电接DC/DC2备供电接DC/DC1|0X 017
|ISU-A甲机复位|0X 018
|ISU-A乙机复位|0X 019

类别：01代表指令当量为16ms；10代表指令当量为64ms，MEO卫星指令类型全为01。
脉宽：指令实际脉冲宽度=（脉宽数值+1）*指令当量；
MEO卫星离散开关指令脉冲宽度默认为7（128ms）；指令宽度可随实际需要更改。
指令码高有效字对应上表D31~D16；指令码低有效字对应上表D15~D0。
（2） 切换控制部件指令
指令功能：用于向ISU-A发送切换控制部件指令。
类型标识字：C311H
指令码长度：116bit
指令码定义及说明：
定义
D7~D0
指令码

此指令专门用于CMU应用软件转发的开关控制分系统部件的时标指令。文中的8位指令码定义如下：
表4-8 ISU-A注入间接指令码列表
序号|指令名称|指令码
|地球敏感器A开|0x 50
|地球敏感器A关|0x 4F
|地球敏感器B开|0x 52
|地球敏感器B关|0x 51
|Z2陀螺开|0x 31
|Z2陀螺关|0x 32
|Z3陀螺开|0x 33
|Z3陀螺关|0x 34
|GX电源开|0x 35
|GX电源关|0x 36
|GY电源开|0x 37
|GY电源关|0x 38
|GZ电源开|0x 39
|GZ电源关|0x 3A
|GS电源开|0x 3B
|GS电源关|0x 3C
|反作用轮A开|0x 2E
|反作用轮A关|0x 2F
|反作用轮B开|0x 49
|反作用轮B关|0x 4A
|反作用轮C开|0x 4B
|反作用轮C关|0x 4C
|反作用轮D开|0x 4D
|反作用轮D关|0x 4E
|ISU-C 驱动线路主份电源开|0x 67
|ISU-C 驱动线路主份电源关|0x 68
|ISU-C 驱动线路备份电源开|0x 61
|ISU-C 驱动线路备份电源关|0x 62
|ISU-C CIP主份线路电源开|0x 65
|ISU-C CIP主份线路电源关|0x 66
|ISU-C CIP备份线路电源开|0x 63
|ISU-C CIP备份线路电源关|0x 64
|CMU SPE-A开|0x 57
|CMU SPE-A关|0x 58
|CMU SPE-B开|0x 59
|CMU SPE-B关|0x 5A

说明：此36条指令脉宽均为128ms，脉宽由ISUA保证。
（3） 控制模式转换指令
指令功能：此指令用于控制模式转换。
类型标识字：C322H
指令码长度：116
指令码定义及说明：
指令码|定义
方式字|定义
00H|捕获模式——速率阻尼方式
04H|停控模式

（4） 5N推力器健康状态设置指令
指令功能：设置5N推力器健康状态
类型标识字：C333H
指令码长度：216
指令码定义及说明：
推力器健康状态设置高16位D31~D16在前，
推力器健康状态设置低16位D15~D0在后。
D31~ D0定义如下：
D31|D30|D29|D28|D27|D26|D25|D24
0|0|0|0|0|0|0|0
D23|D22|D21|D20|D19|D18|D17|D16
0|0|JK-6A|JK-5A|JK-4A|JK-3A|JK-2A|JK-1A
D15|D14|D13|D12|D11|D10|D9|D8
0|0|0|0|0|0|0|0
D7|D6|D5|D4|D3|D2|D1|D0
0|0|JK-6B|JK-5B|JK-4B|JK-3B|JK-2B|JK-1B

注：健康标志位为0表示对应推力器健康，健康标志位为1表示对应推力器不健康。将推力器设置为健康，可以使其上线；将推力器设为不健康，可以使其离线。推力器上线后方可被开启，推力器离线后不能被开启。当接收到此指令时，须同时把上述信息以MPS配置信息的形式发送给ISU-C（通过DPRU转发）。
（5） 控制部件健康字设置指令
指令功能：更改部件健康字
类型标识字：C344H
指令码长度：216
指令码定义及说明： 设置状态在前，部件标识在后。
设置状态：取值为0x0000时设置为健康，取值为0x5A5A时设置为不健康；
部件名称及标识见下表分配值：特别当编号为0xFFFF时，表示选择下表所有部件。例如，当设置状态为0x0000，部件编号为0xFFFF时，设置下表所有部件健康。
序号|部件名称|标识|部件编号
1|X陀螺|GA-X|0x0101
2|Y陀螺|GA-Y|0x0202 
3|Z陀螺|GA-Z|0x0303 
4|S陀螺|GA-S|0x0404 
5|喷气控制线路主份|MPSDP-A|0x0707 
6|喷气控制线路备份|MPSDP-B|0x0808 

(6) 控制标志字设置指令
指令功能：设置部件或者控制标志字	
类型标识字：C355H
指令码长度：216
指令码定义及说明： 
标志字识别码在前，标志字指令内容在后。
更改的标志字的内容16位二进制码，具体内容定义：
序号|标志字识别码|指令内容定义|对应符号
标志字1|0x0101|""0：S陀螺顶替X陀螺；
1：S陀螺顶替Y陀螺；  
2：S陀螺顶替Z陀螺；
3：禁止顶替。""|
标志字2|0x0202|""0：A分支推力器工作；
1：B分支推力器工作；  
2：双分支推力器工作。""|
标志字3|0x0303|""0：不允许推力器故障判断；
A：允许推力器故障判断。""|
标志字4|0x0404|""0：不允许二浮陀螺故障判断；
A：允许二浮陀螺故障判断。""|
标志字5|0x0505|""0：设置推力器未发生切换；
A：设置推力器已发生切换。""|任务书中推力器故障诊断中的 flgSwitch
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：计算卫星对规划目标的姿态四元数和控制量。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：复位模式处理
处理：
- 采集陀螺、红外、太阳敏感器数据；
- 继续与ALTU通讯（控制量都为0，无控制指令）；
- 响应除“重要数据保存”的所有星务遥控及遥测；
- 不查询应急加电标志，不保存APP_WorkMode1/2/3变量；
",1,0,0,0,0,0,0,0,0,0,0
"上行注入功能是地面干预星上运行状态的重要手段，主要是指OBDH通讯协议中定义的控制分系统“接收遥控注入数据”功能。上行注入数据块由地面发送到OBDH分系统，再由OBDH分系统通过B总线发送到AOCC执行。包括下表的功能点。
序号|功能描述|功能编号
|接收数据指令注入|FREQ7.8.1
|接收固定参数注入|FREQ7.8.2
|可变地址注入|FREQ7.8.3
|轨道参数注入|FREQ7.8.4
|程序修改注入|FREQ7.8.5
|星敏感器指令注入|FREQ7.8.6

具体的内容见注入文件。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：偏航捕获模式控制
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。",0,0,0,1,0,0,0,0,0,0,0
功能描述：太阳数据处理,0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收遥控固定参数注入块的地面站位置信息功能区数据
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器A修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：CAN通信上行/下行数据的组帧和处理。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：遥测组帧、遥控接收、遥测帧头打包、遥测数据打包、下行：重要数据组帧、上行：数据指令处理、上行：模式转换指令处理、上行：软件标志字指令处理、上行：控制参数指令处理、上行：变轨和位保指令处理、上行：部件加断电指令处、上行：校时指令处理、上行：轨道注入指令处理、上行：部件数据转发指令处理、在轨维护指令处理、重要数据保存、重要数据恢复",0,0,0,0,0,0,0,0,0,0,1
功能描述：太阳全姿态捕获模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：二次电源切换。
处理：
ACU内部含有两套二次电源，两套互为备份，可以同时加电工作，通常仅一份工作。AOCC每个控制周期采集工作电源的状态模拟量，并设置当班状态（若某份的5V和12V遥测模拟量均≥2V则当班，若主备二次电源同时符合加电条件则置主份当班）。
若当班电源的5V或12V遥测模拟量连续5个控制周期<2V时，且允许ACU二次电源自主切换，则先发送另一份电源开、隔两个控制周期后再发送本电源关指令，并禁止ACU二次电源自主切换。。
上电/复位初始化为允许自主切换，主份当班。",0,0,0,0,0,0,0,1,0,0,0
功能描述：三轴稳定模式下的帆板控制。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺数据采集在BZ8=5（轨控模式轨控期间、帆板未展开模式和全姿态捕获模式太阳捕获期间）的采样周期为0.262秒，其余模式的采样周期为0.524秒。
（2）陀螺共有三个互为备份的LTU，通过每个LTU均可获得六个陀螺的数据；AOCC向陀螺LTU发送取数命令1和取数命令2来获得数据，其中取数命令1有两个字节，取数命令2有一个字节；只有取数命令1通讯不成功时才发取数命令2。AOCC根据ZT14（4）（3）来确定和哪个LTU进行通讯，同时确定通道选择号和取数命令1和取数命令2的第一个字节。 
ZT14(4)(3)的值|进行通讯的陀螺LTU|取数命令1和命令2
01|陀螺LTU1|53H和5CH
10|陀螺LTU2|63H和6CH
11|陀螺LTU3|73H和7CH
00|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1|53H（或63H或73H）和5CH（或6CH或7CH）

（3）AOCC根据ZT15、ZT16确定要采集哪几个陀螺的数据（加电的陀螺），即决定取数命令1中的第二个字节（工作陀螺编码字节）的低6位，。ZT15、ZT16与第二个字节的对应关系如下：
取数命令1的第二个字节
D0
ZT15（1）

（4）将陀螺LTU返回的数据根据LTU通讯协议中的计算公式转换为陀螺的角度增量（弧度）。根据ZT46、ZT47确定当前引入陀螺。
（5）陀螺LTU数据采集过程中的故障处理见本文的.1。",0,0,0,0,0,0,0,0,1,0,0
功能描述：计算太阳星历、红外补偿量及光行差计算。,0,0,0,0,1,0,0,0,0,0,0
功能描述：星上自主检测动量轮故障。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：与帆板通信，控制帆板并获得帆板状态数据。
处理：
功能编号|功能|引用文档|备注
FREQ46|帆板初始化|帆板协议|B
FREQ47|帆板数据采集|任务书、帆板协议|B
FREQ48|数据解包与转换|帆板协议|B
FREQ49|帆板数据有效性判断、处理|任务书|B
FREQ50|帆板控制量输出|帆板协议|B
FREQ51|帆板故障重构|任务书|B
",0,0,0,0,0,0,0,1,0,0,0
"包括下表的功能点。
序号|功能描述|功能编号
|从ICU接收控制计算机重要数据|FREQ7.7.1
|从OBDH接收控制计算机重要数据|FREQ7.7.2

接收控制计算机重要数据的具体要求见重要数据文件。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：卫星正常运行模式之一，完成三周对地指向，包含辐射定标方式。
处理：控制分系统按照地面规划的指令在轨道A、B、C、D四个点进行姿态机动来完成日地、地日、地地之间的姿态转换。辐射标定模式下的姿态固定，由数据指令控制进入标定模式。
在该模式下，控制系统根据数据块指令提供的开始和结束时间，开始、停止对指定天线控制角度进行计算，并0.5秒向天线发送一次控制指令。
正常模式初始化需向引入的星敏发送TC_RATE_LIMIT指令，将星敏工作的最大转速设置为固定地址注入的ratelimitnormal值（高精度状态）。
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺的数据处理；
调用四元数陀螺预估；
调用星敏感器数据处理；
if(MoveSTSInSystemFlag=2且SSTCatchSuc＝0) 调用 星敏感器对日定向 的a项；
调用利用星敏感器的姿态确定；
调用中继天线捕获跟踪控制；
调用对地数传天线捕获跟踪控制；
调用目标姿态确定；
调用控制器输入量计算；
调用喷气卸载条件计算；
调用CMG奇异状态的判断及算法计算；
if((UnLoadMode =0  或 TimeStopC > 0.0) 
{调用CMG的控制；调用磁卸载控制；}
else {if(Flag_equation=0且TimeStopC<=0)调用相平面喷气脉宽；
调用CMG启动与保持；}
调用系统故障诊断；",0,0,0,1,0,0,0,0,0,0,0
根据任务要求，应用软件进行LTU初始化、1553B初始化、调用系统软件的StartStarTimer、变量的初始化。,1,0,0,0,0,0,0,0,0,0,0
"功能描述：根据姿轨控喷气规律计算结果，发出相应的喷气指令。
处理：同用户需求的。",0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|5.2.1|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|星敏感器相对基准标定|FREQ3.10|5.2.11|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.14.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.14.2|进行卫星姿态四元数的重置
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法产品规范|FREQ3.1.3|/|规范化算法：
|基于单星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量叉乘信息的滤波修正算法产品规范|FREQ3.1.6|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.2|""计算模式的目标姿态
""
|对地定向目标姿态计算|FREQ3.12.0|5.3.2.1|对地定向目标姿态计算
|点对点机动目标姿态计算|FREQ3.12.1|5.3.2.2|点对点机动目标姿态计算
|姿态预置过程目标姿态计算|FREQ3.12.3|5.3.2.3|姿态预置过程目标姿态计算
|非沿迹跟踪阶段目标姿态计算|FREQ3.12.4|5.3.2.4|角速度建立过程目标姿态计算
|轨控目标姿态计算|FREQ3.12.5|5.3.2.5|轨控目标姿态计算
|凝视过程目标姿态计算|FREQ3.12.6|5.3.2.6|凝视过程中计算三轴目标姿态
|正常对日巡航目标姿态计算|FREQ3.12.7|5.3.2.7|正常对日巡航目标姿态计算
|姿态机动初始化|FREQ3.13.1|5.3.1.1|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|非沿迹跟踪轨迹初始化|FREQ3.13.2|5.3.1.2|匀地速、匀角速度、匀积分时间非沿迹跟踪初始化，计算地心张角和方向矢量等
|轨控姿态机动轨迹初始化|FREQ3.13.4|5.3.1.4|轨控模式目标姿态计算初始化
|计算多项式轨迹系数|FREQ3.13.5|5.3.3.1|根据轨迹规划时间，初始姿态/姿态角速度和目标姿态/姿态角速度计算基于多项式轨迹规划的轨迹系数
|姿态预置机动目标姿态确定|FREQ3.13.6|5.3.3.2|基于多项式曲线的轨迹规划，计算目标姿态
|非沿迹目标姿态角计算|FREQ3.13.8|5.3.4|根据所指定的扫描起始经纬度和末端点经纬度
|偏流角计算|FREQ3.13.9|5.3.5|适用于地球椭球模型，星体姿态描述为转序，计算基于星体光轴(与星本体＋Z轴平行)下的偏流角
|轨道角速度建立目标姿态计算|FREQ3.13.10|5.3.6|在惯性定向与轨道系姿态保持之间切换时，进行轨道角速度的建立或削除
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|正弦轨迹规划算法算法产品规范|FREQ3.12.7|/|规范化算法：
|基于加速度导数为正弦函数的轨迹规划算法算法产品规范|FREQ3.12.8|/|规范化算法：
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收内存数据块号
处理：将接收内存数据块号存储地址中内容的解包成内存数据块号，并将需下传的内容放到发送AOCC内存数据指定内存内容地址空间中。此处理在中断中进行。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ110|初始化|任务书
FREQ111|磁力矩器使用要求|任务书
FREQ112|通信(DA)|任务书
FREQ113|通信故障处理|预留
FREQ114|数据解包与转换|预留
FREQ115|磁力矩器数据有效性处理|预留
FREQ116|磁力矩器硬件采集、处理|任务书
FREQ117|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
功能描述：发送姿态机动过程参数包。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：采集陀螺的数据，并处理成需要的数据格式。
处理：
（1）从A/D输入采集陀螺的数据，转换为角速度
（2）乘以控制周期得到速度增量",0,0,0,0,0,0,0,0,1,0,0
"功能描述、输入、输出、。
序号|功能点编号|功能描述|说明
|FREQ3.4.4.1|加计数据处理|《用户需求》4.2.1
|FREQ3.4.4.2|陀螺数据处理|《用户需求》4.2.2
|FREQ3.4.4.3|陀螺的姿态预估|《用户需求》4.2.3
|FREQ3.4.4.4|星敏感器A姿态修正|《用户需求》4.2.4.1
|FREQ3.4.4.5|星敏感器B姿态修正|《用户需求》4.2.4.2
|FREQ3.4.4.6|星敏感器C姿态修正|《用户需求》4.2.4.3
|FREQ3.4.4.7|太阳捕获及对日定向|《用户需求》4.2.5
|FREQ3.4.4.8|轨控目标姿态角速度和四元数|《用户需求》4.2.6
|FREQ3.4.4.9|误差四元数计算|《用户需求》4.2.7
|FREQ3.4.4.10|陀螺在轨标定|《用户需求》4.2.8
|FREQ3.4.4.11|相对天东北系姿态计算|《用户需求》4.2.9
",0,0,1,0,0,0,0,0,0,0,0
功能描述：使用GPS轨道版数据进行GPS定轨。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：上行注入数据接收和处理
处理： 
序号|功能点编号|功能描述|备注
|FREQ4.1.1|姿控数据包1|该数据块采用内存修改实现
|FREQ4.1.2|姿控数据包2|该数据块采用内存修改实现
|FREQ4.1.3|IMU系数包|该数据块采用内存修改实现
|FREQ4.1.4|相平面系数包|该数据块采用内存修改实现
|FREQ4.1.5|姿态数据包|该数据块采用内存修改实现
|FREQ4.1.6|星敏滤波系数包|该数据块采用内存修改实现
|FREQ4.1.7|主减速系数包|""该数据块采用内存修改实现
删除BKFlag启动动力下降标志，该变量移至导航初始数据包""
|FREQ4.1.8|接近下降系数包|该数据块采用内存修改实现
|FREQ4.1.9|垂直下降系数包|该数据块采用内存修改实现
|FREQ4.1.10|轨道数据包|该数据块采用内存修改实现
|FREQ4.1.11|自主定位数据包|该数据块采用内存修改实现
|FREQ4.1.12|天文历书包|该数据块采用内存修改实现
|FREQ4.1.13|起飞参数包|该数据块采用内存修改实现
|FREQ4.1.14|导航修正系数包|该数据块采用内存修改实现
|FREQ4.1.15|软着陆轨道控制系数包|该数据块采用内存修改实现
|FREQ4.1.16|部件加断电命令包|
|FREQ4.1.17|LTU命令包|""CCU与推进线路盒的指令不通过LTU命令包发送。
与驱动和太阳模块的接口取数指令和控制指令都可通过地面注入发起""
|FREQ4.1.18|加电状态字设置包|该数据块采用内存修改实现
|FREQ4.1.19|串口周期通讯指定包|""该数据块采用内存修改实现
ZZ2的D0位与D5位定义互换""
|FREQ4.1.20|星敏感器RTS命令包|
|FREQ4.1.21|PID系数包|该数据块采用内存修改实现
|FREQ4.1.22|调制系数包|该数据块采用内存修改实现
|FREQ4.1.23|动量轮系数包1|该数据块采用内存修改实现
|FREQ4.1.24|动量轮系数包2|该数据块采用内存修改实现
|FREQ4.1.25|陀螺脉冲当量系数包|该数据块采用内存修改实现
|FREQ4.1.26|加计脉冲当量系数包|该数据块采用内存修改实现
|FREQ4.1.27|故障判别因子系数包|
|FREQ4.1.27|垂直上升及备份姿控PID系数包|
|FREQ4.1.28|内存修改包|修改内存字数由58改为57
|FREQ4.1.29|对日定向系数包|该数据块采用内存修改实现
|FREQ4.1.30|轨控命令包|""该数据块采用内存修改实现
删除变轨系数""
|FREQ4.1.31|惯性调姿命令包|该数据块采用内存修改实现
|FREQ4.1.32|程序包|
|FREQ4.1.33|星敏标定数据包|该数据块采用内存修改实现
|FREQ4.1.34|导航初始数据包|""该数据块采用内存修改实现
增加BKFlag启动动力下降标志""
|FREQ4.1.35|导航敏感器系统误差初值包|该数据块采用内存修改实现
|FREQ4.1.36|微波标定数据包|与LTU命令块合并
|FREQ4.1.37|内存下卸包|
|FREQ4.1.38|驱动与太阳模块状态控制包|
|FREQ4.1.39|着陆器推进控制包|
|FREQ4.1.40|上升器推进控制包|
|FREQ4.1.41|IMU数据存储控制包|IMU数据存储控制标志IMU_flag的定义更改

备注中注明“该数据块采用内存修改实现”的命令块，软件编码不实现该数据包的注入功能，数据包中变量需要修改时通过内存修改包实现。软件编码应保证该数据包中变量处于连续的内存区。",0,0,0,0,0,0,0,0,0,1,0
功能描述：接收遥控固定参数注入块的外1533B发送子地址内存管理区,0,0,0,0,0,0,0,0,0,1,0
"功能描述：仅利用星敏感器A、B的测量，修正姿态四元数与姿态角速度移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：若某个模拟太阳故障，则模拟太阳数据无效。若某个模拟太阳不见太阳标志，则该模拟太阳无效。,0,0,0,0,0,0,1,0,0,0,0
功能描述：计算CMG的框架角速度。                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：修改奇异规避算法。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：CMG数据处理
",0,0,0,0,0,0,0,0,1,0,0
"时间服务采用1s作为时间同步周期，BC使用子地址29发送时间消息，使用广播方式发送，A、B总线各广播一次。本型号选用“一步方式”，即仅发送时间消息而没有时间同步消息，时间数据消息在通信帧0末发出。对于接收硬件秒脉冲信号的用户，时间码的整秒部就是秒脉冲对应的整秒时刻。因此包含的功能点为两个：
序号|功能描述|功能编号|
|接收OBDH校时时刻|FREQ7.1.1|设置OBDH校时标志TimeFlg.RcvOBDH
|接收GPS秒脉冲时刻|FREQ7.1.2|设置GPS校时标志
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。
功能编号|功能|引用文档
FREQ53|初始化|星敏协议
FREQ54|星敏使用要求|任务书
FREQ55|通信|星敏协议
FREQ56|通信故障处理|任务书
FREQ57|数据解包与转换|星敏协议
FREQ58|星敏数据有效性判断、处理|任务书
FREQ59|星敏模拟量采集、处理|任务书
FREQ60|部件在轨转发（在轨修改）|任务书

3）GPS高精度校时与星敏感器数据的使用
功能描述：根据GPS秒脉冲，秒脉冲广播，进行GPS高精度校时和星敏感器时标处理。
输入：地面遥控指令，GPS秒脉冲，秒脉冲广播，星敏感器数据。
输出：星时，时标，星敏感器数据广播。
处理：",0,0,0,0,0,0,0,0,1,0,0
"功能描述：计算巡天模式下的目标姿态
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
调用条件：有发送和接收OBDH重要数据命令字时
输入：OBDH重要数据地址中内容
输出：OBDH重要数据地址中内容。
处理：OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,0,0,0,1
功能描述：无控模式初始化,0,0,0,1,0,0,0,0,0,0,0
功能描述：根据指令完成中继天线的捕获跟踪控制。,0,1,0,0,0,0,0,0,0,0,0
功能描述：帆板故障检测，切换帆板LTU。,0,0,0,0,0,1,0,0,0,0,0
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|对地数传天线1 LTU控制指令
对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|对地数传天线2
LTU控制指令|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|中继天线LTU控制指令|中继天线的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：引入飞轮控制（包含启动、动量保持、喷气卸载等）及撤去飞轮控制。
处理：
根据ZT2的取值进行不同的处理，处理逻辑见下表，见用户需求。
ZT2=1：飞轮启动，动量保持
ZT2=2：飞轮整星零动量控制模式
ZT2 6：不用轮控
ZT3≤3：用红外+太阳+陀螺定姿，且接入控制回路
ZT3=A：星敏无陀螺定姿，且接入控制回路，整星零动量控制方式
ZT3=C：用星敏感器+陀螺定姿，且接入控制回路
ZT3=F：用红外+单个斜装陀螺定姿，且接入控制回路
                      表38：飞轮控制的判别处理
条件|处理
 ZT2 6或3个动量轮工作|（i = 1， … ，6）
ZT2=1，3个以上动量轮工作|飞轮动量保持控制及飞轮启动
ZT2=2，3个以上动量轮工作|""喷气卸载逻辑判断：
①，。当BZ1 = 8时令,=0.
② 当连续三次，则：FHU = A,若BZ1 =1或 2或 9，则：FHU = A 
③当FHU = A且ZT8  3且ZT9  3，则：飞轮动量保持控制及飞轮启动 
④当ZT,ZT，且且且，则：FHU = 0
⑤当ZT3 = F或B且且BZ50且且，则：FHU = 0
⑥ 若ZT3=A，则：
若且FSTD 1且且，则：FHU = 0
""

卫星的三轴转动惯量分别为 3023.2kgm2、  3453.1kgm2 、 4998.7kgm2。
其中飞轮动量保持控制及飞轮启动的处理详见用户需求，飞轮控制电压计算详见用户需求1.3.4",0,1,0,0,0,0,0,0,0,0,0
"功能描述：搜索并捕获太阳，完成并保持帆板对太阳定向
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：各模式初始化
序号|功能点编号|功能描述|说明
|FREQ3.4.2.1|等待段初始化|《用户需求》4.1.1【初始化】
|FREQ3.4.2.2|太阳定向模式初始化|《用户需求》4.1.2【初始化】
|FREQ3.4.2.3|恒星定向2初始化|《用户需求》4.1.3【初始化】
|FREQ3.4.2.4|惯性调姿模式初始化|《用户需求》4.1.4【初始化】
|FREQ3.4.2.5|恒星定向4初始化|《用户需求》4.1.5【初始化】
|FREQ3.4.2.6|轨控定向模式初始化|《用户需求》4.1.6【初始化】
|FREQ3.4.2.7|着陆准备模式初始化|《用户需求》4.1.7【初始化】
|FREQ3.4.2.8|主减速模式初始化|《用户需求》4.1.8【初始化】
|FREQ3.4.2.9|快速调整模式初始化|《用户需求》4.1.9【初始化】
|FREQ3.4.2.10|接近下降模式初始化|《用户需求》4.1.10【初始化】
|FREQ3.4.2.11|悬停模式初始化|《用户需求》4.1.11【初始化】
|FREQ3.4.2.12|避障模式初始化|《用户需求》4.1.12【初始化】
|FREQ3.4.2.13|缓速下降模式初始化|《用户需求》4.1.13【初始化】
|FREQ3.4.2.14|自主定位模式初始化|《用户需求》4.1.14【初始化】
|FREQ3.4.2.15|起飞准备模式初始化|《用户需求》4.1.15【初始化】
|FREQ3.4.2.16|垂直上升模式初始化|《用户需求》4.1.16【初始化】
|FREQ3.4.2.17|上升调姿模式初始化|《用户需求》4.1.17【初始化】
|FREQ3.4.2.18|轨道入射模式初始化|《用户需求》4.1.18【初始化】
|FREQ3.4.2.19|星光环月模式初始化|《用户需求》4.1.19【初始化】
|FREQ3.4.2.20|速率阻尼模式初始化|《用户需求》4.1.20【初始化】
|FREQ3.4.2.21|无控模式初始化|《用户需求》4.1.21【初始化】
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件进行LTU初始化、1553B初始化、变量的初始化
处理： 
进行LTU初始化
进行1553B初始化
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。变量初值见上行注入、用户需求、装订参数。对于上述文件中相同变量的初值，以装订参数文件为准。对于上行注入与用户需求中相同变量的初值，以用户需求的规定为准。复位后的状态恢复不区分单机复位和三机复位。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：接收服务请求确认字
处理： 将接收服务请求确认字存储地址中内容解包成服务请求确认字的数据格式，根据不同的服务请求确认字停止对应的服务请求的申请。",0,0,0,0,0,0,0,0,0,1,0
功能描述：轨控姿态机动模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：利用红外太阳建立正常飞行姿态
",0,0,1,0,0,0,0,0,0,0,0
功能描述：为动量轮启动与保持模式姿态确定提供初始姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：对地对日相互转换的过渡模式。                                                                                                                                                                                                                                                                                                                                                                                                                                                            处理：
根据地面规划指令，使用CMG完成姿态快速机动，满足姿态条件自主退出该模式。
从进入该模式起，AOCC需每秒向引入的星敏发送星敏角速度限制指令TC_RATE_LIMIT指令。指令包含的参数计算见用户需求，指令格式见AOCC与星敏通信协议。使用单独的时间间隔计数器，并从第一个周期开始发送TC_RATE_LIMIT指令。
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺的数据处理；
调用四元数陀螺预估；
调用星敏感器数据处理；
if(MoveSTSInSystemFlag=1) 调用利用星敏感器的姿态确定；
elseif(MoveSTSInSystemFlag=2且 且SSTCatchSuc=0)   调用星敏感器对日定向的a项；
调用 .13（姿态修正及星敏粗姿态计算）；
调用机动目标姿态确定；
调用中继天线捕获跟踪控制；
调用对地数传天线捕获跟踪控制；
调用控制器输入量计算；
调用CMG奇异状态的判断及算法计算；
调用CMG的控制；
调用系统故障诊断；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：上电/复位初始化
处理：
- 串口初始化
- CAN总线初始化
- ALTU、NSMU当班设置
- 红外加电
- 磁力矩器二次电源加电
- 上电/复位星箭分离查询",1,0,0,0,0,0,0,0,0,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.8.1~4.8.8。
序号|功能点编号|功能描述|说明
|FREQ3.4.10.1|陀螺故障检测及选择|《用户需求》4.8.1
|FREQ3.4.10.2|加速度计故障检测及选择|《用户需求》4.8.2
|FREQ3.4.10.3|星敏感器故障检测及选择|《用户需求》4.8.3
|FREQ3.4.10.4|系统故障检测及选择|《用户需求》4.8.4
|FREQ3.4.10.5|加计通讯故障处理|《用户需求》4.8.5
|FREQ3.4.10.6|陀螺通讯故障处理|《用户需求》4.8.6
|FREQ3.4.10.7|测速波束有效性检测及选择|《用户需求》4.8.7
|FREQ3.4.10.8.1|单机类故障诊断_陀螺|《用户需求》4.8.8 
|FREQ3.4.10.8.2|单机类故障诊断_加计|《用户需求》4.8.8
|FREQ3.4.10.8.3|单机类故障诊断_星敏|《用户需求》4.8.8
|FREQ3.4.10.8.4|单机类故障诊断_微波测距测速|《用户需求》4.8.8
|FREQ3.4.10.8.5|单机类故障诊断_激光测距|《用户需求》4.8.8
|FREQ3.4.10.8.6|单机类故障诊断_激光测速|《用户需求》4.8.8
|FREQ3.4.10.8.7|自主启动IMU数据存储|《用户需求》4.8.8
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,0,0,0,1
"功能描述：采集模拟太阳的数据，并处理成需要的数据格式。
处理：
（1）从A/D输入采集模拟太阳的角度数据
（2）从I/O输入采集模拟太阳的视场码",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收GPS轨道板定位数据
处理：保存GPS轨道板定位数据，35V帆板电压遥测用于帆板故障检测。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收遥测采集设置指令
处理：将接收遥测采集设置指令存储地址中内容解包成帧计数值，而AOCC则返回与帧计数值相对应的60字节DS遥测量。此指令与发送遥测数据块配合执行。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：将加计数据换算成卫星三轴加速度和速度增量
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收遥控间接指令单元
处理：
间接指令单元指令种类包括以下四个指令：
中继程序跟踪停止指令
中继天线复位指令
整星侧摆指令
中继快扫到位指令
指令|收到后的处理
中继程序跟踪停止|置FAST=1
中继天线复位|置FARP=1，记录X轴复位角度，Y轴复位角度
整星侧摆|置FM=1，记录起摆时刻，侧摆到位用时，侧摆角
中继快扫到位|置FAFP=1，记录快扫到位绝对时间，侧摆角
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：发送和接收OBDH重要数据1、2、3
处理：软件初始化后不用做处理，应用软件只需在初始化时为它指定存储的地址空间即可。",0,0,0,0,0,0,0,0,0,0,1
功能描述：由平衡方程方法、星敏感器数据、红外/太阳数据，以及动力学输出对陀螺进行故障检测。,0,0,0,0,0,1,0,0,0,0,0
功能描述：接收数据指令注入块的CMG串口指令,0,0,0,0,0,0,0,0,0,1,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书。
功能编号|功能|引用文档
FREQ49|初始化|陀螺协议
FREQ50|陀螺使用要求|任务书
FREQ51|通信|陀螺协议
FREQ52|通信故障处理|任务书
FREQ53|数据解包与转换|陀螺协议
FREQ54|陀螺数据有效性判断、处理|任务书
FREQ55|陀螺模拟量采集、处理|任务书
FREQ56|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
功能描述：确定动量轮角动量数据的有效性。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：按指令值，控制星体三轴角速率。
处理：同用户需求的
（1）计算得到用于控制角速度偏差，计算公式见（1）；
（2）进行各轴喷气状态的设置，当ZT43[4]=1允许陀螺自主加电且FlagGyroAdd=1正在给陀螺加电时，设置===0，计算公式见（2）；
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令
（4）对是否转无控模式的计数值FWM进行处理：首先将FWM限幅到1和7E之间；然后判断是否满足下列条件之一，如果满足则FWM减1，否则FWM加1
三轴惯性角速度，的最大值大于0.0116弧度/秒",0,1,0,0,0,0,0,0,0,0,0
"功能描述：使用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|CMG 1数据的采集与处理|FREQ1.9.1|""CMG 1
1553B取数指令
""|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 2数据的采集与处理|FREQ1.9.2|""CMG 2
1553B取数指令
""|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 3数据的采集与处理|FREQ1.3.3|""CMG 3
1553B取数指令
""|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 4数据的采集与处理|FREQ1.9.4|""CMG 4
1553B取数指令
""|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 5数据的采集与处理|FREQ1.9.5|""CMG 5
1553B取数指令
""|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 控制指令的输出处理|FREQ1.9.6|计算得到CMG的控制数据|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
|CMG 6数据的采集与处理|FREQ1.9.7|""CMG 6
1553B取数指令
""|CMG 6的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 6的当班标志为1），每周期向CMG 6 RT发取数指令，获得CMG 6数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG的程序注入修改|FREQ1.9.8|从OBDH收到的CMG需修改程序内容|CMG需修改程序内容|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
|CMG的内存下传|FREQ1.9.9|从OBDH收到的CMG内存下传设置指令|内存下传设置指令|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,0,0,0,1,0,0
功能描述：动量轮摩擦力矩的补偿电压计算。,0,1,0,0,0,0,0,0,0,0,0
功能描述：对部件加断电指令的处理 ,0,0,0,0,0,0,0,1,0,0,0
功能描述： CMG数据处理。,0,1,0,0,0,0,0,0,0,0,0
功能描述：根据平台光纤陀螺组件接收的0.25秒内陀螺的角度增量，算出卫星在惯性空间的角速度。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：CAN通信上行/下行数据的组帧和解包。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：星务接收、星务发送、快帧遥测1打包、快帧遥测2打包、快帧遥测3打包、快帧遥测4打包、快帧遥测5打包、姿态广播、星敏广播、陀螺广播、重要数据打包、上行:数据指令响应处理、上行:固定地址注入解包、上行:可变地址注入解包、上行:轨道注入解包、上行:程序注入、上行:内存下卸指令注入、上行:任务块、上行:地面站、重要数据返回解包、GPS定位广播解包、整星广播对时解包、GPS高精度秒脉冲对时广播解包、CAN总线使用要求",0,0,0,0,0,0,0,0,0,0,1
"功能描述：使用星敏感器A、C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：分支号与喷管对应选择

处理：
序号|分支状态|姿控分支标志|姿控发动机|轨控分支标志|轨控发动机
1|A、B、C分支都好|A|A1|BC|B1
1|A、B、C分支都好|A|A2|BC|B2+B3+C2+C3
1|A、B、C分支都好|A|A3|BC|B5
1|A、B、C分支都好|A|A4|BC|B4
1|A、B、C分支都好|A|A6|BC|B6+B7+C6+C7
1|A、B、C分支都好|A|A5|BC|B8+B9+C8+C9
2|A、B分支好|A|同A分支|B|同BC
2|A、B分支好|A|同A分支|B|B2+B3
2|A、B分支好|A|同A分支|B|同BC分支
2|A、B分支好|A|同A分支|B|同BC分支
2|A、B分支好|A|同A分支|B|B6+B7
2|A、B分支好|A|同A分支|B|B8+B9
3|A、C好|A|同上|C|C1+C10
3|A、C好|A|同上|C|C2+C3
3|A、C好|A|同上|C|C5
3|A、C好|A|同上|C|C4
3|A、C好|A|同上|C|C6+C7
3|A、C好|A|同上|C|C8+C9
4|B、C好|C|C6+C9|B|同B分支
4|B、C好|C|C7+C8|B|同B分支
4|B、C好|C|C1|B|同B分支
4|B、C好|C|C10|B|同B分支
4|B、C好|C|C2|B|同B分支
4|B、C好|C|C3|B|同B分支
5|A好|A|同A分支|0|无效
6|B好|0|无效|B|同B分支
7|C好|C|同C分支|0|无效",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据从SLTU接收的0.25秒或1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
输入：0.25秒或1秒内陀螺的角度增量 (量纲：弧度)
(i=1,2,3,…6，依次表示陀螺G1，G2，…，G6的输出)；
采样周期 (量纲：秒)；
陀螺数据有效性标志F_GyroValid(由陀螺有效性判据给出)。
陀螺系统在星体三轴方向等效的常值漂移估值 (量纲：弧度/小时)
星敏感器数据有效性标志：F_SAValid，F_SBValid，F_SCValid
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送控制计算机计算得出的星历数据
处理：将控制计算机计算得出的星历数据打包后放到星历数据地址空间中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理：",0,0,0,0,0,0,0,0,0,1,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
-Y帆板数据的采集与处理|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,0,0,0,1,0,0
"    各个模式切换的功能点列表如下：
模式字|功能|功能编号
0|主动段模式切换|FREQ5.1
1|入轨段消初偏模式切换|FREQ5.2
2|正飞模式切换|FREQ5.3
3|大角度机动模式切换|FREQ5.4
4|正常运行模式切换|FREQ5.5
5|轨控模式切换|FREQ5.6
6|SAR未展开模式切换|FREQ5.7
7|帆板未展开模式切换|FREQ5.8
8|偏置动量控制模式切换|FREQ5.9
9|全姿态捕获模式切换|FREQ5.10
A|应急安全模式切换|FREQ5.11
B|停控模式切换|FREQ5.12

工作模式的转换如下表所示： 
模式字|到1|到2|到3|到4|到5|到6|到7|到8|到9|到10|到11
从0|ZC0-1||||||||ZC0-9||
从1||ZC1-2|||||||ZC1-9|ZC1-10|
从2|||ZC2-3|ZC2-4||ZC2-6|ZC2-7|ZC2-8|ZC2-9|ZC2-10|ZC2-11
从3||||ZC3-4|||||ZC3-9|ZC3-10|ZC3-11
从4||ZC4-2|ZC4-3||ZC4-5|ZC4-6|ZC4-7|ZC4-8|ZC4-9|ZC4-10|ZC4-11
从5||||ZC5-4|||||ZC5-9|ZC5-10|ZC5-11
从6||ZC6-2||ZC6-4|||||ZC6-9|ZC6-10|ZC6-11
从7||ZC7-2|||||||ZC7-9|ZC7-10|ZC7-11
从8||ZC8-2||ZC8-4|||||ZC8-9|ZC8-10|ZC8-11
从9||ZC9-2||ZC9-4||||||ZC9-10|ZC9-11
从10|||||||||ZC10-9||
从|||||||||ZC11-9|ZC11-10|

条件标识原则：ZCX—Y，其中ZC表示转换条件，X为转出的模式字，Y为转入的模式字。具体见用户需求3.3。AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：为姿态机动提供的目标轨迹参考数据
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能：利用红外、数字太阳敏感器确定姿态。
",0,0,1,0,0,0,0,0,0,0,0
AOCC在收到此指令并且判断数据正确后，即认为星箭分离有效，通过方式代码的服务请求，申请OBDH停止发送星箭分离信号。当AOCC应用软件接收到CTU发送至AOCC的通知进全捕指令时，AOCC自主转入全捕模式，并通过服务请求告诉CTU  AOCC已收到CTU通知进全捕指令，停止传送该信号，具体要求详见《星串行数据总线通信协议》。,0,0,0,0,0,0,0,0,0,1,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：AOCC在CAN总线中断中接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,0,0,0,1
"AppInit中星箭分离的查询
硬件初始化后，按5取3的方式查星箭分离状态位(对星箭分离状态位读5次，有连续3次或3次以上读入为“1”，则认为查到星箭已分离，每次读的时间间隔要求大于1ms)。
AppInit中星箭未分离的初始化
如果星箭未分离，对应用软件相关变量、硬件初始化。进入主动段工作模式。在主动段工作模式下，每个控制周期按5取3的方式查星箭分离状态位，如果连续3个周期内都查到星箭已分离，则可确认为星箭已分离。进入初始速率阻尼模式，并置星时0.375s。
AppInit中星箭已分离的初始化
对应用软件相关变量、硬件初始化，星时清0，进入复位模式。
在复位模式下，与星务分系统通讯，取回保存在星务分系统的重要数据，具体见《卫星姿轨控分系统AOCC与星务通讯协议》。如果取数成功，根据控制模式字进入初始化。若连续5秒从星务分系统取重要数据失败则认为申请失败。取重要数据不成功，设置工作模式为“太阳捕获模式”，星时为2100秒，发送CMG1~5“复位及高速断电”指令。ALTU当班状态根据前面章节的内容进行复位后设置；切除6个陀螺，发送“陀螺1~5开”指令，新加电陀螺等10分钟后引入，并置状态分为120，10分钟内系统不引入，不进行速率阻尼。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：红外数据处理
",0,0,0,0,0,0,0,0,1,0,0
功能描述：发送模拟量遥测数据包1,0,0,0,0,0,0,0,0,0,0,1
"功能描述：发送AOCC重要数据给OBDH保存
处理：将重要数据打包后放到AOCC重要数据内存地址空间中。AOCC共四块重要数据，每块重要数据均64个字节。每块重要数据均有校验和，校验和占4个字节。校验和的计算方法为：将60个字节按双字进行异或计算。重要数据的内容具体见重要数据文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：使用估计的四元数转换姿态角。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收遥控中继星轨道注入块,0,0,0,0,0,0,0,0,0,1,0
功能描述：计算磁卸载所需的磁矩与磁力矩器工作脉宽。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态。
输入：采样周期，陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出： ",0,0,1,0,0,0,0,0,0,0,0
功能描述：发送全姿态捕获模式数据包,0,0,0,0,0,0,0,0,0,0,1
"软件需求名称：自锁阀开关控制 
需求类别：其他 
软件需求描述：控制自锁阀开关。",0,0,0,0,0,0,0,1,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|主动段模式控制|FREQ44.0|3.3.0|主动段模式调用流程
|入轨消初偏模式控制|FREQ44.1|3.3.1|入轨消初偏模式调用流程
|红外引入对地粗定向模式控制|FREQ44.2|3.3.2|红外引入对地粗定向模式调用流程
|动量轮启动模式控制|FREQ44.3|3.3.3|动量轮启动模式调用流程
|正常轨道运行模式控制|FREQ44.4|3.3.4|正常轨道运行模式调用流程
|轨控模式1模式控制|FREQ44.5|3.3.5|轨控模式1模式调用流程
|由正常姿态进行姿态机动模式控制|FREQ44.6|3.3.6|由正常姿态进行姿态机动模式调用流程
|轨控模式2模式控制|FREQ44.7|3.3.7|轨控模式2模式调用流程
|由轨控姿态机动回正常轨道运行模式控制|FREQ44.8|3.3.8|由轨控姿态机动回正常轨道运行模式调用流程
|全姿态捕获模式控制|FREQ44.9|3.3.9|全姿态捕获模式调用流程
|应急安全模式模式控制|FREQ44.10|3.3.10|应急安全模式模式调用流程
|停控模式控制|FREQ44.11|3.3.11|停控模式调用流程
|帆板未展开模式控制|FREQ44.12|3.3.12|帆板未展开模式调用流程
|偏置动量控制模式控制|FREQ44.13|3.3.13|偏置动量控制模式调用流程

主动段模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的3。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：选择通讯的红外LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）红外共有两个LTU（正俯仰红外LTU和负俯仰红外LTU），AOCC每个控制周期向注入文件中的ZT5和IresLTUSeltFlag的最大组合中指定的红外LTU发送取数指令
（2）向选择的红外LTU发送完取数指令，获得红外LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：使用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：卫星绕俯仰轴转动，直到红外搜索到地球。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：若3000秒（全姿态捕获除速率阻尼外1000秒，可注入修改）内，三轴中任一轴喷气总量（正负轴单独判断）超过范围（正常模式50s，粗定向和轮子启动、全姿态捕获100s，可注入修改），则根据自锁阀状态，开关自锁阀。全姿态模式下,0,0,0,0,0,1,0,0,0,0,0
"功能描述：置卫星姿态无控处于自由飞行
处理过程：过程如下：
STEP1：进行姿态预估（见用户需求），得到姿态角和角速度
STEP2：当ZT7为0、7、3、5时，发相应的帆板控制指令：
ZT7取值|处理
ZT7 = 0|发左右帆板转角均为0度的指令
ZT7 = 7|发左右帆板转角均为180度的指令
ZT7 = 3|发左为90度，右为 -90指令
ZT7 = 5|发左右均为90度指令

STEP3：关自锁阀LV-1，LV-2，LV-3，LV-4，关推力器J1，J2，… ，J16。
STEP4：如果ZT7 ≥ 8，则每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值发相应的指令一次
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

STEP5：置六个动量轮的电压为0",0,0,0,1,0,0,0,0,0,0,0
功能描述：红外数据处理。,0,0,0,0,0,0,0,0,1,0,0
功能描述：发送系统工作状态数据包,0,0,0,0,0,0,0,0,0,0,1
根据地面注入的接收内存读出的地址和长度，将对应地址和长度的内存数据放入发送内存读出数据的存储空间内；,0,0,0,0,0,0,0,0,0,0,1
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器1
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器1的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器2
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器2的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器3
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器3的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：利用星敏感器和陀螺输出计算姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
"1）上电/复位软件初始化
功能描述：上电/复位软件初始化
2）取回重要数据初始化
功能描述：取回重要数据初始化
输入：重要数据的陀螺引入标志、推力器组件、数字太阳标志
输出：陀螺引入标志、推力器组件标志
3）未取回重要数据初始化
功能描述：未取回重要数据初始化
输出：陀螺引入标志、推力器组件标志",1,0,0,0,0,0,0,0,0,0,0
"功能描述：根据采集的1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：采集3路模拟磁强计信息。
处理：
采集方法：连续采集3路，采集1路的操作步骤（以X通道磁强计模拟量）：
向选通地址输出偏移地址：0x1200 0000 = 15H；
等待至少100µs,启动A/D转换：0x1200 0040 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0040 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果； ",0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：帆板控制算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.6.1|帆板控制策略|《用户需求》4.6.1|
FREQ12.3-R4.6.2|帆板控制量确定|《用户需求》4.6.2|
FREQ12.3-R4.6.3|帆板控制指令转速计算|《用户需求》4.6.3|
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：主动段模式初始化
处理：
- WorkMode（工作模式）：0（主动段）；
- StarTime（星上时间）：0.0；
- 俯仰磁力矩器线路主份工作；
- 星务校时：禁止星务校时；
- 均匀校时：禁止均匀校时；",1,0,0,0,0,0,0,0,0,0,0
功能描述：对星敏感器输出数据进行有效性判断,0,0,0,0,0,0,1,0,0,0,0
功能描述：根据星敏感器的输出数据判断陀螺故障。,0,0,0,0,0,1,0,0,0,0,0
功能描述：接收遥控轨道参数注入块,0,0,0,0,0,0,0,0,0,1,0
"功能描述：卫星处于应急状态
处理：
STEP1：进行姿态预估，得到姿态角和角速度
STEP2：令动量轮和磁力矩器的控制电压为0",0,0,0,1,0,0,0,0,0,0,0
"功能描述：利用数字太阳角输出，保持卫星帆板对太阳定向。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：进行I/O板SpaceWire接口读入和输入数据的处理；由于不同敏感器输入的姿态角度信息的格式和量化单位都不相同，需要将它们进行格式转换。输入信息格式转换后的单位规定为：地球敏感器、太阳敏感器、陀螺积分的角度单位为弧度（rad），动量轮转速单位为（rpm） 
处理：
(1)  判断IO当班状态；
(2)  697控制双口RAM；
(3) 根据当班状态，选择SPACEWIRE相应通道，主份IO当班，从通道2读取双口RAM中的数据；备份IO当班，从通道3读取双口RAM中的数据；
(4) 对读取的双口RAM中的数据进行解包
(5) 输入数据处理；（包括：太敏、地敏、三浮、光纤、星敏、时间、ADU控制信息、IO状态信息等）。
接口输入功能
功能描述：进行接口数据的读取 
处理：输入功能具体见PM板与IO板接口。(1) 从双口RAM中读取I/O发送的数据；(2) 根据协议对接收的数据进行解包；
输入数据处理功能分解
接口输入后，根据通讯协议和数据格式进行数据处理，下表示输入数据处理的功能分解：
表5.2-4 输入数据处理功能分解1
序号|编号|功能说明|任务书中的章节号|功能描述
|FREQ10.1|太敏数据处理地敏数据处理|6.1.1|太阳敏感器数据进行解码，读入的偏移二进制码转换为控制计算用的浮点数格式；
|FREQ10.2|地敏数据处理|6.1.2|将从接口读入的ES数据转化为弧度值
|FREQ10.3|甚高三浮陀螺数据处理|6.1.3|将三浮陀螺在一个采样周期内的脉冲数转化为角度增量，并做限幅与剔野处理
|FREQ10.4|光纤陀螺数据处理|6.1.4|对光纤陀螺数据包进行解码，测量数据由定点数转换为控制计算用的浮点数格式；
|FREQ10.7.2|星敏曝光时刻计算|6.1.5|星敏曝光时刻计算

表5.2-5 输入数据处理功能分解2
序号|需求ID号|功能点说明|用户需求中章节号|功能描述
|FREQ10.3.1|三浮陀螺数据剔野|11.1.1|三浮陀螺数据剔野
|FREQ10.4.1|光纤陀螺数据剔野|11.1.1|光纤陀螺数据剔野
|FREQ10.5|陀螺的应用选择|11.1.1|控制分系统配置了9个陀螺，根据陀螺健康字和电源状态字确定陀螺状态字，计算分配矩阵。也可通过陀螺组合遥控指令处理，设置陀螺状态字，进而计算出分配矩阵。故障后通过地面遥控进行陀螺重新组合分配
|FREQ10.6|单独测量时的陀螺数据处理|11.1.1|根据陀螺测量值，得到三轴姿态角速度，用于姿态采用陀螺几分测量时
|FREQ10.7|星敏感器数据处理|11.1.2|对星敏数据进行解包、数据有效性判断、通讯故障判断、星敏数据剔野
|FREQ10.7.1|星敏数据剔野|11.1.2|星敏数据剔野
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：
每次中断到来，向TM串口5(US[5])写入8字节的数据（功能编号：FReq-12）。
处理：发送DPRU由RT变为BC的使能请求，每次中断到来，通过同步串口US[5]发出8字节，首先复位FIFO，然后发送指令码为：0x1A、0xCF、0xFC、0x1D、0xBF、0xC0、0xA6、0xED
同步串口5模式寄存器设置为02，帧长设置为128字节。",0,0,0,0,0,0,0,1,0,0,0
功能描述：星上实时计算太阳轨道、方位与其它参数,0,0,0,0,1,0,0,0,0,0,0
功能描述：接收总线指令                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     处理： 将接收总线指令存储地址中内容解包成总线指令的数据格式，根据不同的总线指令进行相应的处理。 ,0,0,0,0,0,0,0,0,0,1,0
功能描述：采集4路动量轮脉冲信息。,0,0,0,0,0,0,0,0,1,0,0
功能描述：各个模式的初始化设置。,0,0,0,1,0,0,0,0,0,0,0
"功能描述：二次电源切换。
处理：
ACU内部含有两套二次电源，两套互为备份，可以同时加电工作，通常仅一份工作。AOCC每个控制周期采集工作电源的状态模拟量，并设置当班状态（5V和12V遥测模拟量≥3V即当班，若同时符合条件则置主份当班），若连续4个控制周期两套电源均不当班，且允许自主切换，则连续两个控制周期先后发送主份电源开、备份电源关两条指令，并置主份当班。
若当班电源的5V或12V遥测模拟量连续5个控制周期<3V时，且允许自主切换，则连续两个控制周期先后发送另一份电源开、本电源关两条指令，并禁止自主切换；若禁止自主切换，则设置切机命令字。
上电/复位初始化为允许自主切换，当班标志为保持。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：使用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送姿态数据包、红外太阳敏感器数据包、星敏感器数据包、姿态控制数据包、天线数据包、轨道数据包、部件工作状态数据包、系统工作状态数据包、全姿态捕获模式数据包、模拟量遥测数据包。
处理：数据内容见《卫星控制分系统数字量遥测数据格式定义》。
要求应用软件设计时，对角速度相关的遥测参数采取平滑处理，并将处理后的结果遥测输出（高精度数据包中记录的角速度相关数据不采用平滑处理），平滑处理要求为本周期输出的遥测值为最近8个控制周期该遥测参数的平均值。需采取平滑处理的遥测参数包括不同定姿方式下的三轴角速度遥测（dφ/dθ/dψ、//、/）以及角速度误差遥测（//）。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：与发动机通信，输出本周期喷气脉宽。
处理：
功能编号|功能|引用文档|备注
FREQ52|UPS初始化|任务书|B
FREQ53|化学推进数据采集|任务书|B
FREQ54|推力器脉冲输出|任务书|B
FREQ55|推力器健康字设置|任务书|B
FREQ56|部件操作（程控490N点火，故障重构）|任务书|B
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：根据姿态估值与数字输出，判断修正可用性。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据红外信息绕滚动俯仰转动，进行滚动俯仰捕获
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：对目标轨迹进行初始化，供姿态机动使用
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：星上实时计算追踪器轨道
",0,0,0,0,1,0,0,0,0,0,0
"功能描述：发送遥测数据块
处理： 处理过程如下：
OBDH每个实时遥测帧周期（0.8秒）从AOCC获取并下发60字节DS量遥测数据。每个遥测格式分64帧，以F0---F63标记，每帧所要求AOCC传送的内容各不相同，按数据更新情况分为快速数据（DF），中速数据（MF），慢速数据（SF）。每种数据在不同的卫星的姿态控制方式下，所要求传送的DS遥测量是不同的，可分为三轴稳定模式与非三轴稳定模式；三轴稳定模式下又可分为星敏感器是否参加定姿两种情况。遥测数据DF，MF，SF含义为：
快速数据，每帧传送数据相同，即每帧一循环；
中速数据，每16帧一循环；
慢速数据，每32帧一循环。
遥测输出数据格式及定义见文件R/JBK-10/0.RX1：
星上应用程序每0.524秒在定时中断响应主程序中装载快速遥测数据，在4秒主程序中装载中速和慢速数据，并根据当前控制系统模式装载不同的数据到规定遥测数据区中。为了能根据正确遥测相应的遥测数据，星上应用程序需要分别定义快帧遥测缓存区42字节，中帧遥测缓存区6×16字节和慢帧遥测缓存区12*32字节来存放星上的数据。同时应用程序每个周期都要根据OBDH的帧号从相应的遥测缓存区中找出正确的遥测数据进行打包。以下就快速遥测、中速遥测和慢速遥测的处理过程分别进行说明：
1）快速遥测
STEP1：根据星上控制模式，确定数据装载模式；
STEP2：根据不同的数据装载模式，确定装载数据；
STEP3：在0.524秒控制周期内将确定的装载数据转换为遥测要求的数据格式，并放入规定的缓存区；
STEP4：将规定缓存区的内容放入OBDH定义的内存中；
2）中速遥测
STEP1：根据星上控制模式，确定数据装载模式；
STEP2：根据不同的数据装载模式，确定装载数据；
STEP3：在4秒主程序内将确定的装载数据转换为遥测要求的数据格式，并放入规定的缓存区；
STEP4：根据遥测帧号从规定的缓存区中挑出遥测的数据并放入OBDH定义的内存中；
3）慢速遥测
STEP1：在4秒主程序内将确定的装载数据转换为遥测要求的数据格式，并放入规定的缓存区；
STEP2：根据遥测帧号从规定的缓存区中挑出遥测的数据并放入OBDH定义的内存中；
遥测的快帧内容不变，中帧和慢帧去掉加速度计相关内容，新增和更改内容详见《卫星控制分系统数字量实时遥测数据格式和参数定义》。",0,0,0,0,0,0,0,0,0,0,1
功能：姿态角、角速度与姿态四元数预估。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的系统安全模式姿态控制器系数
处理：
调整安全模式偏航角偏差限幅的初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：NSMU初始化
处理：
初始化类型|自主切换允许标志|NSMUState
上电|允许|主份，发主开备关
上电|允许|备份，发备开主关
上电|允许|主份，发主开及备关
上电|允许|空闲
",1,0,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|均匀校时|FREQ1.4.5|""本周期的绝对星时；
均匀校时补偿量""|""本周期的绝对星时；
""|应用软件每次进行星时计算时，将计算后的绝对星时加上均匀校时补偿量作为本周期的补偿后的绝对星时。。具体见任务书要求
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：选择通讯的红外LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）红外共有两个LTU（正俯仰红外LTU和负俯仰红外LTU），AOCC每个控制周期向注入文件中的ZT5和IresLTUSeltFlag的最大组合中指定的和加电的红外LTU发送取数指令
（2）向选择的红外LTU发送完取数指令，获得红外LTU返回的数据，将数据转换为所需的数据格式。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：数传天线数据处理
",0,0,0,0,0,0,0,0,1,0,0
功能描述：进行单轴相平面分区及控制规律计算。由，决定是否要喷气；喷气的脉冲宽度；确定本时刻的。,0,1,0,0,0,0,0,0,0,0,0
功能描述：ACU模拟量遥测 ,0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|卫星轨道参数外推计算|FREQ2.0|5.1.1|实时计算卫星轨道参数。
|轨道外推根数获取与星历计算|FREQ2.1|5.1.2|岁差章动计算、GPS 轨道数据判断、太阳星历、地面站位置、地磁场强度计算
|GPS轨道数据有效性判断|FREQ2.2|5.1.2.2|对GPS轨道数据的有效性进行判断
|GPS 通道版和轨道版轨道计算|FREQ2.3|5.1.2.2.1和5.1.2.2.2|利用GPS 通道版和轨道版数据进行GPS 定轨程序
| 系的卫星位置及速度计算|FREQ2.4|5.1.2.5|将J2000 系的卫星位置与速度转换为WGS84 系的位置和速度
|近圆中低轨卫星轨道根数外推算法产品规范|FREQ2.5|/|规范化算法：
|近圆中低轨卫星GPS轨道计算算法产品规范|FREQ2.6|/|规范化算法：
|岁差章动矩阵计算算法产品规范|FREQ2.7|/|规范化算法：
|4阶星上地磁场计算方法算法产品规范|FREQ2.8|/|规范化算法：
|光行差计算算法产品规范|FREQ2.9|/|规范化算法：
|自主轨控计算及发送请求|FREQ2.10.0|5.1.2.6|根据实际与标称轨道参数计算轨控参数，并进行轨控申请
|自主轨控计算初始化|FREQ2.10.1|5.1.2.6.1|进行自主轨控远地点选取和轨控时间计算
|发送自主轨控请求|FREQ2.10.2|5.1.2.6.2|发送轨控加温请求，判断是否可以进行自主轨控
|牛顿插值法|FREQ2.1.2|6.1.25|根据一组已知时刻函数值，推断任意时刻函数值
",0,0,0,0,1,0,0,0,0,0,0
"功能描述：模拟太阳故障状态。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：CMG奇异状态的判断及算法计算。
输入：采集得的各CMG的框架角Sgang[i]（弧度）；CMG有效性标志Lcmg[i]，Jacobi矩阵sgJ",0,1,0,0,0,0,0,0,0,0,0
"功能描述：检测红外HL及HR故障，并选取正确的红外信号。

处理：
FM3——5.3（1）更改：若ZT35(3)=0，则：当HL通讯自检信号中表明见太阳，则HL = 0。若ZT35(3)=0，则：当HR通讯自检信号中表示见太阳，则HR = 0。
5.3（3）更改：若HL  HR = 1且HL的LTU中的特征位为“数据正常”，则：FHL  FHL + 1。若HL  HR = 1且HR的LTU中的特征位为“数据正常”，则：FHR  FHR + 1。
5.3（4）①更改： ZT5  4，{FHR < 6，HL =0}或{ FHL < 6，HR =0}
5.3（4）③更改： ZT5  4，HL = 1，HR = 0，FHL  6
5.3（4）④更改：ZT5  4，HR = 1，HL = 0， FHR  6
将红外数据有效性互检中的判断逻辑，扣除标称侧摆角度。",0,0,0,0,0,1,0,0,0,0,0
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
下图中模式之间的连接线分为实线和虚线，实线表示正常转移，虚线表示故障转移，在下表中具体列出了模式转移的条件。
                            图5-1 自主模式转换图
表5.2.4.4-2 模式自主转换条件（除复位后重要数据恢复成功转模式外）
序号|功能编号|功能简述|功能详述
|FREQ3.4. 1.22|WM0_to_WM1|连续27s满足组合体分离状态为已分离且触地开关状态为未触地后，系统转太阳定向模式，置LAFlag=00H，为组合体状态；
|FREQ3.4. 1.27|WM1_to_WM20|太阳定向模式中，若故障标志FailureFlag=3，则转入无控模式
|FREQ3.4. 1.28|WM2_to_WM3|""恒星定向2模式中，若惯性调姿开始时刻到tgon≤t≤tgon +ΔtMS且
tgon≥0，则转惯性调姿模式""
|FREQ3.4. 1.29|WM2_to_WM19|恒星定向2模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.30|WM3_to_WM4|""惯性调姿模式中，若姿态好或恒星定向4的时间到，即连续20个周期满足|qBT|≤qhon且|ω|≤ωhon或t≥thon，则转入恒星定向4模式""
|FREQ3.4. 1.31|WM3_to_WM19|惯性调姿模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.32|WM4_to_WM5|恒星定向4模式中，若轨控开始时刻到tgi≤t≤tgi+ΔtMS且tgi>0，则转入轨控定向模式
|FREQ3.4. 1.33|WM4_to_WM6|""恒星定向4模式中，若着陆上升组合体状态下着陆准备开始时刻到且启动动力下降标志有效，即LAFlag=0且
t0+Δtdb-t0p≤t≤t0+Δtdb-t0p+ΔtMS且
BKFlag=1，则转入着陆准备模式""
|FREQ3.4. 1.34|WM4_to_WM19|恒星定向4模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.35|WM5_to_WM1|轨控定向模式中，若轨控子模式字GMODE=2后计时>240s，则转入太阳定向模式
|FREQ3.4. 1.36|WM5_to_WM19|轨控定向模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.37|WM6_to_WM7|着陆准备模式中，若着陆准备模式开始时刻到且启动动力下降标志BKFlag=1，则转入主减速模式
|FREQ3.4. 1.38|WM7_to_WM8|主减速模式中，若FailureFlag=0且PDMSFlag=1，则转入快速调整模式
|FREQ3.4. 1.39|WM7_to_WM9_1|主减速模式中，若FailureFlag=0但是高度已经在主减速切换到接近下降的高度内h<hSafe1，则转入接近下降模式
|FREQ3.4. 1.40|WM7_to_WM9_2|主减速模式中，若（出现陀螺饱和Flag=1，则转入接近下降模式
|FREQ3.4. 1.42|WM7_to_WM10_2|主减速模式中，若FailureFlag=5且 速度满足故障时切换到悬停模式的条件且高度已在悬停高度偏差内，则转入悬停模式
|FREQ3.4. 1.44|WM7_to_WM10_4|主减速模式中，若FailureFlag=5且制导时间已经在切换到悬停模式的阀值内，则转入悬停模式
|FREQ3.4. 1.45|WM8_to_WM9_1|快速调整模式中，若PDMSFlag=2，则转入接近下降模式
|FREQ3.4. 1.46|WM8_to_WM9_2|快速调整模式中，若允许调用安全模式制导律ZT11(D10)=1，则转入接近下降模式
|FREQ3.4. 1.47|WM8_to_WM9_3|快速调整模式中，若高度已经小于快速调整转入接近下降的高度h<hSafe2，则转入接近下降模式
|FREQ3.4. 1.48|WM8_to_WM9_4|快速调整模式中，若出现陀螺饱和Flag=1，则转入接近下降模式
|FREQ3.4. 1.49|WM9_to_WM10_1|接近下降模式中，若接近段无超差AppFFlag=0且动力下降段模式切换标志PDMSFlag=4，则转入悬停模式
|FREQ3.4. 1.50|WM9_to_WM10_2|接近下降模式中，若接近段有超差AppFFlag=1且速度满足故障时切换到悬停模式的条件且高度已在悬停高度偏差内h≤hsus+ dhsus，则转入悬停模式
|FREQ3.4. 1.51|WM9_to_WM10_3|接近下降模式中，若接近段有超差AppFFlag=1且制导时间已经在切换到悬停模式的阀值内tgo1<tgo1AS，则转入悬停模式
|FREQ3.4. 1.52|WM10_to_WM11_1|悬停模式中，若已获安全着陆点SLPFlag=1，则转入避障模式
|FREQ3.4. 1.53|WM10_to_WM11_2|悬停模式中，若悬停计时超过悬停模式切换到避障模式的计时阀值tSH，则转入避障模式
|FREQ3.4. 1.54|WM10_to_WM11_3|悬停模式中，若成像时间已经只剩一个控制周期Tsus≤Δt，则转入避障模式
|FREQ3.4. 1.74|WM10_to_WM11_4|悬停模式中，若BZ1=7或8或9或10时发生过复位，则当vmb_B 低于阀值后转避障
|FREQ3.4. 1.55|WM11_to_WM12_1|避障模式中，若高度距离缓速下降起始高度已经达到模式切换阀值，则转入缓速下降模式
|FREQ3.4. 1.56|WM11_to_WM12_2|避障模式中，若制导时间与避障垂向规划轨迹标称时间之差大于2个控制周期，则转入缓速下降模式
|FREQ3.4. 1.57|WM12_to_WM20_1|""缓速下降模式中，若收到关机信号且缓速下降持续时间大于缓速下降切换到无控的时间切换阀值1，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.58|WM12_to_WM20_2|""缓速下降模式中，若缓速下降持续时间大于缓速下降切换到无控的时间切换阀值2，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.59|WM12_to_WM20_3|""缓速下降模式中，若缓速下降持续时间大于缓速下降切换到无控的时间切换阀值3且注入指令允许加速度关机，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.60|WM14_to_WM15|""起飞准备模式中，若起飞时间到且收到着陆上升器分离信号，则转垂直上升模式
转模式删除tLaunch=t""
|FREQ3.4. 1.70|WM14_to_WM20|起飞准备模式中，若FailureFlag=7，则转无控模式，置BZ1=20
|FREQ3.4. 1.61|WM15_to_WM16|""垂直上升模式中，t>tswitch或（max(|φc|,|θc|,|ψc|)<Φswitch且dh>vswitch 且FailureFlag=0，则切换为BZ1=16""
|FREQ3.4. 1.71|WM15_to_WM17|""垂直上升模式中，t>tswitch或（max(|φc|,|θc|,|ψc|)<Φswitch且dh>vswitch 且FailureFlag≠0，则置PEGConvergeFlag=0，切换为BZ1=16""
|FREQ3.4. 1.69|WM15_to_WM20|垂直上升模式中，若t≥tLaunch+Δtac 且RCSOnFlag≠1，则切换为无控模式BZ1=20
|FREQ3.4. 1.62|WM16_to_WM17|上升调姿模式中，若t-tswitch>tPD1且δθgui≤ΔθPD）或t-tswitch>tPD2，则转入轨道入射模式
|FREQ3.4. 1.72|WM16_to_WM17_2|上升调姿模式中，若FailureFlag≠0，则置PEGConvergeFlag=0，并切换轨道入射模式BZ1=17。
|FREQ3.4. 1.63|WM17_to_WM1_1|轨道入射模式中，若GMODE=2且TGMODE·Δt>Δtaf，则转入太阳定向模式
|FREQ3.4. 1.75|WM17_to_WM3|轨道入射模式中，若GMODE=2且FailureFlag=8，则转入惯性调姿
|FREQ3.4. 1.65|WM18_to_WM1|星光环月模式下，若FailureFlag=6，则转入太阳定向模式
|FREQ3.4. 1.66|WM18_to_WM20|星光环月模式下，若收到轨道器或地面发送的转无控命令，或收到微波应答机发送的停控指令后，则转入无控模式
|FREQ3.4. 1.67|WM19_to_WM2|速率阻尼模式下，若连续100个周期满足惯性角速度好，且ZT11(D11)=1，则转恒星定向2
|FREQ3.4. 1.68|WM19_to_WM1|速率阻尼模式下，若FailureFlag=2，则转入太阳定向模式
|FREQ3.4. 1.73|WM19_to_WM1_2|速率阻尼模式下，若连续100个周期满足惯性角速度好，且ZT11(D11) ≠1，则转入太阳定向模式
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：
  应急软件初始化功能在软件上电或复位时调用，完成应急软件相关变量的初始化工作和硬件初始化。
处理： 完成80C32E处理器初始化、软件变量初始化、ASIC芯片初始化、1553B初始化，初始化流程的前后顺序可适当调整。
（1）80C32E处理器初始化：
初始化项目|寄存器名|初始值|说明
中断使能寄存器|IE|0x00|关闭中断。
计时器控制寄存器|TCON|0x05|外部中断0、1触发方式设置为下降沿触发。
计时器模式寄存器|TMOD|0x61|定时器1工作模式为2：自动装入TL1计数（8位）;定时器0工作模式为1: 16位定时器
定时器1初值|""TH1
TL1""|""0x00
0x00""|计数器（定时器）1从0开始进行计数，计数到256时溢出，触发计数器1中断，从而得到128ms
中断优先级寄存器|IP|0x01|中断优先级设置:全帧遥测数据接口帧同步中断为高优先级, 其余低优先级
P1口|P1_4|1|选择主份TM
P1口|P1_0|1|清狗电平
内部RAM|0x00~0xFF|0x00|上电后将内部RAM初始化为0

（2）软件变量初始化
软件变量初始化时，先将32KB外部RAM初始化为0，之后将非零变量显示初始化。帆板初始状态为正向复位，部件状态为不加电，推力器采用A分支，部件故障诊断不允许。
（3）ASIC芯片初始化
按照任务书、以及硬件技术说明书对ASIC芯片进行初始化，主要涉及GPIO口、GC计数器、GT定时器，同步串口等。
（4）1553B初始化
详见5.2.9.1节 FReq-9。
初始化完成后，允许总中断、T1(128ms)定时器中断、外部中断0，并启动T1。",1,0,0,0,0,0,0,0,0,0,0
功能描述：GPS定轨程序。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量（动量轮角速度为1800r/min时的角动量为15Nms）。
（3）令（i = 1，2，… ，4）。为上一次轮子角动量值。",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|功能及处理描述
|星敏感器1数据的采集与处理|FREQ4.1|选择通讯的星敏1LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|星敏感器2数据的采集与处理|FREQ4.2|选择通讯的星敏2LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：计算星上星时。
处理：
应用软件的星上时是以星箭分离时刻作为“0”时刻。
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收发送AOCC重要数据
处理：
控制分系统重要数据保存在系统内ICU以及外系统的CTU，应用软件上电/复位后首先从ICU恢复重要数据，如果连续5个控制周期申请重要数据失败（帧头错误、校验和错误或者收到的数据为非法数据）则认为从ICU恢复重要数据失败。应用软件通过外部1553B总线向OBDH申请星上时间和重要数据，如果连续15个控制周期申请重要数据失败，则根据星箭分离状态进行模式转换，并清除服务请求和矢量字。若星箭已分离则设置模式字为“入轨段”，星箭未分离则设置模式字为“主动段”。
申请重要数据成功后，按照重要数据中保存的部件当班状态初始化各部件软件当班状态，对于光纤陀螺产品需根据重要数据中的当班状态进行恢复对于三浮陀螺则根据重要数据中的Fi_GyroSelt状态进行恢复，并统一根据Fi_GyroSelt和当班状态补发产品开指令；对于CMG、红外、星敏产品根据重要数据中的当班状态恢复状态；统一根据当班状态和选择标志补发产品开指令；针对三浮陀螺产品，陀螺开指令连续发送3个控制周期后，连续3个控制周期发送陀螺马达开指令
  申请重要数据失败后，对于陀螺产品则根据ACU提供的部件加电状态初始化陀螺的当班状态和Fi_GyroSelt状态，并根据Fi_GyroSelt状态和当班状态补发产品开指令；对于红外产品，则根据ACU提供的部件加电状态初始化红外的当班状态和Fi_IRESSelt状态，并根据Fi_IRESSelt和当班状态补发产品开指令；对于CMG，根据ACU提供的部件加电状态初始化CMG的当班状态和Fi_CMGSelt状态，并根据Fi_CMGSelt状态和当班状态补发产品开指令；对于星敏感器，软件当班状态仍保持“不当班”状态，等待地面指令设置相应部件当班状态；
重要数据恢复成功后，使用第二块重要数据中的q\q\q\ q恢复“星体在惯性系下的姿态四元数q1/qng1、q2/qng2、q3/qng3、q4/qng4”。
第二块重要数据增加保存星敏定姿方式下的卫星三轴姿态角估值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理：
（1）AOCC的星上时钟是由一片54-4的通道0和1组成的32位计数器，输入脉冲速率为976.5625Hz。AOCC从54-4中读取32位时间（最小码位当量为1.024毫秒），将该时间转换为32位定点数并保存在THDT（LSB=1/8秒）、40位定点数并保存在THDT40（LSB=1/256秒）中。
（2）OBDH通过1553B总线每10分钟给AOCC校时一次（校时误差＜20ms），OBDH所产生的卫星时间为标准北京时间，其时间原点位于北京时间的毫秒的起点。卫星时间由6字节构成（如下表所示），其中高4字节为32比特的二进制的秒数，低2字节为亚秒部，最小码位当量为25微秒。将这个时间转换为LSB=1/8秒并保存在32位定点数TT0、TTS0和40位定点数TT040中，转换为36位定点LSB=1/128秒保存在OBQT36中。
47||     |0
秒（32位）|毫秒（16位）|秒（32位）|毫秒（16位）

（3）对0.524秒控制周期进行时间累计将结果保存在32位定点数TSDT（LSB=1/8秒）
（4）计算32位定点数星时TT（TTH=TT0+THDT、TTS=TTS0+TSDT，TT等于两者之一：默认为TTH，当OBDH星时与TTS的差小于等于1秒且TTH与TTS之差大于8秒选择为TTS或当8254出现故障，软时钟与OBDH的时间比较接近时，采用软时钟TTS）和40位定点数星时TT40（TT040+THDT40 ）
（5）AOCC要将接收到的OBDH时间与AOCC中当前时间TT进行比对，如果相差8秒以上应申请OBDH立即重新校时一次。如果再次相差8秒则校时有效。
（6）将TT转换为如下格式的48位遥测时间并通过OBDH遥测下传：
47||     |0
秒（32位）|毫秒（16位）|秒（32位）|毫秒（16位）

（7）接收OBDH注入的轨道数据块、中继卫星轨道数据块、轨控命令块、帆板命令块中时间（40位定点数，最小码位当量为秒）。根据用户需求用TT40和这些时间进行运算。
（8）接收OBDH每4s向AOCC发送一次GPS定位数据，根据用户需求用TT40和其中的40位定点数，当量为秒的GPS时间进行运算。
（9）接收OBDH的中继快扫到位指令，记中继快扫到位指令中的时间（格式为32位定点数，当量为1秒）。将TT转换为当量为1秒的时间和这个时间进行计算。：
31||0
32位，最小码位当量为1秒|32位，最小码位当量为1秒|32位，最小码位当量为1秒

（10）接收OBDH的整星侧摆指令，将其中两字节相对时间（数据格式是16位无符号定点数，最小码当量1s）转换为24位浮点数并保存在DTM中。记录接收OBDH的整星侧摆指令的时间并保存在（32位定点数，LSB=1/8秒）
整星侧摆指令中的时间格式为：
15||0
16位，最小码位当量为1秒|16位，最小码位当量为1秒|16位，最小码位当量为1秒

（11）将TT转换为36位定点数，LSB=1/128秒的数据格式并保存在QT36中。
（12）将星敏取数返回数据中的相对时间（16位有符号数，码当量1ms，最高位为符号位，负数用补码表示）和校时时刻TT-STSA、TT-STSB、TT-STSC（三个时间格式为精度高于秒的时间）进行运算，将结果转换为32位浮点数并保存在t星A、t星B、t星C中。
（13）校时
定时校时，即OBDH每10分钟向AO发送一次校时指令；
当软钟与OBDH时间差大于8秒，则重新申请一次校时；如果还大于8秒，接授OBDH时间；
当AO发生复位和切机后需要重新校时；
如果计算机软件直接通过非屏蔽软件有系统软件引导到应用软件，也需要校时。",0,0,0,0,0,0,0,0,1,0,0
功能描述：偏航捕获模式初始化                                                                                                                                                                                处理：第i项当用星敏捕获时置SMODE =1改为SMODE =0。,0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收卫星时间
处理：AOCC上电或复位时通过发送重要数据申请给OBDH，OBDH把卫星时间和AOCC重要数据都发到AOCC终端。",0,0,0,0,0,0,0,0,0,1,0
"软件需求名称：初始化 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。
调用条件：上电/复位。
处理：依据“用户需求”、“任务书”、“上行注入”对非0变量进行初始化。 ",1,0,0,0,0,0,0,0,0,0,0
"功能描述：根据红外输出，估计卫星姿态与陀螺漂移。
输入： 姿态估计值
红外测量的新息
陀螺漂移估值
标志F_IresUsed",0,0,1,0,0,0,0,0,0,0,0
"功能描述：复位模式初始化
处理：
- StarTime（星上时间）：0.0；
- 向星务分系统申请重要数据；",1,0,0,0,0,0,0,0,0,0,0
"软件需求标识：FREQ26 
软件需求名称：推进数据采集处理要求 
需求类别：其他 
软件需求描述：推进数据采集处理要求。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输出：数字太阳敏感器输出；模拟太阳敏感器输出；模拟式太阳敏感器视场码；0-1式太阳敏感器的信号（0或1）；数字太阳敏感器视场码。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得数字太阳、模拟太阳、0-1太阳数据；每个控制周期根据DSSLTUSeltFlag确定进行通讯的太阳LTU，发送取数指令，具体如下表所示：
DSSLTUSeltFlag |进行通讯的太阳LTU|发送的取数指令
01H|太阳LTU1|43H
02H|太阳LTU2|43H
其它|根据LTU故障诊断的结果决定太阳LTU的选取。初始状态为太阳LTU1|43H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，具体参见LTU通讯协议件。
（3）太阳LTU数据采集过程中的故障处理见4.4.3中规定。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：若连续3个周期判断出星箭分离信号为分离，则置初始速率阻尼模式，对卫星的角速度进行控制。
处理：
自主或指令进入此模式后，进行如下初始设置：
星时赋初值为0.375s；
连续2个周期发送“推进加电”指令；
根据自锁阀状态设置自锁阀1和/或自锁阀2开
发送6个陀螺加电指令，引入6个陀螺信息，且不需要陀螺等待时间
每个控制周期顺序调用用户需求中的逻辑：
轨道与星历；
部件故障检测与信号选取；
陀螺数据处理；
惯性姿态陀螺预估；
速率阻尼；
控制器输入量计算；
if((1<t <60|| t>80)且Flag_equation=0) 调用 相平面喷气脉宽；
模式转换条件：
若t >100，则WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收时间码
处理： 记录收到时间码时对应的GPT的计数值和时间码值，并设置相应的标志。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：根据红外输入，计算滚动和俯仰角。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：在CMG控制期间按照一定算法对磁力矩器施加控制电压，所产生磁矩与实际地磁场相互作用产生磁控力矩对CMG进行卸载。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：进行单轴相平面分区及控制规律计算。由、、决定是否要喷气；喷气的脉冲宽度；确定本时刻的。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据红外信息进行姿态滤波修正。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|轨道与星历|FREQ2.0|5.1.1|卫星轨道、太阳星历、地面站位置、地磁场强度等计算程序的主流程。
|卫星轨道计算|FREQ2.1|5.1.2|计算卫星当前轨道
|GPS轨道数据有效性判断|FREQ2.2|5.1.3|对GPS轨道数据的有效性进行判断
|GPS轨道版轨道计算|FREQ2.3|5.1.4|利用GPS轨道版数据进行GPS定轨程序
|轨道、目标姿态预计算|FREQ2.4|5.1|完成下控制周期的轨道星历与目标姿态预先计算
|近圆中低轨卫星轨道根数外推算法产品规范|FREQ2.5|/|规范化算法：
|近圆中低轨卫星GPS轨道计算算法算法产品规范|FREQ2.6|/|规范化算法：
|岁差章动矩阵计算算法算法产品规范|FREQ2.7|/|规范化算法：
|4阶星上地磁场计算方法算法产品规范|FREQ2.8|/|规范化算法：
|光行差计算算法产品规范|FREQ2.9|/|规范化算法：
",0,0,0,0,1,0,0,0,0,0,0
"功能描述：当星敏感器需要粗姿态时，利用卫星的姿态估值，计算两个星敏感器的光轴在惯性坐标系中的投影。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压
说明：  控制方式发生改变时，每回首次调用该模块时清轮子角动量积分量。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：
 128ms周期计时（功能编号：FReq-13）。
处理： 设置128ms控制周期中断标志，计数器值为0时产生中断，不需要显示的重新装载。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：轨控推进系统与加速度计联合诊断加计及轨控部件状态
",0,0,0,0,0,1,0,0,0,0,0
功能描述：动量轮转速采集 ,0,0,0,0,0,0,0,0,1,0,0
功能描述：飞轮进行整星零动量和侧摆控制。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：运行段喷气姿态控制及飞轮控联合运行。
处理：同用户需求的
（1）各轴喷气参数设置如表35所示
表35：运行段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|2.0|2.0|2.0
|1.0 mθD11（注1）|1.0 mθD11（注1）|1.0 mθD11（注1）
|1.0 mθD11（注2）|1.0 mθD11（注2）|1.0 mθD11（注2）
|4.5（注4）|4.5（注4）|4.5（注4）
|3.0 mθB31|3.0 mθB31|3.0 mθB31
|0.14|0.2|0.1
|0.2（注3注4）|0.2（注3注4）|0.2（注3注4）
|（注3-1）|（注3-1）|（注3-1）
|0.03|0.03|0.03
|0.08|0.08|0.08
|0.43（注3注4）|0.43（注3注4）|0.43（注3注4）
|（注3-1）|（注3-1）|（注3-1）
|0.2（注1）|0.2（注1）|0.2（注1）
|0.06（注2）|0.06（注2）|0.06（注2）
KJ2(s)|3|3|3
KJ2(s)|0.5（注3-1）|0.5（注3-1）|0.5（注3-1）
aJS（/s2）|0.137|0.235|0.089

注1：在FHU = A或 { BZ1 = 4，FEA = 0 }的条件下
注2：在FHU = A，ZT3 = F或A或B的条件下
注3：在{ BZ1=8且FRTS=1}的条件下
注3-1：在{ BZ1 = 3，ZT36 = F }的条件下
注4：在ZT40(2)=1,BZ1=1,ZT8≤3,ZT2≤2,FWH≠22的条件下
（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,1,0,0,0,0,0,0,0,0,0
"功能描述：对自锁阀进行开关处理。
处理：
控制分系统共有两个自锁阀，分别是姿控A套自锁阀(自锁阀1)、姿控B套自锁阀(自锁阀2)。
在星箭分离后，分离开关有效，1秒“分离停控”内；或由“初始速率阻尼”指令退出主动段时，应用软件通过与ALTU通讯发送自锁阀1和自锁阀2开指令。
只有一个自锁阀开时，选择相应的发动机组，两个自锁阀都开时，选择第一组发动机组（A套）。若地面注入修改时，选择注入的发动机组。
复位后若取回重要数据中的模式是对地、对日定向模式、应急和停控模式则不对自锁阀进行操作，否则按重要数据中的自锁阀状态设置自锁阀1、2的开关；否则，根据重要数据中自锁阀的状态发送自锁阀开指令。
自主或遥控进入“停控模式”时，需要发送两个自锁阀关指令。
应用软件通过星务分系统接收自锁阀开关的数据指令，与ALTU通讯，控制自锁阀的开关。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：滚动机动目标姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：计算机应急模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：对星敏感器输出数据进行有效性判断。
输入：STSFailureDiagPermFlag, ZT6，星敏1 输出四元数，
星敏2输出四元数，星敏3输出四元数，预估四元数
t， t星A，t星B ，t星C ,  tmdts ,ZAR , ZBO Z , ZCR Z ,  ms ,  ms1 ,  ms2 ， ms3。
输出：ZA，XA，ZB，XB，ZC，XC，
星敏感器参与定姿标志FSTA，FSTB，FSTC，FSTD 。",0,0,0,0,0,0,1,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|轮控说明|FREQ4.2|5.4.2.1|计算动量轮安装阵及电压分配阵，标称角动量
|轮系摩擦补偿电压计算|FREQ4.3|5.4.2.2|""轮系摩擦力矩的补偿电压计算
""
|动量轮启动与保持|FREQ4.4|5.4.2.3|启动动量轮至标称角动量，并保持
|正常飞行动量轮分配电压计算|FREQ4.5|5.4.2.4|计算正常飞行轮控所需电压
|偏置动量轮分配电压计算|FREQ4.6|5.4.2.5|""计算偏置动量控制时候所需的轮控电压
""
|大力矩飞轮启动与保持|FREQ4.7|""5.4.3.1
""|启动飞轮至标称角动量或角动量维持
|大力矩飞轮控制电压计算|FREQ4.8|""5.4.3.2
""|计算机动或正常模式下保持时的大力矩飞轮控制电压
|喷气卸载条件计算|FREQ4.9|5.4.4|喷气卸载进入和退出条件计算
|磁卸载控制|FREQ4.10|5.4.5|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1|地面站赤经赤纬计算
|运行段帆板控制|FREQ4.12|5.5.1|三轴稳定模式下的帆板控制
|太阳帆板自主跟踪控制|FREQ4.13|5.5.2|根据帆板角误差、控制帆板跟踪太阳
|数传天线指向控制|FREQ4.14|5.6.1.1|根据指令完成数传天线的指向控制
|中继轨道计算|FREQ4.22|5.7.1|中继卫星轨道确定。
|中继天线指向控制|FREQ4.23|5.7|根据指令完成中继天线的指向控制
|动量轮转速保持算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|""基于零空间的N个动量轮的角动量自调整算法产品规范
""|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|""基于三轴角动量反馈的偏置动量控制方法产品规范
""|FREQ4.21|/|规范化算法：
|双脉冲变轨|FREQ4.22|""任务书的
4.2.3""|根据地面注入的指令可实现两次轨控的功能
|数传天线指向目标角计算|FREQ4.14.2|5.6.2|根据指定跟踪数传天线与其被指定跟踪站的方位，计算其跟踪转角
|数传天线指向目标角平滑处理|FREQ4.14.3|5.6.3|由设定加速度与角速度极限约束，对目标转角平滑处理
|数传运动扰动力矩计算|FREQ4.14.4|5.6.4|根据天线运动信息计算对星体质心扰动力矩
|数传角速度控制指令计算|FREQ4.14.5|5.6.5|计算以角速度指令跟踪控制量
|中继天线指令转角计算|FREQ4.23.2|5.7.2|根据指令完成中继天线的捕获跟踪控制
|中继天线扫描指令计算|FREQ4.23.3|5.7.3|根据指令完成中继天线的捕获跟踪控制
|中继天线指向目标角平滑处理|FREQ4.23.4|5.7.4|由设定加速度与角速度极限约束，对目标转角平滑处理
|中继运动扰动力矩计算|FREQ4.23.5|5.7.5|根据天线运动信息计算对星体质心扰动力矩
|中继角速度控制指令计算|FREQ4.23.6|5.7.6|计算以角速度指令跟踪控制量
|外扰力矩估计|FREQ4.24|5.4.2.6|星体扰动力矩实时估计
|姿态机动时的动量轮角动量自调整|FREQ4.25|5.4.2.7|对星体进行姿态机动时的动量轮角动量进行调整
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：处理地面遥控数据指令
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：处理地面遥控注入的程序代码
处理：解包程序代码注入包，得到目的地址、注入内容长度；将注入内容放入目的地址内。
说明：星务分系统向GNCC送数采用256字节(有效使用249字节)帧格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,0,0,0,1,0
"功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。
输入：姿态角，姿态角速度，
实测飞轮角动量   =[，]T
标称角动量       =[，]T
      标志             UnLoadMode， F_WheelSaturation， F_AttrOutLmt
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：ICU模拟量遥测 
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书。
功能编号|功能|引用文档
FREQ52|初始化|星敏协议
FREQ53|星敏使用要求|任务书
FREQ54|通信|星敏协议
FREQ55|通信故障处理|任务书
FREQ56|数据解包与转换|星敏协议
FREQ57|星敏数据有效性判断、处理|任务书
FREQ58|星敏模拟量采集、处理|任务书
FREQ59|部件在轨转发（在轨修改）|任务书

3）GPS高精度校时与星敏感器数据的使用
功能描述：根据GPS秒脉冲，秒脉冲广播，进行GPS高精度校时和星敏感器时标处理。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：动量轮摩擦力矩的补偿电压计算。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件1553B初始化、变量的初始化
处理：
进行1553B初始化，处理过程见的OBDH初始化功能
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的地面站位置信息功能区数据,0,0,0,0,0,0,0,0,0,1,0
"功能描述：根据红外信息，进行全姿态捕获
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|轨道与星历|FREQ2.0|5.1.1|卫星轨道、太阳星历、地面站位置、地磁场强度等计算程序的主流程。
|卫星轨道计算|FREQ2.1|5.1.2|计算卫星当前轨道
|GPS轨道数据有效性判断|FREQ2.2|5.1.3|对GPS轨道数据的有效性进行判断
|GPS轨道版轨道计算|FREQ2.3|5.1.4|利用GPS轨道版数据进行GPS定轨程序
|轨道、目标姿态预计算|FREQ2.4|5.1|完成控制周期的轨道星历与目标姿态预先计算
|近圆中低轨卫星轨道根数外推算法产品规范|FREQ2.5|/|规范化算法：
|近圆中低轨卫星GPS轨道计算算法算法产品规范|FREQ2.6|/|规范化算法：
|岁差章动矩阵计算算法算法产品规范|FREQ2.7|/|规范化算法：
|4阶星上地磁场计算方法算法产品规范|FREQ2.8|/|规范化算法：
|光行差计算算法产品规范|FREQ2.9|/|规范化算法：
",0,0,0,0,1,0,0,0,0,0,0
"功能描述：发送卫星应急控制字
处理：先将AOCC矢量字中“AOCS应急控制标志”位置1，将总线状态字服务请求位置1；OBDH检测到AOCC总线通讯状态字中的服务请求后，自动发送方式指令，从AOCC接收矢量字，判定矢量字中 “AOCS应急控制标志”位为1后，通过子地址19向AOCC发送“卫星应急控制确认字”；AOCC在接收到OBDH“卫星应急控制确认字”后，将状态字服务请求位清0，将矢量字“申请传送OBDH时间”位清0。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：与发动机通信，输出本周期喷气脉宽。
处理：
功能编号|功能|引用文档
FREQ94|初始化|任务书
FREQ95|推力器使用要求(自锁阀和发动机组的选择)|任务书
FREQ96|通信(脉冲输出)|任务书
FREQ097|通信故障处理|预留
FREQ098|数据解包与转换|预留
FREQ099|推力器数据有效性处理|预留
FREQ100|推力器模拟量采集、处理|任务书
FREQ101|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：输出CMG控制指令。
处理：
功能编号|功能|引用文档|备注
FREQ61|CMG初始化|CMG协议|B
FREQ62|CMG数据采集|任务书|B
FREQ63|CMG数据解包与转换|CMG协议|B
FREQ64|CMG指令输出|CMG协议|B
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：与帆板通信，控制帆板并获得帆板状态数据。
处理：
见通信协议。
功能编号|功能|引用文档
FREQ70|初始化|中心控制单元与双轴帆板驱动线路通信协议
FREQ71|帆板使用要求|任务书、帆板协议
FREQ72|通信(串口)|任务书、帆板协议
FREQ73|通信故障处理|任务书
FREQ74|数据解包与转换|帆板协议
FREQ75|帆板数据有效性判断、处理|任务书
FREQ76|帆板模拟量采集、处理|任务书
FREQ77|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：处理地面遥控注入的固定地址参数
处理：
128-135：注入参数乘修正系数
515：全量校时处理：星时=全量校时星时
516：增量校时处理星时=星时+增量校时量
其它：更新注入的参数",0,0,0,0,0,0,0,0,0,1,0
"功能描述：通过注入轨道参数，实时计算卫星轨道参数。
处理： 
由地面注入轨道参数或GPS数据计算的轨道参数（如果GPS引入且数据验证有效），结合当前星时，通过外推公式计算出卫星轨道数据。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：偏置动量轮处于力矩模式，根据红外或星敏测量信息计算得到的滚动角和俯仰角实现三轴姿态控制。滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制。,0,1,0,0,0,0,0,0,0,0,0
"功能编号：FREQ42
功能描述：为三轴姿态喷气控制选择喷管；并记录喷气时间等。
",0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：遥测打包 
需求类别：其他 
软件需求描述：打包内容见“遥测”。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：将星务通过CAN总线广播的GPS定位数据转换成轨道根数。
处理：
由GPS定位数据r（位置），v（速度）计算出轨道六要素（半长轴、偏心率（由两部分组成）、轨道倾角、升交点赤经、平近地点幅角）并通过半长轴、轨道倾角、升交点赤经、平近地点幅角、星时校验，再通过轨道六要素计算其他轨道根数。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：发送控制计算机指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,0,0,0,1
"功能描述：接收GPS数据
处理：将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度、轨道数据的数据格式。",0,0,0,0,0,0,0,0,0,1,0
"功能：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送实时遥测数据。
处理：应急线路实时帧数字量共一个数据包，共60字节，具体定义见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：各模式控制量计算
序号|功能编号|功能简述|功能详述
|FREQ3.4.3.1|等待段调用流程|用户需求4.1.1【调用流程】
|FREQ3.4.3.2|太阳定向模式调用流程|用户需求4.1.2【调用流程】
|FREQ3.4.3.3|恒星定向2/4模式调用流程|用户需求4.1.3【调用流程】
|FREQ3.4.3.4|惯性调姿模式调用流程|用户需求4.1.5【调用流程】
|FREQ3.4.3.5|轨控定向模式调用流程|用户需求4.1.6【调用流程】
|FREQ3.4.3.6|着陆准备模式调用流程|用户需求4.1.7【调用流程】
|FREQ3.4.3.7|主减速模式调用流程|用户需求4.1.8【调用流程】
|FREQ3.4.3.8|快速调整模式调用流程|用户需求4.1.9【调用流程】
|FREQ3.4.3.9|接近下降模式调用流程|用户需求4.1.10【调用流程】
|FREQ3.4.3.10|悬停模式调用流程|用户需求4.1.11【调用流程】
|FREQ3.4.3.11|避障模式调用流程|用户需求4.1.12【调用流程】
|FREQ3.4.3.12|缓速下降模式调用流程|用户需求4.1.13【调用流程】
|FREQ3.4.3.13|自主定位模式调用流程|用户需求4.1.14【调用流程】
|FREQ3.4.3.14|起飞准备模式调用流程|用户需求4.1.15【调用流程】
|FREQ3.4.3.15|垂直上升模式调用流程|用户需求4.1.16【调用流程】
|FREQ3.4.3.16|上升调姿模式调用流程|用户需求4.1.17【调用流程】
|FREQ3.4.3.17|轨道入射模式调用流程|用户需求4.1.18【调用流程】
|FREQ3.4.3.18|星光环月模式调用流程|用户需求4.1.19【调用流程】
|FREQ3.4.3.19|速率阻尼模式调用流程|用户需求4.1.20【调用流程】
|FREQ3.4.3.20|无控模式调用流程|用户需求4.1.21【调用流程】
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送延时遥测数据
处理：
延时遥测数据格式内容具体见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0 |主动段|FREQ52
1|入轨段控制|FREQ53
2|巡天观测模式|FREQ54
3|定点观测模式|FREQ55
4|小天区扫描模式|FREQ56
5|姿态机动|FREQ57
6|轨控|FREQ58
7|捕获太阳并对日定姿模式|FREQ59
8|帆板未展开|FREQ60
9|无控|FREQ61
10|应急模式|FREQ62

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制见用户需求的4。主要模式的姿态确定调用流程的功能点如下：
序号|功能编号|功能描述|用户需求中对应章节
|FREQ53.1|对日定向姿态确定调用流程|5.2.1.1
|FREQ54.1|巡天模式姿态确定调用流程|5.2.1.2
|FREQ55.1|定点观测模式姿态确定调用流程|5.2.1.3
|FREQ56.1|小天区扫描模式姿态确定调用流程|5.2.1.4
|FREQ57.1|姿态机动模式姿态确定调用流程|5.2.1.5
|FREQ58.1|轨控模式姿态确定调用流程|5.2.1.6
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的轨迹规划修正系数
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：根据星敏感器的输入，计算姿态偏差，角速度等。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收卫星安全控制确认字,0,0,0,0,0,0,0,0,0,1,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：，
输出：保持角动量所需电压，
      角动量偏差积分项：，
",0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。
|红外2数据的采集与处理|FREQ1.3.2|""红外2
1553取数指令""|红外2的弦宽和前基|在通讯允许的条件下（红外2的当班标志为1），向红外2 RT发取数指令，获得红外2数据并处理成对应的弦宽和前基。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：根据红外数据和姿态角速度偏差进行系统故障的检测。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：利用星敏感器A、B的测量，估计姿态。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：正常对地运行模式初始化,0,0,0,1,0,0,0,0,0,0,0
功能描述：动量轮状态确定。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据天线安装定义和地面站坐标，实时计算天线和地面站的夹角。
",0,0,1,0,0,0,0,0,0,0,0
当需要请求服务时，将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：星敏感器数据处理，安装偏差估计。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据红外、太阳、星敏感器的输出数据判断陀螺故障。
输入：
      陀螺：		故障标志F_GyroDiagnV
本周期陀螺数据的输出 (量纲：弧度)
		   			陀螺等效漂移估值
      红外：  	故障标志IRES_FLAG，数据有效性F_IresValid
          			本周期红外数据处理输出， (单位：弧度)
      数字太阳：	故障标志DSS_FLAG
数据有效性F_Ds1Valid, F_Ds2Valid
          			本周期太阳输出,  (单位：弧度)
	  星敏感器： 	故障标志数组SS_FLAG[2]
数据可用标志F_SAValid, F_SBValid
本周期星敏感器A角速度输出, 
本周期星敏感器B角速度输出, (单位：弧度/秒)
星敏感器A安装矩阵
星敏感器B安装矩阵
本周期采样到的星敏感器A的有效输出(
本周期采样到的星敏感器B的有效输出(
轨道角速度
太阳星历计算输出
标志F_GyroDiagnIresDssORSS",0,0,0,0,0,1,0,0,0,0,0
"功能：利用星敏感器C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：计算CMG的框架角速度,。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的结构滤波器系数
处理：
调整各系数的初装值。",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|部件状态、双组元推进状态1、推进状态2、ACU工作状态|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|计算得到的喷气脉宽、磁力矩器电压|控制指令消息的输出|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
|部件加断电指令的处理|FREQ1.8.4|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.5|保存CCU的重要数据|接收CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.6|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|FREQ1.8.7|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.8|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.9||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令
",0,0,0,0,0,0,0,0,1,0,0
功能描述：根据注入轨道参数计算太阳轨道、方位与其他参数。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据太阳矢量在帆板1法平面内投影与帆板法线之间的夹角，通过帆板驱动机构1控制帆板1，使帆板1能捕获及跟踪太阳。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：利用数字太阳信息，进行太阳捕获，对太阳定向。
输入：5.2.17.2的输出 ， 
计时器TShadow，
数字太阳敏感器状态F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出），
数字太阳敏感器输出,（量纲：弧度）
上周期姿态角估值，",0,0,1,0,0,0,0,0,0,0,0
"功能描述：处理地面遥控注入的内存下卸指令注入
处理：解包内存下卸指令注入，得到内存下卸起始地址用于第七类快帧数据打包。
说明： 遥测数据指令采用16字节(有效使用9字节)格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,0,0,0,1,0
"功能描述：根据从SLTU接收的0.25秒或1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
输入：0.25秒或1秒内陀螺的角度增量 (量纲：弧度)
(i=1,2,3,…6，依次表示陀螺G1，G2，…，G6的输出)；
采样周期 (量纲：秒)；
陀螺数据有效性标志F_GyroValid(由陀螺有效性判据给出)。
陀螺系统在星体三轴方向等效的常值漂移估值 (量纲：弧度/小时)
星敏感器数据有效性标志：F_SAValid，F_SBValid，F_SCValid",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据标志选择轨控发动机。,0,1,0,0,0,0,0,0,0,0,0
功能描述：确定各部件的工作状态，并开关相关部件电源。,0,0,0,0,0,0,0,0,1,0,0
"功能描述：将动量轮保持至标称角动量所需的电压。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：根据帆板角误差控制帆板跟踪太阳。,0,1,0,0,0,0,0,0,0,0,0
功能描述：发送轨道数据包,0,0,0,0,0,0,0,0,0,0,1
"功能描述：轨道与星历计算。
",0,0,0,0,1,0,0,0,0,0,0
功能描述：实现正常模式姿态偏置模式下的偏流角计算。,0,0,0,0,1,0,0,0,0,0,0
功能描述：根据从0.25秒/1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。,0,0,1,0,0,0,0,0,0,0,0
功能描述：CMG启动模式初始化,0,0,0,1,0,0,0,0,0,0,0
"控制计算机实时遥测包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包1|FRE65
|发送姿态数据包3|FRE65.1
|星敏感器姿态数据包|FRE65.2
|星敏感器自检数据包|FRE65.3
|姿态控制数据包|FRE65.4
|轨道数据包|FRE65.5
|LTU自检数据包|FRE65.6
|AOCC及状态数据包|FRE65.7
|发送星敏修正数据包|FRE65.8
|发送对日定向数据包|FRE65.9
|数传天线地面夹角数据|FRE65.10

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：帆板故障检测，切换帆板LTU。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：接收带数据字的同步                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      处理：根据同步字的编码内容进行相应的处理：
编码|相应的处理
11|数据发送开始
12|数据发送结束
EE|数据接收开始
EB|数据接收结束
bit4～bit0|数据发送/接收子地址
bit7～bit5|0
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：搜索地球，直到红外有地球信息。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据陀螺输入，预估卫星对地姿态。,0,0,1,0,0,0,0,0,0,0,0
功能描述：地面站赤经赤纬计算,0,0,0,0,1,0,0,0,0,0,0
"功能描述：与星敏感器通讯，获得星敏感器数据。
处理：
在使用Astro10星敏感器之前需对星敏感器进行初始化，完成后向星敏感器发出R有效信号，并通过串行口得到星敏感器提供的数据。在AO与星敏感器通信过程中，AO始终处于主动状态。当AO发出R信号下降沿后星敏感器在5ms内返回数据，AO在接收完数据后把R信号置高电平，星敏感器在R信号的上升沿之后的1ms内停止发送数据。
tro10星敏感器通讯故障时，不使用Astro10星敏感器数据进行姿态修正。",0,0,0,0,0,0,0,0,1,0,0
功能描述：计算光行差的修正参数，数字太阳敏感器输出角估值。,0,0,0,0,1,0,0,0,0,0,0
功能描述：单独使用星敏诊陀螺。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：太阳地球捕获主程序。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：为动量轮启动与保持模式姿态确定提供初始姿态。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|给VIPPCU发送轮询和校时包|FREQ1.8.1|""无
""|校时等数据|在每个控制周期与VIPPCU通讯时，在“轮询与校时包”中发送本周期的控制UTC时间
|VIPPCU加电状态状态数据的采集与处理|FREQ1.8.2|""加电状态
""||CCU通过采集来自VIPPCU的 “VIPPCU A机加电状态”、“VIPPCU B机加电状态”两个0～5V模拟量，来确定VIPPCU的A、B机加电状态。
|给VIPPCU发送的下平台控制数据|FREQ1.8.3|无|控制数据|CCU给VIPPCU发送的下平台控制数据。
|给VIPPCU发送CCU的重要数据|FREQ1.8.5|无|CCU的重要数据|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|给VIPPCU发送VIPPCU的重要数据|FREQ1.8.6|无|VIPPCU的重要数据|给VIPPCU发送VIPPCU的重要数据
|转发VIPPCU上注指令参数块|FREQ1.8.7|无|VIPPCU上注指令参数块|需要时，转发VIPPCU上注指令参数块
|接收VIPPCU遥测数据|FREQ1.8.8|VIPPCU遥测数据|无|每个控制周期，接收VIPPCU遥测数据，解包成需要的数据
|接收CCU重要数据返回包|FREQ1.8.9|CCU重要数据|指令|上电/复位后应用软件首先从VIPPC恢复重要数据。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：帆板故障检测，切换帆板LTU。
处理：
（1）帆板LTU切换的条件：
①若BZ1=3且连续650秒FSA=A太阳已捕获(帆板切换后重新开始计时)且帆板不在零位；
②若BZ1=3且FSA=A且帆板在机械零位且帆板控制信号不是取自帆板机械转角且此帆板上的模拟太阳连续5个周期不见太阳。
③如果35V帆板电压遥测变量在连续30次低于28V（28V要设计为可内存修改变量），此功能可通过注入数据块ZT38（4）启动或禁止该功能。若发生了切换，则星上自主禁止此功能，等待地面注入重新启动。
（2）帆板LTU切换后更改ZT17,连续3个0.524s周期发送帆板归零指令。     ",0,0,0,0,0,1,0,0,0,0,0
功能描述：CMG启动模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：模式6切换方式。
处理：
if() 置WorkMode=5；若，若，WorkModeT=6；
if() 置WorkMode=5；若，若，WorkModeT=6；
若且且 ，置WorkMode＝7；
if(且且且且AutoPermission=1) 置WorkMode=5；WorkModeT=4；；//阴影区进入阳照区自主转对日定向；可注入修改，初值为1；
if(且且且且且AtuoPermission=1) 置WorkMode=5；WorkModeT=4；；//南纬60度强制转对日定向，为纬度系数，可注入修改，该条件优先于下一个条件
if( 且且且) 置WorkMode=5；WorkModeT=6；；；//程控指令自主转对地姿态
收到星务的“对日定向” 指令，置WorkMode=5；WorkModeT=4；；；//成像任务完成后指令转入对日定向，并清除辐射定标目标角
收到星务的“辐射定标”指令，置WorkMode=5，WorkModeT=6，；//辐射定标模式，为注入的辐射定标目标角
若FailureFlag=1，置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
功能描述：对弦宽、基准与给定的范围进行比较，确定红外故障。若两红外数据均有效，则还可根据本周期与上周期红外姿态角确定红外故障。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：与星敏感器通讯，获得星敏感器数据。
处理：
在使用星敏感器之前需对其进行初始化，在每个控制周期的开始向S星敏感器发出R信号，并通过串口得到S星敏感器提供的数据。在AO与S星敏感器通信过程中，AO始终处于主动状态。当AO发出R信号下降沿后星敏感器在5ms内返回数据，AO在接收完数据后把R信号置高电平，星敏感器在R信号的上升沿之后的1ms内停止发送数据。
AO为Astro10星敏感器和S星敏感器配置了2个独立的UART，分别各有256byte的FO缓存。因此可以对Astro10星敏感器和S星敏感器同时发出R信号，交替进行进行数据FO缓冲区数据读取。
与APS星敏感器通讯故障时，不使用APS星敏感器数据进行姿态修正。",0,0,0,0,0,0,0,0,1,0,0
功能描述：使用GPS通道版数据进行GPS定轨。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的陀螺脉冲当量系数
处理：
调整陀螺1~3的脉冲当量的初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收AOCC重要数据1-4，并处理重要数据1中的内容。
处理：应急线路加电后与OBDH通信，获得陀螺和推力器状态，若连续3个控制周期都没有成功取得重要数据，默认陀螺使用7、8、9号，推力器使用主备份推力器，模拟式太阳敏感器使用ASS1和ASS21。由于AOCC可使用的陀螺为12个（陀螺1~12），可使用的陀螺为9个（陀螺1~9），因此，无法使用陀螺10~12的数据。当恢复AOCC重要数据后，若ZT9表明使用了陀螺10~12，则设置ZT9中陀螺10~12为不可用，陀螺7、8、9为可用，陀螺工作状态BZ9按照设置后的ZT9中由小到大的顺序（从陀螺1到陀螺9）选用3个陀螺。",0,0,0,0,0,0,0,0,0,1,0
"软件需求标识：FREQ20 
软件需求名称：动量轮数据处理 
需求类别：其他 
软件需求描述：动量轮数据处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：使星体由任意姿态完成重捕地球。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：利用估计的四元数转换姿态角，计算送给星敏感器的四元数。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：将星务通过CAN总线广播的GPS定位数据转换成轨道根数。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：完成卫星入轨后一圈内的控制，完成卫星入轨后的初始姿态捕获，消除星箭分离和太阳帆板展开所产生的姿态扰动，进行动量轮启动和控制，建立对地定向三轴稳定的正常运行姿态
进入条件：
满足下列条件之一：
自主条件（满足下列条件之一）：
星箭分离后的应用软件累计运行时间（24位浮点数）且（0.524秒控制周期累计计数）
ZT1 = 0（入轨初模式）且ZT32 = A（ZT1不等于1）且
退出条件：
满足下列条件之一：
自主条件：满足转入BZ1=1（Z轴对地控制模式）
地面上行注入ZT1不等于（B 、0、1、4）
处理过程：过程如下：
STEP1：进行姿态预估（同用户需求的），得到姿态角和角速度，并赋给姿态角和角速度偏差
STEP2：根据入轨时间分别进行不同的处理：
当[0，5）秒时，先关LV2、4，再开LV1、3，分两个周期进行（第一个周期先关LV2、4，第二个周期再开LV1、3）。
当（1，80（消初偏结束时刻））秒时， 进行消初段喷气姿态控制。
当（80，95）秒时，不控直接退出。
当大于95秒时，进行运行段喷气姿态控制。
当大于120秒（红外接入时刻）时，姿态红外修正、陀螺故障检测及选择和运行段帆板控制。
当（4200（动量轮接入时刻），5400）秒时，如果左右帆板转角输出的绝对值都小于10度，则将ZT19、ZT20分别赋给BZ9、BZ10；如果ZT2不等于2，则置ZT2为1。
当大于4750秒时，如果ZT2等于1且三轴角动量偏差均小于1，则置ZT2为2。
当大于等于4800秒时，置BZ1=1，ZT1=1。
STEP3：根据ZT2的值进行飞轮控制。",0,0,0,1,0,0,0,0,0,0,0
功能描述：计算将动量轮保持至标称角动量所需的电压。,0,1,0,0,0,0,0,0,0,0,0
功能描述：帆板驱动线路数据处理 ,0,0,0,0,0,0,0,0,1,0,0
功能描述：轨控模式时使用轨控发动机及其备份。,0,1,0,0,0,0,0,0,0,0,0
功能描述：检测工作中的动量轮的故障并设置WheelState。,0,0,0,0,0,1,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的功能。
序|需求名称|编号|输入章节号|功能描述
|主动段模式控制|FREQ5.2.0|4|主动段模式控制调用流程
|初始速率阻尼模式控制|FREQ5.2.1|4.1|初始速率阻尼模式控制调用流程
|正常对日巡航模式控制|FREQ5.2.2|4.2|正常对日巡航模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|对地定向模式控制|FREQ5.2.5|4.5|对地定向模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.9|4.9|轨控模式控制调用流程
|太阳捕获模式控制|FREQ5.2.10|4.10|太阳捕获模式控制调用流程
|无控模式控制|FREQ5.2.11|4.11|无控模式控制调用流程
|凝视姿态跟踪模式控制|FREQ5.2.12|4.12|凝视姿态跟踪模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式初始化|FREQ5.3.0|4|主动段模式初始化设置
|初始速率阻尼模式初始化|FREQ5.3.1|4.1|初始速率阻尼模式初始化设置
|正常对日巡航模式初始化|FREQ5.3.2|4.2|正常对日巡航模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|对地定向模式初始化|FREQ5.3.5|4.5|对地定向模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.9|4.9|轨控模式初始化设置
|太阳捕获模式初始化|FREQ5.3.10|4.10|太阳捕获模式初始化设置
|无控模式初始化|FREQ5.3.11|4.11|无控模式初始化设置
|凝视姿态跟踪模式初始化|FREQ5.3.12|4.12|凝视姿态跟踪模式初始化设置
",0,0,0,1,0,0,0,0,0,0,0
"软件需求名称：1553通信上行/下行数据的组帧和处理。 
软件需求描述：1553通信上行/下行数据的组帧和处理。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：遥测组帧、遥控接收、遥测帧头打包、遥测数据打包、下行：重要数据组帧、上行：数据指令处理、任务成像指令、上行：模式转换指令处理、上行：软件标志字指令处理、上行：控制参数指令处理、上行：变轨和位保指令处理、上行：部件加断电指令处理、上行：校时指令处理、上行：轨道注入指令处理、上行：部件数据转发指令处理、在轨维护指令处理、内存下传指令、重要数据保存、重要数据恢复",0,0,0,0,0,0,0,0,0,0,1
"功能描述：发送AOCC重要数据给OBDH保存
处理：将重要数据打包后放到AOCC重要数据内存地址空间中。重要数据的内容具体见重要数据文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：帆板驱动线路数据处理 
",0,0,0,0,0,0,0,0,1,0,0
"应用软件共分21个工作模式，分别是等待段、太阳定向、恒星定向2、惯性调姿、恒星定向4、轨控定向、着陆准备、主减速、快速调整、接近下降、悬停、避障、缓速下降、自主定位、起飞准备、垂直上升、上升调姿、轨道入射、星光环月、速率阻尼和无控。模式字和各模式的对应关系如下：
表5.2.4.4-1 工作模式
模式字|工作模式|使用场合
0|等待段|""加电之后，判出分离27s之前，
或复位之后，重要数据恢复之前。""
1|太阳定向|""组合体地月转移巡航和环月阶段正常运行状态；
上升器远程引导巡航""
2|恒星定向2|变轨建立点火姿态前
3|惯性调姿|变轨建立点火姿态
4|恒星定向4|变轨建立点火姿态后
5|轨控定向|""动力下降之前的轨控
月面上升之后的轨控""
6|着陆准备|建立着陆点火姿态
7|主减速|动力下降
8|快速调整|动力下降
9|接近下降|动力下降
10|悬停|动力下降
11|避障|动力下降
12|缓速下降|动力下降
13|自主定位|月面工作阶段
14|起飞准备|建立月面起飞初始状态
15|垂直上升|月面上升
16|上升调姿|月面上升
17|轨道入射|月面上升
18|星光环月|月球轨道交会对接自主段
19|速率阻尼|轨控姿态超差
20|无控|动力下降着陆、交会对接段轨道器最后逼近、故障
",0,0,0,1,0,0,0,0,0,0,0
功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。,0,1,0,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|三浮陀螺数据的采集与处理|FREQ1.2.1|""三浮陀螺1553B取数指令
""|陀螺1-6的速度增量|在通讯允许的条件下（每个三浮陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是角速率数据，通过任务书给出的公式计算
|光纤陀螺数据的采集与处理|FREQ1.2.2|""光纤陀螺LTU取数指令
""|陀螺79的速度增量|在通讯允许的条件下（每个光纤陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是即为速度增量数据，直接乘当量就可以得到需要的结果；
",0,0,0,0,0,0,0,0,1,0,0
"软件需求名称：星敏感器使用及通信 
需求类别：其他 
软件需求描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
星敏初始化|FREQ34|星敏初始化|B|2
星敏数据采集|FREQ35|星敏数据采集|A|3
数据解包与转换|FREQ36|数据解包与转换|A|4
星敏数据有效性判断|FREQ37|星敏数据有效性判断|A|5
星敏数据曝光时刻计算|FREQ38|星敏数据曝光时刻计算|A|6
星敏数据有效性判断、处理|FREQ39|星敏数据有效性判断、处理|A|7
星敏故障重构|FREQ40|星敏故障重构|C|
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：采集帆板归零信号，并处理成需要的数据格式。
处理：帆板归零的信号",0,0,0,0,0,0,0,0,1,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：姿态角与角速度估值：
正常模式星敏感器与陀螺定姿输出 
，
或：正常模式其它情形相应程序的输出，
惯性角速度估值：
    陀螺角速度估值 ，
    或：星敏感器定姿输出(F_NoGyro=1或3) =[，]T
实测飞轮角动量    ，
      斜轮标称角动量    
      姿态偏差积分项    ，
      斜轮角动量偏差积分项  
标志F_SatStage
=[，]T",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据姿态估值与数字太阳输出，计算量测的一步预测与新息。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收遥控注入数据块1、2、3、4、5、6、7
处理：将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。如果128＜遥控注入数据块长度≤256字节，将数据不足256字节部分以AA16填充，按照“遥控注入数据块结构分为遥控注入数据块1～4，按照子地址（1～4）顺序向AOCC连续发送；如果64＜遥控注入数据块长度≤128字节，将数据不足128字节部分以AA16填充，按照“遥控注入数据块结构分为遥控注入数据块5、6，按照子地址（5、6）顺序向AOCC连续发送；如果遥控注入数据块长度≤64字节，将不足64字节部分以AA16填充，按照“遥控注入数据块结构通过子地址11将数据发送给AOCC；各个上行注入块的格式如表 44所示：
表 44：各个上行注入块的格式
块类型识别字|块类型名称|块长度（字节）|指令
1B H|AOCC程序块|256N|接收遥控注入数据块1、2、3、4
EB H|AOCC轨道数据块|128|接收遥控注入数据块5、6
27 H|AOCC姿控数据块|64|接收遥控注入数据块7
28 H|AOCC系数数据块|64|接收遥控注入数据块7
41 H|AOCC轨控命令块|64|接收遥控注入数据块7
4E H|AOCC太阳翼命令块|256|接收遥控注入数据块1、2、3、4
7D H|AOCC内存修改块|64|接收遥控注入数据块7
BEH|AOCC中继星轨道数据块|128|接收遥控注入数据块5、6
69H|AOCC结构滤波器系数数据块|128|接收遥控注入数据块5、6
C3H|AOCC中继天线安装修订系数块|64|接收遥控注入数据块7

根据上行注入块的大小，可以把上行注入块分成三种，分别为256字节，128字节和64字节。相应AOCC接收遥控注入的处理程序也分为三种，分别对应256字节，128字节和64字节的处理程序。
接收64字节遥控注入处理程序流程如下图所示
图17: 接收64字节遥控注入处理程序流程
2）接收128字节遥控注入处理程序流程如下图所示
图18: 接收128字节遥控注入处理程序流程
3）接收256字节遥控注入处理程序流程如下图所示
图19: 接收256字节遥控注入处理程序流程
若ZT8≠0，则BZ7=ZT8。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：利用星敏感器A、B的测量，估计姿态。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：采集红外数据，计算姿态等。
处理：同用户需求的
STEP1:判断红外数据有效性
若左红外数据有效，则HL=1，否则HL=0。
若右红外数据有效，则HR=1，否则HR=0。
若ZT5=0不用红外，则HL=0，HR=0。
STEP2:计算公式同的（2）（3）（4）（5）（6）（7）（8）（9）（10）。
（9）若ZT3=F或B，则计算dΦH、dΘH。",0,0,1,0,0,0,0,0,0,0,0
功能描述：计算在整星角动量偏置下，CMG控制时的框架角速率指令。,0,1,0,0,0,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
甚高陀螺通讯故障诊断|大量程通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
部件故障诊断与处理|确定各敏感器和执行机构故障诊断及处理
陀螺故障检测|确定各敏感器和执行机构故障诊断及处理
动量轮故障检测|检测工作中的动量轮的故障
大力矩飞轮故障检测|检测工作中的大力矩飞轮的故障
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式7的系统故障诊断|在模式7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
磁力矩器数模一致性诊断|磁力矩器数模一致性诊断
DSS输出一致性诊断|DSS输出一致性诊断
ASS1输出一致性诊断|ASS1输出一致性诊断
ACU 1553B接收故障诊断及处理|由于卫星的执行机构控制均需通过ACU进行，当ACU接收控制指令内存区异常将导致卫星失去控制能力，因此有必要对ACU接收执行机构控制指令的正确性进行判断。在检测到执行机构控制指令接收校验和异常后CCU需要自主进行处理",0,0,0,0,0,0,1,0,0,0,0
"软件需求标识：FREQ15 
软件需求名称：光纤陀螺数据处理 
需求类别：其他 
软件需求描述：光纤陀螺数据处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得12个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据， AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。具体如下表所示： 
GROLTUSeltFlag|进行通讯的陀螺LTU
01H|陀螺LTU1
02H|陀螺LTU2
03H|陀螺LTU3
其它|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1

取数指令由三个字节组成：
第一个字节为对陀螺LTU的命令设置，有四种命令格式：取数指令1、取数指令2、复位指令、地检模式指令，应用软件只自主发取数指令1和取数指令2两种格式，并由注入控制方式指定及LTU通信选择块中的陀螺LTU取数方式来切换，默认为取数指令1；其余两种格式（复位指令和地检模式指令）通过地面注入LTU命令块来设置。
第二个字节为对光纤陀螺的命令设置，有四种命令格式：测量模式1（有温度补偿）、测量模式2（无温度补偿）、地检模式1（只传地面数据）、地地检模式2（地面数据+头部测量数据），由注入控制方式指定及LTU通信选择块中的光纤陀螺指令切换方式字来切换这四种格式，默认为测量模式1（有温度补偿）。
第三个字节为前两个字节的累加和。
另外，每个控制周期AOCC还向选取的陀螺LTU发送取陀螺状态指令，指令为3字节指令（D5、AA、7F），得到的状态信息用于遥测。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式，具体参见LTU通讯协议。",0,0,0,0,0,0,0,0,1,0,0
"    当由于陀螺故障或者动量轮故障不能构成PID 控制方式时，根据地面遥控
指令可以进入“偏置动量控制模式”。偏置动量轮处于力矩模式，可以根据红外
敏感器测量信息计算得到的滚动角和俯仰角。俯仰轴采用角动量反馈方式控制，
偏航轴采用耦合控制，滚动轴采用磁控或角动量反馈方式控制。处理同用户需求的4.3.4。具体包括的下一层功能点列表如下：
序|功能编号|功能描述|输入、输出及处理
1|FREQ4.14.1|三轴等效角动量偏差|
2|FREQ4.14.2|俯仰通道轮控算法|
3|FREQ4.14.3|磁进动、章动阻尼及俯仰轮卸载控制|
4|FREQ4.14.4|三轴轮控算法|
",0,1,0,0,0,0,0,0,0,0,0
功能描述：接收同步字,0,0,0,0,0,0,0,0,0,1,0
"功能：利用估计的四元数转换姿态角，送给星敏感器的四元数。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|""5.2.1
""|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估对地姿态|FREQ3.3|5.2.3|根据陀螺测量输出，一步预估卫星姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|基于红外滤波的卫星姿态确定|FREQ3.6|5.2.6|根据陀螺预估结果和红外(和数字太阳)输出，确定卫星姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|红外与太阳双矢量定姿|FREQ3.9|5.2.9|利用红外、数字太阳敏感器确定姿态
|星敏感器相对基准标定|FREQ3.10|5.2.10|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.11.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.11.2|进行卫星姿态四元数的重置
|三轴欧拉姿态角预估算法产品规范|FREQ3.1.1|/|规范化算法：
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法算法产品规范|FREQ3.1.3|/|规范化算法：
|基于红外测量的红外滤波修正算法产品规范|FREQ3.1.4|/|规范化算法：
|基于单星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.6|/|规范化算法：
|基于红外与太阳矢量的双矢量定姿算法算法产品规范|FREQ3.1.7|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.2|
|正常、偏置飞行目标姿态计算|FREQ3.12.1|5.3.2.1|正常与偏置姿态飞行时的目标姿态计算
|点对点机动目标姿态计算|FREQ3.12.2|5.3.2.2|点对点机动目标姿态计算
|姿态预置过程目标姿态计算|FREQ3.12.3|5.3.2.3|姿态预置过程目标姿态计算
|非沿迹目标姿态计算|FREQ3.12.4|5.3.2.4|角速度建立过程目标姿态计算
|轨控目标姿态计算|FREQ3.12.5|5.3.2.5|轨控目标姿态计算
|轨控姿态机动轨迹初始化|FREQ3.12.6|5.3.1.4|轨控模式目标姿态计算初始化
|正弦轨迹规划算法算法产品规范|FREQ3.12.7|/|规范化算法：
|基于加速度导数为正弦函数的轨迹规划算法算法产品规范|FREQ3.12.8|/|规范化算法：
|点对点姿态机动初始化处理|FREQ3.13|5.3.1.1|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|非沿迹跟踪初始化|FREQ3.14|5.3.1.2|非沿迹跟踪初始化，计算地心张角和方向矢量
|计算多项式轨迹系数|FREQ3.15|5.3.3.1|根据轨迹规划时间，初始姿态/姿态角速度和目标姿态/姿态角速度计算基于多项式轨迹规划的轨迹系数
|姿态预置机动目标姿态确定|FREQ3.16|5.3.3.2|基于多项式曲线的轨迹规划，计算目标姿态
|非沿迹目标姿态角计算|FREQ3.17|5.3.4|根据所指定的扫描起始经纬度和末端点经纬度
|偏流角计算|FREQ3.18|5.3.5|适用于地球椭球模型，星体姿态描述为转序，计算基于星体光轴(与星本体＋Z轴平行)下的偏流角
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|增量式偏流角计算算法产品规范|FREQ3.21|/|规范化算法：
|凝视过程目标姿态计算|FREQ3.22|5.3.2.6|凝视过程中计算三轴目标姿态
|陀螺标定过程目标姿态计算|FREQ3.25.0|5.15.1|陀螺标定全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角
|目标姿态计算初始化|FREQ3.25.1|5.15.1.1|对陀螺标定过程中涉及到的两次机动过程进行机动姿态计算的初始化
|惯性姿态点对点机动轨迹规划|FREQ3.25.2|5.12.1.2|对陀螺标定过程所涉及到的两次点对点机动进行轨迹规划
|角速度起速保持与减速过程轨迹规划|FREQ3.25.3|5.12.1.3|对陀螺标定过程中的速度运行进行轨迹规划
|大角速度标定的分档确定|FREQ3.25.4|5.12.1.4|根据实现指向的4挡速度，根据当前的速度的幅值，确定所标定的陀螺刻度因子的位置
|惯性定向时转阶段处理|FREQ3.25.5|5.12.1.5|陀螺标定在第1段中完成惯性定向，并在此期间标定陀螺真实常漂。在惯性定向转速度运行结束时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等。
|速度运行时转阶段处理|FREQ3.25.6|5.12.1.6|SubMode= 2~9，陀螺按照规定的角速度完成起速、恒速运行、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等
|速度曲线规划|FREQ3.25.7|5.12.1.7|根据所选择的机动轨迹，规划出角速度变化曲线
|陀螺标定算法|FREQ3.26.0|5.12.2|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺常漂修正标志确定|FREQ3.26.1|5.12.2.1|对陀螺标定过程中，陀螺常漂的修正标志进行确定。当星体达到了规定的惯性角速度时，开始进行陀螺常漂估计
|基于星敏陀螺滤波的等效常漂估计|FREQ3.26.2|5.12.2.2|采用星敏陀螺滤波的方法对陀螺等效常漂进行估计
|星敏陀螺滤波的陀螺等效常漂记录|FREQ3.26.3|5.12.2.3|对陀螺等效常漂，选取稳态时的一段数据进行平均，得到各个角速度下的等效常漂和星体真实角速度的估计值
|小角速度时的陀螺安装误差和刻度因子误差估计|FREQ3.26.4|5.12.2.4|经过N次速度机动后，对陀螺的测量模型进行标定，给出标定结果
|大角速度时的陀螺标定算法|FREQ3.26.5|5.12.2.5|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺在轨标定时的控制量计算|FREQ3.27|5.12.3|对标定过程中的控制量进行计算
|陀螺安装误差标校结果引入|FREQ3.28|5.12.4|对陀螺完成标定后，待地面确认标定结果无误后，将陀螺的标定结果进行赋值。当地面注入FP__MountingCmp时执行本程序一次
|陀螺刻度因子误差标校结果引入|FREQ3.29|5.12.5|完成陀螺标定，待地面确认无误后，对陀螺的刻度因子进行在轨标校。标校时，取陀螺输出的角速度与与之最接近的两个已标定的特征角速度进行线性插值标校
|惯性定向期间目标姿态计算|FREQ3.30|5.3.2.7|""惯性调姿过程中的姿态机动目标姿态计算，当航天器从轨道系姿态进入时，首先进入submode0，进行轨道角速度的削除，之后进行惯性调姿。在转出时，若后续姿态为轨道系姿态，需要建立轨道角速度
""
|轨道角速度建立目标姿态计算|FREQ3.31|5.3.6|""在惯性定向与轨道系姿态保持之间切换时，进行轨道角速度的建立或削除 
""
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：轨控模式初始化
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令。
（2）向帆板LTU发完取数命令后，获得LTU返回数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。
（3）帆板LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
功能描述：根据数字太阳见太阳标志和故障标志判断数字太阳数据的有效性。。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：复位未取回重要数据初始化
处理：
- 卫星构型=9；
- 对系统软件提供的工作模式字APP_WorkMode进行3取2
- 若工作模式字为Mode7-11，切换至Mode16，SubMode1，StarTime= 2100.0， 开自锁阀3、4、5；
- 否则，切换至Mode2，StarTime = 2100.0， 开自锁阀3、5，关自锁阀4。
- 磁力矩器俯仰通道主份工作；
- 陀螺：陀螺引入状态初始化",1,0,0,0,0,0,0,0,0,0,0
功能描述：决定磁卸载或喷气卸载方式,0,1,0,0,0,0,0,0,0,0,0
功能描述：地面站赤经赤纬计算。,0,0,0,0,1,0,0,0,0,0,0
功能描述：接收总线指令。,0,0,0,0,0,0,0,0,0,1,0
功能描述：接收轨道根数数据,0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收应急线路注入数据。
处理：应急线路的上行注入数据为姿控数据块，具体见上行注入文件。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：星上自主检测推进系统故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：
  根据三轴姿态角和姿态角速度误差计算三轴控制力矩(功能编号：FReq-5)。
处理： 
控制器结构为PD控制，见下图。
图5-2  PID控制器
控制器输入计算和限幅：角度信息、角速度信息由5.2.2节获取；
用于计算控制力矩的角度信息限幅为[-5,5]度、角速度信息限幅1.0度/秒。
；
		；",0,1,0,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的光纤红外控制命令参数,0,0,0,0,0,0,0,0,0,1,0
"需求名称|功能及处理描述
CMG 1数据的采集与处理|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 2数据的采集与处理|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 3数据的采集与处理|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 4数据的采集与处理|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 5数据的采集与处理|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 控制指令的输出处理|根据控制方式发送相应的控制指令，具体见内总线通讯协议
CMG 6数据的采集与处理|在通讯允许的条件下（CMG 6的当班标志为1），每周期向CMG 6 RT发取数指令，获得CMG 6数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG的程序注入修改|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
CMG的内存下传|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据红外输入，计算姿态偏差、弦宽误差估计与量测新息。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：星上实时计算卫星轨道。,0,0,0,0,1,0,0,0,0,0,0
"    各个模式切换的功能点列表如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ5.1.0|4|主动段模式切换条件判断及转出设置
|入轨段控制模式切换|FREQ5.1.1|4.1|入轨段控制模式切换条件判断及转出设置
|正常对地运行模式切换|FREQ5.1.2|4.2|正常对地运行模式切换条件判断及转出设置
|点对点机动模式切换|FREQ5.1.3|4.3|点对点机动模式切换条件判断及转出设置
|偏置飞行模式切换|FREQ5.1.5|4.4|偏置飞行模式切换条件判断及转出设置
|轨控模式切换|FREQ5.1.8|4.5|轨控模式切换条件判断及转出设置
|全姿态捕获模式切换|FREQ5.1.9|4.10|全姿态捕获模式切换条件判断及转出设置
|无控模式切换|FREQ5.1.10|4.11|无控模式切换条件判断及转出设置
|陀螺标定模式切换|FREQ5.1.11|4.8|陀螺标定模式切换条件判断及转出设置
|惯性定向模式切换|FREQ5.1.12|4.6|陀螺标定模式切换条件判断及转出设置

切换条件具体见用户需求4。CCU切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
功能描述：帆板驱动机构切换。,0,0,0,0,0,0,0,1,0,0,0
"功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：根据指令完成数传天线的指向控制。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：决定利用星敏感器A、B、C单独或组合定姿的方式，调用相应姿态修正程序。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：机动姿态保持模式初始化,0,0,0,1,0,0,0,0,0,0,0
"功能描述：处理地面遥控注入的用于替换EEPROM的代码
处理：
-  解包EEPROM代码注入包，得到帧号、源地址（SRAM）、目的地址（EEPROM）、注入内容长度；
- 以源地址为起始地址，将注入内容放入该SRAM区域
说明：星务分系统向GNCC送数采用256字节(有效使用249字节)帧格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,0,0,0,1,0
"功能描述：完成卫星正常轨道运行期间的三轴稳定姿态，并进行偏流角修正控制，实现姿态指向精度、姿态稳定度等性能指标。
进入条件：
自主条件：从BZ1=B、2、4、6、8满足条件转入
退出条件：
满足下列条件之一：
自主条件：
满足ZT6  3（有偏航机动）且C1 = FFFF（轨控数据有效标志为有效）且（偏航机动开始时刻之前1800秒）（偏航回调机动开始时刻后600秒）转入BZ1=2
满足（轨控发动机开机时刻-60秒）（轨控发动机关机时刻+100秒）且C1 = FFFF（轨控数据有效标志为有效）且转入BZ1 = 6
满足FM=1（ZT35不等于0且收到侧摆命令块）转入BZ1=8
满足ZT226（系统故障自检有效，可自主切换工作模式）且FSY07（系统故障打分小于等于7）且ZT8  3，ZT9  3（姿轨控发动机可用）转入BZ1=3
满足ZT226（系统故障自检有效，可自主切换工作模式），FSY07（系统故障打分小于等于7），且（ZT8  4（姿控发动机不可用）或ZT9  4（轨控发动机不可用））转入BZ1=7
地面上行注入ZT1不等于1、4 
处理过程：过程如下：
STEP1：当ZT F且ZTA且ZT3B ，进行姿态预估，得到姿态角和角速度。
STEP2：进行运行段姿态确定，具体过程如下：
姿态红外修正（1）和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP3：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3（姿控发动机可用）且ZT9  3（轨控发动机可用）且ZT（不用红外+单个斜装陀螺定姿）时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
t的取值范围|处理
|""发姿轨控发动机加温指令
进行运行段姿态确定 
进行运行段控制""
|""发姿轨控发动机加温指令
发左右帆板归零指令
飞轮动量保持控制及飞轮启动
令，
 轨控段喷气姿态控制""
|""令 ，

轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令""
|""令，
轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令
""
|""红外数据采集及处理
红外故障检测及信号选取
姿态红外修正（2）
，
运行段喷气姿态控制
飞轮动量保持控制及飞轮启动
运行段帆板控制""
|BZ1 = 1，C1 = CCCC。

当ZT40(4) = 1（天线扫描捕获）时，进行数传天线捕获跟踪控制
STEP4：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：轨控模式控制
",0,0,0,1,0,0,0,0,0,0,0
功能描述：为三轴姿态喷气控制选择推力器。,0,1,0,0,0,0,0,0,0,0,0
"软件需求名称：姿态确定算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.4.1|陀螺姿态预估|《用户需求》4.4.1|
FREQ12.3-R4.4.2|星敏感器陀螺确定惯性姿态|《用户需求》4.4.2|
FREQ12.3-R4.4.3|中继跟踪目标姿态计算|《用户需求》4.4.3|
FREQ12.3-R4.4.4-K|太阳捕获及太阳定向|《用户需求》4.4.4|
FREQ12.3-R4.4.5|轨控目标姿态计算|《用户需求》4.4.5|
FREQ12.3-R4.4.6|误差四元数计算|《用户需求》4.4.6|
",0,0,1,0,0,0,0,0,0,0,0
"软件需求标识：FREQ18 
软件需求名称：模拟太敏数据处理 
需求类别：其他 
软件需求描述：模拟太敏数据处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：使用星敏感器C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器。                                                                                                                                                                                                                                                                                                                                                                                                                                                       输入：标志F_JetGroup，F_SatStage
姿态角与角速度：
正常模式星敏感器与陀螺定姿输出(F_NoGyro=0或2) 
，(量纲：弧度)
，(量纲：弧度/秒)
或：正常模式星敏感器定姿输出(F_NoGyro=1或3时)
(量纲：弧度)
(量纲：弧度/秒)
或：机动与轨控模式姿态输出(无量纲)，(量纲：弧度/秒)
或：其它情形相应程序的输出
，(量纲：弧度)
，(量纲：弧度/秒)
，(量纲：度)
输出：	喷气状态，
各推力器分配脉宽，
累计三轴姿控正向喷气时间：，
累计三轴姿控负向喷气时间：，
=[，]T(量纲：弧度/秒2)",0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送遥测数据
处理：
遥测数据分为实时遥测数据和延时遥测数据。
实时遥测数据格式包含5种格式：发射模式、正常模式、变轨模式、全姿态捕获模式、停控模式/应急模式。对于AOCS分系统而言，发射模式和正常模式的处理方式相同。若AOCS分系统出现模式转换则需通过方式代码的服务申请，请求OBDH变化遥测格式。
OBDH在收到地面指令或者在接收到AOCS的服务请求后，在125ms的时间内给AOCC发送对应的‘同步’方式代码。若AOCC在服务请求后大于0.25s的时间内未收到对应的‘同步’方式代码，则再次申请改变模式，若同一次申请的申请次数大于40次，则停止本次的申请。遥测数据格式内容具体见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
功能描述：确定ASS21，ASS22，ASS31，ASS32 及帆板转角的信号选取。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送AOCC自身产生的重要数据块1、2
处理：将用户需求规定的AOCC重要数据存放制定的区域（02星去掉加速度计相关变量，新增重要数据ZT3），并当OBDH接收AOCC重要数据时将这些数据存放在OBDH固定的区域中。具体处理过程如下：
STEP1：AOCC应用程序每0.524秒查询一次有无OBDH接收数据请求，如果有则转入第二步，否则退出；
STEP2：将AOCC重要数据从缓存区搬到OBDH规定的内存中。",0,0,0,0,0,0,0,0,0,0,1
功能描述：标称角动量、安装、分配矩阵及轮子组合计算,0,1,0,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：卫星绕俯仰轴转动，直到满足姿态角条件，进入下一阶段偏航捕获。姿态确定由红外和陀螺。姿态控制是喷气控制
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送姿态数据包1
",0,0,0,0,0,0,0,0,0,0,1
OBDH重要数据有两块，大小共为128字节，AOCC不做任何改动保存在RAM中。如果AOCC发生复位，应利用方式代码请求服务，索取OBDH重要数据进行保存。若在大于0.256s的时间内仍未收到接收OBDH重要数据的指令，则重新请求服务，同时索要OBDH重要数据的计数器累加，若此计数器大于等于40，则不再索要OBDH重要数据。若索要OBDH重要数据成功，将此计数器清零。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：完成整星绕滚动轴的姿态侧摆角保持功能
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
条件|FRTS的取值
ZT35(2) = 1且|1
其余情况|0

STEP2：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP3：进行运行段姿态确定，具体过程如下：
进行红外数据采集及处理和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP4：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3且ZT9  3且ZT时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
当ZT40(4) = 1时，进行数传天线捕获跟踪控制
STEP5：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的姿态偏置系数
",0,0,0,0,0,0,0,0,0,1,0
"软件需求名称：推进系统操作 
需求类别：其他 
软件需求描述：对自锁阀、推力器进行操作。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。
输入：上周期姿态角估值
陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出：",0,0,1,0,0,0,0,0,0,0,0
"功能描述：使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令。
处理：
软件设计时应注意保护Vm，保证此节使用的Vm未在周期性清0处理中被清除。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
输入：
数传天线(j=1,2)跟踪地面站编号i，跟踪起始时刻ti，地面站i在惯性系指向，被数传天线(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线(j=1,2)跟踪的地面站i的矢量在本体系的表示。（i可为1~7）。
输出：
数传天线1和2的指令转角，指令转速，或者复位及保持控制指令。",0,1,0,0,0,0,0,0,0,0,0
功能描述：把三轴控制电压转换到工作飞轮的控制电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：不使用陀螺数据时的姿态角、角速度与姿态四元数预估。
",0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：帆板驱动装置的处理 
需求类别：其他 
软件需求描述：对帆板驱动装置的加断电等进行特殊处理。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：中继天线数据处理
处理：
处理数据时应对接收数据中的捕跟分系统工作模式进行保护判断。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：
将从1553B总线上接收到ISUA、ISUC遥测数据，以及的常规遥测数据根据遥测打包协议进行打包（FReq-8）。
处理： 1553B总线通过子地址11接收到ISUA、ISUC常规遥测数据，ISUC闭环控制反馈数据，当轮询子地址10到来时，将计算的常规遥测数据同子地址11接收到的ISUA、ISUC常规遥测数据、部分ISUC闭环控制反馈数据，一并打包并发送到子地址10。遥测内容的相关变化见遥测文件以及1553B通讯协议。
遥测打包时模式字与方式字占用1个字节，模式字占用高4位，方式字占用低4位。对于未明确定义的遥测当量，使用CMU的当量，表示范围根据占用的字节数决定。",0,0,0,0,0,0,0,0,0,0,1
"软件需求名称：应用软件初始化 
需求类别：其他 
软件需求描述：初始化函数为void AppInit(void )。在上电/复位时，系统软件调用此函数来完成应用软件的初始化。见“任务书”4.1.2.1“初始化函数”。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：发送姿态数据包3
",0,0,0,0,0,0,0,0,0,0,1
"功能描述：使星体Z轴对日定向，星体偏航姿态为零，适当时重捕地球。
处理过程：
STEP1:若||〉0.8且FEA=0地球未捕获，则调用-Z轴对日定向，置BZ1=3全姿态捕获对日定向姿态模式。
STEP2:若〉-0.8且FEA=0地球未捕获，则根据BZ5显示的红外有效状态和红外实际的有效情况，计算，。计算公式见（2）。
STEP3:若||≤0.8且FEA=0地球未捕获，则，BZ1 = 4重捕地球转三轴稳定运行，调用Z轴对日定向。若，则FPA = A偏航捕获成功。
STEP4:若FPA = A，FEA = 0，则FEA = 5地球初捕完成，。
STEP5:若FEA = 5，则{调用姿态予估器(1)，调用轨控段喷气姿态控制，FSA = 0，FPA = 0；若，则FEA = A地球捕获成功，FSA = 0，FPA = 0，FSY = ；若ZT2 = 2，ZT1 = 4，则调用飞轮动量保持控制及飞轮启动}。",0,1,0,0,0,0,0,0,0,0,0
功能描述：若3000秒（全姿态捕获除速率阻尼外1000秒，可注入修改）内，三轴中任一轴喷气总量（正负轴单独判断）超过范围（正常模式50s，粗定向和轮子启动、全姿态捕获100s，可注入修改），则根据自锁阀状态，开关自锁阀。全姿态模式,0,0,0,0,0,1,0,0,0,0,0
功能：利用星敏感器A、B、C单独或组合定姿的方式，调用相应姿态修正程序。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：系统软件上电复位后，调用应用软件AppInit函数，并根据初始化内容，启动任务
处理：
OBC上电/复位后，由系统软件引导应用软件运行。首先进行初始化，包括系统软件初始化和系统软件调用应用软件提供的初始化函数（AppInit）。启动任务并开始进行任务调度管理。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的相平面参数
处理：
调整推力角加速度修正因子初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：由-Z面姿控发动机(A1/A2/A3/A4/+X/-X)进行变轨。
处理
有姿控发动机姿控加变轨方式见用户需求5.3.1.3和姿控发动机变轨，cmg姿控方式见5.3.1.，两种方式由地面选取。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：秒脉冲信号处理。,0,0,0,0,0,0,0,1,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ62|初始化|小卫星统一化平台中心控制单元RS422通讯协议：数太协议
FREQ63|数太使用要求|任务书、数太协议
FREQ64|通信|任务书、数太协议
FREQ65|通信故障处理|任务书
FREQ66|数据解包与转换|数太协议
FREQ67|数太数据有效性判断、处理|任务书
FREQ68|数太模拟量采集、处理|预留
FREQ69|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
功能描述：搜索太阳，直到数字太阳敏感器有太阳信息。,0,0,1,0,0,0,0,0,0,0,0
功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据给定电压乘电压/力矩系数和角动量变化率之差判断轮子的故障。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：根据红外信息，将卫星控制在正常飞行姿态。
输入：陀螺数据输出 ，
红外弦宽
红外数据处理（全姿态捕获）的输出，
红外数据有效性标志F_IresValid",0,0,1,0,0,0,0,0,0,0,0
"功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件1553B初始化、变量的初始化                                                                                                                                                                                                                                                                                                                                                                                                             处理：
进行1553B初始化，处理过程见的OBDH初始化功能
设置3个星敏的 RTS信号为无效
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示：
服务编码|发送的条件
85H|上电时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次
47H|每5.12秒
74H|复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次
83H|进入无控模式时申请，收到服务请求确认字后结束
",0,0,0,0,0,0,0,0,0,0,1
"软件需求名称：化学推进使用及通信 
需求类别：其他 
软件需求描述：与发动机通信，输出本周期喷气脉宽。
处理：
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
UPS初始化|FREQ52|UPS初始化|B|2
化学推进数据采集|FREQ53|化学推进数据采集|B|3
推力器脉冲输出|FREQ54|推力器脉冲输出|B|4
推力器健康字设置|FREQ55|推力器健康字设置|B|5
部件操作（程控490N点火，故障重构）|FREQ56|部件操作（程控490N点火，故障重构）|B|
",0,0,0,0,0,0,0,1,0,0,0
功能描述：接收遥控固定参数注入块的系统功能参数设置区数据,0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集0-1太阳的数据，并处理成需要的数据格式。
处理：从I/O口数据采集0-1太阳敏感器的信号",0,0,0,0,0,0,0,0,1,0,0
"功能描述：发送AOCC姿态数据（含侧摆角度）
处理： OBDH在相机成像期间每500ms从AOCC接收一次姿态数据（含2字节侧摆角度值），AOCC在OBDH完成接收姿态数据后，将新的姿态数据（含2字节侧摆角度值）写入总线发送缓冲区。其处理过程如下：
STEP1：AOCC应用程序每0.524秒查询一次有无OBDH发送数据请求，如果有则转入第二步，否则退出；
STEP2：根据不同的数据装载模式，确定装载数据，并按照遥测要求进行格式转换；
STEP3：把遥测缓存区的内容放入OBDH定义的内存中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据指令完成中继天线的捕获跟踪控制。
输入：跟踪开始指令（R_GZKS=1），跟踪结束指令（R_GZJS=1），RelayGDASwapAcqFlag，FRelayGDASwapAcq, ， 
输出：RelayGDAView, FRelayGDASwapAcq ,、，",0,1,0,0,0,0,0,0,0,0,0
"功能描述：使星体-Z轴捕获太阳。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：光纤陀螺数据处理,0,0,0,0,0,0,0,0,1,0,0
"功能描述：用整星广播时间校正星上时间
处理：解包广播校时数据，
- 若为星务UTC校时，计算星务星箭分离星时；
- 若当前星时与星务星箭分离星时相差绝对值小于dt，则实施校时；否则不校时。
- 校时成功后，更新星敏、CCD、微波测距仪、可见光相机的同步信号基准时刻。
说明：上电/复位时，dt = 200秒；成功校时后，dt = 10秒",0,0,0,0,0,0,0,0,0,1,0
"功能描述：在红外太阳定姿方式下计算四元数，在其余定姿方式下计算欧拉角。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据帆板角误差、控制帆板跟踪太阳。
处理：
左帆板的处理流程：
""||""|FF1|
——|——|=0.0105sgn(-)
——|——|=0.00524sgn(-)
——|——|=+0.0000875sgn(-)
[0, 0.0175]|——|=
(0.0175,∞)|1|=+0.0000875sgn(-)
(0.0524,∞)|——|=+0.0000875sgn(-)
[0, 0.0524]|0|=

若，则：FF1=0；
若，则：FF1=1。
右帆板的处理流程：
同左帆板，相应变量替换为右帆板的变量。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：绕本体x轴转动，减小卫星的滚动角。
输入：	陀螺数据输出的输出 ，红外数据有效性标志F_IresValid（由有效性判据给出）
红外数据处理（全姿态捕获）的输出，
上周期姿态角估值，",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压、、。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：选择相平面参数、角加速度
处理：根据工作模式设置相平面参数；根据推力器分支及追踪器构型设置角加速度。
说明：10种构型，2种分支共计20组角加速度（每组包括正负三轴共6个）；",0,1,0,0,0,0,0,0,0,0,0
"将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。
序号|功能描述|功能编号
|姿控数据块1|FREQ65.1
|变轨数据块|FREQ65.2
|轨道数据块|FREQ65.3
|动量轮参数块|FREQ65.4
|轮控系数块|FREQ65.5
|相平面控制参数块|FREQ65.6
|陀螺当量修正数据块|FREQ65.7
|红外太阳修正数据块|FREQ65.8
|星敏感器数据块|FREQ65.9
|故障判别因子系数块|FREQ65.10
|陀螺故障判别因子系数块|FREQ65.11
|全姿态捕获参数块|FREQ65.12
|SDC命令块|FREQ65.13
|LTU命令块|FREQ65.14
|程序块|FREQ65.15
|内存修改块|FREQ65.16
|姿控数据块2|FREQ65.17
|陀螺红外参数数据块|FREQ65.18
|星敏修正时无陀螺模式的修正参数块|FREQ65.19
|整星偏置动量数据块|FREQ65.20
|轨道注入保护参数块|FREQ65.21
|星敏感器程序块|FREQ65.22
|星敏感器程序注入控制块|FREQ65.23
|EEPROM程序操作块|FREQ65.24
|帆板命令块|FREQ65.25

具体内容见注入文件。",0,0,0,0,0,0,0,0,0,1,0
"通讯串口
04H|波特率寄存器|RW|""波特率寄存器低位：0x04（115200）
0x18（19200）""
08H|波特率寄存器|RW|波特率寄存器高位：0x00
CAN总线初始化
寄存器名称|初始化内容|初始化意义
""CAN_ADDR        
(CAN总线地址)""|无。|无说明。
""控制寄存器
(Control Register)
""|0x07|""D7D6D5：保留。
D4：超载（接收设备不能按数据发送速率接收数据而造成的数据丢失）中断使能。
高：开放。低：禁止
D3：错误中断使能。
高：开放。低：禁止
D2：发送中断使能。
高：开放。低：禁止
D1：接收中断使能。
高：开放。低：禁止
D0：复位模式。
在初始化的时候，复位模式位置1，才可以进行初始化设置。""
命令寄存器(Command register)|0x=00001100|""D7D6D5：保留。必须。
D4：进入睡眠状态。
高：睡眠 。低：睡眠唤醒。
D3：清除超载状态。不产生超载中断。
高：清除。低：无动作。
D2：释放接收缓冲器。（读接收缓存器内容后，释放缓存器，以便其他报文立即可用）。
高：释放。低：无动作。
D1：夭折发送。
D0：发送请求。
高：报文即将发送。低：无动作。""
""验收代码寄存器
(Acceptance 
Code Register)""|0xa7=10100111|""当通过验收测试的报文被接收，且若存在空的接收缓存器，则各自的描述符和数据场被顺序存贮在空的缓存器中，在不存在空的接收缓存器的情况下，数据超载位被置位高(超载)，当完整的报文被正确接收，将出现下列操作：
接收缓存器状态位被置为高(满)
若接收中断开放位被置为高(开放)，接收中断被置为高(置位)
验收码位(AC.7~AC.0)和报文标识符的最高8位(ID.10~ID.3)必须等于由验收屏蔽位必须满足""
""验收屏蔽寄存器
((Acceptance 
Mask Register))""|0xf8|最后三位相关。
总线时序寄存器0(Bus Timing Register 0)|0x00|""总线时序寄存器的内容决定波特率预分频器(BRP)和同步跳转宽度(SJW)的数值。

通过总线定时器的内容，将波特率预分频器设置为2，即将输入的系统时钟二分频，由于输入的系统时钟已经是将计算机晶体频率14.7456MHz二分频，即7.3728MHz。所以这个时候时钟为3.6864 MHz。""
总线时序寄存器1(Bus Timing Register 1)|0x18|""采样（SAM）=1总线采样1次。
TSEG1和TSEG2确定每位周期的时钟周期数目和采样点位置：

由于一位周期是由

而

波特率＝""
""时钟分频器
(Clock Divider
register)""|0x40|""D7:CAN模式。
0：基本模式。
D5:1(旁路输入比较器，仅在复位模式下起作用)。""
""OCR
(output Control)""|0x|

在完成上述初始化后，要再次初始化控制寄存器。将最低位初始化为0。",1,0,0,0,0,0,0,0,0,0,0
功能描述：当滚动（俯仰）、偏航发动机计数器归零发出中断请求时关闭相应推力器。,0,0,0,0,0,0,0,1,0,0,0
功能描述：确定数字太阳数据的有效性。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输出：数字太阳敏感器输出；模拟太阳敏感器输出；模拟式太阳敏感器视场码；0-1式太阳敏感器的信号（0或1）；数字太阳敏感器视场码。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得数字太阳、模拟太阳、0-1太阳数据；每个控制周期根据DSSLTUSeltFlag确定进行通讯的太阳LTU，发送取数指令。
（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：选择视速度增量关机位置控制喷管
",0,1,0,0,0,0,0,0,0,0,0
功能描述：J2000年地心赤道惯性系中的速度增量计算,0,0,0,0,1,0,0,0,0,0,0
"功能描述：与推进线路盒通信，输出本周期喷气脉宽。
处理：
功能编号|功能|引用文档
FREQ90|初始化|任务书
FREQ91|推力器使用要求|任务书
FREQ92|通信|任务书
FREQ93|通信故障处理|预留
FREQ94|数据解包与转换|预留
FREQ95|推力器数据有效性处理|预留
FREQ96|推力器模拟量采集、处理|任务书
FREQ97|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：重要数据保存
处理：回送重要数据
说明：上电/复位35秒内 或 主动段 或 任务超时 或 与LTU通讯连续失败20次且自主切换禁止，不保存重要数据。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：计算给控制器的姿态和角速度误差。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：仅使用红外定姿时，计算正常飞行轮控所需电压。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：选择三轴控制力
处理：根据推力器分支设置控制力。
说明：3种分支共计3组控制力（每组包括正负X轴，Y轴，Z轴共4个）",0,1,0,0,0,0,0,0,0,0,0
"软件需求标识：FREQ21 
软件需求名称：部件加断电指令处理 
需求类别：其他 
软件需求描述：部件加断电指令处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位。
处理：更动：去掉星敏粗姿态计算。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收AOCC系统注入参数
处理：
当收到接收遥控注入结束标识消息后，将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。只有当某个块类型的所有数据都收到，且每块数据的校验和都正确时，才能使用此种类型的注入数据。注入的数据具体见上行注入文件。需要注意的是：地面注入ZT9时：若ZT9中为1的个数小于3个，则不改变星上ZT9的取值，如果等于3个，则BZ9=ZT9；应用软件不响应ZT1=2、ZT1=6、ZT1=8的注入指令。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：地垂线捕获后，捕获偏航角，建立对地三轴稳定。
",0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|卫星轨道计算|FREQ8|4.1.1|星上实时计算卫星轨道
|GPS计算|FREQ9|4.1.1.2|将GPS轨道确定参数转换成控制系统中太阳星历和地磁场计算所需的19个轨道参数
|光行差的修正参数和数字太阳敏感器输出角估值计算|FREQ10|4.1.2|计算光行差的修正参数，数字太阳敏感器输出角估值
|地磁场模型计算|FREQ11|4.1.3|星上实时计算地磁场强度
",0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据陀螺输入，予估卫星对地姿态。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的红外太阳姿态滤波参数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：正常对地运行模式控制
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：搜索太阳，直到数字/模拟太阳敏感器有太阳信息
",0,0,1,0,0,0,0,0,0,0,0
功能描述：通过注入轨道参数，计算轨道外推数据。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：将陀螺有效输出数据，换算成卫星三轴角速度。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的执行机构参数设定及诊断参数
处理：
调整CMG高速角动量与标称值偏差阀值系数的初装值。",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|对地数传天线1数据的采集与处理|FREQ1.7.1|""对地数传天线1 LTU控制指令
""|对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
|对地数传天线2数据的采集与处理|FREQ1.7.2|""对地数传天线2
LTU控制指令""|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：
循环太阳搜索时对部件的切换（功能编号：FReq-16）。
处理：
(1)第一次滚动搜索不成功时，若另一份SPE健康，切换另一份SPE；
(2)第二次滚动搜索不成功时，若另一份MPSDP健康，切换另一份MPSDP；否则切换另一份SPE，此条件下第三次搜索不成功直接进入（4）;  
(3)第三次滚动搜索不成功时，切换另一份SPE;
(4)第四次滚动搜索不成功时，转停控;
部件切换的间隔周期，在保证不冲突的情况下，软件可自主确定。",0,0,0,0,0,1,0,0,0,0,0
功能：利用星敏感器和陀螺或者仅利用星敏感器的输出计算卫星欧拉角和四元数。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：太阳地球全姿态捕获模式捕获过程
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压。
",0,1,0,0,0,0,0,0,0,0,0
"软件需求标识：FREQ5 
软件需求名称：星时校正 
软件需求描述：星时校时。
",0,0,0,0,0,0,0,0,1,0,0
功能描述：CMG数据处理。,0,1,0,0,0,0,0,0,0,0,0
功能描述：利用星敏感器数据进行卫星姿态捕获。,0,1,0,0,0,0,0,0,0,0,0
"功能编号|功能|引用文档
FREQ86|初始化|预留
FREQ87|模太使用要求|任务书
FREQ88|通信(AD)|任务书
FREQ89|通信故障处理|预留
FREQ90|数据解包与转换|任务书
FREQ91|模太硬件故障处理|预留
FREQ92|模太数据有效性处理|任务书
FREQ93|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|对地数传天线1数据的采集与处理|FREQ1.7.1|""对地数传天线1 LTU控制指令
""|对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
|对地数传天线2数据的采集与处理|FREQ1.7.2|""对地数传天线2
LTU控制指令""|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
|中继天线数据的采集与处理|FREQ1.7.3|中继天线LTU控制指令|中继天线的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据+Y帆板角误差控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：检测推力器的微漏，必要时作相应的主备份切换。
",0,0,0,0,0,1,0,0,0,0,0
功能描述：在完成对日定向后，由地面指令转入地球捕获。当两个地球红外敏感器同时故障时，使用数字太阳敏感器和星敏感器定姿建立正常姿态。,0,0,1,0,0,0,0,0,0,0,0
"软件需求名称：动量轮控制 
需求类别：其他 
软件需求描述：根据控制律计算结果，驱动动量轮，进行姿态控制。",0,0,0,0,0,0,0,1,0,0,0
"功能描述：由模拟太阳A/B码、监视码得到模拟太阳角、见太阳标志。
处理：
以0.25~0.30太阳常数作为门槛值，2路监视码电压信号均高于门槛值时，设置该模拟太阳输出信号有效。在模拟太阳敏感器输出有效前提下，按下面定出的计算公式，对采集的2路A/B码信号进行处理，最终获得模拟太阳敏感器的输出。
测量角，最小码当量0.
上式中XA，XB分别对应2路A/B码中A码和B码的信号输出。
当监视码输出有效且测量角绝对值大于19.6875时，需要进行饱和处理，输出19.6875，极性不变。",0,0,0,0,0,0,0,0,1,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
平台陀螺通讯诊断及处理|进行平台陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
SpaceWire内总线通讯故障诊断|进行SpaceWire内总线通讯故障诊断
SpaceWire外总线通讯故障诊断|进行SpaceWire外总线通讯故障诊断
CAN总线通讯故障诊断|进行CAN总线通讯故障诊断
同步串口通讯故障诊断|进行同步串口通讯故障诊断
CMG通讯诊断及处理|进行CMG通讯故障诊断及处理
部件故障诊断|对部件进行故障诊断
陀螺故障诊断|由平衡方程方法、星敏感器数据、以及动力学输出对陀螺进行故障检测
CMG故障诊断|根据CMG输出数据和理论数据进行CMG故障检测
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
系统故障检测|根据姿态角和姿态角速度偏差数据进行系统故障的检测",0,0,0,0,0,0,1,0,0,0,0
功能描述：对星敏感器输出数据进行有效性判断。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：光纤陀螺取数指令及一体化红外指令
",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|功能及处理描述
|红外1数据的采集与处理|FREQ3.1|选择通讯的红外1LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|红外2数据的采集与处理|FREQ3.2|选择通讯的红外2LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
",0,0,0,0,0,0,0,0,1,0,0
"此章节01星为“发送AOCC侧摆事件数据”，现删除，替换为“发送AOCC硬件工作状态数据”
功能描述：发送AOCC硬件工作状态数据
处理：当控制计算机发生加电工作时，此功能有效标志默认为无效，当班计算机不会存储重要数据。此功能需要通过内存修改功能有效标志才能启动，每4S保存一次，存满后申请发送。复位后不清此功能的有效标志。OBDH中的数据为切机前的控制计算机保存的重要数据，可供地面下卸分析使用。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：利用估计的四元数转换姿态角，送给星敏感器的四元数。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：系统软件上电复位后，调用应用软件AppInit函数，并根据初始化内容，启动任务
处理：
AOCC上电/复位后，由系统软件引导应用软件运行。首先进行初始化，包括系统软件初始化和系统软件调用应用软件提供的初始化函数（AppInit）。启动任务并开始进行任务调度管理。",1,0,0,0,0,0,0,0,0,0,0
