Requirements Description,功能需求/初始化,功能需求/控制计算/姿态控制,功能需求/控制计算/姿态确定,功能需求/控制计算/模式管理,功能需求/控制计算/轨道计算,功能需求/控制计算/运行时保障/故障诊断和处理,功能需求/控制计算/运行时保障/数据有效性判断,功能需求/控制输出,功能需求/数据采集,功能需求/遥控,功能需求/遥测
功能描述：太阳全姿态捕获模式控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：决定利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：使星体−Z 轴捕获太阳。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ93|初始化|任务书
FREQ94|磁力矩器使用要求|任务书
FREQ95|通信(DA)|任务书
FREQ96|通信故障处理|预留
FREQ97|数据解包与转换|预留
FREQ98|磁力矩器数据有效性处理|预留
FREQ99|磁力矩器硬件采集、处理|任务书
FREQ100|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：向LTU和星敏感器发送自检指令，获得自检信息
处理：
（1）每0.524秒对1个部件LTU进行自检，依次为选通的太阳、选通的陀螺、选通的左和右帆板，每4个0.524秒对4个LTU自检一次；
(2）对红外LTU的自检见.3；
(3) 每4秒（8个0.524秒）发送一次星敏感器自检命令数据包（HK1包），；
(4)根据遥测格式将返回的自检信息通过OBDH传至地面。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：CAN通信上行/下行数据的组帧和解包。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：星务接收、星务发送、快帧遥测1打包、快帧遥测2打包、轨道参数注入快帧打包、内存下卸快帧打包、慢帧遥测1打包、慢帧遥测2打包、慢帧遥测3打包、姿控广播、热控温度广播、重要数据打包、上行:目标星轨道、上行:数据指令响应处理、上行:固定地址注入解包、上行:可变地址注入解包、上行:轨道注入解包、上行:程序注入、上行:内存下卸指令注入、上行:部件指令、上行:任务块、重要数据返回解包、GNSS定位广播解包、整星广播对时解包、GNSS高精度秒脉冲对时广播解包、CAN总线使用要求",0,0,0,0,0,0,0,0,0,0,1
功能描述：接收遥控固定参数注入块的帆板参数,0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收遥控固定参数注入块的系统正常姿态控制器系数
处理：
调整部分零动量稳态、机动PID系数和正常模式偏航角偏差限幅的初装值。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：使星体Z轴捕获太阳。
处理过程：
STEP1:帆板归零
STEP2:若FSA=0太阳未捕获且ZT13≠4不用数字太阳捕获，则使用0-1太阳敏感器进行捕获。公式见（2）
STEP3:若FSA=0太阳未捕获且ZT13=4用数字太阳捕获，则使用数字太阳敏感器进行捕获，直至两个数字太阳都见太阳，置FSA=5初捕获。公式见（3）
STEP4：当ZT43[4]=1允许陀螺自主加电且FlagGyroAdd=1正在给陀螺加电时，设置FSA=0。若FSA=0，则调用速率喷气控制。
STEP5:若ZT2=2飞轮整星零动量控制模式，且工作飞轮的分数都不小于12分，则调用飞轮动量保持控制及飞轮启动。
STRP6:若ZT2≠2或出现工作飞轮的分数小于12分，则6个飞轮的输出电压都置0。",0,1,0,0,0,0,0,0,0,0,0
"功能描述：仅利用星敏感器A、C的测量，修正姿态四元数与姿态角速度移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：以星敏感器X 为基准标定星敏感器Y。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据-Y帆板角误差控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入预估卫星惯性姿态四元数。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：计算卫星偏流角，适用于地球椭球模型，星体姿态描述为转序。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：姿态机动过程目的姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送应急线路指定内存内容。
处理：
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,0,0,0,1
"功能描述：判断陀螺的使用范围。
输入：	本控制周期内采样的陀螺角度增量 (量纲：弧度) （=,…,）
      	上周期陀螺数据
      	标志 N_GyroDiagnV
处理
对陀螺数据进行有效性判断。若某个陀螺故障或某个陀螺为新上电，则不进行有效性判断（陀螺不引入）。其中陀螺新加电有三种情况1、判断出陀螺故障且允许自主加电情况下，应用软件自主加电。2、数据指令加电。3、脉冲遥控指令加电。对于新加电陀螺，则在该陀螺加电时间小于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为0；当该陀螺加电时间大于等于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为1。
若SLTU陀螺不加电或该陀螺故障，不引入。当“允许使用电源状态诊断陀螺”时，应用软件根据与SLTU通讯得到的陀螺电源状态确定陀螺加断电状态；当“不允许使用电源状态诊断陀螺”时，应用软件只根据数据指令确定陀螺加断电状态。若SLTU得到的六个电源状态均断电，则不根据电源状态判断陀螺是否加电。",0,0,0,0,0,0,1,0,0,0,0
功能描述：根据CMG所对应的期望角动量与CMG产生的实际角动量之差，自主诊断CMG的工作状态。,0,0,0,0,0,1,0,0,0,0,0
"软件需求名称：动量轮使用及通信（5m不配置） 
需求类别：其他 
软件需求描述：与动量轮通信，输出本周期电压。采集动量轮电源状态、转速、模拟量等信息。
处理：
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
动量轮初始化|FREQ57|动量轮初始化|B|2
动量轮数据采集|FREQ58|动量轮数据采集|B|3
通信(DA输出、脉冲输入)|FREQ59|通信(DA输出、脉冲输入)|B|4
数据解包与转换|FREQ60|数据解包与转换|B|
",0,0,0,0,0,0,0,1,0,0,0
"包括下表的功能点。
序号|功能描述|功能编号
|向ICU发送控制计算机重要数据|FREQ7.6.1
|向OBDH发送控制计算机重要数据|FREQ7.6.2

发送控制计算机重要数据的具体要求见重要数据文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：帆板未展开时的三轴喷气姿态控制。

处理：同用户需求的
（1）各轴喷气参数设置如表34所示
表34：消初段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|0.4|0.4|0.4
|1.0|1.0|1.0
|0.27|0.2|0.15
|0.15|0.15|0.15
|0.35|0.35|0.35
KJ2(s)|1|2|2
aJS（/s2）|0.281|0.216|0.118

（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,1,0,0,0,0,0,0,0,0,0
"功能：利用星敏感器A的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：利用GPS通道板数据进行GPS定轨程序。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：利用A头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.10
STEP1：计算；FM3更改：若，则：，FSTD=1；
STEP2：计算，。的各项乘以，的各项乘以。
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,0,1,0,0,0,0,0,0,0,0
"功能描述：接收数据指令注入块的部件使用选择类指令
处理：
序号37使用四个陀螺定姿和序号38使用三个陀螺定姿初值更改，改为默认使用3个陀螺。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：紧急撤离模式下，计算视速度增量关机时间长度
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态的变化。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
处理：
OBDH重要数据有四块，大小共为256字节，AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：接收时间码
处理： OBDH分系统每1分钟给控制计算机校时一次。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用动量轮控制电压与动量轮转速的控制关系诊断动量轮
",0,0,0,0,0,1,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|甚高三浮陀螺数据的采集与处理|FREQ1.2.1|""甚高三浮陀螺1553B取数指令
""|陀螺1-6的速度增量|在通讯允许的条件下（每个甚高陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|甚高光纤陀螺数据的采集与处理|FREQ1.2.2|甚高光纤陀螺1553B取数指令|陀螺7-9的速度增量|在通讯允许的条件下（每个光纤陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是即为速度增量数据，直接乘当量就可以得到需要的结果；
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：当星敏感器需要粗姿态时，利用卫星的姿态估值，计算星敏感器的测量系在惯性坐标系中的四元数表示。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：检测工作中的动量轮的故障并设置BZ3。,0,0,0,0,0,1,0,0,0,0,0
功能描述：星上实时计算地磁场强度,0,0,0,0,1,0,0,0,0,0,0
功能描述：发送控制对数传天线的控制角度。,0,0,0,0,0,0,0,1,0,0,0
"功能描述：发送遥测数据
处理：
CTU从AOCC接收遥测数据后，向AOCC发送“当前”的实时遥测帧计数，AOCC随后组织“下一帧”62字节遥测数据并将数据放到相应的子地址（更新总线缓存）。数字量遥测数据格式内容具体见数字量遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能：在完成对日定向后，由地面指令转入地球捕获。使用数字太阳敏感器和星敏感器定姿建立正常姿态。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：由GPS得到轨道外推的16根数。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
输入：数传天线j (j=1,2)，预置指令，跟踪开始指令，跟踪结束指令，地面站i在惯性系指向，被数传天线j(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线j(j=1,2)跟踪的地面站i的矢量在本体系的表示，数传天线收到的预置角度
输出：数传天线1和2的指令转角",0,1,0,0,0,0,0,0,0,0,0
"功能描述：转换动量轮脉冲得到轮子角动量。
处理：
控制系统配置4Nms平台动量轮4个（X、Y、Z、S）。平台动量轮每转18个脉冲，转/分钟对应4Nms。",0,0,0,0,0,0,0,0,1,0,0
功能：利用星敏感器A 、C的测量，修正姿态四元数与估计角速度。,0,0,1,0,0,0,0,0,0,0,0
功能描述：为机动过程姿态确定提供初始姿态。,0,0,1,0,0,0,0,0,0,0,0
功能描述：判断陀螺故障，并选取可用的陀螺。,0,0,0,0,0,1,0,0,0,0,0
功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：上电或复位未取回重要数据初始化
处理
初始化类型|自主切换允许标志|ALTUState
上电|允许|主份，发主开备关
上电|允许|备份，发备开主关
上电|允许|主份，发主开备关
",1,0,0,0,0,0,0,0,0,0,0
功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件进行1553B初始化、变量的初始化
处理：
GPS无效判断的连续次数变量由1改为7。
删除读取一次星时计数器的要求。",1,0,0,0,0,0,0,0,0,0,0
根据同步字的编码内容进行相应的处理：,0,0,0,0,0,0,0,0,0,1,0
功能描述：由模拟太阳粗细码得到模拟太阳角、全开码、见太阳标志。,0,0,0,0,0,0,0,0,1,0,0
"功能描述：计算星上星时。
处理：
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：与CMG通信，控制CMG并获得CMG数据。
处理：
功能编号|功能|引用文档
FREQ74|初始化|与CMG通讯协议
FREQ75|CMG使用要求|任务书
FREQ76|通信(串口)|与CMG通讯协议
FREQ77|通信故障处理|任务书
FREQ78|数据解包与转换|与CMG通讯协议
FREQ79|帆板数据有效性判断、处理|任务书
FREQ80|帆板模拟量采集、处理|任务书
FREQ81|部件在轨转发（在轨修改）|任务书
",0,0,0,0,0,0,0,1,0,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理：包括CPU内部星时时钟和CPU外部星时时钟的星时采集计算与校时。
（1）CPU外部星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期星时锁存寄存器中读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU外部星时时钟星时校时包括OBDH校时和GPS高精度校时两种校时方式：
OBDH校时：当“OBDH星时校时开关”为允许的情况下，进行校时，要求“OBDH星时校时开关”为可内存修改的变量（默认为“OBDH星时校时开关”为“允许”），地面可通过内存修改的方式设置“OBDH星时校时开关”。也分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；
 GPS高精度校时。
OBDH星时校时为系统默认使用的校时方式。GPS秒脉冲高精度时间是否引入系统由注入指令执行控制：若注入指令表示“使用GPS秒脉冲高精度校时时间”，则当满足GPS秒脉冲高精度校时条件时AOCC应用软件仅进行GPS秒脉冲高精度校时时间的计算，系统使用该时间。GPS秒脉冲高精度方式优先级高于OBDH星时校时，当GPS秒脉冲校时时不再进行OBDH星时校时。如果连续超过1分钟均不满足GPS秒脉冲高精度校时条件，则可进行OBDH星时校时。一旦再满足GPS秒脉冲高精度校时条件则继续采用GPS秒脉冲高精度校时。其中GPS秒脉冲高精度校时条件及校时计算具体见任务书中规定。
（2）CPU内部星时时钟的星时采集计算与校时
CPU内部星时时钟星时计算方法。同CPU外部星时时钟星时计算；CPU内部星时时钟星时校时只包括OBDH校时：分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时。
星时的选取
根据注入的姿控数据块2中的CPU星时时钟选用标志来实现内部星时时钟和外部星时时钟的切换，默认为CPU外部星时时钟
均匀校时
内部和外部时钟星时计算中在计算完本周期绝对星时后增加每周期修正量，并在计算前先将它限幅到1毫秒，每周期的修正量初始为0，通过内存修改来修改该修正量。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：利用红外数据自主诊断红外部件状态
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：利用星敏感器数据进行卫星姿态捕获。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：启动动量轮至标称角动量，并保持
",0,1,0,0,0,0,0,0,0,0,0
"包括三个功能点：发送姿态数据、陀螺数据、星敏感器数据辅助数据，功能描述和列写如下：
序号|功能描述|功能编号
1|发送姿态数据|FREQ7.14.1
2|发送陀螺数据|FREQ7.14.2
3|发送星敏感器数据|FREQ7.14.3
",0,0,0,0,0,0,0,0,0,0,1
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书。
功能编号|功能|引用文档
FREQ57|初始化|星敏协议
FREQ58|星敏使用要求|任务书
FREQ59|通信|星敏协议
FREQ60|通信故障处理|任务书
FREQ61|数据解包与转换|星敏协议
FREQ62|星敏数据有效性判断、处理|任务书
FREQ63|星敏模拟量采集、处理|任务书
FREQ64|部件在轨转发（在轨修改）|任务书

3）GPS高精度校时与星敏感器数据的使用
功能描述：根据GPS秒脉冲，秒脉冲广播，进行GPS高精度校时和星敏感器时标处理。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收数传天线状态数据
处理： 将接收数传天线状态存储地址中内容解包成数传天线状态的数据格式，根据不同的数传天线状态设置对应数传天线的加断电状态。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集GPS的状态信息和星敏同步信号
处理：（1）采集GPS状态寄存器转换为状态数据。
       （2）采集星敏同步信号作为计算星敏同步时刻的判据",0,0,0,0,0,0,0,0,1,0,0
功能描述：对二次电源使用、故障切换。,0,0,0,0,0,0,0,1,0,0,0
"功能描述：计算三轴的轮控力矩。
处理：
STEP1:分别计算P,I,D项。，的限幅值可以通过内存修改；，的限幅值可以通过内存修改。计算公式见（1）；
STEP2:PID加补偿的控制律计算。若{BZ1≠8(侧摆机动)或（BZ1=8且ZT43(3)=1允许侧摆机动引入结构滤波器）}且ZT39(4)=1引入结构滤波器，则调用结构滤波器算法得到，。计算公式见（2）；
STEP3:若ZT8≤3姿控发动机可用，ZT2=2飞轮整星零动量控制模式，BZ1≠1（三轴稳定正常轨道运行姿态）或2（偏航机动并稳定运行）或8（侧摆机动）或9（侧摆角保持），则：
若或，则=0.01；
若或，则=0.01；
若或，则=0.01。",0,1,0,0,0,0,0,0,0,0,0
功能描述：接收GPS秒脉冲整秒时间,0,0,0,0,0,0,0,0,0,1,0
"功能描述：利用A，B头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.7。
STEP1：计算；FM3更改：若，则：，FSTD=1；
STEP2：计算，。的各项乘以，的各项乘以。
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,0,1,0,0,0,0,0,0,0,0
CCU控制周期为125ms，对于BC端每帧50ms通信同步服务，应用软件采用轮询方式查询帧序号，作为循环缓冲区子地址指针复位时判断使用。,0,0,0,0,0,0,0,0,0,1,0
"功能描述：动量轮喷气卸载进入和退出条件计算。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送遥测数据
处理：
包括两个子地址，发送两条指令是连续的，共有76个字节。应用软件在收到发送遥测帧计数（低字节为实时遥测帧计数0~63，高字节为实时格式计数0~7）的低字节为62时，根据高字节实时格式计数根据延时遥测数据格式进行打包后放到发送延时遥测参数地址中，具体数据见延时遥测文件。",0,0,0,0,0,0,0,0,0,0,1
功能描述：对数字太阳有效性进行判断。,0,0,0,0,0,0,1,0,0,0,0
"功能描述：0.262秒的中断服务主程序。
处理： 
STEP1：若ZT36=5,则进入自旋模式；
STEP2：
STEP3：若BZ8=5,则进行STEP4，否则返回；
STEP4：陀螺数据输入及转换
STEP5：若BZ1 = 3，FSA = 0，则进行姿态预估器（4）和Z轴捕获太阳；
STEP6：若BZ1 = 6，则：
调用姿态预估器（2）；
，
STEP7：进行轨控开关机，轨控段喷气姿态控制，飞轮动量保持控制及飞轮启动；
STEP8：若BZ1 = 5，则：
帆板未展开模式。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：从SDC获取部件供电状态信息
处理：读入各部件加电状态信息并遥测打包。",0,0,0,0,0,0,0,0,1,0,0
功能描述：接收遥控注入数据，收到遥控注入结束标识后传输结束。,0,0,0,0,0,0,0,0,0,1,0
"功能描述：根据注入的时间，控制轨控发动机，完成初始轨道捕获和正常运行期间的轨道保持
处理过程：过程如下：
STEP1：进行姿态预估（见用户需求），得到姿态角和角速度
STEP2：令，：
STEP3：根据ZT6的值，计算得到：
STEP4：实现轨控开关机功能（见用户需求1.5），输出相应的状态标志及数据：
STEP5：进行轨控段喷气姿态控制（见用户需求）
STEP5：进行飞轮动量保持控制及飞轮启动（见用户需求）",0,0,0,1,0,0,0,0,0,0,0
"功能描述：控制逻辑描述
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收TG状态数据
处理：将接收TG状态数据存储地址中内容解包TG状态。",0,0,0,0,0,0,0,0,0,1,0
"功能描述：接收遥控固定参数注入块的CMG控制系数
处理：
调整CMG框架角回位控制系数、CMG群奇异规避律调整阀值1、CMG群奇异规避律调整系数2的初装值。",0,0,0,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号的选取。
处理：同用户需求的5.1。
——5.1（2）；;",0,0,1,0,0,0,0,0,0,0,0
功能描述：利用陀螺确定出卫星对目标的姿态四元数。,0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|星时的采集和计算|FREQ6.1|对星时进行计算和处理
|星时校正|FREQ6.2|OBDH每隔8分钟向AOCC发送一次校时命令，校正AOCC星上时间。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向帆板LTU发完取数命令后，获得LTU返回数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。具体参见LTU通讯协议件。
（3）帆板LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,0,0,0,1,0,0
"功能描述：姿态角、角速度与姿态四元数预估。
",0,0,1,0,0,0,0,0,0,0,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的控制数据转换为消息需要的格式并输出。
MW数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发MW数据采集指令，获得ACU数据并处理成对应的MW的角动量。
部件加断电指令的处理|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每三个控制周期将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,0,0,0,1,0,0
功能描述：接收内存读出地址及长度，发送内存读出数据包。                                                                                                                                                                                                                                                                                                                                                                                                                    处理：将接收内存地址及长度存储地址中内容的解包成需下传的内存首地址和长度，并判断需下传内容是否在内1553RAM有效地址范围内。若在范围内，则将需下传的内容放到指定地址中。,0,0,0,0,0,0,0,0,0,0,1
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
处理：
（1）读每路动量轮的转速脉冲数，将读到的上一个周期的计数器的值减去本周期的计数器的值（要进行计数器过零时的处理），将差值乘以系数0.0395784。
（2）读每路动量轮的转速方向。AOCC通过并行口（F2H）的D0～D5分别测量MW1～MW6的转动方向，测得0表示反转，1表示正转。
（3）将（1）和（2）的结果相乘得到六个动量轮的角动量，
，（Nms）
动量轮状态确定：根据BZ9、BZ10确定参与工作的动量轮标志FWH，FWH取值与BZ9、BZ10的逻辑关系如下表所示，具体见用户需求5.12，其中BZ9、BZ10由动量轮故障诊断确定。
    表33：动量轮状态确定
BZ9、BZ10的组合情况|FWH取值
BZ10（2）|FWH取值
1|0（动量轮无故障）
1|1（动量轮1故障）
1|2（动量轮2故障）
1|3（动量轮3故障）
1|4（动量轮4故障）
1|5（动量轮5故障）
0|6（动量轮6故障）
1|7（动量轮1、5故障）
1|8（动量轮2、5故障）
1|9（动量轮3、5故障）
1|10（动量轮4、5故障）
0|11（动量轮1、6故障）
0|12（动量轮2、6故障）
0|13（动量轮3、6故障）
0|14（动量轮4、6故障）
0|15（动量轮5、6故障）
1|16（动量轮1、2故障）
1|17（动量轮1、3故障）
1|18（动量轮1、4故障）
1|19（动量轮2、3故障）
1|20（动量轮2、4故障）
1|21（动量轮3、4故障）
其余组合|FWH值不变
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：根据注入轨控开始时间和轨控长度，由6个喷管完成轨控。
处理：
根据注入轨控开始时间和轨控长度，由6个喷管完成轨控，进入轨控模式后需进行如下设置。
		自锁阀1、2均开；
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；//在有星敏和无星敏时均可启动CMG
调用目标姿态确定；
调用控制器输入量计算；
if(OrContrlCmg=0)  调用 姿控发动机轨控1；
else{调用 姿控发动机轨控2；调用 CMG的控制；}
调用系统故障诊断；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：计算磁卸载所需的磁矩与磁力矩器工作脉宽。
",0,1,0,0,0,0,0,0,0,0,0
功能描述：对星敏感器输出数据进行有效性判断，并选取定姿星敏组合。,0,0,0,0,0,0,1,0,0,0,0
功能描述：自旋模式控制,0,0,0,1,0,0,0,0,0,0,0
功能描述：进行单轴相平面分区及控制规律计算。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：发送和接收时间差值
调用条件：有发送和接收时间差值命令字时
周期：CTU复位时
输入：星时，计数值
输出：时间差值
处理：具体处理要求见与外总线通讯协议。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ77|初始化|任务书
FREQ78|地检使用要求|任务书
FREQ79|通信(串口)|任务书
FREQ80|通信故障处理|任务书
FREQ81|数据解包与转换|任务书
FREQ82|地检数据有效性判断、处理|任务书
FREQ83|地检模拟量采集、处理|预留
FREQ84|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,0,0,1,0,0,0
"功能：利用星敏感器B、C的测量，修正姿态四元数与姿态角速度。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的系统轨控调姿及轨控姿态控制系数,0,0,0,0,0,0,0,0,0,1,0
"软件需求名称：陀螺使用及通信 
需求类别：其他 
软件需求描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书附录1时序。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
陀螺接口初始化|FREQ33.1|陀螺接口初始化|B|2
陀螺数据采集|FREQ33.2|陀螺数据采集|A|3
数据解包与转换|FREQ33.3|数据解包与转换|A|4
陀螺数据有效性判断、处理|FREQ33.4|陀螺数据有效性判断、处理|A|5
陀螺故障重构|FREQ33.5|陀螺故障重构|C|
",0,0,0,0,0,0,0,0,1,0,0
"有效性处理放在控制周期中断中采样数据后、定姿前处理；故障诊断放在控制周期中断中定姿与控制后处理。红外定姿时应同时将数字太阳和星敏感器的数据有效性标志置为无效。
需求名称|功能描述
陀螺数据有效性|确定陀螺数据的有效性
红外数据有效性|确定红外数据的有效性
数字太阳数据有效性|确定数字太阳数据的有效性
星敏感器数据有效性|确定星敏感器数据的有效性
动量轮角动量数据有效性|确定动量轮角动量数据的有效性
模拟太阳敏感器数据有效性|确定模拟太阳敏感器数据的有效性
红外自主故障诊断|星上自主检测红外故障
陀螺自主故障诊断|星上自主检测陀螺故障
星敏感器通讯故障|星上自主检测星敏感器故障
动量轮故障诊断|星上自主检测动量轮故障。
推进系统故障诊断|星上自主检测推进系统故障
帆板驱动机构故障诊断|星上自主检测帆板驱动机构故障
模拟太阳敏感器故障诊断|星上自主检测模拟太阳敏感器故障",0,0,0,0,0,0,1,0,0,0,0
"功能描述：根据姿态估值与数字太阳输出，计算量测的一步预测与新息，建立数字太阳输出的可用性标志。
",0,0,1,0,0,0,0,0,0,0,0
"上电/复位后，系统软件进行相应的初始化工作，之后调用应用软件的AInit()函数进行应用软件的初始化。应用软件初始化工作主要包括硬件初始化、变量初始化、星箭分离查询、确定部件加断电状态状态。
硬件初始化的内容如下表所示：
表5-2 上电/复位后硬件初始化表
内  容|状  态
串口初始化|按前面要求进行设置
CANA、B总线初始化|按通讯协议要求进行设置

硬件初始化完成后应用软件需对初始值不为0的变量初始化（系统软件已对B段变量清零），相应变量的初始化值见《卫星控制分系统控制计算机应用软件用户需求》和《卫星控制分系统注入参数及数据指令的用户需求》。应用软件需读取一次星时计数器值。
硬件和变量初始化完成后，应用软件连续进行5次星箭分离查询，每次间隔大于1ms。若连续3次查到星箭分离，则认为星箭已分离，置当前控制模式为“复位进入模式”，设置星时为0.75秒；否则认为星箭未分离，进行主动段初始化工作。",1,0,0,0,0,0,0,0,0,0,0
功能描述：检测推力器的微漏，必要时作相应的主备份切换。,0,0,0,0,0,1,0,0,0,0,0
功能描述：外推轨道计算主程序。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：0.5秒中断采集各部件数据
输出：内存单元保存的各部件数据与状态。
处理：  
     处理流程如下图所示：
                      图11：数据采集处理流程",0,0,0,0,0,0,0,0,1,0,0
功能描述：接收遥控固定参数注入块的星敏姿态修正系数,0,0,0,0,0,0,0,0,0,1,0
功能描述：利用数字太阳信息，进行太阳捕获，对太阳定向；,0,1,0,0,0,0,0,0,0,0,0
"功能描述：星时计算
处理：控制周期中断服务程序，对星时加1",0,0,0,0,0,0,0,0,1,0,0
"功能描述：若本周期角动量与上一周期角动量之差（绝对值）大于0.15Nms，则用上一周期角动量作为本周期输入，角动量变化取0。若连续大于三次或本周期与上一周期角动量之差（绝对值）小于0.15Nms，则以本周期角动量为真值，角动量变化取
输入：实测飞轮角动量，
      上周期角动量数据，
      剔野判断计数器N_WheelPick_i (i=x,y,z,s)",0,0,0,0,0,0,1,0,0,0,0
功能描述：接收数据指令注入块的自主诊断允许类指令,0,0,0,0,0,0,0,0,0,1,0
功能描述：根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：接收GPS通道板定位数据
处理：将接收GPS通道板定位数据存储地址中内容解包星时、卫星的位置和速度。",0,0,0,0,0,0,0,0,0,1,0
功能描述：对数传天线控制指令的处理 ,0,0,0,0,0,0,0,1,0,0,0
"软件需求名称：模式切换 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.1-1-K|从太阳定向模式转出|《用户需求》4.1.1【模式转换条件】|
FREQ12.1-2|从恒星定向1模式转出|《用户需求》4.1.2【模式转换条件】|
FREQ12.1-3|从惯性调姿模式转出|《用户需求》4.1.3【模式转换条件】|
FREQ12.1-4|从恒星定向2模式转出|《用户需求》4.1.4【模式转换条件】|
FREQ12.1-5|从轨控定向模式转出|《用户需求》4.1.5【模式转换条件】|
FREQ12.1-6|从中继跟踪模式转出|《用户需求》4.1.6【模式转换条件】|
FREQ12.1-7|从速率阻尼模式转出|《用户需求》4.1.7【模式转换条件】|
",0,0,0,1,0,0,0,0,0,0,0
功能描述：接收数据指令注入块的模式运行类指令,0,0,0,0,0,0,0,0,0,1,0
功能描述：发送姿态数据包,0,0,0,0,0,0,0,0,0,0,1
"功能描述：进行系统故障的检测。
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：利用星敏感器B、D的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：把陀螺数据、、输入并变换到星体坐标系中的。,0,0,1,0,0,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|三浮陀螺数据的采集与处理|FREQ1.2.1|""三浮陀螺1553B取数指令
""|陀螺1-3的速度增量|在通讯允许的条件下（每个三浮陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是角速率数据，通过任务书给出的公式计算
|光纤陀螺数据的采集与处理|FREQ1.2.2|""光纤陀螺LTU取数指令
""|陀螺4-9的速度增量|在通讯允许的条件下（每个光纤陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是即为速度增量数据，直接乘当量就可以得到需要的结果；
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：模式3切换方式。
处理：
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：若地面指令转入对日定向运行模式或者太阳捕获模式，置CMGStartFlag=1。",0,0,0,1,0,0,0,0,0,0,0
"    各个模式切换的功能点列表如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ5.1.0|4|主动段模式切换条件判断及转出设置
|入轨段控制模式切换|FREQ5.1.1|4.1|入轨段控制模式切换条件判断及转出设置
|正常对地运行模式切换|FREQ5.1.2|4.2|正常对地运行模式切换条件判断及转出设置
|点对点机动模式切换|FREQ5.1.3|4.3|点对点机动模式切换条件判断及转出设置
|姿态/角速度预置模式切换|FREQ5.1.4|4.4|姿态/角速度预置模式切换条件判断及转出设置
|偏置飞行模式切换|FREQ5.1.5|4.5|偏置飞行模式切换条件判断及转出设置
|匀地速跟踪模式切换|FREQ5.1.6|4.6|匀地速跟踪模式切换条件判断及转出设置
|匀角速度匀积分时间跟踪模式切换|FREQ5.1.7|4.7|一般轨迹跟踪模式切换条件判断及转出设置
|轨控模式切换|FREQ5.1.8|4.9|轨控模式切换条件判断及转出设置
|全姿态捕获模式切换|FREQ5.1.9|4.10|全姿态捕获模式切换条件判断及转出设置
|无控模式切换|FREQ5.1.10|4.11|无控模式切换条件判断及转出设置
|凝视姿态跟踪模式切换|FREQ5.1.11|4.12|凝视姿态跟踪模式切换条件判断及转出设置
|测试与标定模式切换|FREQ5.1.12|4.8|测试与标定模式切换条件判断及转出设置
|惯性定向模式切换|FREQ5.1.13|4.13|惯性定向模式切换条件判断及转出设置

切换条件具体见用户需求4。CCU切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
"功能描述：估计各个加速度计零位漂移增量
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：偏航通道喷气中断处理程序。
处理：将推力器9、10、11、12关掉",0,0,0,0,0,0,0,1,0,0,0
功能描述：置卫星姿态无控，处于自由飞行状态。,0,1,0,0,0,0,0,0,0,0,0
功能描述：卫星绕y轴转动，使红外搜索地球。,0,0,1,0,0,0,0,0,0,0,0
"功能描述：卫星速率阻尼下来后，转动卫星，使得数字或模拟太阳见到太阳；先绕本体x轴转动，若转动360度太阳未见太阳，停止x轴转动，再绕本体y轴转动，若转动360度太阳仍未见太阳，重复上述过程(若模拟太阳搜索，则减少转动角度)；
输入：，控制周期；滚动、俯仰数字太阳监视码，TsearchSun；滚动、俯仰模拟太阳监视码；

",0,1,0,0,0,0,0,0,0,0,0
"功能描述：光纤陀螺数据处理
",0,0,0,0,0,0,0,0,1,0,0
功能描述：发送部件工作状态数据包,0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据GPS接收到的数据计算轨道平根数和GPS数据有效性。
处理：
STEP1：若ZT41[4]=0，则使用通道板数据计算GPS数据对应得星时及在惯性系中的位置速度，瞬根数；否则瞬根数用轨道板数据；
STEP2：计算平根数；
STEP3：GPS数据有效性判断。其中误差增加模PI限幅。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：根据动力学输入预估卫星惯性姿态。
",0,0,1,0,0,0,0,0,0,0,0
"星务中心计算机在1s运行周期内与控制计算机完成数据交互一次，在每次交互时星务中心计算机先发送12字节的握手信号，紧接着连续发送有效传输数据。控制计算机在接收全部数据后250ms内，将需要发送给星务计算机的数据数据发给星务中心计算机（包含握手包头和有效传输数据）。
上行数据处理（星务计算机→控制计算机）的功能点如下：上行数据包轮询及数据处理流程、GPS轨道数据、接收AOCC重要数据、星务至CCU数据块、星务至VIPPCU数据块、原始任务注入块、规划结果单次任务输入、任务规划用整星遥测
下行数据处理（控制计算机→星务计算机）的功能点如下：下行数据处理流程、快帧1遥测数据包、快帧2遥测数据包、慢帧1遥测数据包、慢帧2遥测数据包、慢帧3遥测数据包、慢帧4遥测数据包、慢帧5遥测数据包、辅助数据、发送AOCC重要数据、控制分系统成像任务规划结果、控制分系统数传任务规划结果、慢帧6遥测数据包、CCU内存下卸帧、部件内存下卸帧、VIPPCU内存下卸帧",0,0,0,0,0,0,0,0,0,0,1
" 软件需求名称：轨道控制算法 
需求类别：其他 
软件需求描述：轨控速度增量计算及轨控发动机选择。《用户需求》4.7。 ",0,1,0,0,0,0,0,0,0,0,0
"功能描述：模式5切换方式。
处理：
若（且WorkModeT=6且 (且)连续次，WorkMode=6；
若（且WorkModeT=4且 (且)连续次，WorkMode=4；
若{若，则WorkMode= WorkModeT，否则WorkMode=4}；
若FailureFlag=3，置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0,0,0,0
"功能描述：选择通讯的中等精度星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）中等精度星敏共有三个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的中等精度星敏LTU发送取数指令。
（2）向选择的中等精度星敏LTU发送完取数指令后，获得中等精度星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
|极高星敏感器数据的采集与处理|FREQ1.5.5|极高星敏感器1553B取数指令|极高星敏感器的四元素、角速度状态信息|在通讯允许的条件下（极高星敏感器的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：使用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。
功能编号|功能|引用文档|备注
FREQ34|星敏初始化|星敏协议|B
FREQ35|星敏数据采集|任务书|A
FREQ36|数据解包与转换|星敏协议|A
FREQ37|星敏数据有效性判断|任务书|
FREQ38|星敏数据曝光时刻计算|任务书|
FREQ39|星敏数据有效性判断、处理|任务书|A
FREQ40|星敏故障重构|任务书|A
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：用注入程序替代SRAM中对应程序块
处理：解包可变地址参数注入包，更新JumpSlot（下一周期软件根据JumpSlot中的ID转入JumpSlot指定的地址，运行替换后的注入代码）；
说明：JumpSlot是一结构数组，结构中的成员是被修改的模块的ID和注入模块的地址，定义如下：
struct OUMP_SLOT
{
unsigned int mole；
unsigned int *hr0；
unsigned int *hr1；
unsigned int *hr2；
}OSJump_Slot[8]",0,0,0,0,0,0,0,0,0,1,0
"功能描述：采集8路模拟太阳A\B码、监视码。
处理：
采集方法：连续采集8路，采集1路的操作步骤（以ASS1的电流1为例）：
向选通地址输出偏移地址：0x1200 0000 = 30H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果；",0,0,0,0,0,0,0,0,1,0,0
"功能描述：接收同步控制。
处理：根据应急线路同步字的编码内容进行相应的处理：
编码|相应的处理
28H|发送内存的数据区指针复位
",0,0,0,0,0,0,0,0,0,1,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：OBC在CAN总线中断中接收/发送数据；
通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：将陀螺有效输出数据，换算成卫星三轴角度增量。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：实现卫星星上自主或地面遥控下的自旋。为了节省内存，将此模式的代码从PROM中去掉。若需要此模式，则通过在轨注入的方式，将此模式引入控制。
处理过程：过程如下：
STEP1：进行姿态预估，得到姿态角和角速度
STEP2：令动量轮和磁力矩器的控制电压为0
STEP3：当ZT1 = D且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

根据ZT12向偏航和滚动发控制脉冲，处理完置ZT12为0
ZT12取值|处理
3|发偏航正脉冲0.5秒
C|发偏航负脉冲0.5秒
5|当时发滚动正脉冲0.5秒
A|当时发滚动正脉冲0.1秒
F|当L11 + L21 = 1时发滚动正脉冲0.5秒

STEP4：当ZT1 = F且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

确定的符号",0,0,0,1,0,0,0,0,0,0,0
功能描述：：检测工作中的动量轮的故障并设置BZ3。,0,0,0,0,0,1,0,0,0,0,0
"功能描述：星上实时计算太阳轨道、方位与其它参数
说明：计算目标器GPS时，将输入、输出改为目标器的相应变量。",0,0,0,0,1,0,0,0,0,0,0
"功能描述：姿态机动模式控制
",0,0,0,1,0,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器；并记录喷气时间和次数等。
",0,1,0,0,0,0,0,0,0,0,0
"功能：利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序。
输入：姿态预估周期 (量纲：秒)
有效性判据给出的星敏感器A数据可用标志F_SAUsed(1:可用，0:不可用)
有效性判据给出的星敏感器B数据可用标志F_SBUsed(1:可用，0:不可用)
本周期采样到的星敏感器A的有效输出 (设有nA个，即)，以及它们测量时刻相应的星时 (量纲：秒)
本周期采样到的星敏感器B的有效输出(设有nB个，即)，以及它们测量时刻相应的星时(量纲：秒)
使用陀螺数据时：
本周期计算的与前Num_q-1个周期的，以及符号标志F_Qsgn
不使用陀螺数据时：
本周期计算的与前Num_q-1个周期的，以及符号标志F_Qsgn_ng
修正参数 
本周期轨道计算采用的星时 (量纲：秒)
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：决定轨控开关机及姿控，输出相应的状态标志及数据。
处理：在各种条件下的处理见下表所示：判断的顺序为自上而下。
表37：轨控开关机的判别处理
条件|处理
""或
""|""FJO = 0
TJO = 0""
""ZT8  3且
ZT9  3且
""|FTO = 0，FXO = 0，
""且
ZT8  3且
0 < ZT9  3且
FTO  A
""|""	时间关机条件： 

姿态关机条件如下：
轨控推力器开关判断：

喷气长度和累计计算如下

""
""BZ1=6
轨控期间""|发的指令
{ FTO = A }，星体无偏航机动|C1 = CCCC
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：以1s为采样周期，计算角速度。。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：确定星敏感器数据的有效性。,0,0,0,0,0,0,1,0,0,0,0
功能描述：计算磁卸载所需的磁矩与磁力矩器工作电压,0,1,0,0,0,0,0,0,0,0,0
"功能描述：由模拟太阳信号码、监视码得到模拟太阳角、见太阳标志。
",0,0,0,0,0,0,0,0,1,0,0
"功能描述：1553B芯片初始化；
处理：
芯片复位，将1553B芯片的RAM区显式地清零，设置内存映射，将所用1553B寄存器显式地初始化，初始化1553B为RT模式。
其中子地址10、11为循环缓冲方式，其余子地址为单消息方式。
软件的1553B消息处理采用查询方式。",1,0,0,0,0,0,0,0,0,0,0
功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移,0,0,1,0,0,0,0,0,0,0,0
"功能描述：三轴喷气姿态控制。
",0,1,0,0,0,0,0,0,0,0,0
"功能描述：使用红外、数字太阳敏感器确定姿态。
",0,0,1,0,0,0,0,0,0,0,0
功能描述：计算固定目标视线在本体系的表示。,0,0,0,0,1,0,0,0,0,0,0
"功能描述：光纤陀螺、星敏及一体化红外通讯状态设置指令
",0,0,0,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,0,0,0,1,0,0
"    各个模式切换的功能点列表如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ5.1.0|4|主动段模式切换条件判断及转出设置
|初始速率阻尼模式切换|FREQ5.1.1|4.1|初始速率阻尼模式切换条件判断及转出设置
|正常对日巡航模式切换|FREQ5.1.2|4.2|正常对日巡航模式切换条件判断及转出设置
|点对点机动模式切换|FREQ5.1.3|4.3|点对点机动模式切换条件判断及转出设置
|姿态/角速度预置模式切换|FREQ5.1.4|4.4|姿态/角速度预置模式切换条件判断及转出设置
|对地定向模式切换|FREQ5.1.5|4.5|对地定向模式切换条件判断及转出设置
|匀地速跟踪模式切换|FREQ5.1.6|4.6|匀地速跟踪模式切换条件判断及转出设置
|轨控模式切换|FREQ5.1.9|4.9|轨控模式切换条件判断及转出设置
|太阳捕获模式切换|FREQ5.1.10|4.10|太阳捕获模式切换条件判断及转出设置
|无控模式切换|FREQ5.1.11|4.11|无控模式切换条件判断及转出设置
|凝视姿态跟踪模式切换|FREQ5.1.12|4.12|凝视姿态跟踪模式切换条件判断及转出设置

切换条件具体见用户需求4。CCU切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,0,0,1,0,0,0,0,0,0,0
"“复位进入模式”中应用软件进行如下初始化工作：
置星时为2100秒；
置“向星务分系统申请重要数据”标志。
在“复位进入模式”中AO进行如下工作：
控制量输出均为0。部件开关设置为“不进行任何操作”。
响应星务分系统遥测轮询、数据遥控指令、数据注入、程序注入并进行相应处理，但不响应星务重要数据的轮询。
在“复位进入模式”中AO不进行控制律计算。",1,0,0,0,0,0,0,0,0,0,0
"功能描述：实时计算卫星轨道参数及太阳方位，太阳敏感器理论输出。
处理：同用户需求的4.2。为防止t-t0过大导致系统切机，在轨道计算中增加时间超差不调用轨道计算，仅外推轨道幅角；太阳星历的计算仍然调用。
STEP1：计算卫星轨道根数。计算公式见4.2(1)；
STEP2：计算太阳轨道和太阳敏感器理论输出，其中岁差补偿公式有更改，Cbo的计算公式改用红外定姿姿态。计算公式见4.2(2)；
STEP3：若FlagIresOrbSun=0，则FHSL=FHSR=1左右红外都不见太阳。FlagIresOrbSun是注入内存修改变量，若注入修改令FlagIresOrbSun=1，则引入红外软件见太阳保护。
STEP4：若计算的轨道半径r和相差以上，或计算的轨道角速度和0.001108rad/s相差0.00008以上，则判定轨道计算偏差太大，置BZ2=4，同时置r=6871，=0.001108，。",0,0,0,0,1,0,0,0,0,0,0
"软件需求名称：上电/复位后模式转换处理 
需求类别：其他 
软件需求描述：电/复位后模式转换处理”。",0,0,0,1,0,0,0,0,0,0,0
"序号|功能描述|功能编号
|姿态数据包|FREQ60.1
|星敏感器数据包1|FREQ60.2
|星敏感器数据包2|FREQ60.3
|红外太阳修正数据包|FREQ60.4
|星敏感器修正数据包|FREQ60.5
|姿态控制数据包1|FREQ60.6
|姿态控制数据包2|FREQ60.7
|轨道数据包1|FREQ60.8
|轨道数据包2|FREQ60.9
|AOCC状态数据包|FREQ60.10
|LTU自检数据包|FREQ60.11
|星敏感器自检数据包|FREQ60.12
|变轨数据包|FREQ60.13
|正常模式和发射模式延时遥测数据|FREQ60.14
|应急模式延时遥测数据|FREQ60.15
|全姿态捕获模式延时遥测数据|FREQ60.16
|变轨模式延时遥测数据|FREQ60.17

具体格式和定义见遥测文件。",0,0,0,0,0,0,0,0,0,0,1
"功能描述：根据帆板角误差、控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0,0,0,0
"功能：计算给控制器的姿态和角速度误差。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：滚动/俯仰姿态机动目标姿态确定。
",0,0,1,0,0,0,0,0,0,0,0
"功能：利用星敏感器A、C的测量，修正姿态四元数与姿态角速度。
调用条件：见用户需求5.2.6节。
周期：0.125秒
输入：WorkMode， ， 。
输出：，
处理
见用户需求5.2.6.11。",0,0,1,0,0,0,0,0,0,0,0
功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。,0,1,0,0,0,0,0,0,0,0,0
"功能描述：卫星的10个工作模式切换方式。
处理：
对每个模式分别按照切换条件处理。见用户需求3.3节。
工作模式切换表
""换后
模式
切换
前模式""|Mode1|Mode2|Mode3|Mode4|Mode5|Mode6|Mode7|Mode8|Mode9
Mode0|1,2||||||||1,2
Mode1||1,2||||||2|1,2
Mode2|||2|2||||1,2|1,2
Mode3||2||1,2|||||1,2
Mode4||1,2|||1,2||||1,2
Mode5||1,2||1,2||1,2|||1,2
Mode6||1,2||2|1,2||1,2||1,2
Mode7||2|||1,2|1|||1,2
Mode8||1,2|||||||1,2
Mode9||1,2|||||||

说明：代号“1”表示自主进入；代号“2”表示地面/总线指令进入",0,0,0,1,0,0,0,0,0,0,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
部件加断电指令的处理|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,0,0,0,1,0,0
功能描述：入轨段控制,0,0,0,1,0,0,0,0,0,0,0
"功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：诊断姿控喷管微漏故障
",0,0,0,0,0,1,0,0,0,0,0
"功能描述：利用数字太阳信息，进行太阳捕获，对太阳定向。
",0,0,1,0,0,0,0,0,0,0,0
"功能：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。
",0,0,1,0,0,0,0,0,0,0,0
"功能描述：太阳定向完成后，利用数字太阳与红外信息，进行俯仰、滚动捕获，并建立正常姿态
",0,0,1,0,0,0,0,0,0,0,0
功能描述：置卫星姿态无控，处于自由飞行状态,0,1,0,0,0,0,0,0,0,0,0
"功能描述：推力器喷气状态清零
",0,1,0,0,0,0,0,0,0,0,0
