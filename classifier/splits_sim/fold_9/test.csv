Requirements Description,初始化,控制计算,控制输出,故障诊断和处理,数据有效性判断,数据采集,遥控,遥测
根据同步字的编码内容进行相应的处理：,0,0,0,0,0,0,1,0
"AO在主动段初始化中进行如下工作：
星时清零；
工作模式为主动段；",0,0,0,1,0,0,0,0
功能描述：正常对地运行模式初始化,0,1,0,0,0,0,0,0
功能描述：根据姿态估值与数字太阳输出，判断太阳修正可用性。,0,1,0,0,0,0,0,0
"功能描述：发送AOCC时间
处理：
CTU复位后需要从AOCC恢复重要数据和星上时间。首先CTU发送“接收用于做时间差值的时间码”指令，将CTU目前的时间发送给AOCC。AOCC将星上时间和接收到的CTU时间做差值处理，将AOCC时间-CTU时间保存。CTU在1s后发送“发送时间差值”指令，AOCC将保存的时间差值发送给CTU。",0,0,0,0,0,0,1,0
"功能描述：根据指令完成中继天线的捕获跟踪控制。
输入：跟踪开始指令（R_GZKS=1），跟踪结束指令（R_GZJS=1），RelayGDASwapAcqFlag，FRelayGDASwapAcq, ， 
输出：RelayGDAView, FRelayGDASwapAcq ,、，",0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|+Y帆板1553B取数指令（广播同步消息）
+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
-Y帆板数据的采集与处理|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|+Y帆板控制数据
+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|-Y帆板控制数据
-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,1,0,0
"功能描述：根据CMG输出数据和理论数据进行CMG故障检测。
",0,1,0,0,0,0,0,0
功能描述：根据加在CMG框架上的指令角速度而产生的期望角度与CMG框架产生的实际角度之差，自主诊断CMG框架的工作状态。,0,0,0,0,1,0,0,0
"功能描述：利用星敏感器捕获地球分两个阶段。在第一阶段，60秒判断一次星敏感器姿态输出。如果星敏感器A、B、C均有姿态输出，且测量的光轴夹角满足一定条件，则利用星敏感器双矢量定姿确定姿态。若仅有A或仅有B或仅有C有姿态输出，则偏航转过小角度（3度），重复捕获。偏航转过3度后，若星敏感器A或B或C有姿态输出，且满足一定条件，利用星敏感器双矢量定姿。若三个星敏感器均无姿态输出或由输出但仍不满足一定的条件，进行偏航转动（45度）。若偏航转动1周天仍未捕获成功，则滚动转动90度。若全天球捕获成功，则当姿态角和姿态角速度满足一定条件，进入阶段2。在阶段2，利用四元数进行姿态确定（与姿态机动定姿相同）。喷气控制。
",0,1,0,0,0,0,0,0
"功能描述：接收服务请求确认字
处理： 将接收服务请求确认字存储地址中内容解包成服务请求确认字的数据格式，根据不同的服务请求确认字停止对应的服务请求的申请。",0,0,0,0,0,0,1,0
"功能描述：进行系统故障的检测。
",0,1,0,0,0,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ62|初始化|小卫星统一化平台中心控制单元RS422通讯协议：数太协议
FREQ63|数太使用要求|任务书、数太协议
FREQ64|通信|任务书、数太协议
FREQ65|通信故障处理|任务书
FREQ66|数据解包与转换|数太协议
FREQ67|数太数据有效性判断、处理|任务书
FREQ68|数太模拟量采集、处理|预留
FREQ69|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"功能描述：CMG数据处理
",0,0,0,0,0,1,0,0
功能描述：动量轮摩擦力矩的补偿电压计算。,0,1,0,0,0,0,0,0
功能描述：置卫星姿态无控，处于自由飞行状态。,0,1,0,0,0,0,0,0
功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。,0,1,0,0,0,0,0,0
"功能描述：轨道数据解包及处理
处理：依据地面注入轨道种类，追踪器轨道平根数、目标器轨道平根数、追踪器J2000坐标系轨道参数、目标器J2000坐标系轨道参数，更新相应轨道数据。
说明：星务分系统向GNCC送数采用128字节(有效使用1字节)帧格式。注入数据格式见《卫星GNC分系统GN与星务分系统通讯协议》，注入内容见《卫星控制分系统注入参数及数据指令》",0,0,0,0,0,0,1,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。                                                                                                                                                                                                                                                                                                                                                                                                                    处理：
在AOCC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ66|初始化|与一体化太阳通信协议
FREQ67|数太使用要求|任务书、数太协议
FREQ68|通信|任务书、数太协议
FREQ69|通信故障处理|任务书
FREQ70|数据解包与转换|数太协议
FREQ71|数太数据有效性判断、处理|任务书
FREQ72|数太模拟量采集、处理|预留
FREQ73|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"功能描述：完成卫星正常轨道运行期间的三轴稳定姿态，并进行偏流角修正控制，实现姿态指向精度、姿态稳定度等性能指标。
进入条件：
自主条件：从BZ1=B、2、4、6、8满足条件转入
退出条件：
满足下列条件之一：
自主条件：
满足ZT6  3（有偏航机动）且C1 = FFFF（轨控数据有效标志为有效）且（偏航机动开始时刻之前1800秒）（偏航回调机动开始时刻后600秒）转入BZ1=2
满足（轨控发动机开机时刻-60秒）（轨控发动机关机时刻+100秒）且C1 = FFFF（轨控数据有效标志为有效）且转入BZ1 = 6
满足FM=1（ZT35不等于0且收到侧摆命令块）转入BZ1=8
满足ZT226（系统故障自检有效，可自主切换工作模式）且FSY07（系统故障打分小于等于7）且ZT8  3，ZT9  3（姿轨控发动机可用）转入BZ1=3
满足ZT226（系统故障自检有效，可自主切换工作模式），FSY07（系统故障打分小于等于7），且（ZT8  4（姿控发动机不可用）或ZT9  4（轨控发动机不可用））转入BZ1=7
地面上行注入ZT1不等于1、4 
处理过程：过程如下：
STEP1：当ZT F且ZTA且ZT3B ，进行姿态预估，得到姿态角和角速度。
STEP2：进行运行段姿态确定，具体过程如下：
姿态红外修正（1）和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP3：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3（姿控发动机可用）且ZT9  3（轨控发动机可用）且ZT（不用红外+单个斜装陀螺定姿）时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
t的取值范围|处理
|""发姿轨控发动机加温指令
进行运行段姿态确定 
进行运行段控制""
|""发姿轨控发动机加温指令
发左右帆板归零指令
飞轮动量保持控制及飞轮启动
令，
 轨控段喷气姿态控制""
|""令 ，

轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令""
|""令，
轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令
""
|""红外数据采集及处理
红外故障检测及信号选取
姿态红外修正（2）
，
运行段喷气姿态控制
飞轮动量保持控制及飞轮启动
运行段帆板控制""
|BZ1 = 1，C1 = CCCC。

当ZT40(4) = 1（天线扫描捕获）时，进行数传天线捕获跟踪控制
STEP4：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态的变化。
",0,1,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：，
输出：保持角动量所需电压， 
      角动量偏差积分项：，
",0,1,0,0,0,0,0,0
"功能描述：卫星正常运行模式之一，完成三周对地指向，包含辐射定标方式。
处理：控制分系统按照地面规划的指令在轨道A、B、C、D四个点进行姿态机动来完成日地、地日、地地之间的姿态转换。辐射标定模式下的姿态固定，由数据指令控制进入标定模式。
在该模式下，控制系统根据数据块指令提供的开始和结束时间，开始、停止对指定天线控制角度进行计算，并0.5秒向天线发送一次控制指令。
正常模式初始化需向引入的星敏发送TC_RATE_LIMIT指令，将星敏工作的最大转速设置为固定地址注入的ratelimitnormal值（高精度状态）。
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺的数据处理；
调用四元数陀螺预估；
调用星敏感器数据处理；
if(MoveSTSInSystemFlag=2且SSTCatchSuc＝0) 调用 星敏感器对日定向 的a项；
调用利用星敏感器的姿态确定；
调用中继天线捕获跟踪控制；
调用对地数传天线捕获跟踪控制；
调用目标姿态确定；
调用控制器输入量计算；
调用喷气卸载条件计算；
调用CMG奇异状态的判断及算法计算；
if((UnLoadMode =0  或 TimeStopC > 0.0) 
{调用CMG的控制；调用磁卸载控制；}
else {if(Flag_equation=0且TimeStopC<=0)调用相平面喷气脉宽；
调用CMG启动与保持；}
调用系统故障诊断；",0,1,0,0,0,0,0,0
"功能描述：二次电源切换。
处理：
ACU内部含有两套二次电源，两套互为备份，可以同时加电工作，通常仅一份工作。AOCC每个控制周期采集工作电源的状态模拟量，并设置当班状态（若某份的5V和12V遥测模拟量均≥2V则当班，若主备二次电源同时符合加电条件则置主份当班）。
若当班电源的5V或12V遥测模拟量连续5个控制周期<2V时，且允许ACU二次电源自主切换，则先发送另一份电源开、隔两个控制周期后再发送本电源关指令，并禁止ACU二次电源自主切换。。
上电/复位初始化为允许自主切换，主份当班。",0,0,1,0,0,0,0,0
功能描述：确定陀螺数据的有效性。,0,1,0,0,0,0,0,0
功能描述：计算固定目标视线在本体系的表示。,0,1,0,0,0,0,0,0
"功能描述：复位模式初始化
处理：
- StarTime（星上时间）：0.0；
- 向星务分系统申请重要数据；",1,0,0,0,0,0,0,0
"序号|功能描述|功能编号
|姿态数据包|FREQ60.1
|星敏感器数据包1|FREQ60.2
|星敏感器数据包2|FREQ60.3
|红外太阳修正数据包|FREQ60.4
|星敏感器修正数据包|FREQ60.5
|姿态控制数据包1|FREQ60.6
|姿态控制数据包2|FREQ60.7
|轨道数据包1|FREQ60.8
|轨道数据包2|FREQ60.9
|AOCC状态数据包|FREQ60.10
|LTU自检数据包|FREQ60.11
|星敏感器自检数据包|FREQ60.12
|变轨数据包|FREQ60.13
|正常模式和发射模式延时遥测数据|FREQ60.14
|应急模式延时遥测数据|FREQ60.15
|全姿态捕获模式延时遥测数据|FREQ60.16
|变轨模式延时遥测数据|FREQ60.17

具体格式和定义见遥测文件。",0,0,0,0,0,0,0,1
功能描述：计算在整星角动量偏置下，CMG控制时的框架角速率指令。,0,1,0,0,0,0,0,0
"功能描述：
 完成推力器判断和处理功能（功能编号：FReq-15）。

处理：进行推力器喷气量过量的故障诊断，仿真推力器堵漏、安装错误等故障。诊断出一份故障后等待1000个周期，再进行另一份推力器故障诊断的要求。具体判断与处理逻辑详见任务书，任务书中cntwaitWTF的相关操作实际无效，软件可自主实现其相关操作。
根据推力器故障诊断逻辑，综合考虑了推力器的工作分支、太阳可见标志SP61/62、太阳数据跳数等相关因素。",0,1,0,0,0,0,0,0
"功能描述：决定利用星敏感器A、B、C单独或组合定姿的方式，调用相应姿态修正程序。
",0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计角速度。
",0,1,0,0,0,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量。
输入：动量轮的转速方向和脉冲计量、上一次轮子角动量值。
输出：动量轮的角动量。
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量（动量轮角速度为1800r/min时的角动量为15Nms）。
（3）令（i = 1，2，… ，6）。为上一次轮子角动量值。（i = 1，2，… ，6）。",0,0,0,0,0,1,0,0
"功能描述：选择通讯的数传天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）数传天线有四个LTU，天线1和2各有两个互为备份。应用软件初始上电时不与数传天线通讯，与数传天线开始通讯的条件为：收到数传天线预指或复位总线指令和数传天线加电。停止与数传天线通讯的条件为：收到数传天线停止总线指令和数传天线断电。其中数传天线加断电状态由1553B的接收数传天线伺服控制器状态设置数据命令来确定。同时也根据这个命令确定参与通讯的LTU。初始为选择主份，收到主切备时切换到备份；在备份通讯时，收到备切主时切换到主份。
（2）向数传天线LTU发完取数命令后，获得数传天线LTU返回的数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。",0,0,0,0,0,1,0,0
"软件需求名称：接收上行注入数据指令 
需求类别：其他 
软件需求描述：接收并处理上行注入数据指令。",0,0,0,0,0,0,1,0
当需要请求服务时，将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。,0,0,0,0,1,0,0,0
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|对地数传天线1 LTU控制指令
对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|对地数传天线2
LTU控制指令|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|中继天线LTU控制指令|中继天线的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,0,0,1,0,0
"软件需求名称：帆板驱动装置的处理 
需求类别：其他 
软件需求描述：对帆板驱动装置的加断电等进行特殊处理。",0,0,1,0,0,0,0,0
"功能描述：发送和接收时间差值
调用条件：有发送和接收时间差值命令字时
周期：CTU复位时
输入：星时，计数值
输出：时间差值
处理：具体处理要求见与外总线通讯协议。",0,0,0,0,0,0,0,1
"功能描述：模式3切换方式。
处理：
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：若地面指令转入对日定向运行模式或者太阳捕获模式，置CMGStartFlag=1。",0,1,0,0,0,0,0,0
功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测,0,1,0,0,0,0,0,0
功能描述：红外数据处理,0,0,0,0,0,1,0,0
"功能描述：由数字太阳粗细码得到数字太阳角、全开码、见太阳标志。
处理：
每个数字太阳敏感器包括7道粗码（C1～C7）、4道细码（F1～F4）、2道监视码（M1、M2）和1道全开码（T），数字太阳敏感器的第8道粗码(C8)与第1道细码(F1)合为一道码。所有14道码均由电路处理为电压信号，量纲为伏。
在数字太阳敏感器中，8道粗码以格雷码形式编码，探头输出的信号为原始的光电流信号，进行I/V变换放大后为模拟电压信号，再经A/D转换为数字量信号。粗码与格雷码的对应关系见表5-4所示：
表5-4 粗码与格雷码对应关系
粗  码|C1|C2|C3|C4|C5|C6|C7|C8(F1)
格雷码|G7|G6|G5|G4|G3|G2|G1|G0

首先，对粗码进行二值化处理，以全开码输出的一半作为阈值，当高于阈值时，对应的格雷码输出为“1”，否则为“0”。
其次，对数字太阳粗码角度部分从格雷码向二进制码进行转换。格雷码向二进制码转换时，最高位不变，其后的几位按下列规律转换：
二进制码第i位(i=0～6)： ，式中是异或功能逻辑符。
再次，细码角度（几何角）部分可由下列公式得到：
      F1=A/2 [1-cos（180×α）]	（1）
      F2=A/2 [1-（180×α）]	（2）
      F3=A/2 [1+cos（180×α）]	（3）
      F4=A/2 [1+（180×α）] 	（4）
式中是细码角度（几何角）， 量纲为度，细码角度范围为0～2º，最小码当量为0.78125º；F1～F4的量纲为伏；A表示信号幅值。
	在0～0.5º范围内时，由式（1）～（4）可以得到：
               α=a()      
，通过粗细码同步处理进行补偿。粗细码同步处理原则如下：
当细码最高两位都为0，且粗码最低两位都为1时，将粗码加1。
当细码最高两位都为1，且粗码最低两位都为0时，将粗码减1。
其余情况不作任何处理。
粗细码角度同步处理完毕之后，所得到的角度为偏移二进制码，偏移量为64度，然后将偏移二进制码转换成原码形式。
每个数字太阳敏感器数据处理后的为：2字节原码，D15：“0”表示见太阳，“1”表示未见太阳；D14：“0”表示负角度，“1”表示正角度；D13~D1为有效数据；D0：恒为0。
数字太阳敏感器视场有效性判断：以0.28太阳常数（34H，对应电压值为1.02V）作为监视码的固定门槛值，用采集到的监视码M1和M2分别与其比较，仅当监视码M1和M2的值均高于固定门槛值时，数字太阳敏感器视场为视场内，否则为视场外。",0,0,0,0,0,1,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书附录1时序。
功能编号|功能|引用文档|备注
FREQ33|陀螺接口初始化|陀螺协议|B
FREQ34|陀螺数据采集|陀螺协议|A
FREQ35|数据解包与转换|陀螺协议|A
FREQ36|陀螺数据有效性判断、处理|任务书|A
FREQ37|陀螺故障重构|任务书|C
",0,0,0,0,0,1,0,0
功能描述：将GPS轨道确定参数转换成控制系统中太阳星历和地磁场计算所需的19个轨道参数,0,1,0,0,0,0,0,0
功能描述：各个模式的初始化设置。,0,1,0,0,0,0,0,0
功能描述：利用星敏感器数据计算卫星对惯性的角速度在本体系的分量,0,0,0,1,0,0,0,0
"功能描述：接收卫星时间
处理：AOCC上电或复位时通过发送重要数据申请给OBDH，OBDH把卫星时间和AOCC重要数据都发到AOCC终端。",0,0,0,0,0,0,1,0
"功能描述：发送AOCC重要数据给OBDH保存
处理：将重要数据打包后放到AOCC重要数据内存地址空间中。重要数据的内容具体见重要数据文件。",0,0,0,0,0,0,0,1
功能描述：地地全姿态捕获模式初始化,0,1,0,0,0,0,0,0
"软件需求名称：模式控制 
需求类别：其他 
软件需求描述：见“用户需求”和“任务书”4.1.10“工作模式要求”2）。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-WM-1|太阳定向模式|《用户需求》4.1.1【调用流程】|
FREQ12.3-WM-2|恒星定向1模式|《用户需求》4.1.2【调用流程】|
FREQ12.3-WM-3|惯性调姿模式|《用户需求》4.1.3【调用流程】|
FREQ12.3-WM-4|恒星定向2模式|《用户需求》4.1.4【调用流程】|
FREQ12.3-WM-5|轨控定向模式|《用户需求》4.1.5【调用流程】|
FREQ12.3-WM-6|中继跟踪模式|《用户需求》4.1.6【调用流程】|
FREQ12.3-WM-7|速率阻尼模式|《用户需求》4.1.7【调用流程】|
FREQ12.3-WM-8|无控模式|《用户需求》4.1.8【调用流程】|
",0,1,0,0,0,0,0,0
"功能描述：搜索太阳，直到数字/模拟太阳敏感器有太阳信息
",0,1,0,0,0,0,0,0
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
下图中模式之间的连接线分为实线和虚线，实线表示正常转移，虚线表示故障转移，在下表中具体列出了模式转移的条件。
                            图5-1 自主模式转换图
表5.2.4.4-2 模式自主转换条件（除复位后重要数据恢复成功转模式外）
序号|功能编号|功能简述|功能详述
|FREQ3.4. 1.22|WM0_to_WM1|连续27s满足组合体分离状态为已分离且触地开关状态为未触地后，系统转太阳定向模式，置LAFlag=00H，为组合体状态；
|FREQ3.4. 1.27|WM1_to_WM20|太阳定向模式中，若故障标志FailureFlag=3，则转入无控模式
|FREQ3.4. 1.28|WM2_to_WM3|""恒星定向2模式中，若惯性调姿开始时刻到tgon≤t≤tgon +ΔtMS且
tgon≥0，则转惯性调姿模式""
|FREQ3.4. 1.29|WM2_to_WM19|恒星定向2模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.30|WM3_to_WM4|""惯性调姿模式中，若姿态好或恒星定向4的时间到，即连续20个周期满足|qBT|≤qhon且|ω|≤ωhon或t≥thon，则转入恒星定向4模式""
|FREQ3.4. 1.31|WM3_to_WM19|惯性调姿模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.32|WM4_to_WM5|恒星定向4模式中，若轨控开始时刻到tgi≤t≤tgi+ΔtMS且tgi>0，则转入轨控定向模式
|FREQ3.4. 1.33|WM4_to_WM6|""恒星定向4模式中，若着陆上升组合体状态下着陆准备开始时刻到且启动动力下降标志有效，即LAFlag=0且
t0+Δtdb-t0p≤t≤t0+Δtdb-t0p+ΔtMS且
BKFlag=1，则转入着陆准备模式""
|FREQ3.4. 1.34|WM4_to_WM19|恒星定向4模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.35|WM5_to_WM1|轨控定向模式中，若轨控子模式字GMODE=2后计时>240s，则转入太阳定向模式
|FREQ3.4. 1.36|WM5_to_WM19|轨控定向模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.37|WM6_to_WM7|着陆准备模式中，若着陆准备模式开始时刻到且启动动力下降标志BKFlag=1，则转入主减速模式
|FREQ3.4. 1.38|WM7_to_WM8|主减速模式中，若FailureFlag=0且PDMSFlag=1，则转入快速调整模式
|FREQ3.4. 1.39|WM7_to_WM9_1|主减速模式中，若FailureFlag=0但是高度已经在主减速切换到接近下降的高度内h<hSafe1，则转入接近下降模式
|FREQ3.4. 1.40|WM7_to_WM9_2|主减速模式中，若（出现陀螺饱和Flag=1，则转入接近下降模式
|FREQ3.4. 1.42|WM7_to_WM10_2|主减速模式中，若FailureFlag=5且 速度满足故障时切换到悬停模式的条件且高度已在悬停高度偏差内，则转入悬停模式
|FREQ3.4. 1.44|WM7_to_WM10_4|主减速模式中，若FailureFlag=5且制导时间已经在切换到悬停模式的阀值内，则转入悬停模式
|FREQ3.4. 1.45|WM8_to_WM9_1|快速调整模式中，若PDMSFlag=2，则转入接近下降模式
|FREQ3.4. 1.46|WM8_to_WM9_2|快速调整模式中，若允许调用安全模式制导律ZT11(D10)=1，则转入接近下降模式
|FREQ3.4. 1.47|WM8_to_WM9_3|快速调整模式中，若高度已经小于快速调整转入接近下降的高度h<hSafe2，则转入接近下降模式
|FREQ3.4. 1.48|WM8_to_WM9_4|快速调整模式中，若出现陀螺饱和Flag=1，则转入接近下降模式
|FREQ3.4. 1.49|WM9_to_WM10_1|接近下降模式中，若接近段无超差AppFFlag=0且动力下降段模式切换标志PDMSFlag=4，则转入悬停模式
|FREQ3.4. 1.50|WM9_to_WM10_2|接近下降模式中，若接近段有超差AppFFlag=1且速度满足故障时切换到悬停模式的条件且高度已在悬停高度偏差内h≤hsus+ dhsus，则转入悬停模式
|FREQ3.4. 1.51|WM9_to_WM10_3|接近下降模式中，若接近段有超差AppFFlag=1且制导时间已经在切换到悬停模式的阀值内tgo1<tgo1AS，则转入悬停模式
|FREQ3.4. 1.52|WM10_to_WM11_1|悬停模式中，若已获安全着陆点SLPFlag=1，则转入避障模式
|FREQ3.4. 1.53|WM10_to_WM11_2|悬停模式中，若悬停计时超过悬停模式切换到避障模式的计时阀值tSH，则转入避障模式
|FREQ3.4. 1.54|WM10_to_WM11_3|悬停模式中，若成像时间已经只剩一个控制周期Tsus≤Δt，则转入避障模式
|FREQ3.4. 1.74|WM10_to_WM11_4|悬停模式中，若BZ1=7或8或9或10时发生过复位，则当vmb_B 低于阀值后转避障
|FREQ3.4. 1.55|WM11_to_WM12_1|避障模式中，若高度距离缓速下降起始高度已经达到模式切换阀值，则转入缓速下降模式
|FREQ3.4. 1.56|WM11_to_WM12_2|避障模式中，若制导时间与避障垂向规划轨迹标称时间之差大于2个控制周期，则转入缓速下降模式
|FREQ3.4. 1.57|WM12_to_WM20_1|""缓速下降模式中，若收到关机信号且缓速下降持续时间大于缓速下降切换到无控的时间切换阀值1，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.58|WM12_to_WM20_2|""缓速下降模式中，若缓速下降持续时间大于缓速下降切换到无控的时间切换阀值2，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.59|WM12_to_WM20_3|""缓速下降模式中，若缓速下降持续时间大于缓速下降切换到无控的时间切换阀值3且注入指令允许加速度关机，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.60|WM14_to_WM15|""起飞准备模式中，若起飞时间到且收到着陆上升器分离信号，则转垂直上升模式
转模式删除tLaunch=t""
|FREQ3.4. 1.70|WM14_to_WM20|起飞准备模式中，若FailureFlag=7，则转无控模式，置BZ1=20
|FREQ3.4. 1.61|WM15_to_WM16|""垂直上升模式中，t>tswitch或（max(|φc|,|θc|,|ψc|)<Φswitch且dh>vswitch 且FailureFlag=0，则切换为BZ1=16""
|FREQ3.4. 1.71|WM15_to_WM17|""垂直上升模式中，t>tswitch或（max(|φc|,|θc|,|ψc|)<Φswitch且dh>vswitch 且FailureFlag≠0，则置PEGConvergeFlag=0，切换为BZ1=16""
|FREQ3.4. 1.69|WM15_to_WM20|垂直上升模式中，若t≥tLaunch+Δtac 且RCSOnFlag≠1，则切换为无控模式BZ1=20
|FREQ3.4. 1.62|WM16_to_WM17|上升调姿模式中，若t-tswitch>tPD1且δθgui≤ΔθPD）或t-tswitch>tPD2，则转入轨道入射模式
|FREQ3.4. 1.72|WM16_to_WM17_2|上升调姿模式中，若FailureFlag≠0，则置PEGConvergeFlag=0，并切换轨道入射模式BZ1=17。
|FREQ3.4. 1.63|WM17_to_WM1_1|轨道入射模式中，若GMODE=2且TGMODE·Δt>Δtaf，则转入太阳定向模式
|FREQ3.4. 1.75|WM17_to_WM3|轨道入射模式中，若GMODE=2且FailureFlag=8，则转入惯性调姿
|FREQ3.4. 1.65|WM18_to_WM1|星光环月模式下，若FailureFlag=6，则转入太阳定向模式
|FREQ3.4. 1.66|WM18_to_WM20|星光环月模式下，若收到轨道器或地面发送的转无控命令，或收到微波应答机发送的停控指令后，则转入无控模式
|FREQ3.4. 1.67|WM19_to_WM2|速率阻尼模式下，若连续100个周期满足惯性角速度好，且ZT11(D11)=1，则转恒星定向2
|FREQ3.4. 1.68|WM19_to_WM1|速率阻尼模式下，若FailureFlag=2，则转入太阳定向模式
|FREQ3.4. 1.73|WM19_to_WM1_2|速率阻尼模式下，若连续100个周期满足惯性角速度好，且ZT11(D11) ≠1，则转入太阳定向模式
",0,1,0,0,0,0,0,0
"软件需求名称：星时获取 
需求类别：其他 
软件需求描述：计算星上星时。
处理：
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。 ",0,0,0,0,0,1,0,0
"功能描述：实现正常模式及侧摆模式下的偏流角计算。
",0,1,0,0,0,0,0,0
功能描述：对星敏感器输出数据进行有效性判断。,0,1,0,0,0,0,0,0
"功能描述：星上实时计算追踪器轨道
",0,1,0,0,0,0,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.6.1~4.6.3。
序号|功能点编号|功能描述|说明
|FREQ3.4.8.1|喷气控制|《用户需求》4.6.1
|FREQ3.4.8.1.1|相平面姿控算法|《用户需求》4.6.1.1
|FREQ3.4.8.1.2|相平面法喷管选择|《用户需求》4.6.1.2
|FREQ3.4.8.1.3|脉冲调宽姿控算法|《用户需求》4.6.1.3
|FREQ3.4.8.1.4|脉冲调宽法喷管选择|《用户需求》4.6.1.4
|FREQ3.4.8.2|动量轮控制|《用户需求》4.6.2
|FREQ3.4.8.2.1|动量轮安装矩阵和电压分配矩阵|《用户需求》4.6.2.1
|FREQ3.4.8.2.2|动量轮摩擦补偿计算|《用户需求》4.6.2.2
|FREQ3.4.8.2.3|动量轮角动量保持的PI控制|《用户需求》4.6.2.3
|FREQ3.4.8.2.4|动量轮启动与保持|《用户需求》4.6.2.4
|FREQ3.4.8.2.5|正常飞行动量轮分配电压计算|《用户需求》4.6.2.5
|FREQ3.4.8.3|喷气卸载计算|《用户需求》4.6.3
|FREQ3.4.8.4|喷气动量轮联合控制|《用户需求》4.6.4
",0,1,0,0,0,0,0,0
"功能描述：根据红外输初，计算太阳在本体坐标系中方位、姿态偏差、弦宽误差估计与量测新息。
输入：姿态估值 
	   红外数据有效性输出 ，
      红外常值偏差估值 ， (量纲：弧度)
红外数据有效性标志F_IresValid（由有效性判据给出）
输出的太阳方位",0,1,0,0,0,0,0,0
"功能描述：上电/复位初始化
处理：
- 串口初始化
- CAN总线初始化
- ALTU、NSMU当班设置
- 红外加电
- 磁力矩器二次电源加电
- 上电/复位星箭分离查询",1,0,0,0,0,0,0,0
"功能描述：卫星速率阻尼下来后，转动卫星，使得数字或模拟太阳见到太阳；先绕本体x轴转动，若转动360度太阳未见太阳，停止x轴转动，再绕本体y轴转动，若转动360度太阳仍未见太阳，重复上述过程(若模拟太阳搜索，则减少转动角度)；
输入：，控制周期；滚动、俯仰数字太阳监视码，TsearchSun；滚动、俯仰模拟太阳监视码；

",0,0,0,1,0,0,0,0
功能描述：接收OBDH时间数据,0,0,0,0,0,0,1,0
"功能描述：自主对计算机进行切换。
处理：
AOCC的A机和B机满足一定的条件下，可以进行切换。",0,0,1,0,0,0,0,0
功能描述：接收遥控固定参数注入块的系统模式转化条件修正系数,0,0,0,0,0,0,1,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。
输入：上周期姿态角估值
陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出：",0,1,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
处理：
OBDH重要数据有四块，大小共为256字节，AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,1
"上电/复位后，系统软件进行相应的初始化工作，之后调用应用软件的AInit()函数进行应用软件的初始化。应用软件初始化工作主要包括硬件初始化、变量初始化、星箭分离查询、确定部件加断电状态状态。
硬件初始化的内容如下表所示：
表5-2 上电/复位后硬件初始化表
内  容|状  态
串口初始化|按前面要求进行设置
CANA、B总线初始化|按通讯协议要求进行设置

硬件初始化完成后应用软件需对初始值不为0的变量初始化（系统软件已对B段变量清零），相应变量的初始化值见《卫星控制分系统控制计算机应用软件用户需求》和《卫星控制分系统注入参数及数据指令的用户需求》。应用软件需读取一次星时计数器值。
硬件和变量初始化完成后，应用软件连续进行5次星箭分离查询，每次间隔大于1ms。若连续3次查到星箭分离，则认为星箭已分离，置当前控制模式为“复位进入模式”，设置星时为0.75秒；否则认为星箭未分离，进行主动段初始化工作。",1,0,0,0,0,0,0,0
"软件需求名称：太阳敏感器使用及通信 
需求类别：其他 
软件需求描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
太敏初始化|FREQ41|太敏初始化|B|2
太敏数据采集|FREQ42|太敏数据采集|A|3
数据解包与转换|FREQ43|数据解包与转换|A|4
太敏数据有效性判断|FREQ44|太敏数据有效性判断|A|5
太敏故障重构|FREQ45|太敏故障重构|C|
",0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,1,0,0
"功能描述：计算机动模式轮控所需电压。
输入：本体相对目标姿态的四元数
      本体相对目标坐标系转速的估值
      陀螺角速度估值    ，
      实测飞轮角动量    ，
      ，",0,1,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示：
服务编码|发送的条件
85H|上电时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次
47H|每5.12秒
74H|复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次
83H|进入无控模式时申请，收到服务请求确认字后结束
",0,0,0,0,0,0,0,1
功能描述：确定数字太阳数据的有效性。,0,1,0,0,0,0,0,0
"功能描述：当星敏感器需要粗姿态时，利用卫星的姿态估值，计算星敏感器的测量系在惯性坐标系中的四元数表示。
",0,1,0,0,0,0,0,0
功能描述：根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差。,0,1,0,0,0,0,0,0
"功能描述：根据姿态估值与数字输出，判断修正可用性。
",0,0,0,0,1,0,0,0
"功能描述：卫星正常运行模式之一，完成在阳照区和非任务区的对日功能，保证星上能源。
处理：
该模式卫星正常在轨工作模式，入轨期间，CMG启动在满足一定的姿态条件后，由地面指令“允许转入对日定向模式”指令，控制星上模式由CMG启动模式转入对日定向模式。之后控制分系统按照地面规划的指令在轨道A、B、C、D四个点进行姿态机动来完成日地、地日、地地之间的姿态转换。辐射标定模式下的姿态固定，由数据指令控制进入标定模式。
在该模式下，控制系统根据数据块指令提供的开始和结束时间，开始、停止对指定天线控制角度进行计算，并0.5秒向天线发送一次控制指令每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺的数据处理；
调用四元数陀螺预估；
调用星敏感器数据处理；
调用利用星敏感器的姿态确定；
调用中继天线捕获跟踪控制；
调用对地数传天线捕获跟踪控制；
调用目标姿态确定；
调用控制器输入量计算；
调用喷气卸载条件计算；
调用CMG奇异状态的判断及算法计算；
if(UnLoadMode=0)
{调用CMG的控制；调用磁卸载控制；}
else {调用CMG启动与保持；
if(Flag_equation=0且TimeStopC<=0)调用相平面喷气脉宽；}
调用系统故障诊断；",0,1,0,0,0,0,0,0
功能：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。,0,0,0,0,1,0,0,0
功能描述：根据CMG输出数据和理论数据进行CMG故障检测及处理。,0,1,0,0,0,0,0,0
功能：利用星敏感器A 、C的测量，修正姿态四元数与估计角速度。,0,1,0,0,0,0,0,0
"功能描述：引入飞轮控制（包含启动、动量保持、喷气卸载等）及撤去飞轮控制。
处理：
根据ZT2的取值进行不同的处理，处理逻辑见下表，见用户需求。
ZT2=1：飞轮启动，动量保持
ZT2=2：飞轮整星零动量控制模式
ZT2 6：不用轮控
ZT3≤3：用红外+太阳+陀螺定姿，且接入控制回路
ZT3=A：星敏无陀螺定姿，且接入控制回路，整星零动量控制方式
ZT3=C：用星敏感器+陀螺定姿，且接入控制回路
ZT3=F：用红外+单个斜装陀螺定姿，且接入控制回路
                      表38：飞轮控制的判别处理
条件|处理
 ZT2 6或3个动量轮工作|（i = 1， … ，6）
ZT2=1，3个以上动量轮工作|飞轮动量保持控制及飞轮启动
ZT2=2，3个以上动量轮工作|""喷气卸载逻辑判断：
①，。当BZ1 = 8时令,=0.
② 当连续三次，则：FHU = A,若BZ1 =1或 2或 9，则：FHU = A 
③当FHU = A且ZT8  3且ZT9  3，则：飞轮动量保持控制及飞轮启动 
④当ZT,ZT，且且且，则：FHU = 0
⑤当ZT3 = F或B且且BZ50且且，则：FHU = 0
⑥ 若ZT3=A，则：
若且FSTD 1且且，则：FHU = 0
""

卫星的三轴转动惯量分别为 3023.2kgm2、  3453.1kgm2 、 4998.7kgm2。
其中飞轮动量保持控制及飞轮启动的处理详见用户需求，飞轮控制电压计算详见用户需求1.3.4",0,1,0,0,0,0,0,0
"功能描述：接收时间码
处理： OBDH分系统每1分钟给控制计算机校时一次。",0,0,0,0,1,0,0,0
"功能描述：对磁力矩器电压一阶滤波。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ12|4.2.1|将陀螺有效输出数据，换算成卫星三轴角度增量
|欧拉角姿态预估|FREQ13|4.2.2|根据陀螺输出，预估卫星姿态和姿态角速度
|红外输出的数据处理|FREQ14|4.2.3.1|根据红外输入，计算姿态偏差、弦宽误差估计与量测新息
|太阳输出的数据处理|FREQ15|4.2.3.2|根据姿态估值与数字太阳输出，计算量测的一步预测与新息
|红外的姿态修正|FREQ16|4.2.4.1|根据红外输出，估计卫星姿态与陀螺漂移
|红外与数字太阳双矢量滤波姿态修正|FREQ17|4.2.4.2|利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差
|正常模式姿态四元数预估|FREQ18|4.2.5.1|姿态角速度与姿态四元数的预估，包括使用陀螺数据和不使用陀螺数据的姿态四元数预估
|星敏感器数据预处理与姿态修正|FREQ19|4.2.5.2|利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序
|星敏感器A、B姿态修正|FREQ20|4.2.5.3|利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移
|星敏感器A姿态修正|FREQ21|4.2.5.4|利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移
|星敏感器B姿态修正|FREQ22|4.2.5.5|利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移
|正常飞行模式的姿态角估计|FREQ23|4.2.5.9|利用估计的四元数转换姿态角
|由正常模式机动起始时刻的姿态四元数|FREQ24|4.2.6.1|为机动过程姿态确定提供初始姿态
|从偏置机动回正常模式时机动起始时刻的姿态四元数|FREQ25|4.2.6.2|为该机动过程姿态确定提供初始姿态
|机动过程与轨控模式的姿态确定|FREQ26|4.2.6.3|利用陀螺确定出卫星对目标的姿态四元数
|从偏置飞行机动回正常模式后的初始姿态换算|FREQ27|4.2.6.4|为正常模式姿态确定提供初始姿态
|计算星敏感器定姿需要的初始姿态|FREQ28|4.2.7|为星敏感器定姿提供初始的相对惯性的姿态四元数。
|红外与数字太阳双矢量定姿|FREQ29|4.2.8|利用红外、数字/太阳敏感器确定姿态
|星敏感器双矢量定姿|FREQ30|4.2.9|利用星敏感器A、B的测量，估计姿态
|不使用陀螺数据的星敏感器A、B姿态修正|FREQ87|4.2.5.6|利用星敏感器A、B的测量，修正姿态四元数
|不使用陀螺数据的星敏感器A姿态修正|FREQ88|4.2.5.7|利用星敏感器A的测量，修正姿态四元数
|不使用陀螺数据的星敏感器B姿态修正|FREQ89|4.2.5.8|利用星敏感器B的测量，修正姿态四元数
|红外差分姿态确定算法|FREQ90|4.2.10|无陀螺时用红外估计滚动、俯仰姿态角及角速度信息
|卫星跟踪姿态及对地表定向目标角计算|FREQ90.1|""4.2.13
4.2.13.1""|计算卫星正常对地跟踪姿态及对地表定向目标角
|偏航目标角计算|FREQ90.2|4.2.13.2|计算偏航跟踪目标姿态，实现帆板对日定向
",0,1,0,0,0,0,0,0
功能描述：检测工作中的动量轮的故障并设置BZ3。,0,1,0,0,0,0,0,0
"控制计算机实时遥测包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包1|FRE65
|发送姿态数据包3|FRE65.1
|星敏感器姿态数据包|FRE65.2
|星敏感器自检数据包|FRE65.3
|姿态控制数据包|FRE65.4
|轨道数据包|FRE65.5
|LTU自检数据包|FRE65.6
|AOCC及状态数据包|FRE65.7
|发送星敏修正数据包|FRE65.8
|发送对日定向数据包|FRE65.9
|数传天线地面夹角数据|FRE65.10

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,1
"功能描述：运行段喷气姿态控制及飞轮控联合运行。
处理：同用户需求的
（1）各轴喷气参数设置如表35所示
表35：运行段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|2.0|2.0|2.0
|1.0 mθD11（注1）|1.0 mθD11（注1）|1.0 mθD11（注1）
|1.0 mθD11（注2）|1.0 mθD11（注2）|1.0 mθD11（注2）
|4.5（注4）|4.5（注4）|4.5（注4）
|3.0 mθB31|3.0 mθB31|3.0 mθB31
|0.14|0.2|0.1
|0.2（注3注4）|0.2（注3注4）|0.2（注3注4）
|（注3-1）|（注3-1）|（注3-1）
|0.03|0.03|0.03
|0.08|0.08|0.08
|0.43（注3注4）|0.43（注3注4）|0.43（注3注4）
|（注3-1）|（注3-1）|（注3-1）
|0.2（注1）|0.2（注1）|0.2（注1）
|0.06（注2）|0.06（注2）|0.06（注2）
KJ2(s)|3|3|3
KJ2(s)|0.5（注3-1）|0.5（注3-1）|0.5（注3-1）
aJS（/s2）|0.137|0.235|0.089

注1：在FHU = A或 { BZ1 = 4，FEA = 0 }的条件下
注2：在FHU = A，ZT3 = F或A或B的条件下
注3：在{ BZ1=8且FRTS=1}的条件下
注3-1：在{ BZ1 = 3，ZT36 = F }的条件下
注4：在ZT40(2)=1,BZ1=1,ZT8≤3,ZT2≤2,FWH≠22的条件下
（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,1,0,0,0,0,0,0
"功能描述：由平衡方程方法、陀螺自检信号和星敏感器数据进行陀螺的故障检测。

处理：(1)6个或5个陀螺参加诊断时，使用平衡方程进行诊断，并且若ZT35(3)=1地面允许自检信号引入诊断，则自检信号无效的陀螺分数减1。若ZT16(3)(4)=11，则星上自主选取定姿陀螺，否则由地面指定。
(2)4个陀螺参加诊断时，若ZT35(4)=0不允许星敏诊陀螺，则同(1)。
(3)3个陀螺参加诊断时，若ZT35(4)=0不允许星敏诊陀螺，则这3个陀螺就是定姿陀螺。
(4)4个或3个陀螺参加检测时，若ZT35(4)=1，则用星敏差分值诊陀螺。判分的阀值乘以，可以进行调整。当允许星上自主选取定姿陀螺时，仅当平衡方程不平衡时可以切换陀螺。",0,1,0,0,0,0,0,0
功能描述：在正常模式中，利用1N推力器实现小推力变轨功能。,0,1,0,0,0,0,0,0
"功能描述：卫星的10个工作模式切换方式。
处理：
对每个模式分别按照切换条件处理。见用户需求3.3节。
工作模式切换表
""换后
模式
切换
前模式""|Mode1|Mode2|Mode3|Mode4|Mode5|Mode6|Mode7|Mode8|Mode9
Mode0|1,2||||||||1,2
Mode1||1,2||||||2|1,2
Mode2|||2|2||||1,2|1,2
Mode3||2||1,2|||||1,2
Mode4||1,2|||1,2||||1,2
Mode5||1,2||1,2||1,2|||1,2
Mode6||1,2||2|1,2||1,2||1,2
Mode7||2|||1,2|1|||1,2
Mode8||1,2|||||||1,2
Mode9||1,2|||||||

说明：代号“1”表示自主进入；代号“2”表示地面/总线指令进入",0,1,0,0,0,0,0,0
"功能描述：姿态机动模式控制
",0,1,0,0,0,0,0,0
功能描述：实现正常模式姿态偏置模式下的偏流角计算。,0,1,0,0,0,0,0,0
"软件需求名称：帆板使用及通信 
需求类别：其他 
软件需求描述：与帆板通信，控制帆板并获得帆板状态数据。
处理：
见通信协议。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
帆板初始化|FREQ46|帆板初始化|B|2
帆板数据采集|FREQ47|帆板数据采集|B|3
数据解包与转换|FREQ48|数据解包与转换|B|4
帆板数据有效性判断、处理|FREQ49|帆板数据有效性判断、处理|B|5
帆板控制量输出|FREQ50|帆板控制量输出|B|6
帆板故障重构|FREQ51|帆板故障重构|C|
",0,0,1,0,0,0,0,0
"功能描述：采集模拟太阳的数据，并处理成需要的数据格式。
处理：
（1）从A/D输入采集模拟太阳的角度数据
（2）从I/O输入采集模拟太阳的视场码",0,0,0,0,0,1,0,0
"功能：利用星敏感器A的测量，修正姿态四元数与估计角速度。
",0,1,0,0,0,0,0,0
"功能描述：CMG奇异状态的判断及算法计算。
输入：采集得的各CMG的框架角Sgang[i]（弧度）；CMG有效性标志Lcmg[i]，Jacobi矩阵sgJ",0,1,0,0,0,0,0,0
"功能描述：选择通讯的红外LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）红外共有两个LTU（正俯仰红外LTU和负俯仰红外LTU），AOCC每个控制周期向注入文件中的ZT5和IresLTUSeltFlag的最大组合中指定的红外LTU发送取数指令
（2）向选择的红外LTU发送完取数指令，获得红外LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,1,0,0
"功能描述：完成运行段偏差姿态确定，（红外修正，太阳修正，星敏感器姿态确定，斜装陀螺定姿等）确定，。
处理：
（1）若BZ1 ≠ 8，9，ZT3≠F,A,B则调用姿态红外修正，调用q及s姿态予估器；若，则：，。
（2）若BZ1 = 8，则
① 根据轮子的工作状况，计算滚动轴最大控制力矩。
② 计算滚动轴角加速度。
③ 计算加速时间。
④ 侧摆喷气判断。
⑤ 计算滚动轴期望轨迹和。
（3）计算姿态角控制量。其中当BZ1≠8,9,ZT3=F或B时，滚动角和俯仰角的限幅值改为可内存修改系数，。红外+斜装陀螺增加偏流角计算。",0,1,0,0,0,0,0,0
"功能描述：
 太阳捕获功能主要实现速率阻尼、俯仰搜索、滚动搜索、巡航等功能，使卫星由任意姿态进入保持对日定向巡航姿态运行。太阳捕获功能分为速率阻尼、俯仰搜索、滚动搜索和巡航四种方式（FReq-6）。
                        表5-2 方式字定义
名称|方式字定义|说明
RDSM|0|速率阻尼方式.(默认方式，程控结束后进入)
PASM|1|俯仰搜索方式
RASM|2|滚动搜索方式
CSM|3|巡航运行方式

处理： 
  （1） 模块初始化设置
   程序结束后，根据任务书5.4.5.3.1节进行模块初始化设置。考虑到地面遥控指令可以重新进入太阳捕获模式（速率阻尼初始化置陀螺故障诊断不允许），软件对模块初始化中的变量分为2个部分，其中以下部分为程控结束后只设置一次的变量：   
推力器输出状态清零；
CleNum = 0;  
采用MRE板数据设置陀螺顶替标志；（考虑S陀螺健康时才进行相应顶替）。
若有飞轮的电源状态为开，则允许飞轮进行转速控制WheelCon＝TRUE；
部分软件自身使用的变量。
（2）在太阳捕获中需要进行动量轮刹车控制以及方式控制：
动量轮刹车控制详见5.2.17节。（有动量轮加电，则进行动量轮刹车控制。）
（3）方式控制如下：
(I) 对卫星进行速率阻尼，连续35个控制周期三轴角速度绝对值（实际取最大值即可）小于0.14°/s，进入俯仰搜索方式；或者进入速率阻尼方式的时间超过2000个控制周期（256秒）后，进入俯仰搜索，开始搜索太阳。
(II)进入俯仰搜索方式，使卫星以+/-0.5/s（速率阻尼结束后进入时根据SPz13选择极性)绕Y轴转动，若5625个控制周期（720秒）后没有捕获到太阳，进入滚动搜索方式。进入滚动搜索方式后，使卫星以0.5°/s绕X轴转动。
(III) 若(II)中滚动搜索方式经过6250个控制周期（800秒）后还未见到太阳则再重复俯仰搜索和滚动搜索，则再次进入（II），即俯仰捕获方式（这种情况下b＝-0.5/s）。其中滚动搜索不成功的故障处理逻辑见5.2.14节。
(IV) 在(II)(III)过程中一旦捕获到太阳且持续时间大于2.048秒(16个控制周期)，则进入巡航方式。进入巡航模式后，控制SADA归零。
说明：捕获太阳时，对于持续时间大于2.048秒的判断，太阳连续可见（SP61/62 = 1）的条件下，俯仰搜索时，俯仰角绝对值大于1°的累计时间；滚动搜索时，滚动角绝对值大于1°的累计时间。",0,1,0,0,0,0,0,0
"功能描述：仅利用星敏感器A、B的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
功能描述：发送部件工作状态数据包,0,0,0,0,0,0,0,1
"功能模式：姿态机动目标姿态确定。
",0,1,0,0,0,0,0,0
"功能描述：检测系统故障，给出故障标志。
",0,0,0,1,0,0,0,0
"功能描述：处理星务返回的重要数据
处理：解包并更新重要数据",0,0,0,0,0,0,1,0
"通讯串口
04H|波特率寄存器|RW|""波特率寄存器低位：0x04（115200）
0x18（19200）""
08H|波特率寄存器|RW|波特率寄存器高位：0x00
CAN总线初始化
寄存器名称|初始化内容|初始化意义
""CAN_ADDR        
(CAN总线地址)""|无。|无说明。
""控制寄存器
(Control Register)
""|0x07|""D7D6D5：保留。
D4：超载（接收设备不能按数据发送速率接收数据而造成的数据丢失）中断使能。
高：开放。低：禁止
D3：错误中断使能。
高：开放。低：禁止
D2：发送中断使能。
高：开放。低：禁止
D1：接收中断使能。
高：开放。低：禁止
D0：复位模式。
在初始化的时候，复位模式位置1，才可以进行初始化设置。""
命令寄存器(Command register)|0x=00001100|""D7D6D5：保留。必须。
D4：进入睡眠状态。
高：睡眠 。低：睡眠唤醒。
D3：清除超载状态。不产生超载中断。
高：清除。低：无动作。
D2：释放接收缓冲器。（读接收缓存器内容后，释放缓存器，以便其他报文立即可用）。
高：释放。低：无动作。
D1：夭折发送。
D0：发送请求。
高：报文即将发送。低：无动作。""
""验收代码寄存器
(Acceptance 
Code Register)""|0xa7=10100111|""当通过验收测试的报文被接收，且若存在空的接收缓存器，则各自的描述符和数据场被顺序存贮在空的缓存器中，在不存在空的接收缓存器的情况下，数据超载位被置位高(超载)，当完整的报文被正确接收，将出现下列操作：
接收缓存器状态位被置为高(满)
若接收中断开放位被置为高(开放)，接收中断被置为高(置位)
验收码位(AC.7~AC.0)和报文标识符的最高8位(ID.10~ID.3)必须等于由验收屏蔽位必须满足""
""验收屏蔽寄存器
((Acceptance 
Mask Register))""|0xf8|最后三位相关。
总线时序寄存器0(Bus Timing Register 0)|0x00|""总线时序寄存器的内容决定波特率预分频器(BRP)和同步跳转宽度(SJW)的数值。

通过总线定时器的内容，将波特率预分频器设置为2，即将输入的系统时钟二分频，由于输入的系统时钟已经是将计算机晶体频率14.7456MHz二分频，即7.3728MHz。所以这个时候时钟为3.6864 MHz。""
总线时序寄存器1(Bus Timing Register 1)|0x18|""采样（SAM）=1总线采样1次。
TSEG1和TSEG2确定每位周期的时钟周期数目和采样点位置：

由于一位周期是由

而

波特率＝""
""时钟分频器
(Clock Divider
register)""|0x40|""D7:CAN模式。
0：基本模式。
D5:1(旁路输入比较器，仅在复位模式下起作用)。""
""OCR
(output Control)""|0x|

在完成上述初始化后，要再次初始化控制寄存器。将最低位初始化为0。",1,0,0,0,0,0,0,0
"功能：利用估计的四元数转换姿态角，送给星敏感器的四元数。
",0,1,0,0,0,0,0,0
功能描述：自旋模式控制,0,1,0,0,0,0,0,0
功能描述：进行部件通讯与选用、数据采集与处理、自检与校时。,0,0,0,0,0,1,0,0
"软件需求名称：动量轮控制 
需求类别：其他 
软件需求描述：根据控制律计算结果，驱动动量轮，进行姿态控制。",0,0,1,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器A、B修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,1,0,0,0,0,0,0
功能描述：姿态机动模式初始化,0,1,0,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|星敏感器1数据的采集与处理|FREQ4.1|选择通讯的星敏1LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|星敏感器2数据的采集与处理|FREQ4.2|选择通讯的星敏2LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
",0,0,0,0,0,1,0,0
功能描述：接收遥控固定参数注入块的轨控参数,0,0,0,0,0,0,1,0
"功能描述：根据陀螺输入，予估q及姿态角（在星测量回路中），等。。
处理：同用户需求的1.6。
STEP1:计算星敏预估角速度，。计算结果的限幅值是0.027。计算公式见1.6（1）。
STEP2:计算q,和，计算公式见1.6（2）。
STEP3:计算，。对于计算结果，当BZ1=8（侧摆机动）时，否则。对于计算结果，。对于计算结果，。计算公式见1.6（3）。",0,1,0,0,0,0,0,0
功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。,0,1,0,0,0,0,0,0
功能描述：根据陀螺输入，预估卫星惯性姿态。,0,1,0,0,0,0,0,0
"功能描述：用整星广播时间校正星上时间
处理：解包广播校时数据，
- 若为星务UTC校时，计算星务星箭分离星时；
- 若当前星时与星务星箭分离星时相差绝对值小于dt，则实施校时；否则不校时。
- 校时成功后，更新星敏、CCD、微波测距仪、可见光相机的同步信号基准时刻。
说明：上电/复位时，dt = 200秒；成功校时后，dt = 10秒",0,0,0,0,0,0,1,0
功能描述：发送星敏感器数据包,0,0,0,0,0,0,0,1
功能描述：接收遥控固定参数注入块的红外陀螺数据有效性及系统故障诊断修正系数,0,0,0,0,0,0,1,0
功能描述：计算磁卸载所需的磁矩与磁力矩器工作脉宽。,0,1,0,0,0,0,0,0
"功能描述：姿态角、角速度与姿态四元数预估。
",0,1,0,0,0,0,0,0
功能描述：对工作的飞轮进行电压补偿，并输出控制电压。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.3|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.4|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据轨控需求和姿控推力器使用情况，开推力器进行轨道控制
|轨道控制喷气|FREQ4.3|5.4.6|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1.1|地面站赤经赤纬计算
|数传天线指向控制|FREQ4.14|5.6.1|根据指令完成数传天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|基于三轴角动量反馈的偏置动量控制方法产品规范|FREQ4.21|/|规范化算法：
|数传天线指向目标角计算|FREQ4.14.2|5.6.1.2|根据指定跟踪数传天线与其被指定跟踪站的方位，计算其跟踪转角
",0,1,0,0,0,0,0,0
"功能描述：与星敏感器通讯获得星敏感器数据是否可以用来定姿。
",0,0,0,0,0,1,0,0
"软件需求标识：FREQ21 
软件需求名称：部件加断电指令处理 
需求类别：其他 
软件需求描述：部件加断电指令处理。",0,0,0,0,0,1,0,0
"软件需求标识：FREQ16 
软件需求名称：加速度计数据处理 
需求类别：其他 
软件需求描述：加速度计数据处理。",0,0,0,0,0,1,0,0
"功能描述：完成遇有单翼帆板未展开时，抖动星体帮助帆板展开的功能。为了节省内存，将此模式的代码从PROM中去掉。若需要此模式，则通过在轨注入的方式，将此模式引入控制。
处理过程：过程如下：
STEP1：如果ZT1 = 5且ZT32 = A且C1 = A1则进行下列处理：
滚动通道每个采样周期中发喷气脉冲（主备份同时发）。其脉冲宽度序列为+0.131，-0.262，+0.262，-0.262，… ，-0.262，+0.262，-0.131，共计120个脉冲。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。
STEP2：如果ZT1 = 5且ZT32 = A且C1 = A2则进行下列处理：
俯仰通道每个采样周期中发喷气脉冲（主备份同时发）。其脉冲宽度序列为+0.131，-0.262，+0.262，-0.262，… ，-0.262，+0.262，-0.131，共计120个脉冲。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。
STEP3：如果ZT1 = 5且ZT32 = A且C1 = A3则进行下列处理：
偏航通道每个采样周期中发喷气脉冲（主备份同时发）。其脉冲宽度序列为+0.131，-0.262，+0.262，-0.262，… ，-0.262，+0.262，-0.131，共计120个脉冲。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。
STEP4：如果ZT1 = 5且ZT32 = A且C1 = FFFF则进行下列处理：
发四个轨控喷管同时工作的脉冲序列：脉冲宽度为0.262，0，0.262，0，… ，0.262，0，共计120个（包括宽度为0的脉冲）。。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。",0,1,0,0,0,0,0,0
轨道计算包括卫星轨道和太阳方位计算、中继卫星轨道计算；GPS计算包括GPS数据转换为轨道平根数计算、GPS平根数数据转换为外推轨道数据计算；地磁场计算为通过轨道外推数据计算地磁场矢量分量。,0,0,0,0,1,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|均匀校时|FREQ1.4.5|""本周期的绝对星时；
均匀校时补偿量""|""本周期的绝对星时；
""|应用软件每次进行星时计算时，将计算后的绝对星时加上均匀校时补偿量作为本周期的补偿后的绝对星时。
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,1,0,0,0,0
"功能描述：接收遥控固定参数注入块的系统正常姿态控制器系数
处理：
调整部分零动量稳态、机动PID系数和正常模式偏航角偏差限幅的初装值。",0,0,0,0,0,0,1,0
功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。,0,1,0,0,0,0,0,0
"功能描述：接收记录AOCC时间指令
处理：CTU在需要恢复星上时间时，向AOCC发送“记录AOCC时间指令”，AOCC收到指令后立即记录AOCC时间并将时间数据写入发送AOCC时间指定的存储地址空间中。",0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|数字太阳数据的采集与处理|FREQ1.1.1|""数字太阳LTU取数指令
""|数字太阳角度和视场码DSS1输出滚动方向角度，DSS2输出俯仰方向角度|在通讯允许的条件下（当班标志为1），每周期向数字太阳LTU发取数指令，获得数字太阳数据并处理成滚动方向和俯仰方向角度以及相应的视场码。
|模拟太阳数据的采集与处理|FREQ1.1.2|""模拟太阳LTU取数指令
""|模拟太阳角度和视场码|每周期无条件的向模拟太阳LTU发取数指令，获得模拟太阳数据并处理成对应的角度。 
",0,0,0,0,0,1,0,0
功能描述：接收数据指令注入块的自主诊断允许类指令,0,0,0,0,0,0,1,0
功能描述：利用陀螺确定出卫星对目标的姿态四元数。,0,1,0,0,0,0,0,0
"功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、。
",0,1,0,0,0,0,0,0
"功能描述：根据地面指令ZT3,ZT42,ZT43，给无故障陀螺自主加电。
处理：同用户需求的。
（1）可以进行陀螺自主加电的条件：①或②
①{6个陀螺中至多只有1个有故障，即姿控数据块中ZT42的低4位和ZT43的低2位中至多只有1位等于1}且{加电陀螺不足5个，即姿控数据块中ZT15的低4位和ZT16的低2位中至多只有4位等于1}；
②{ZT3=A，即“星敏无陀螺定姿，且接入控制回路，整星零动量控制方式”或ZT3=B或ZT3=F}且{6个陀螺中至少有3个正常，即姿控数据块中ZT42的低4位和ZT43的低2位中至少有3位等于1}。
（2）陀螺自主加电的步骤：
STEP1:若满足条件(1)②，则根据ZT42,ZT43按陀螺1至6的升序开启3个正常陀螺，设置ZT15,ZT16相应位为1，并设置BZ3=ZT15，BZ4=ZT16；否则若满足(1)①，则{若ZT42,ZT43显示6个陀螺都正常，则开陀螺12356；否则根据ZT42,ZT43开启5个正常的陀螺}，设置ZT15,ZT16相应位为1。
STEP2:加电后设置陀螺正在加电标志FlagGyroAdd=1（正在加电）。令工作陀螺计分为0FH。",0,1,0,0,0,0,0,0
"功能描述：NSMU初始化
处理：
初始化类型|自主切换允许标志|NSMUState
上电|允许|主份，发主开备关
上电|允许|备份，发备开主关
上电|允许|主份，发主开及备关
上电|允许|空闲
",1,0,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0 |主动段|FREQ52
1|入轨段控制|FREQ53
2|巡天观测模式|FREQ54
3|定点观测模式|FREQ55
4|小天区扫描模式|FREQ56
5|姿态机动|FREQ57
6|轨控|FREQ58
7|捕获太阳并对日定姿模式|FREQ59
8|帆板未展开|FREQ60
9|无控|FREQ61
10|应急模式|FREQ62

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制见用户需求的4。主要模式的姿态确定调用流程的功能点如下：
序号|功能编号|功能描述|用户需求中对应章节
|FREQ53.1|对日定向姿态确定调用流程|5.2.1.1
|FREQ54.1|巡天模式姿态确定调用流程|5.2.1.2
|FREQ55.1|定点观测模式姿态确定调用流程|5.2.1.3
|FREQ56.1|小天区扫描模式姿态确定调用流程|5.2.1.4
|FREQ57.1|姿态机动模式姿态确定调用流程|5.2.1.5
|FREQ58.1|轨控模式姿态确定调用流程|5.2.1.6
",0,1,0,0,0,0,0,0
功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。,0,1,0,0,0,0,0,0
"功能描述：计算正常飞行模式轮控所需电压
说明：系数，装订值均为1，可注入修改。",0,1,0,0,0,0,0,0
"功能描述：为机动过程姿态确定提供初始姿态。
输入：	机动起始时刻本体对轨道估计姿态角()
输出：	机动目标相对轨道的姿态四元数
变换矩阵
本体对目标坐标系的姿态四元数",0,0,0,1,0,0,0,0
"功能描述：接收数据指令注入块的部件使用选择类指令
处理：
序号37使用四个陀螺定姿和序号38使用三个陀螺定姿初值更改，改为默认使用3个陀螺。",0,0,0,0,0,0,1,0
"有效性处理放在控制周期中断中采样数据后、定姿前处理；故障诊断放在控制周期中断中定姿与控制后处理。红外定姿时应同时将数字太阳和星敏感器的数据有效性标志置为无效。
需求名称|功能描述
陀螺数据有效性|确定陀螺数据的有效性
红外数据有效性|确定红外数据的有效性
数字太阳数据有效性|确定数字太阳数据的有效性
星敏感器数据有效性|确定星敏感器数据的有效性
动量轮角动量数据有效性|确定动量轮角动量数据的有效性
模拟太阳敏感器数据有效性|确定模拟太阳敏感器数据的有效性
红外自主故障诊断|星上自主检测红外故障
陀螺自主故障诊断|星上自主检测陀螺故障
星敏感器通讯故障|星上自主检测星敏感器故障
动量轮故障诊断|星上自主检测动量轮故障。
推进系统故障诊断|星上自主检测推进系统故障
帆板驱动机构故障诊断|星上自主检测帆板驱动机构故障
模拟太阳敏感器故障诊断|星上自主检测模拟太阳敏感器故障",0,1,0,0,0,0,0,0
功能描述：CMG数据处理。,0,1,0,0,0,0,0,0
功能描述：利用星敏感器A、B的测量，估计姿态。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|对地数传天线1数据的采集与处理|FREQ1.7.1|""对地数传天线1 LTU控制指令
""|对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
|对地数传天线2数据的采集与处理|FREQ1.7.2|""对地数传天线2
LTU控制指令""|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
|中继天线数据的采集与处理|FREQ1.7.3|中继天线LTU控制指令|中继天线的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。
",0,0,0,0,0,1,0,0
"功能描述：轨控段喷气控制计算。
处理：同用户需求的
（1）各轴喷气参数设置如表36所示
表36：轨控段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|0.4 mθD04|0.4 mθD04|0.4 mθD04
|1.0 mθD13（注1）|1.0 mθD13（注1）|1.0 mθD13（注1）
|1.0 mθB36|1.0 mθB36|1.0 mθB36
|3.0 mθB33（注1）|3.0 mθB33（注1）|3.0 mθB33（注1）
|0.1|0.14|0.07
|0.2|0.2|0.2
|（注3）|（注3）|（注3）
|0.3|0.3|0.3
|0.43（注2）|0.43（注2）|0.43（注2）
|（注3）|（注3）|（注3）
KJ2(s)|2|2|2
aJS（/s2）|0.137|0.235|0.089

注1：在BZ1 =3、4的条件下
注2：在BZ1 =2的条件下
注3：在BZ1 =4的条件下
（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,0,0,1,0,0,0,0
"功能描述：更新地面遥控注入的可变地址参数并处理

处理：解包可变地址数据包，更新相应地址的参数。
可变地址参数注入时，星务分系统向GNCC送数采用8字节(有效使用1字节)帧格式，最多同时注入15个数据。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,1,0
"功能描述：把陀螺数据测量值变换为星体三轴角速度。
",0,1,0,0,0,0,0,0
"功能描述：利用数字太阳角输出，保持卫星帆板对太阳定向。
",0,1,0,0,0,0,0,0
"功能描述：遥测数据打包
处理： 
序号|功能点编号|功能描述
|FREQ4.2.1|四器巡航模式
|FREQ4.2.2|四器变轨模式
|FREQ4.2.3|组合体分离模式
|FREQ4.2.4|着上巡航模式
|FREQ4.2.5|着上轨控模式
|FREQ4.2.6|着上下降模式
|FREQ4.2.7|月面工作模式
|FREQ4.2.8|上升准备模式
|FREQ4.2.9|上升器巡航模式
|FREQ4.2.10|上升器轨控模式
",0,0,0,0,0,0,0,1
功能描述：确定动量轮角动量数据的有效性。,0,1,0,0,0,0,0,0
"功能描述：完成陀螺判断和处理功能（功能编号：FReq-14）。
处理：陀螺故障判断与处理逻辑，进行陀螺饱和故障、陀螺输出常值故障诊断、陀螺跳数故障、控制量与角速度增量不匹配的故障诊断。其中陀螺常值故障诊断由以前的角速度前后周期绝对值之差累计，变更为：角速度前后周期之差累计。并且陀螺平衡方程满足时，增加清相关计数器的可靠性操作。具体处理逻辑详见任务书 中的5.4.5.8.1节。",0,1,0,0,0,0,0,0
"功能描述：决定轨控开关机及姿控，输出相应的状态标志及数据。
处理：在各种条件下的处理见下表所示：判断的顺序为自上而下。
表37：轨控开关机的判别处理
条件|处理
""或
""|""FJO = 0
TJO = 0""
""ZT8  3且
ZT9  3且
""|FTO = 0，FXO = 0，
""且
ZT8  3且
0 < ZT9  3且
FTO  A
""|""	时间关机条件： 

姿态关机条件如下：
轨控推力器开关判断：

喷气长度和累计计算如下

""
""BZ1=6
轨控期间""|发的指令
{ FTO = A }，星体无偏航机动|C1 = CCCC
",0,1,0,0,0,0,0,0
"功能描述：输出喷气指令
处理：
（1）将喷气的喷管打开
（2）将喷气长度写入各自通道的定时器；",0,0,1,0,0,0,0,0
"功能描述：星敏感器数据处理，安装偏差估计。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,1,0,0
"功能描述：帆板未展开时的三轴喷气姿态控制。

处理：同用户需求的
（1）各轴喷气参数设置如表34所示
表34：消初段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|0.4|0.4|0.4
|1.0|1.0|1.0
|0.27|0.2|0.15
|0.15|0.15|0.15
|0.35|0.35|0.35
KJ2(s)|1|2|2
aJS（/s2）|0.281|0.216|0.118

（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,1,0,0,0,0,0,0
功能描述： CMG控制,0,1,0,0,0,0,0,0
"功能描述：与CAN通讯获得上行/下行数据。
调用条件：AOCC被动接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通讯，交换数据，以实现星地联系和对卫星的人工干预。主要完成下列功能：
AOCC向星务分系统发送数据（中断接收星务分系统命令，依据命令发送各类遥测参数）；
发送快帧遥测；
发送慢帧遥测；
将AOCC为星务保存的重要数据发送给星务分系统；
发送星敏感器和姿态辅助数据；
有内存下卸要求时，发送AOCC指定内存内容；
AOCC接收星务分系统数据（中断方式）包括接收固定地址参数注入；接收可变地址参数注入；接收轨道参数数据；接收程序注入；接收数据指令；接收重要数据返回；接收整星对时广播数据；接收GPS高精度秒脉冲对时广播；接收GPS导航数据等。
如果应用软件4s收不到星务分系统信息或连续100秒未收到符合通信协议的正确数据，对CAN总线控制器重新初始化。",0,0,0,0,0,0,0,1
"功能描述：各模式初始化
序号|功能点编号|功能描述|说明
|FREQ3.4.2.1|等待段初始化|《用户需求》4.1.1【初始化】
|FREQ3.4.2.2|太阳定向模式初始化|《用户需求》4.1.2【初始化】
|FREQ3.4.2.3|恒星定向2初始化|《用户需求》4.1.3【初始化】
|FREQ3.4.2.4|惯性调姿模式初始化|《用户需求》4.1.4【初始化】
|FREQ3.4.2.5|恒星定向4初始化|《用户需求》4.1.5【初始化】
|FREQ3.4.2.6|轨控定向模式初始化|《用户需求》4.1.6【初始化】
|FREQ3.4.2.7|着陆准备模式初始化|《用户需求》4.1.7【初始化】
|FREQ3.4.2.8|主减速模式初始化|《用户需求》4.1.8【初始化】
|FREQ3.4.2.9|快速调整模式初始化|《用户需求》4.1.9【初始化】
|FREQ3.4.2.10|接近下降模式初始化|《用户需求》4.1.10【初始化】
|FREQ3.4.2.11|悬停模式初始化|《用户需求》4.1.11【初始化】
|FREQ3.4.2.12|避障模式初始化|《用户需求》4.1.12【初始化】
|FREQ3.4.2.13|缓速下降模式初始化|《用户需求》4.1.13【初始化】
|FREQ3.4.2.14|自主定位模式初始化|《用户需求》4.1.14【初始化】
|FREQ3.4.2.15|起飞准备模式初始化|《用户需求》4.1.15【初始化】
|FREQ3.4.2.16|垂直上升模式初始化|《用户需求》4.1.16【初始化】
|FREQ3.4.2.17|上升调姿模式初始化|《用户需求》4.1.17【初始化】
|FREQ3.4.2.18|轨道入射模式初始化|《用户需求》4.1.18【初始化】
|FREQ3.4.2.19|星光环月模式初始化|《用户需求》4.1.19【初始化】
|FREQ3.4.2.20|速率阻尼模式初始化|《用户需求》4.1.20【初始化】
|FREQ3.4.2.21|无控模式初始化|《用户需求》4.1.21【初始化】
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|5.2.1|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估对地姿态|FREQ3.3|5.2.3|根据陀螺测量输出，一步预估卫星姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|基于红外滤波的卫星姿态确定|FREQ3.6|5.2.6|根据陀螺预估结果和红外(和数字太阳)输出，确定卫星姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|红外与太阳双矢量定姿|FREQ3.9|5.2.9|利用红外、数字太阳敏感器确定姿态
|星敏感器相对基准标定|FREQ3.10|5.2.10|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.11.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.11.2|进行卫星姿态四元数的重置
|三轴欧拉姿态角预估算法产品规范|FREQ3.1.1|/|规范化算法：
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法算法产品规范|FREQ3.1.3|/|规范化算法：
|基于红外测量的红外滤波修正算法产品规范|FREQ3.1.4|/|规范化算法：
|基于单星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.6|/|规范化算法：
|基于红外与太阳矢量的双矢量定姿算法算法产品规范|FREQ3.1.7|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.1|目标姿态计算流程
|正常、偏置飞行目标姿态计算|FREQ3.12.1|5.3.1.1|正常与偏置姿态飞行时的目标姿态计算
|点对点机动目标姿态计算|FREQ3.12.2|5.3.1.2|点对点机动目标姿态计算
|姿态预置过程目标姿态计算|FREQ3.12.3|5.3.1.3|姿态预置过程目标姿态计算
|轨迹跟踪目标姿态计算|FREQ3.12.4|5.3.1.5|角速度建立过程目标姿态计算
|轨控目标姿态计算|FREQ3.12.5|5.3.1.6|轨控目标姿态计算
|角速度扫描阶段目标姿态计算|FREQ3.12.6.1|5.3.1.4|角速度扫描阶段目标姿态计算
|轨控姿态机动轨迹初始化|FREQ3.12.6.2|5.3.2.3|轨控模式目标姿态计算初始化
|正弦轨迹规划算法算法产品规范|FREQ3.12.7|/|规范化算法：
|基于加速度导数为正弦函数的轨迹规划算法算法产品规范|FREQ3.12.8|/|规范化算法：
|点对点姿态机动初始化处理|FREQ3.13|5.3.2.1|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|非沿迹跟踪初始化|FREQ3.14|5.3.2.2|非沿迹跟踪初始化，计算地心张角和方向矢量
|计算多项式轨迹系数|FREQ3.15|5.3.3.1|根据轨迹规划时间，初始姿态/姿态角速度和目标姿态/姿态角速度计算基于多项式轨迹规划的轨迹系数
|姿态预置机动目标姿态确定|FREQ3.16|5.3.3.2|基于多项式曲线的轨迹规划，计算目标姿态
|轨迹跟踪目标姿态角计算|FREQ3.17|5.3.4|根据所指定的扫描起始经纬度和末端点经纬度
|偏流角计算|FREQ3.18|5.3.5|适用于地球椭球模型，星体姿态描述为转序，计算基于星体光轴(与星本体＋Z轴平行)下的偏流角
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|增量式偏流角计算算法产品规范|FREQ3.21|/|规范化算法：
|匀地速姿态预置目标姿态计算|FREQ3.22|5.12|计算模式2/5经模式4转入模式6时姿态预置的目标姿态及角速度
|匀角速度预置目标姿态计算|FREQ3.23|5.13|计算模式2/5经模式4转入模式7时姿态预置的目标姿态及角速度
|零姿态预置目标姿态计算|FREQ3.24|5.14|计算模式6/7经模式4转入模式2时姿态预置的目标姿态及角速度
|陀螺标定过程目标姿态计算|FREQ3.25.0|5.15.1|陀螺标定全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角
|目标姿态计算初始化|FREQ3.25.1|5.15.1.1|对陀螺标定过程中涉及到的两次机动过程进行机动姿态计算的初始化
|惯性姿态点对点机动轨迹规划|FREQ3.25.2|5.15.1.2|对陀螺标定过程所涉及到的两次点对点机动进行轨迹规划
|角速度起速保持与减速过程轨迹规划|FREQ3.25.3|5.15.1.3|对陀螺标定过程中的速度运行进行轨迹规划
|大角速度标定的分档确定|FREQ3.25.4|5.15.1.4|根据实现指向的4挡速度，根据当前的速度的幅值，确定所标定的陀螺刻度因子的位置
|惯性定向时转阶段处理|FREQ3.25.5|5.15.1.5|陀螺标定在第1段中完成惯性定向，并在此期间标定陀螺真实常漂。在惯性定向转速度运行结束时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等。
|速度运行时转阶段处理|FREQ3.25.6|5.15.1.6|SubMode= 2~9，陀螺按照规定的角速度完成起速、恒速运行、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等
|速度曲线规划|FREQ3.25.7|5.15.1.7|根据所选择的机动轨迹，规划出角速度变化曲线
|陀螺标定算法|FREQ3.26.0|5.15.2|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺常漂修正标志确定|FREQ3.26.1|5.15.2.1|对陀螺标定过程中，陀螺常漂的修正标志进行确定。当星体达到了规定的惯性角速度时，开始进行陀螺常漂估计
|基于星敏陀螺滤波的等效常漂估计|FREQ3.26.2|5.15.2.2|采用星敏陀螺滤波的方法对陀螺等效常漂进行估计
|星敏陀螺滤波的陀螺等效常漂记录|FREQ3.26.3|5.15.2.3|对陀螺等效常漂，选取稳态时的一段数据进行平均，得到各个角速度下的等效常漂和星体真实角速度的估计值
|小角速度时的陀螺安装误差和刻度因子误差估计|FREQ3.26.4|5.15.2.4|经过N次速度机动后，对陀螺的测量模型进行标定，给出标定结果
|大角速度时的陀螺标定算法|FREQ3.26.5|5.15.2.5|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺在轨标定时的控制量计算|FREQ3.27|5.15.3|对标定过程中的控制量进行计算
|陀螺安装误差标校结果引入|FREQ3.28|5.15.4|对陀螺完成标定后，待地面确认标定结果无误后，将陀螺的标定结果进行赋值。当地面注入FP__MountingCmp时执行本程序一次
|陀螺刻度因子误差标校结果引入|FREQ3.29|5.15.5|完成陀螺标定，待地面确认无误后，对陀螺的刻度因子进行在轨标校。标校时，取陀螺输出的角速度与与之最接近的两个已标定的特征角速度进行线性插值标校
|偏航对日目标姿态计算|FREQ3.30|5.3.1.7|偏航对日模式下的目标姿态机动
",0,1,0,0,0,0,0,0
功能描述：检测红外的故障，并选取正确的红外信号。,0,1,0,0,0,0,0,0
"功能描述：发送星敏感器数据
处理：OBDH在每个遥测格式的第0帧，从AOCC接收8字节星敏感器数据。其处理过程如下：
STEP1：AOCC应用程序每0.524秒查询一次有无OBDH发送数据请求，如果有则转入第二步，否则退出；
STEP2：判别是否此时星上正在取新的星图，如果是则此次发送8字节固定数4444444444444444，否则转第三步；
STEP3：判别8颗星图（每个星图32字节）数据是否取完，如果没取完，则将取星图数据计数器加1，从规定的星图数据缓存区中取8个字节的数据放入OBDH规定的内存中；否则转第四步。
STEP4：将取星图数据计数器清0，星上开始取新的星图数据 。",0,0,0,0,0,0,0,1
功能描述：对动量轮、推力器和磁力矩器控制指令的处理 ,0,0,1,0,0,0,0,0
"功能描述：使星体−Z 轴对日定向，星体偏航姿态为零，适当时重捕地球。
",0,1,0,0,0,0,0,0
"软件需求名称：帆板控制算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.6.1|帆板控制策略|《用户需求》4.6.1|
FREQ12.3-R4.6.2|帆板控制量确定|《用户需求》4.6.2|
FREQ12.3-R4.6.3|帆板控制指令转速计算|《用户需求》4.6.3|
",0,1,0,0,0,0,0,0
"功能描述：选择通讯的星敏，发取数指令，采集发送的数据，并处理成需要的数据格式。
处理：
 （1）AOCC置取数指令并发送；
（2）AOCC等待接收数据，如果200us没有数据应答，AOCC认为超时故障，把故障计数器加1，退出接收过程；
（3）如果在200us内收到星敏感器数据传递的一个字节数据，则继续接收星敏感器发送的数据，直到规定的数据接收完毕，如果接收过程中有超时，则把故障计数器加1，退出接收过程；
（4）当规定的数据接收完别后，判别星敏感器返回的指令头与发送的指令头是否一致，不一致则把故障计数器加1，退出接收过程；
（5）当校验正确时，把接收的星敏感器数据进行格式转换，并保存。
见本文 “AOCC与星敏感器串行通讯接口”。",0,0,0,0,0,1,0,0
"功能描述：发送控制计算机指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,1,0,0,0,0
"功能描述：地垂线捕获后，捕获偏航角，建立对地三轴稳定。
",0,1,0,0,0,0,0,0
"功能描述：进行单轴相平面分区及控制规律计算。由、、决定是否要喷气；喷气的脉冲宽度；确定本时刻的。
",0,1,0,0,0,0,0,0
"功能描述：根据注入的时间，控制轨控发动机，完成初始轨道捕获和正常运行期间的轨道保持
处理过程：过程如下：
STEP1：进行姿态预估（见用户需求），得到姿态角和角速度
STEP2：令，：
STEP3：根据ZT6的值，计算得到：
STEP4：实现轨控开关机功能（见用户需求1.5），输出相应的状态标志及数据：
STEP5：进行轨控段喷气姿态控制（见用户需求）
STEP5：进行飞轮动量保持控制及飞轮启动（见用户需求）",0,1,0,0,0,0,0,0
"功能描述：每4.192秒运行一次的主程序。
处理： 
STEP1：记录当前的星时、数字太阳敏感器输出、四元数和星敏数据、星敏姿态角及惯性角速度：
，
FSTAVD = FSTAVD05，FSTBVD = FSTBVD05，FSTCVD = FSTCVD05
t星A = t星A05，t星B = t星B05，t星C = t星C05
=，=，=，=，=，=
，；
STEP2：若指定星敏诊断陀螺故障，则：对工作陀螺，
STEP3：进行外推轨道计算和中继卫星轨道计算；
STEP4：重要数据打包，进行数据校正和红外故障检测及信号选取；
STEP5：当BZ1 为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，如果没有喷气则进行光行差修正量计算及加速计零位估计；
STEP6：进行星敏感器数据处理；
STEP7：当BZ1为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，进行下列操作：
当BZ1= 1（三轴稳定正常轨道运行姿态）且BZ2 = 1（已有遥控轨道数据注入）且BZ6 = 3（姿态确定用红外、陀螺和数字太阳）且C1 = 0000（轨控数据有效标志为无效）且ZT3≠F（用红外+单个斜装陀螺定姿，且接入控制回路）且ZT3≠A（星敏无陀螺定姿，且接入控制回路，整星零动量控制方式）时进行姿态太阳修正。
当C1 = CCCC（轨控关机后或偏航机动结束后）时令星敏修正时间；否则
进行S姿态的q修正及光轴方位计算（由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位）
当时令，=，=，=，=，
若C1=0，则根据FSTD（星敏参与定姿的标志）的取值进行相应的星敏修正并令
FSTD取值|处理
2|用A，B头测量修正q
3|用A，C头测量修正q
4|用B，C头测量修正q
5|用A头测量修正q
6|用B头测量修正q
7|用C头测量修正q

当满足ZT4  0（用磁力矩器）且BZ2  2（有遥控注入过）且ZT2  2（飞轮启动保持或零动量控制方式）时进行地磁场计算和飞轮磁卸载；否则令磁力矩器的输出电压为0；
STEP8：当BZ1 = 1或9或 { BZ1 = 3，FSA≥5 } 或 { BZ1 = B，}，则进行推进系统故障检测及切换；
STEP9：若BZ1 = 1或9或 { BZ1 = B，}，则：系统故障检测；否则系统故障检测中的连续时间计数；
STEP10：若ZT17≥4，ZT18≥7，则：帆板故障检测及切换；
STEP11：当ZT38 = F（0.524主程序中插入帆板未展开模式）时，进行帆板未展开模式处理；
STEP12：当BZ1  1，8，9（入轨段控制模式、偏航机动模式、全姿态捕获、重
捕地球、轨控模式、姿态无控模式、自旋模式）时，令不用星敏定姿；
STEP13：若BZ1  1，8，9，B，则：FSY = ；
STEP14：当ZT4 = 0（不用磁力矩器时）或BZ1  （1、9）时，令磁力矩器的电压为0；
STEP15：当ZT2  6时，令动量轮的电压为0；
STEP16：设置，；
STEP17：记录数据， ；
STEP18：进行中帧、慢帧的遥测数据和黑匣子数据的打包。",0,0,0,1,0,0,0,0
"功能描述：发送姿态数据包、红外太阳敏感器数据包、星敏感器数据包、姿态控制数据包、天线数据包、轨道数据包、部件工作状态数据包、系统工作状态数据包、全姿态捕获模式数据包、模拟量遥测数据包。
处理：数据内容见《卫星控制分系统数字量遥测数据格式定义》。
要求应用软件设计时，对角速度相关的遥测参数采取平滑处理，并将处理后的结果遥测输出（高精度数据包中记录的角速度相关数据不采用平滑处理），平滑处理要求为本周期输出的遥测值为最近8个控制周期该遥测参数的平均值。需采取平滑处理的遥测参数包括不同定姿方式下的三轴角速度遥测（dφ/dθ/dψ、//、/）以及角速度误差遥测（//）。",0,0,0,0,0,0,0,1
"功能描述：数传天线数据处理
",0,0,0,0,0,1,0,0
