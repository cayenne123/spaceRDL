Requirements Description,初始化,控制计算,控制输出,故障诊断和处理,数据有效性判断,数据采集,遥控,遥测
将重要数据打包后放到AOCC重要数据内存地址空间中。AOCC共三块重要数据，每块重要数据均有校验和，校验和占4个字节。校验和的计算方法为：将60个字节按双字进行异或计算。,0,0,0,0,0,0,0,1
"功能描述：使用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：模拟太阳故障状态。,0,1,0,0,0,0,0,0
"功能描述：二次电源切换。
处理：
ACU内部含有两套二次电源，两套互为备份，可以同时加电工作，通常仅一份工作。AOCC每个控制周期采集工作电源的状态模拟量，并设置当班状态（若某份的5V和12V遥测模拟量均≥2V则当班，若主备二次电源同时符合加电条件则置主份当班）。
若当班电源的5V或12V遥测模拟量连续5个控制周期<2V时，且允许ACU二次电源自主切换，则先发送另一份电源开、隔两个控制周期后再发送本电源关指令，并禁止ACU二次电源自主切换。。
上电/复位初始化为允许自主切换，主份当班。",0,0,1,0,0,0,0,0
"功能描述：发送应急线路指定内存内容。
处理：
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,1
"功能描述：接收数据指令注入块的部件开关类指令
",0,0,0,0,0,0,1,0
"功能描述：数传天线数据处理
",0,0,0,0,0,1,0,0
功能描述： CMG数据处理。,0,1,0,0,0,0,0,0
"功能描述：选择通讯的红外LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）AOCC每两个0.524秒根据加断电控制字IR_PWR（设置原则见任务书的附录D），向加电的红外LTU发送取数命令（向红外LTU1发送13H，向红外LTU2发送23H），获得每个红外LTU返回的5个字节数据。
（2）将数据根据LTU通讯协议转换成（红外1的前沿到基准）、（红外2的前沿到基准），（红外1的前沿到后沿）、（红外2的前沿到后沿）。
（3）AOCC每两个0.524秒同时向两个红外LTU发自检命令，根据返回的自检信息确定红外1、2有无信号标志HL（1为有效，0为无效）和HR（1为有效，0为无效）。
（4）每31个0.524秒控制周期（约16秒），根据ZT31向红外LTU1和LTU2发送切换方案命令
ZT31(1)＝1，红外H1用主份；ZT31(1)＝0，红外H1用备份
ZT31(2)＝1，红外H2用主份；ZT31(2)＝0，红外H2用备份
ZT31(3)＝1，ZT31(4)＝0，ZT5＝1，红外H1加电
ZT31(3)＝0，ZT31(4)＝1，ZT5＝2，红外H2加电
其余情况下，红外H1、H2都加电
红外LTU数据采集过程中的故障处理见本文的5.2.9.3。",0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,1,0,0
"功能描述：选择通讯的数传天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）数传天线有四个LTU，天线1和2各有两个互为备份。应用软件初始上电时不与数传天线通讯，与数传天线开始通讯的条件为：收到数传天线预指或复位总线指令和数传天线加电。停止与数传天线通讯的条件为：收到数传天线停止总线指令和数传天线断电。其中数传天线加断电状态由1553B的接收BG与数传天线伺服控制器状态设置数据命令来确定。同时也根据这个命令确定参与通讯的LTU。初始为选择主份，收到主切备时切换到备份；在备份通讯时，收到备切主时切换到主份。
（2）向数传天线LTU发完取数命令后，获得数传天线LTU返回的数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，具体参见LTU通讯协议件。
（3）数传天线LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
"功能描述：采集22路数字太阳粗码、监视码和全开码。
处理：
采集方法：连续采集28路（中间有细码信息，处理时略过），采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,1,0,0
功能描述：仅使用红外定姿时，计算正常飞行轮控所需电压。,0,1,0,0,0,0,0,0
功能描述：若AOCC与星敏感器通讯不成功，则记录星敏感器故障一次。若连续240次不成功，判断该星敏感器故障。若星敏感器连续2000次故障，需重新启动星敏感器。,0,1,0,0,0,0,0,0
功能描述：红外数据处理,0,0,0,0,0,1,0,0
"软件需求名称：上电/复位后模式转换处理 
需求类别：其他 
软件需求描述：电/复位后模式转换处理”。",0,1,0,0,0,0,0,0
功能描述：星上实时计算地磁场强度,0,1,0,0,0,0,0,0
"功能描述：进行系统故障的检测。
",0,1,0,0,0,0,0,0
"功能描述：偏航捕获模式控制
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。",0,1,0,0,0,0,0,0
"功能描述：利用A头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.10
STEP1：计算；FM3更改：若，则：，FSTD=1；
STEP2：计算，。的各项乘以，的各项乘以。
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,1,0,0,0,0,0,0
"功能描述：根据红外、太阳、星敏感器的输出数据判断陀螺故障。
输入：
      陀螺：		故障标志F_GyroDiagnV
本周期陀螺数据的输出 (量纲：弧度)
		   			陀螺等效漂移估值
      红外：  	故障标志IRES_FLAG，数据有效性F_IresValid
          			本周期红外数据处理输出， (单位：弧度)
      数字太阳：	故障标志DSS_FLAG
数据有效性F_Ds1Valid, F_Ds2Valid
          			本周期太阳输出,  (单位：弧度)
	  星敏感器： 	故障标志数组SS_FLAG[2]
数据可用标志F_SAValid, F_SBValid
本周期星敏感器A角速度输出, 
本周期星敏感器B角速度输出, (单位：弧度/秒)
星敏感器A安装矩阵
星敏感器B安装矩阵
本周期采样到的星敏感器A的有效输出(
本周期采样到的星敏感器B的有效输出(
轨道角速度
太阳星历计算输出
标志F_GyroDiagnIresDssORSS",0,1,0,0,0,0,0,0
"软件需求名称：接收上行注入数据指令 
需求类别：其他 
软件需求描述：接收并处理上行注入数据指令。",0,0,0,0,0,0,1,0
"功能描述：计算给控制器的姿态和角速度误差。
",0,1,0,0,0,0,0,0
"功能描述：发送AOCC姿态数据（含侧摆角度）
处理： OBDH在相机成像期间每500ms从AOCC接收一次姿态数据（含2字节侧摆角度值），AOCC在OBDH完成接收姿态数据后，将新的姿态数据（含2字节侧摆角度值）写入总线发送缓冲区。其处理过程如下：
STEP1：AOCC应用程序每0.524秒查询一次有无OBDH发送数据请求，如果有则转入第二步，否则退出；
STEP2：根据不同的数据装载模式，确定装载数据，并按照遥测要求进行格式转换；
STEP3：把遥测缓存区的内容放入OBDH定义的内存中。",0,0,0,0,0,0,0,1
功能描述：无控模式控制,0,1,0,0,0,0,0,0
"软件需求标识：FREQ16 
软件需求名称：加速度计数据处理 
需求类别：其他 
软件需求描述：加速度计数据处理。",0,0,0,0,0,1,0,0
"计算机上电/复位后应用软件的工作流程如下。
图5-1应用软件初始化和复位处理流程",0,0,0,1,0,0,0,0
"功能描述：使用星敏感器C的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理： 
（1）CPU星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU星时时钟星时校时是通过OBDH校时，OBDH校时分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；",0,0,0,0,0,1,0,0
"功能描述：根据红外信息，作姿态滤波修正。
",0,1,0,0,0,0,0,0
"功能描述：模式3切换方式。
处理：
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：若地面指令转入对日定向运行模式或者太阳捕获模式，置CMGStartFlag=1。",0,1,0,0,0,0,0,0
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续60个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是A090H或者校验和错误或者未收到重要数据），则应用软件按照重要数据的初始值运行。",0,0,0,0,0,0,1,0
"功能描述：根据红外信息，将卫星控制在正常飞行姿态
",0,1,0,0,0,0,0,0
OBDH分系统每8分钟给AOCC校时一次。,0,0,0,0,0,0,1,0
功能描述：检测工作中的动量轮的故障并设置BZ3。,0,1,0,0,0,0,0,0
"功能：利用星敏感器C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"软件需求名称：部件加断电 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。",0,0,0,1,0,0,0,0
功能描述：发送遥测数据,0,0,0,0,0,0,0,1
"功能描述：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：地面注入数据处理
说明：计算目标器GPS时，将输入、输出改为目标器的相应变量。",0,1,0,0,0,0,0,0
功能描述：抖动帆板。,0,1,0,0,0,0,0,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ82|初始化|任务书
FREQ83|地检使用要求|任务书
FREQ84|通信(串口)|任务书
FREQ85|通信故障处理|任务书
FREQ86|数据解包与转换|任务书
FREQ87|地检数据有效性判断、处理|任务书
FREQ88|地检模拟量采集、处理|预留
FREQ89|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"序|需求名称|编号|功能和处理描述
|滚动俯仰通道喷气中断服务程序|FREQ81|将滚动俯仰通道相应的推力器关掉
|偏航通道喷气中断服务程序|FREQ82|根据状态字关相应的推力器
|轨控发动机喷气中断服务程序|FREQ83|将轨控发动机关掉，如果有1N轨控则根据轨控状态字关相应的推力器
",0,0,0,0,1,0,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书。
功能编号|功能|引用文档
FREQ49|初始化|陀螺协议
FREQ50|陀螺使用要求|任务书
FREQ51|通信|陀螺协议
FREQ52|通信故障处理|任务书
FREQ53|数据解包与转换|陀螺协议
FREQ54|陀螺数据有效性判断、处理|任务书
FREQ55|陀螺模拟量采集、处理|任务书
FREQ56|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"功能描述：与发动机通信，输出本周期喷气脉宽。
处理：
功能编号|功能|引用文档
FREQ94|初始化|任务书
FREQ95|推力器使用要求(自锁阀和发动机组的选择)|任务书
FREQ96|通信(脉冲输出)|任务书
FREQ097|通信故障处理|预留
FREQ098|数据解包与转换|预留
FREQ099|推力器数据有效性处理|预留
FREQ100|推力器模拟量采集、处理|任务书
FREQ101|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"功能描述：卫星绕滚动轴转动，直到满足姿态角条件，进入下一阶段俯仰捕获。姿态确定由红外和陀螺。姿态控制是喷气控制
",0,1,0,0,0,0,0,0
"功能描述：根据姿态估值与数字太阳输出，计算量测的一步预测与新息，建立数字太阳输出的可用性标志。
",0,1,0,0,0,0,0,0
"功能描述：利用C头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.12。
STEP1：计算，将下标A换成C；FM3更改：若，则：，FSTD=1；
STEP2：计算。的各项乘以，的各项乘以。将下标A换成C；
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,1,0,0,0,0,0,0
"功能描述：使星体由任意姿态完成重捕地球。
",0,1,0,0,0,0,0,0
功能描述：根据指令完成数传天线的指向控制。,0,1,0,0,0,0,0,0
功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压、、。,0,1,0,0,0,0,0,0
功能描述：计算固定目标视线在本体系的表示。,0,1,0,0,0,0,0,0
"功能描述：使用星敏感器A、B的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：根据星敏感器的输入，计算姿态偏差，角速度等。
",0,1,0,0,0,0,0,0
"功能描述：采集3路模拟磁强计信息。
处理：
采集方法：连续采集3路，采集1路的操作步骤（以X通道磁强计模拟量）：
向选通地址输出偏移地址：0x1200 0000 = 15H；
等待至少100µs,启动A/D转换：0x1200 0040 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0040 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果； ",0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|平台陀螺数据的采集与处理|FREQ1.2.1|""平台陀螺1553B取数指令
""|陀螺1-4的速度增量|在通讯允许的条件下（每个陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|测微陀螺数据的采集与处理|FREQ1.2.2|""
遥测数据""|陀螺5-8的速度增量|从遥测数据中，获得陀螺数据并处理成对应的速度增量。
",0,0,0,0,0,1,0,0
"功能描述：接收遥控固定参数注入块的姿态偏置系数
",0,0,0,0,0,0,1,0
功能：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。,0,0,0,0,1,0,0,0
"功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、；输入陀螺自检信号GDi（i = 1，…，6）。
处理：
用户需求的的6(1)：陀螺脉冲当量；
用户需求的的6(2)
STEP1:A阵计算；
STEP2:",0,1,0,0,0,0,0,0
功能描述：动量轮喷气卸载进入和退出条件计算。,0,1,0,0,0,0,0,0
"功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。
",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器和陀螺输出计算姿态四元数。
",0,1,0,0,0,0,0,0
功能描述：计算太阳星历、红外补偿量及光行差计算。,0,1,0,0,0,0,0,0
"功能：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,1,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
功能编号|功能|引用文档
FREQ44|初始化|陀螺协议
FREQ45|陀螺使用要求|任务书
FREQ46|通信|陀螺协议
FREQ47|通信故障处理|任务书
FREQ48|数据解包与转换|陀螺协议
FREQ49|陀螺数据有效性判断、处理|任务书
FREQ50|陀螺模拟量采集、处理|任务书
FREQ51|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
功能描述：采集4路动量轮脉冲信息。,0,0,0,0,0,1,0,0
"功能描述：采集模拟太阳的数据，并处理成需要的数据格式。
处理：
（1）从A/D输入采集模拟太阳的角度数据
（2）从I/O输入采集模拟太阳的视场码",0,0,0,0,0,1,0,0
"功能描述：利用星敏感器A、B的测量，估计姿态。
输入：	星敏感器数据可用标志F_UsingSS
      	本次采样到的星敏感器A的有效输出(只考虑取一个情况) 
本周期采样到的星敏感器B的有效输出
太阳星历的输出
输出：	本体相对轨道系的姿态
",0,1,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择喷管；并记录喷气时间等。
",0,1,0,0,0,0,0,0
功能描述：由模拟太阳A/B码、监视码得到模拟太阳角、见太阳标志。,0,0,0,0,0,1,0,0
功能描述：对帆板驱动装置进行控制和诊断。,0,1,0,0,0,0,0,0
"功能描述：接收遥控间接指令单元
处理：
间接指令单元指令种类包括以下四个指令：
中继程序跟踪停止指令
中继天线复位指令
整星侧摆指令
中继快扫到位指令
指令|收到后的处理
中继程序跟踪停止|置FAST=1
中继天线复位|置FARP=1，记录X轴复位角度，Y轴复位角度
整星侧摆|置FM=1，记录起摆时刻，侧摆到位用时，侧摆角
中继快扫到位|置FAFP=1，记录快扫到位绝对时间，侧摆角
",0,0,0,0,0,0,1,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ110|初始化|任务书
FREQ111|磁力矩器使用要求|任务书
FREQ112|通信(DA)|任务书
FREQ113|通信故障处理|预留
FREQ114|数据解包与转换|预留
FREQ115|磁力矩器数据有效性处理|预留
FREQ116|磁力矩器硬件采集、处理|任务书
FREQ117|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
功能描述：三轴喷气姿态控制。,0,1,0,0,0,0,0,0
功能描述：若本周期角动量与上一周期角动量之差（绝对值）大于0.15Nms，则用上一周期角动量作为本周期输入，角动量变化取0。若连续大于三次或本周期与上一周期角动量之差（绝对值）小于0.15Nms，则以本周期角动量为真值，角动量变化,0,1,0,0,0,0,0,0
功能描述：若3000秒（全姿态捕获除速率阻尼外1000秒，可注入修改）内，三轴中任一轴喷气总量（正负轴单独判断）超过范围（正常模式50s，粗定向和轮子启动、全姿态捕获100s，可注入修改），则根据自锁阀状态，开关自锁阀。全姿态模式下,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|轨道与星历|FREQ2.0|5.1.1|卫星轨道、太阳星历、地面站位置、地磁场强度等计算程序的主流程。
|卫星轨道计算|FREQ2.1|5.1.2|计算卫星当前轨道
|GPS轨道数据有效性判断|FREQ2.2|5.1.3|对GPS轨道数据的有效性进行判断
|GPS轨道版轨道计算|FREQ2.3|5.1.4|利用GPS轨道版数据进行GPS定轨程序
|轨道、目标姿态预计算|FREQ2.4|5.1|完成下控制周期的轨道星历与目标姿态预先计算
|近圆中低轨卫星轨道根数外推算法产品规范|FREQ2.5|/|规范化算法：
|近圆中低轨卫星GPS轨道计算算法算法产品规范|FREQ2.6|/|规范化算法：
|岁差章动矩阵计算算法算法产品规范|FREQ2.7|/|规范化算法：
|4阶星上地磁场计算方法算法产品规范|FREQ2.8|/|规范化算法：
|光行差计算算法产品规范|FREQ2.9|/|规范化算法：
",0,1,0,0,0,0,0,0
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
在模式切换中以地面上行注入优先，所有模式都可以通过地面注入的模式运行类指令进行转换。下面主要分析自主转换换条件与过程，具体转换条件见用户需求4.1~4.11的模式转换条件。4.4姿态机动模式喷气机动转对地或保持的条件中姿态角控制量判据中由0.000262mΦM4改为0.0262mΦM4。    ",0,1,0,0,0,0,0,0
"功能描述：接收星箭分离信号及天线状态数据
处理：控制计算机在收到星箭分离指令并且判断数据正确后，即认为星箭分离有效，通过方式代码的服务请求，申请OBDH停止发送星箭分离信号。天线状态的数据具体见与外总线通讯协议。",0,0,0,0,0,0,1,0
"功能描述：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：星敏感器数据处理。
处理：同用户需求的5.11。
(1)获得FSTA,FSTB,FSTC
条件|FSTA|FSTB|FSTC
ZT23=0|0|0|0
ZT23=6,|1|0|0
ZT23=6,|0|0|0
ZT23=9,|1|*|*
ZT23=9,|0|*|*
ZT23=9,|*|1|*
ZT23=9,|*|0|*
ZT23=9,|*|*|1
ZT23=9,|*|*|0
ZT23=A,|0|1|0
ZT23=A,|0|0|0
ZT23=B,|0|0|1
ZT23=B,|0|0|0
ZT23=C,|0|1|*
ZT23=C,|0|0|*
ZT23=C,|0|*|1
ZT23=C,|0|*|0
ZT23=D,|1|0|*
ZT23=D,|0|0|*
ZT23=D,|*|0|1
ZT23=D,|*|0|0
ZT23=E,|1|*|0
ZT23=E,|0|*|0
ZT23=E,|*|1|0
ZT23=E,|*|0|0

(2)修订FSTA,FSTB,FSTC
若ZT41[3]=1允许星敏数据有效性判断且BZ13全姿态捕获对日定向姿态且BZ14重捕地球转三轴稳定运行且BZ1≠7无控则进行如下诊断：
若FSTA = 1，FSTC = 1，（或）则FSTA = 0，FSTC = 0；
若FSTA = 1，FSTB = 1，（或）则FSTA = 0，FSTB = 0；
若FSTB = 1，FSTC = 1，（或）则FSTB= 0；FSTC = 0。
(3)获得FSTD
FSTA|FSTB|FSTC|ZT12|BZ2|FSTD
1|1|*|1或9或8|≤2|2
1|*|1|1或9或D|≤2|3
*|1|1|1或9或E|≤2|4
1|*|*|6或9|≤2|5
*|1|*|7或9|≤2|6
*|*|1|B或9|≤2|7
不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|1

(4)当BZ1=1(三轴稳定正常运行轨道姿态)或9(侧摆角保持)时，进行星敏感器数据修正。公式见5.11(9)。
(4)当BZ1=1(三轴稳定正常运行轨道姿态)时，根据ZT40(3)是否为1（引入星敏在轨标定）进行星敏感器在轨标定。公式见5.11(10)。",0,1,0,0,0,0,0,0
功能描述：太阳数据处理,0,0,0,0,0,1,0,0
"软件需求名称：1553通信上行/下行数据的组帧和处理。 
软件需求描述：1553通信上行/下行数据的组帧和处理。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：遥测组帧、遥控接收、遥测帧头打包、遥测数据打包、下行：重要数据组帧、上行：数据指令处理、任务成像指令、上行：模式转换指令处理、上行：软件标志字指令处理、上行：控制参数指令处理、上行：变轨和位保指令处理、上行：部件加断电指令处理、上行：校时指令处理、上行：轨道注入指令处理、上行：部件数据转发指令处理、在轨维护指令处理、内存下传指令、重要数据保存、重要数据恢复",0,0,0,0,0,0,0,1
"功能描述：根据太阳矢量在帆板1法平面内投影与帆板法线之间的夹角，通过帆板驱动机构1控制帆板1，使帆板1能捕获及跟踪太阳。
",0,1,0,0,0,0,0,0
功能描述：确定各部件的工作状态，并开关相关部件电源。,0,0,0,0,0,1,0,0
"功能描述：仅利用星敏感器A的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
功能描述：对陀螺进行剔野、限幅处理，并根据平衡方程满足情况对陀螺数据的有效性进行判断。,0,1,0,0,0,0,0,0
"功能描述：上电或复位未取回重要数据初始化
处理
初始化类型|自主切换允许标志|ALTUState
上电|允许|主份，发主开备关
上电|允许|备份，发备开主关
上电|允许|主份，发主开备关
",1,0,0,0,0,0,0,0
"功能：计算给控制器的姿态和角速度误差。
",0,1,0,0,0,0,0,0
功能描述：动量轮摩擦力矩的补偿电压计算。,0,1,0,0,0,0,0,0
"功能描述：发送控制计算机计算得出的星历数据
处理：将控制计算机计算得出的星历数据打包后放到星历数据地址空间中。",0,0,0,0,0,0,0,1
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ98|初始化|任务书
FREQ99|磁力矩器使用要求|任务书
FREQ100|通信(DA)|任务书
FREQ101|通信故障处理|预留
FREQ102|数据解包与转换|预留
FREQ103|磁力矩器数据有效性处理|预留
FREQ104|磁力矩器硬件采集、处理|任务书
FREQ105|部件在轨转发（在轨修改）|预留
",0,0,0,0,1,0,0,0
"功能描述：姿态机动模式控制
",0,1,0,0,0,0,0,0
"功能描述：发送AOCC重要数据包
处理： AOCC在接收注入的重要数据快的同时将其存放在OBDH规定的内存中，AOCC不再进行单独处理。",0,0,0,0,0,0,0,1
功能描述：根据星敏感器的输出数据判断陀螺故障。,0,1,0,0,0,0,0,0
功能描述：根据陀螺输入，预估卫星惯性姿态四元数。,0,1,0,0,0,0,0,0
"功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。
输入：姿态角，姿态角速度，
实测飞轮角动量   =[，]T
标称角动量       =[，]T
      标志             UnLoadMode， F_WheelSaturation， F_AttrOutLmt
",0,1,0,0,0,0,0,0
"控制计算机实时遥测包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包1|FRE65
|发送姿态数据包3|FRE65.1
|星敏感器姿态数据包|FRE65.2
|星敏感器自检数据包|FRE65.3
|姿态控制数据包|FRE65.4
|轨道数据包|FRE65.5
|LTU自检数据包|FRE65.6
|AOCC及状态数据包|FRE65.7
|发送星敏修正数据包|FRE65.8
|发送对日定向数据包|FRE65.9
|数传天线地面夹角数据|FRE65.10

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,1
功能描述：动量轮状态确定。,0,1,0,0,0,0,0,0
功能描述：对星敏感器输出数据进行有效性判断，并选取定姿星敏组合。,0,1,0,0,0,0,0,0
"功能描述：根据天线安装定义和地面站坐标，实时计算天线和地面站的夹角。
",0,1,0,0,0,0,0,0
功能描述：计算得到的控制电压输出给动量轮。,0,0,1,0,0,0,0,0
"功能描述：复位未取回重要数据初始化
处理：
- 卫星构型=9；
- 对系统软件提供的工作模式字APP_WorkMode进行3取2
- 若工作模式字为Mode7-11，切换至Mode16，SubMode1，StarTime= 2100.0， 开自锁阀3、4、5；
- 否则，切换至Mode2，StarTime = 2100.0， 开自锁阀3、5，关自锁阀4。
- 磁力矩器俯仰通道主份工作；
- 陀螺：陀螺引入状态初始化",1,0,0,0,0,0,0,0
功能描述：实现正常模式姿态偏置模式下的偏流角计算。,0,1,0,0,0,0,0,0
功能描述：根据加在CMG框架上的指令角速度而产生的期望角度与CMG框架产生的实际角度之差，自主诊断CMG框架的工作状态。,0,0,0,0,1,0,0,0
"功能描述：启动动量轮至标称角动量，并保持
",0,1,0,0,0,0,0,0
"模式字定义如下，装订值为0：
模式字|工作模式描述
0|主动段
1|正常对地运行
2|偏航机动
3|全姿态捕获
4|对地捕获
5|帆板未展开
6|轨控
7|无控
8|侧摆机动
9| 侧摆保持
10|CMG启动模式
11|入轨段控制
12|自旋模式
13|应急模式
14|星敏全姿态捕获模式

定义星箭分离前为主动段工作模式（包括射前和主动段飞行状态），BZ1=0。主动段工作模式下，应用软件进行下列工作：
星时计算；
数据采样，但无任何控制指令输出；
组帧遥测数据；
响应OBDH通讯命令；
仅在主动段查询星箭分离信号的有效性，确认依据为：一个控制周期读取3路星箭分离状态位，若3路中的2路读入为“1”，则认为本周期查到星箭已分离。如果在连续5个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入入轨段模式，BZ1=B。
通过注入在轨维护程序，实现部件测试功能，此功能仅在主动段模式下有效。
判别星箭分离后，应用软件开自锁阀3、5及1N推力器短期加温，并进入入轨段模式。
工作模式的转换可分为以下二种情况：
按地面上行注入进行转换：通过注入姿控数据块中的模式字进行转换；
按应用软件用户需求给定的条件判别，由软件自主控制转换：自主转换分两种：一种为正常运行转换；一种为故障时转换。下面分别进行说明
正常运行转换如下图所示：
正常运行自主转换如下表所示：条件标识原则：ZCCX—Y，其中ZCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。
标识|具体条件
ZCC0—B|星箭分离
ZCCB—1|Tin >4800 
ZCC1—2|
ZCC1—6|
ZCC1—8|且且且且
ZCC2—1|
ZCC2—6|
ZCC4—1|FEA=A
ZCC6—1|
ZCC6—2|)且
ZCC8—1|""满足下列条件之一：
且CBStyleFlag<2且且(
且连续次
且CBStyleFlag>1且且且)连续次
且""
ZCC8—9|""满足下列条件之一：
且CBStyleFlag<2且且
(
且)连续次
且CBStyleFlag>1且且且)连续次
且""
ZCC9—8|""满足下列条件之一：
且
""
ZCCA—1|""CMG_NewFault
且(max()<
且 ()<0.000262且 ()<0.017)连续次""

故障自主转换如下表所示：条件标识原则：GCX—Y，其中GCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。其中进入应急模式的条件为读到应急线路加电，记为GCC-D。其余的自主故障切换如下图所示：
故障条件定义如下：
标识|具体条件
GCC1—3|FailureFlag=1并且WacqSunorSTSModeFlag =0并且ZT7属于[1，4]区间内
GCC1—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC1—A|CMG_NewFault0且 1ZT14
GCC1—E|FailureFlag=1并且WacqSunorSTSModeFlag =1并且ZT7属于[1，4]区间内
GCC3—7|FailureFlag＝4且AutoInStopNum<2
GCC3—E|SMODE＝3且TSMODE>8000（若ZT11=4则取值为32000）
GCC4—1|FEA=A
GCC4—3|WacqUseIresOrSTSFlag=1且TCOUNT>24000
GCC5—3|脉冲发完后
GCC6—1|FailureFlag＝2且无机动要求
GCC6—2|FailureFlag＝2且无机动要求
GCC7—3|>6900 且AutoInStopNum<2且WacqSunFlag =0
GCC7—E|>6900 且AutoInStopNum<2且WacqSunFlag =1
GCC8—1|FailureFlag=3
GCC8—A|""满足下列条件之一：
CBStyleFlag=0，且CMG通讯故障计数器CMGComFailCnt[i] (i=1,2,3) >CMGErapolationNum为ZT14选定的CMG之一
CMG_NewFault且 1ZT14""
GCC9—3|FailureFlag=1并且WacqSunorSTSModeFlag =0并且ZT7属于[1，4]区间内
GCC9—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC9—A|CMG_NewFault且 1ZT14
GCC9—E|FailureFlag=1并且WacqSunorSTSModeFlag =1并且ZT7属于[1，4]区间内
GCCA—1|""满足下列条件之一：
>400且max()>0.08连续次
CMG_NewFault且>6000""
GCCB—3|FailureFlag=1并且ZT7属于[1，4]区间内
GCCB—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCCE—1|StarCatchFlag=1且(1-()<0.000685)且norm()<0.000875
GCCE—7|TCOUNT>31200或（FailureFlag＝4且AutoInStopNum<2）

AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,1,0,0,0,0,0,0
"功能描述：实时计算地心矢量、太阳矢量在本体系下的表示，以及星体X轴指向的赤经、赤纬
",0,1,0,0,0,0,0,0
"功能描述：根据CMG输出数据和理论数据进行CMG故障检测。
处理：推力器喷气异常检测的阈值由10*mp改为20*mp。软件设计时应注意故障计数器值的设置和清除。喷管切换时不要清120秒累计喷气时间计数。",0,1,0,0,0,0,0,0
"功能描述：太阳地球全姿态捕获模式捕获过程
",0,1,0,0,0,0,0,0
"功能描述：正常对地运行模式控制
",0,1,0,0,0,0,0,0
"功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：根据注入轨道参数计算地磁场强度。,0,1,0,0,0,0,0,0
功能描述：根据指令完成中继天线的捕获跟踪控制。,0,1,0,0,0,0,0,0
"功能描述：星时计算
处理：控制周期中断服务程序，对星时加1",0,0,0,0,0,1,0,0
功能描述：计算机应急模式控制,0,1,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.4|偏置飞行模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.5|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|陀螺标定模式控制|FREQ5.2.11|4.8|陀螺标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.12|4.6|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.4|偏置飞行模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.5|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|陀螺标定模式初始化|FREQ5.3.11|4.8|陀螺标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.12|4.6|惯性定向模式初始化设置

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,1,0,0,0,0,0,0
"功能描述：模式1切换方式。
处理：
若t >100，则WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,1,0,0,0,0,0,0
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理：",0,0,0,0,0,0,1,0
"功能描述：发送控制计算机指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,1,0,0,0,0
"功能：对日定向和对地定向的目标姿态确定。
",0,0,0,0,1,0,0,0
功能描述：使卫星的角速度阻尼下来。,0,1,0,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|红外1数据的采集与处理|FREQ3.1|选择通讯的红外1LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|红外2数据的采集与处理|FREQ3.2|选择通讯的红外2LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
",0,0,0,0,0,1,0,0
"功能描述：检测动量轮的故障。
",0,1,0,0,0,0,0,0
"功能描述：根据需求，计算去往小天区扫描模式机动过程中所需的目标姿态。
",0,1,0,0,0,0,0,0
功能描述：采集3路模拟磁强计信息得到磁场强度。,0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,1,0,0
功能描述：根据CMG角动量及地磁场强度决定并输出磁棒控制电压。,0,1,0,0,0,0,0,0
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：按通讯协议要求进行设置
SpaceWire总线（外总线）初始化：按通讯协议要求进行设置
CAN总线（外总线）初始化：按通讯协议要求进行设置，
变量初始化""
|复位初始化|FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置
SpaceWire总线（外总线）初始化：按通讯协议要求进行设置
CAN总线（外总线）初始化：按通讯协议要求进行设置，
变量初始化""",1,0,0,0,0,0,0,0
"功能描述：绕本体x轴转动，减小卫星的滚动角。
输入：	陀螺数据输出的输出 ，红外数据有效性标志F_IresValid（由有效性判据给出）
红外数据处理（全姿态捕获）的输出，
上周期姿态角估值，",0,1,0,0,0,0,0,0
"功能描述：接收总线指令
处理： 将接收总线指令存储地址中内容解包成总线指令的数据格式，根据不同的总线指令进行相应的处理。",0,0,0,0,0,0,1,0
功能描述：在CMG控制期间按照一定算法对磁力矩器施加控制电压，所产生磁矩与实际地磁场相互作用产生磁控力矩对CMG进行卸载。,0,1,0,0,0,0,0,0
功能描述：利用估计的四元数转换姿态角。,0,1,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的执行机构参数设定及诊断参数
处理：
调整CMG高速角动量与标称值偏差阀值系数的初装值。",0,0,0,0,0,0,1,0
"功能描述：偏航通道喷气中断处理程序。
处理：将推力器9、10、11、12关掉",0,0,1,0,0,0,0,0
"功能描述：检测推力器的微漏，必要时作相应的主备份切换。
处理：
Ix=Iy=Iz=0",0,1,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
输入：
数传天线(j=1,2)跟踪地面站编号i，跟踪起始时刻ti，地面站i在惯性系指向，被数传天线(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线(j=1,2)跟踪的地面站i的矢量在本体系的表示。（i可为1~7）。",0,1,0,0,0,0,0,0
功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。,0,1,0,0,0,0,0,0
"功能描述：发送事件数据给OBDH保存
处理：将事件数据打包后放到事件数据内存地址空间中。",0,0,0,0,0,0,0,1
"功能描述：完成整星绕滚动轴的姿态侧摆角保持功能
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
条件|FRTS的取值
ZT35(2) = 1且|1
其余情况|0

STEP2：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP3：进行运行段姿态确定，具体过程如下：
进行红外数据采集及处理和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP4：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3且ZT9  3且ZT时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
当ZT40(4) = 1时，进行数传天线捕获跟踪控制
STEP5：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
轨道计算包括卫星轨道和太阳方位计算、中继卫星轨道计算；GPS计算包括GPS数据转换为轨道平根数计算、GPS平根数数据转换为外推轨道数据计算；地磁场计算为通过轨道外推数据计算地磁场矢量分量。,0,0,0,0,1,0,0,0
功能：利用星敏感器和陀螺或者仅利用星敏感器的输出计算卫星欧拉角和四元数。,0,0,0,1,0,0,0,0
功能描述：根据CMG所对应的期望角动量与CMG产生的实际角动量之差，自主诊断CMG的工作状态。,0,1,0,0,0,0,0,0
"软件需求名称：应用软件初始化 
需求类别：其他 
软件需求描述：初始化函数为void AppInit(void )。在上电/复位时，系统软件调用此函数来完成应用软件的初始化。见“任务书”4.1.2.1“初始化函数”。",1,0,0,0,0,0,0,0
"功能描述：轨控模式控制
",0,0,0,1,0,0,0,0
"功能描述、输入、输出、。
序号|功能点编号|功能描述|说明
|FREQ3.4.4.1|加计数据处理|《用户需求》4.2.1
|FREQ3.4.4.2|陀螺数据处理|《用户需求》4.2.2
|FREQ3.4.4.3|陀螺的姿态预估|《用户需求》4.2.3
|FREQ3.4.4.4|星敏感器A姿态修正|《用户需求》4.2.4.1
|FREQ3.4.4.5|星敏感器B姿态修正|《用户需求》4.2.4.2
|FREQ3.4.4.6|星敏感器C姿态修正|《用户需求》4.2.4.3
|FREQ3.4.4.7|太阳捕获及对日定向|《用户需求》4.2.5
|FREQ3.4.4.8|轨控目标姿态角速度和四元数|《用户需求》4.2.6
|FREQ3.4.4.9|误差四元数计算|《用户需求》4.2.7
|FREQ3.4.4.10|陀螺在轨标定|《用户需求》4.2.8
|FREQ3.4.4.11|相对天东北系姿态计算|《用户需求》4.2.9
",0,1,0,0,0,0,0,0
功能描述：实时计算卫星轨道参数及太阳方位、太阳敏感器理论输出。,0,1,0,0,0,0,0,0
功能描述：发送模拟量遥测数据包2,0,0,0,0,0,0,0,1
"功能描述：发送姿态数据
处理：
AOCC每个控制周期（250ms）组织22个字节姿态数据，OBDH每500ms取1次姿态数据（44个字节）。每个数据包中的2个姿态的时标需按照时间顺序排列。",0,0,0,0,0,0,0,1
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.5|偏置飞行模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|匀角速度匀积分时间跟踪模式控制|FREQ5.2.7|4.7|一般轨迹跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.9|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|凝视姿态跟踪模式控制|FREQ5.2.11|4.12|凝视姿态跟踪模式控制调用流程
|测试与标定模式控制|FREQ5.2.12|4.8|测试与标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.13|4.13|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.5|偏置飞行模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|匀角速度匀积分时间跟踪模式初始化|FREQ5.3.7|4.7|一般轨迹跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.9|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|凝视姿态跟踪模式初始化|FREQ5.3.11|4.12|凝视姿态跟踪模式初始化设置
|测试与标定模式初始化|FREQ5.3.12|4.8|测试与标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.13|4.13|惯性定向模式初始化设置

主动段和无控工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,1,0,0,0,0,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输出：数字太阳敏感器输出；模拟太阳敏感器输出；模拟式太阳敏感器视场码；0-1式太阳敏感器的信号（0或1）；数字太阳敏感器视场码。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得数字太阳、模拟太阳、0-1太阳数据；每个控制周期根据DSSLTUSeltFlag确定进行通讯的太阳LTU，发送取数指令，具体如下表所示：
DSSLTUSeltFlag |进行通讯的太阳LTU|发送的取数指令
01H|太阳LTU1|43H
02H|太阳LTU2|43H
其它|根据LTU故障诊断的结果决定太阳LTU的选取。初始状态为太阳LTU1|43H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，具体参见LTU通讯协议件。
（3）太阳LTU数据采集过程中的故障处理见4.4.3中规定。",0,0,0,0,0,1,0,0
"功能描述：上行注入数据接收和处理
处理： 
序号|功能点编号|功能描述|备注
|FREQ4.1.1|姿控数据包1|该数据块采用内存修改实现
|FREQ4.1.2|姿控数据包2|该数据块采用内存修改实现
|FREQ4.1.3|IMU系数包|该数据块采用内存修改实现
|FREQ4.1.4|相平面系数包|该数据块采用内存修改实现
|FREQ4.1.5|姿态数据包|该数据块采用内存修改实现
|FREQ4.1.6|星敏滤波系数包|该数据块采用内存修改实现
|FREQ4.1.7|主减速系数包|""该数据块采用内存修改实现
删除BKFlag启动动力下降标志，该变量移至导航初始数据包""
|FREQ4.1.8|接近下降系数包|该数据块采用内存修改实现
|FREQ4.1.9|垂直下降系数包|该数据块采用内存修改实现
|FREQ4.1.10|轨道数据包|该数据块采用内存修改实现
|FREQ4.1.11|自主定位数据包|该数据块采用内存修改实现
|FREQ4.1.12|天文历书包|该数据块采用内存修改实现
|FREQ4.1.13|起飞参数包|该数据块采用内存修改实现
|FREQ4.1.14|导航修正系数包|该数据块采用内存修改实现
|FREQ4.1.15|软着陆轨道控制系数包|该数据块采用内存修改实现
|FREQ4.1.16|部件加断电命令包|
|FREQ4.1.17|LTU命令包|""CCU与推进线路盒的指令不通过LTU命令包发送。
与驱动和太阳模块的接口取数指令和控制指令都可通过地面注入发起""
|FREQ4.1.18|加电状态字设置包|该数据块采用内存修改实现
|FREQ4.1.19|串口周期通讯指定包|""该数据块采用内存修改实现
ZZ2的D0位与D5位定义互换""
|FREQ4.1.20|星敏感器RTS命令包|
|FREQ4.1.21|PID系数包|该数据块采用内存修改实现
|FREQ4.1.22|调制系数包|该数据块采用内存修改实现
|FREQ4.1.23|动量轮系数包1|该数据块采用内存修改实现
|FREQ4.1.24|动量轮系数包2|该数据块采用内存修改实现
|FREQ4.1.25|陀螺脉冲当量系数包|该数据块采用内存修改实现
|FREQ4.1.26|加计脉冲当量系数包|该数据块采用内存修改实现
|FREQ4.1.27|故障判别因子系数包|
|FREQ4.1.27|垂直上升及备份姿控PID系数包|
|FREQ4.1.28|内存修改包|修改内存字数由58改为57
|FREQ4.1.29|对日定向系数包|该数据块采用内存修改实现
|FREQ4.1.30|轨控命令包|""该数据块采用内存修改实现
删除变轨系数""
|FREQ4.1.31|惯性调姿命令包|该数据块采用内存修改实现
|FREQ4.1.32|程序包|
|FREQ4.1.33|星敏标定数据包|该数据块采用内存修改实现
|FREQ4.1.34|导航初始数据包|""该数据块采用内存修改实现
增加BKFlag启动动力下降标志""
|FREQ4.1.35|导航敏感器系统误差初值包|该数据块采用内存修改实现
|FREQ4.1.36|微波标定数据包|与LTU命令块合并
|FREQ4.1.37|内存下卸包|
|FREQ4.1.38|驱动与太阳模块状态控制包|
|FREQ4.1.39|着陆器推进控制包|
|FREQ4.1.40|上升器推进控制包|
|FREQ4.1.41|IMU数据存储控制包|IMU数据存储控制标志IMU_flag的定义更改

备注中注明“该数据块采用内存修改实现”的命令块，软件编码不实现该数据包的注入功能，数据包中变量需要修改时通过内存修改包实现。软件编码应保证该数据包中变量处于连续的内存区。",0,0,0,0,0,0,1,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0|主动段|FREQ56
1|正常对地运行|FREQ57
2|偏航机动|FREQ58
3|全姿态捕获|FREQ59
4|对地捕获|FREQ60
5|帆板未展开|FREQ61
6|轨控|FREQ62
7|无控|FREQ63
8|侧摆机动|FREQ64
9| 侧摆保持|FREQ65
11|入轨段控制|FREQ66
12|自旋模式|FREQ67
13|应急模式|FREQ68
14|星敏全姿态捕获模式|FREQ69
10|CMG启动模式|FREQ107

主动段工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定和姿态和轨道控制的如下所示
|模式字
|E
卫星轨道外推计算|√
GPS轨道计算|√
太阳星历计算|√
地面站位置计算|√
地磁场计算|√
偏流角计算|
岁差章动计算|√
陀螺数据处理|√
惯性姿态陀螺预估|√
对地姿态陀螺预估|
四元数陀螺预估|
红外输出的数据处理|√
太阳输出的数据处理|√
红外的姿态修正|
红外与太阳双矢量定姿|
红外太阳姿态修正|
星敏感器数据处理|
星敏感器A姿态修正|
星敏感器B姿态修正|
星敏感器C姿态修正|
星敏感器A、B姿态修正|
星敏感器A、C姿态修正|
星敏感器B、C姿态修正|
对地姿态修正及星敏粗姿态计算|
仅星敏感器A的姿态修正|
仅星敏感器B的姿态修正|
仅星敏感器C的姿态修正|
仅星敏感器AB的姿态修正|
仅星敏感器AC的姿态修正|
仅星敏感器BC的姿态修正|
侧摆目标姿态确定|
–Z轴捕获太阳及对日定向|
偏航捕获及转对地定向|
星敏感器全姿态捕获|√
姿态控制量计算|√
相平面法|√
姿态喷气控制|√
动量轮摩擦补偿计算|√
动量轮角动量保持的PI控制|√
动量轮启动与保持|√
正常飞行动量轮分配电压计算|
结构滤波器计算|
喷气卸载条件计算|
磁卸载控制|
CMG数据处理|√
CMG控制|
运行段帆板控制|
自主跟踪控制|
无控模式下太阳帆板控制|
数传天线指向控制|
偏置动量轮分配电压计算|
正常模式1N变轨|

在正常运行模式下主要有三种定姿方式：红外定姿、红外太阳定姿和星敏定姿。其中星敏定姿为高精度定姿方式。并可采用有陀螺和无陀螺方式，正常情况下为有陀螺。定姿方式的切换通过注入系统定姿方式字和系统故障诊断来实现切换。",0,0,0,0,1,0,0,0
"功能描述：计算卫星对规划目标的姿态四元数和控制量。
",0,0,0,1,0,0,0,0
"功能描述：每0.524秒中断服务程序。
处理：
STEP1：数据采集
STEP2：红外数据采集及处理；
STEP3：动量轮状态确定；
STEP4：部件工作状态确定；
STEP5：模拟式太阳敏感器信号选取
STEP6：若ZT38（1）= 1，则调用帆板未展开模式；
STEP7：若BZ8  5，则进行STEP8，否则退出；
STEP8：数据校正（1）；
STEP9：若ZT39(1) = 1，则调用偏流角计算，否则：；
        若ZT5=0且FlagInitIRESAtt=1，则：， FlagInitIRESAtt=0
STEP10：若BZ1 = B，则进行入轨段控制；
STEP11：若BZ1 = 3或4，则
进行全姿态捕获对日定向，对地三轴稳定；
；
输出磁力矩器控制电压；
STEP12：若BZ1 = 1或2或8或9，则进行Z轴对地控制模式；
STEP13：若BZ1 = 7，则进行姿态无控飞行模式；
STEP14：若BZ1 = C，D，F且ZT32 = A，则：
进行自旋模式
输出飞轮及磁力矩器控制电压。
STEP15：若C1 = FFFF，则：按ZT8，ZT9来决定发轨控发动机加温开指令；
STEP16：若BZ1 = 8，则：；
STEP17：若FBZ1 ≠ BZ1，则：，；
STEP18：若BZ1 = 1或9，则进行动量轮故障检测及切换；
STEP19：FBZ1 = BZ1；
STEP20：若ZT36 = 3，则进行自旋模式，该程序采用注入在轨维护程序的方式实现。
STEP22：若（BZ1=3或BZ1=7） 且ZT43[4]= 1且 FlagGyroAdd=1，则：
；若，则：=0，FlagGyroAdd=0；
若ZT43[4]= 1且FlagGyroAdd=0，（BZ1=3且FSA=0）或BZ1=4，且，则Call  5.9（陀螺故障检测及选择）
STEP23:若ZT41[1]=1且且FlagFSA=5，则：{若FSAA连续成立3000，则：连续时间计时清零；FlagFSA=0；ZT41[1]=0；若，且<1或>6，则：=1；；切换太敏LTU}     否则：连续时间计时清零；若BZ13，则FlagFSA=0；
STEP24:系统工作模式确定。",0,1,0,0,0,0,0,0
功能描述：根据注入轨道参数计算太阳轨道、方位与其他参数。,0,1,0,0,0,0,0,0
"功能描述：姿态角、角速度与姿态四元数预估。
",0,1,0,0,0,0,0,0
功能描述：实现正常模式及侧摆模式下的偏流角计算。,0,0,0,1,0,0,0,0
"功能描述：通过注入轨道参数，实时计算卫星轨道参数。
处理： 
由地面注入轨道参数或GPS数据计算的轨道参数（如果GPS引入且数据验证有效），结合当前星时，通过外推公式计算出卫星轨道数据。",0,1,0,0,0,0,0,0
"功能描述：使用星敏感器A、C的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器。
输入：标志F_JetGroup，F_SatStage
姿态角与角速度：
正常模式星敏感器与陀螺定姿输出(F_NoGyro=0或2) 
，(量纲：弧度)
，(量纲：弧度/秒)
或：正常模式星敏感器定姿输出(F_NoGyro=1或3时)
(量纲：弧度)
(量纲：弧度/秒)
或：机动与轨控模式姿态输出(无量纲)，(量纲：弧度/秒)
或：其它情形相应程序的输出
，(量纲：弧度)
，(量纲：弧度/秒)
，(量纲：度)
输出：	喷气状态，
各推力器分配脉宽，
累计三轴姿控正向喷气时间：，
累计三轴姿控负向喷气时间：，
=[，]T(量纲：弧度/秒2)",0,1,0,0,0,0,0,0
"功能描述：使星体Z轴对日定向，适当时重捕地球。
处理过程：
(1)若星敏数据无效且FEA=0，则Ψ=0.12，调用“-Z轴对日定向”，BZ1=3；
(2)当FEA=0时；FM3②增加判断；
(3)当FEA=5时，其中姿态角的阀值增加调整系数。",0,1,0,0,0,0,0,0
"功能描述：判断陀螺的使用范围。
输入：	本控制周期内采样的陀螺角度增量 (量纲：弧度) （=,…,）
      	上周期陀螺数据
      	标志 N_GyroDiagnV
处理
对陀螺数据进行有效性判断。若某个陀螺故障或某个陀螺为新上电，则不进行有效性判断（陀螺不引入）。其中陀螺新加电有三种情况1、判断出陀螺故障且允许自主加电情况下，应用软件自主加电。2、数据指令加电。3、脉冲遥控指令加电。对于新加电陀螺，则在该陀螺加电时间小于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为0；当该陀螺加电时间大于等于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为1。
若SLTU陀螺不加电或该陀螺故障，不引入。当“允许使用电源状态诊断陀螺”时，应用软件根据与SLTU通讯得到的陀螺电源状态确定陀螺加断电状态；当“不允许使用电源状态诊断陀螺”时，应用软件只根据数据指令确定陀螺加断电状态。若SLTU得到的六个电源状态均断电，则不根据电源状态判断陀螺是否加电。",0,0,0,1,0,0,0,0
"功能描述：接收遥控固定参数注入块的陀螺脉冲当量系数
处理：
调整陀螺1~3的脉冲当量的初装值。",0,0,0,0,0,0,1,0
"功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器B修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,1,0,0,0,0,0,0
"功能描述：发送高精度姿态数据
处理：每个控制周期查询一次是否需要进行数据打包，若需要，则进行数据打包。",0,0,0,0,0,0,0,1
"功能描述：根据姿轨控喷气规律计算结果，发出相应的喷气指令。
处理：同用户需求的。",0,1,0,0,0,0,0,0
功能描述：进行单轴相平面分区及控制规律计算。,0,1,0,0,0,0,0,0
"功能描述：各个模式的姿态和轨道控制。
处理：
定义星箭分离前为主动段工作模式（包括射前和主动段飞行状态），WorkMode=0。主动段工作模式下，应用软件进行下列工作：
星时计算；
数据采样，但无任何控制指令输出；
组帧遥测数据；
响应OBDH通讯命令；
在主动段查询星箭分离信号的有效性，确认依据为：读取2路星箭分离状态，若任意1路星箭分离为“已分离”状态，则认为本周期查到星箭已分离。如果在连续8个周期中至少6个周期都查到星箭已分离，则可确认为星箭已分离，进入入轨段模式，WorkMode =1。
通过注入在轨维护程序，实现部件测试功能。
模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。各个模式控制中调用流程和条件见用户需求4.1至4.14：",0,1,0,0,0,0,0,0
功能描述：计算磁卸载所需的磁矩与磁力矩器工作脉宽。,0,1,0,0,0,0,0,0
功能描述：若3000秒（全姿态捕获除速率阻尼外1000秒，可注入修改）内，三轴中任一轴喷气总量（正负轴单独判断）超过范围（正常模式50s，粗定向和轮子启动、全姿态捕获100s，可注入修改），则根据自锁阀状态，开关自锁阀。全姿态模式,0,1,0,0,0,0,0,0
功能描述：轨控姿态机动模式初始化,0,1,0,0,0,0,0,0
功能描述：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
功能描述：计算岁差章动矩阵。,0,1,0,0,0,0,0,0
功能描述：正常对地运行模式初始化,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|喷气开关逻辑相平面分区，喷气脉冲宽度计算|FREQ31|4.3.1.1|进行单轴相平面分区及控制规律计算
|三轴姿态喷气控制与推力器脉宽分配|FREQ32|4.3.1.3|为三轴姿态喷气控制选择推力器
|轨控发动机与其备份的使用|FREQ33|4.3.1.4|轨控模式时使用轨控发动机及其备份
|动量轮摩擦补偿计算|FREQ34|4.3.2.2|动量轮摩擦力矩的补偿电压计算
|动量轮角动量保持控制|FREQ35|4.3.2.3|计算将动量轮保持至标称角动量所需的电压
|动量轮的启动与保持|FREQ36|4.3.2.4|启动动量轮至标称角动量，并保持
|正常飞行模式动量轮分配电压计算|FREQ37|4.3.2.5|计算正常飞行模式轮控所需电压
|正常模式轮子保护与动量卸载|FREQ38|4.3.3.1|决定采用磁卸载还是喷气卸载方式，调用相应程序
|磁卸载计算|FREQ39|4.3.3.2|计算磁卸载所需的磁矩与磁力矩器工作电压
|结构滤波器计算|FREQ95|4.3.2.6|PID计算控制力矩经过结构滤波器后，改善姿态控制效果
|太阳定向主程序|FREQ40|4.4.3.3|搜索并捕获太阳，完成并保持帆板对太阳定向
|重捕地球与建立正常姿态（1）|FREQ41|4.4.4.1|在完成对日定向后，由地面指令转入重捕地球。在偏航捕获阶段，通过红外和太阳敏感器定姿，消除卫星的偏航角。在完成偏航捕获后，由红外地球敏感器测量信号进行计算得到俯仰角和滚动角，控制滚动、俯仰使其趋向于0
|捕获地球与建立正常姿态（2）|FREQ42|4.4.4.2|当红外敏感器故障时，在太阳定向完成后，利用数字太阳与星敏感器信息，进行全姿态捕获，并建立正常姿态。
|三轴等效角动量偏差|FREQ91|4.3.4.1|根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差
|俯仰通道轮控算法|FREQ92|4.3.4.2|根据俯仰角和俯仰通道角动量偏差信息实现俯仰轴姿态控制
|磁进动、章动阻尼及俯仰轮卸载控制|FREQ93|4.3.4.3|通过磁力矩器，实现滚动-偏航轴的进动控制及章动阻尼，并对俯仰飞轮进行磁卸载
|三轴轮控算法|FREQ94|4.3.4.4|偏置动量轮处于力矩模式，根据红外地球敏感器测量信息计算得到的滚动角和俯仰角实现三轴姿态控制。滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制
|帆板捕获及跟踪控制|FREQ102|4.3.5|根据地面指令或自主使帆板跟踪太阳
|干扰补偿控制算法及动量轮分配电压计算|FREQ95|任务书的4.1.15|计算有效载荷干扰补偿控制电压，以及计算动量轮分配电压
|全姿态捕获动量轮控制方式主程序|FREQ40.5|4.4.5|全姿态捕获动量轮控制方式主程序
",0,1,0,0,0,0,0,0
功能描述：绕本体俯仰轴转动，进行俯仰捕获。,0,1,0,0,0,0,0,0
功能描述：接收卫星安全控制确认字,0,0,0,0,0,0,1,0
"功能描述：紧急撤离模式下，计算视速度增量关机时间长度
",0,1,0,0,0,0,0,0
功能描述：确定动量轮角动量数据的有效性。,0,1,0,0,0,0,0,0
"功能描述：与动量轮通信，输出本周期电压。采集动量轮模拟量信息。
处理：
功能编号|功能|引用文档
FREQ102|初始化(加电)|任务书
FREQ103|动量轮使用要求(方向等)|任务书
FREQ104|通信(DA输出、脉冲输入)|任务书
FREQ105|通信故障处理|预留
FREQ106|数据解包与转换|任务书
FREQ107|处理动量轮数据有效性处理|任务书
FREQ108|动量轮模拟量采集、故障|任务书
FREQ109|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计角速度。
",0,1,0,0,0,0,0,0
功能描述：接收轨道根数数据,0,0,0,0,0,0,1,0
"功能描述：利用动量轮控制电压与动量轮转速的控制关系诊断动量轮
",0,1,0,0,0,0,0,0
功能描述：确定数字太阳数据的有效性。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|5.2.1|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估对地姿态|FREQ3.3|5.2.3|根据陀螺测量输出，一步预估卫星姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|基于红外滤波的卫星姿态确定|FREQ3.6|5.2.6|根据陀螺预估结果和红外(和数字太阳)输出，确定卫星姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|红外与太阳双矢量定姿|FREQ3.9|5.2.9|利用红外、数字太阳敏感器确定姿态
|星敏感器相对基准标定|FREQ3.10|5.2.10|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.11.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.11.2|进行卫星姿态四元数的重置
|三轴欧拉姿态角预估算法产品规范|FREQ3.1.1|/|规范化算法：
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法算法产品规范|FREQ3.1.3|/|规范化算法：
|基于红外测量的红外滤波修正算法产品规范|FREQ3.1.4|/|规范化算法：
|基于单星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.6|/|规范化算法：
|基于红外与太阳矢量的双矢量定姿算法算法产品规范|FREQ3.1.7|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.1|目标姿态计算流程
|正常、偏置飞行目标姿态计算|FREQ3.12.1|5.3.1.1|正常与偏置姿态飞行时的目标姿态计算
|点对点机动目标姿态计算|FREQ3.12.2|5.3.1.2|点对点机动目标姿态计算
|姿态预置过程目标姿态计算|FREQ3.12.3|5.3.1.3|姿态预置过程目标姿态计算
|轨迹跟踪目标姿态计算|FREQ3.12.4|5.3.1.5|角速度建立过程目标姿态计算
|轨控目标姿态计算|FREQ3.12.5|5.3.1.6|轨控目标姿态计算
|角速度扫描阶段目标姿态计算|FREQ3.12.6.1|5.3.1.4|角速度扫描阶段目标姿态计算
|轨控姿态机动轨迹初始化|FREQ3.12.6.2|5.3.2.3|轨控模式目标姿态计算初始化
|正弦轨迹规划算法算法产品规范|FREQ3.12.7|/|规范化算法：
|基于加速度导数为正弦函数的轨迹规划算法算法产品规范|FREQ3.12.8|/|规范化算法：
|点对点姿态机动初始化处理|FREQ3.13|5.3.2.1|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|非沿迹跟踪初始化|FREQ3.14|5.3.2.2|非沿迹跟踪初始化，计算地心张角和方向矢量
|计算多项式轨迹系数|FREQ3.15|5.3.3.1|根据轨迹规划时间，初始姿态/姿态角速度和目标姿态/姿态角速度计算基于多项式轨迹规划的轨迹系数
|姿态预置机动目标姿态确定|FREQ3.16|5.3.3.2|基于多项式曲线的轨迹规划，计算目标姿态
|轨迹跟踪目标姿态角计算|FREQ3.17|5.3.4|根据所指定的扫描起始经纬度和末端点经纬度
|偏流角计算|FREQ3.18|5.3.5|适用于地球椭球模型，星体姿态描述为转序，计算基于星体光轴(与星本体＋Z轴平行)下的偏流角
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|增量式偏流角计算算法产品规范|FREQ3.21|/|规范化算法：
|匀地速姿态预置目标姿态计算|FREQ3.22|5.12|计算模式2/5经模式4转入模式6时姿态预置的目标姿态及角速度
|匀角速度预置目标姿态计算|FREQ3.23|5.13|计算模式2/5经模式4转入模式7时姿态预置的目标姿态及角速度
|零姿态预置目标姿态计算|FREQ3.24|5.14|计算模式6/7经模式4转入模式2时姿态预置的目标姿态及角速度
|陀螺标定过程目标姿态计算|FREQ3.25.0|5.15.1|陀螺标定全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角
|目标姿态计算初始化|FREQ3.25.1|5.15.1.1|对陀螺标定过程中涉及到的两次机动过程进行机动姿态计算的初始化
|惯性姿态点对点机动轨迹规划|FREQ3.25.2|5.15.1.2|对陀螺标定过程所涉及到的两次点对点机动进行轨迹规划
|角速度起速保持与减速过程轨迹规划|FREQ3.25.3|5.15.1.3|对陀螺标定过程中的速度运行进行轨迹规划
|大角速度标定的分档确定|FREQ3.25.4|5.15.1.4|根据实现指向的4挡速度，根据当前的速度的幅值，确定所标定的陀螺刻度因子的位置
|惯性定向时转阶段处理|FREQ3.25.5|5.15.1.5|陀螺标定在第1段中完成惯性定向，并在此期间标定陀螺真实常漂。在惯性定向转速度运行结束时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等。
|速度运行时转阶段处理|FREQ3.25.6|5.15.1.6|SubMode= 2~9，陀螺按照规定的角速度完成起速、恒速运行、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等
|速度曲线规划|FREQ3.25.7|5.15.1.7|根据所选择的机动轨迹，规划出角速度变化曲线
|陀螺标定算法|FREQ3.26.0|5.15.2|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺常漂修正标志确定|FREQ3.26.1|5.15.2.1|对陀螺标定过程中，陀螺常漂的修正标志进行确定。当星体达到了规定的惯性角速度时，开始进行陀螺常漂估计
|基于星敏陀螺滤波的等效常漂估计|FREQ3.26.2|5.15.2.2|采用星敏陀螺滤波的方法对陀螺等效常漂进行估计
|星敏陀螺滤波的陀螺等效常漂记录|FREQ3.26.3|5.15.2.3|对陀螺等效常漂，选取稳态时的一段数据进行平均，得到各个角速度下的等效常漂和星体真实角速度的估计值
|小角速度时的陀螺安装误差和刻度因子误差估计|FREQ3.26.4|5.15.2.4|经过N次速度机动后，对陀螺的测量模型进行标定，给出标定结果
|大角速度时的陀螺标定算法|FREQ3.26.5|5.15.2.5|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺在轨标定时的控制量计算|FREQ3.27|5.15.3|对标定过程中的控制量进行计算
|陀螺安装误差标校结果引入|FREQ3.28|5.15.4|对陀螺完成标定后，待地面确认标定结果无误后，将陀螺的标定结果进行赋值。当地面注入FP__MountingCmp时执行本程序一次
|陀螺刻度因子误差标校结果引入|FREQ3.29|5.15.5|完成陀螺标定，待地面确认无误后，对陀螺的刻度因子进行在轨标校。标校时，取陀螺输出的角速度与与之最接近的两个已标定的特征角速度进行线性插值标校
|偏航对日目标姿态计算|FREQ3.30|5.3.1.7|偏航对日模式下的目标姿态机动
",0,1,0,0,0,0,0,0
功能描述：对动量轮、推力器和磁力矩器控制指令的处理 ,0,0,1,0,0,0,0,0
"功能描述：把陀螺数据测量值变换为星体三轴角速度。
",0,1,0,0,0,0,0,0
功能描述：根据红外数据和姿态角速度偏差进行系统故障的检测。,0,1,0,0,0,0,0,0
功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。    ,0,1,0,0,0,0,0,0
"功能描述：完成卫星正常轨道运行期间的三轴稳定姿态，并进行偏流角修正控制，实现姿态指向精度、姿态稳定度等性能指标。
进入条件：
自主条件：从BZ1=B、2、4、6、8满足条件转入
退出条件：
满足下列条件之一：
自主条件：
满足ZT6  3（有偏航机动）且C1 = FFFF（轨控数据有效标志为有效）且（偏航机动开始时刻之前1800秒）（偏航回调机动开始时刻后600秒）转入BZ1=2
满足（轨控发动机开机时刻-60秒）（轨控发动机关机时刻+100秒）且C1 = FFFF（轨控数据有效标志为有效）且转入BZ1 = 6
满足FM=1（ZT35不等于0且收到侧摆命令块）转入BZ1=8
满足ZT226（系统故障自检有效，可自主切换工作模式）且FSY07（系统故障打分小于等于7）且ZT8  3，ZT9  3（姿轨控发动机可用）转入BZ1=3
满足ZT226（系统故障自检有效，可自主切换工作模式），FSY07（系统故障打分小于等于7），且（ZT8  4（姿控发动机不可用）或ZT9  4（轨控发动机不可用））转入BZ1=7
地面上行注入ZT1不等于1、4 
处理过程：过程如下：
STEP1：当ZT F且ZTA且ZT3B ，进行姿态预估，得到姿态角和角速度。
STEP2：进行运行段姿态确定，具体过程如下：
姿态红外修正（1）和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP3：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3（姿控发动机可用）且ZT9  3（轨控发动机可用）且ZT（不用红外+单个斜装陀螺定姿）时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
t的取值范围|处理
|""发姿轨控发动机加温指令
进行运行段姿态确定 
进行运行段控制""
|""发姿轨控发动机加温指令
发左右帆板归零指令
飞轮动量保持控制及飞轮启动
令，
 轨控段喷气姿态控制""
|""令 ，

轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令""
|""令，
轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令
""
|""红外数据采集及处理
红外故障检测及信号选取
姿态红外修正（2）
，
运行段喷气姿态控制
飞轮动量保持控制及飞轮启动
运行段帆板控制""
|BZ1 = 1，C1 = CCCC。

当ZT40(4) = 1（天线扫描捕获）时，进行数传天线捕获跟踪控制
STEP4：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
功能描述：ACU模拟量遥测 ,0,0,0,1,0,0,0,0
"功能描述：仅利用星敏感器C的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
功能描述：确定模拟太阳敏感器数据的有效性。,0,1,0,0,0,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
处理：
（1）读每路动量轮的转速脉冲数，将读到的上一个周期的计数器的值减去本周期的计数器的值（要进行计数器过零时的处理），将差值乘以系数0.0395784。
（2）读每路动量轮的转速方向。AOCC通过并行口（F2H）的D0～D5分别测量MW1～MW6的转动方向，测得0表示反转，1表示正转。
（3）将（1）和（2）的结果相乘得到六个动量轮的角动量，
，（Nms）
动量轮状态确定：根据BZ9、BZ10确定参与工作的动量轮标志FWH，FWH取值与BZ9、BZ10的逻辑关系如下表所示，具体见用户需求5.12，其中BZ9、BZ10由动量轮故障诊断确定。
    表33：动量轮状态确定
BZ9、BZ10的组合情况|FWH取值
BZ10（2）|FWH取值
1|0（动量轮无故障）
1|1（动量轮1故障）
1|2（动量轮2故障）
1|3（动量轮3故障）
1|4（动量轮4故障）
1|5（动量轮5故障）
0|6（动量轮6故障）
1|7（动量轮1、5故障）
1|8（动量轮2、5故障）
1|9（动量轮3、5故障）
1|10（动量轮4、5故障）
0|11（动量轮1、6故障）
0|12（动量轮2、6故障）
0|13（动量轮3、6故障）
0|14（动量轮4、6故障）
0|15（动量轮5、6故障）
1|16（动量轮1、2故障）
1|17（动量轮1、3故障）
1|18（动量轮1、4故障）
1|19（动量轮2、3故障）
1|20（动量轮2、4故障）
1|21（动量轮3、4故障）
其余组合|FWH值不变
",0,0,0,0,0,1,0,0
"功能描述：进行I/O板SpaceWire接口读入和输入数据的处理；由于不同敏感器输入的姿态角度信息的格式和量化单位都不相同，需要将它们进行格式转换。输入信息格式转换后的单位规定为：地球敏感器、太阳敏感器、陀螺积分的角度单位为弧度（rad），动量轮转速单位为（rpm） 
处理：
(1)  判断IO当班状态；
(2)  697控制双口RAM；
(3) 根据当班状态，选择SPACEWIRE相应通道，主份IO当班，从通道2读取双口RAM中的数据；备份IO当班，从通道3读取双口RAM中的数据；
(4) 对读取的双口RAM中的数据进行解包
(5) 输入数据处理；（包括：太敏、地敏、三浮、光纤、星敏、时间、ADU控制信息、IO状态信息等）。
接口输入功能
功能描述：进行接口数据的读取 
处理：输入功能具体见PM板与IO板接口。(1) 从双口RAM中读取I/O发送的数据；(2) 根据协议对接收的数据进行解包；
输入数据处理功能分解
接口输入后，根据通讯协议和数据格式进行数据处理，下表示输入数据处理的功能分解：
表5.2-4 输入数据处理功能分解1
序号|编号|功能说明|任务书中的章节号|功能描述
|FREQ10.1|太敏数据处理地敏数据处理|6.1.1|太阳敏感器数据进行解码，读入的偏移二进制码转换为控制计算用的浮点数格式；
|FREQ10.2|地敏数据处理|6.1.2|将从接口读入的ES数据转化为弧度值
|FREQ10.3|甚高三浮陀螺数据处理|6.1.3|将三浮陀螺在一个采样周期内的脉冲数转化为角度增量，并做限幅与剔野处理
|FREQ10.4|光纤陀螺数据处理|6.1.4|对光纤陀螺数据包进行解码，测量数据由定点数转换为控制计算用的浮点数格式；
|FREQ10.7.2|星敏曝光时刻计算|6.1.5|星敏曝光时刻计算

表5.2-5 输入数据处理功能分解2
序号|需求ID号|功能点说明|用户需求中章节号|功能描述
|FREQ10.3.1|三浮陀螺数据剔野|11.1.1|三浮陀螺数据剔野
|FREQ10.4.1|光纤陀螺数据剔野|11.1.1|光纤陀螺数据剔野
|FREQ10.5|陀螺的应用选择|11.1.1|控制分系统配置了9个陀螺，根据陀螺健康字和电源状态字确定陀螺状态字，计算分配矩阵。也可通过陀螺组合遥控指令处理，设置陀螺状态字，进而计算出分配矩阵。故障后通过地面遥控进行陀螺重新组合分配
|FREQ10.6|单独测量时的陀螺数据处理|11.1.1|根据陀螺测量值，得到三轴姿态角速度，用于姿态采用陀螺几分测量时
|FREQ10.7|星敏感器数据处理|11.1.2|对星敏数据进行解包、数据有效性判断、通讯故障判断、星敏数据剔野
|FREQ10.7.1|星敏数据剔野|11.1.2|星敏数据剔野
",0,0,0,0,0,1,0,0
功能描述：发送轨道数据包,0,0,0,0,1,0,0,0
"功能描述：发送星敏陀螺数据
处理：将星敏陀螺数据打包后放到发送星敏陀螺数据存储地址中
AOCC每个控制周期（250ms）组织128个字节星敏陀螺数据，OBDH每500ms取1次星敏陀螺数据（256个字节）。其中前128字节数据对应小星时的星敏陀螺数据，后128字节数据对应大星时的星敏陀螺数据。",0,0,0,0,0,0,1,0
"软件需求名称：动量轮控制 
需求类别：其他 
软件需求描述：根据控制律计算结果，驱动动量轮，进行姿态控制。",0,0,1,0,0,0,0,0
"功能描述：已知扫描区域中心坐标和扫描范围后，计算扫描起点的目标姿态。
",0,1,0,0,0,0,0,0
"功能描述：引入飞轮控制（包含启动、动量保持、喷气卸载等）及撤去飞轮控制。
处理：
根据ZT2的取值进行不同的处理，处理逻辑见下表，见用户需求。
ZT2=1：飞轮启动，动量保持
ZT2=2：飞轮整星零动量控制模式
ZT2 6：不用轮控
ZT3≤3：用红外+太阳+陀螺定姿，且接入控制回路
ZT3=A：星敏无陀螺定姿，且接入控制回路，整星零动量控制方式
ZT3=C：用星敏感器+陀螺定姿，且接入控制回路
ZT3=F：用红外+单个斜装陀螺定姿，且接入控制回路
                      表38：飞轮控制的判别处理
条件|处理
 ZT2 6或3个动量轮工作|（i = 1， … ，6）
ZT2=1，3个以上动量轮工作|飞轮动量保持控制及飞轮启动
ZT2=2，3个以上动量轮工作|""喷气卸载逻辑判断：
①，。当BZ1 = 8时令,=0.
② 当连续三次，则：FHU = A,若BZ1 =1或 2或 9，则：FHU = A 
③当FHU = A且ZT8  3且ZT9  3，则：飞轮动量保持控制及飞轮启动 
④当ZT,ZT，且且且，则：FHU = 0
⑤当ZT3 = F或B且且BZ50且且，则：FHU = 0
⑥ 若ZT3=A，则：
若且FSTD 1且且，则：FHU = 0
""

卫星的三轴转动惯量分别为 3023.2kgm2、  3453.1kgm2 、 4998.7kgm2。
其中飞轮动量保持控制及飞轮启动的处理详见用户需求，飞轮控制电压计算详见用户需求1.3.4",0,1,0,0,0,0,0,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。
功能编号|功能|引用文档
FREQ53|初始化|星敏协议
FREQ54|星敏使用要求|任务书
FREQ55|通信|星敏协议
FREQ56|通信故障处理|任务书
FREQ57|数据解包与转换|星敏协议
FREQ58|星敏数据有效性判断、处理|任务书
FREQ59|星敏模拟量采集、处理|任务书
FREQ60|部件在轨转发（在轨修改）|任务书

3）GPS高精度校时与星敏感器数据的使用
功能描述：根据GPS秒脉冲，秒脉冲广播，进行GPS高精度校时和星敏感器时标处理。
输入：地面遥控指令，GPS秒脉冲，秒脉冲广播，星敏感器数据。
输出：星时，时标，星敏感器数据广播。
处理：",0,0,0,0,0,1,0,0
"功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。
",0,1,0,0,0,0,0,0
"功能描述：计算正常飞行模式轮控所需电压。
",0,1,0,0,0,0,0,0
"功能描述：完成运行段偏差姿态确定，（红外修正，太阳修正，星敏感器姿态确定，斜装陀螺定姿等）确定，。
处理：
（1）若BZ1 ≠ 8，9，ZT3≠F,A,B则调用姿态红外修正，调用q及s姿态予估器；若，则：，。
（2）若BZ1 = 8，则
① 根据轮子的工作状况，计算滚动轴最大控制力矩。
② 计算滚动轴角加速度。
③ 计算加速时间。
④ 侧摆喷气判断。
⑤ 计算滚动轴期望轨迹和。
（3）计算姿态角控制量。其中当BZ1≠8,9,ZT3=F或B时，滚动角和俯仰角的限幅值改为可内存修改系数，。红外+斜装陀螺增加偏流角计算。",0,1,0,0,0,0,0,0
功能描述：启动动量轮至标称角动量，并保持。,0,1,0,0,0,0,0,0
功能描述：设置7类快帧遥测数据下传顺序,0,0,0,0,0,0,0,1
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器A、B修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,1,0,0,0,0,0,0
"功能描述：根据框架角偏差计算指令转速。
处理：主要处理过程如下：
当接收到由OBDH发送来的中继快扫到位指令,进入天线预置状态，令FAFP=1，预置的目标角为命令块中的-10对应时刻通过轨道计算得到的天线框架角。控制中继天线转动快扫到达目标位置。当时间大于-10后，退出预置状态令FAFP=0。
当接收到由OBDH发送来的中继复位指令,进入天线复位状态，令FARP=1。根据命令块中数据标志来确定天线要复位的位置。如果标志为55H，天线复位到命令块中指定的角度位置；如果标志为FFH，则天线复位到零位。
当地面上行注入ZT40（1）=1时，天线进入螺旋扫描状态。按照特定的步长控制天线转动，当螺旋扫描持续的时间超过注入的天线捕获扫描时间时，将ZT40(1) 置0退出螺旋扫描状态。
当接收到由OBDH发送来的中继程序跟踪停止指令，停止向中继捕获跟踪控制单元发送控制信息，并设定标志传到遥测。其余情况下天线处于程序跟踪状态。
卫星增加了侧摆中继时传的工作模式，快摆时工作时序见任务书.5。",0,1,0,0,0,0,0,0
"功能描述：速率阻尼。
",0,1,0,0,0,0,0,0
功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。,0,1,0,0,0,0,0,0
功能描述：根据平台光纤陀螺组件接收的0.25秒内陀螺的角度增量，算出卫星在惯性空间的角速度。,0,1,0,0,0,0,0,0
"功能描述：计算星上星时。
处理：
应用软件的星上时是以星箭分离时刻作为“0”时刻。
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。",0,0,0,0,0,1,0,0
"功能描述：使用红外、数字太阳敏感器确定姿态。
",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器C、D的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器A、B的测量，估计姿态。
",0,1,0,0,0,0,0,0
"功能描述：进行模式初始化。
处理：
（1）置帆板归零； 
（2）置 ===0；=0;= 0；",0,1,0,0,0,0,0,0
"功能描述：发送AOCC时间
处理：
CTU复位后需要从AOCC恢复重要数据和星上时间。首先CTU发送“接收用于做时间差值的时间码”指令，将CTU目前的时间发送给AOCC。AOCC将星上时间和接收到的CTU时间做差值处理，将AOCC时间-CTU时间保存。CTU在1s后发送“发送时间差值”指令，AOCC将保存的时间差值发送给CTU。",0,0,0,0,0,0,1,0
"功能描述：仅利用星敏感器B的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的中继天线系数,0,0,0,0,0,0,1,0
"功能描述：发送AOCC内存数据块
处理：OBDH从遥控接收到AOCC内存数据下卸指令后，向AOCC发送内存设置命令，通知AOCC内存数据下卸的段地址、偏移量及下卸长度；OBDH发出内存设置命令后100ms，开始接收AOCC内存数据。其处理过程如下：
STEP1：AOCC应用程序接收到OBDH内存下卸的指令后，进入OBDH中断服务程序（INT1）；
STEP2：AOCC应用程序读出OBDH注入的段地址、偏移地址和数据长度；
STEP3：根据段地址，偏移地址计算下卸内容的地址，并进行合法性判别。
STEP4：根据计算出的下卸内容的起始地址和长度，将下卸内容放入OBDH规定的内存中 。",0,0,0,0,0,0,0,1
"时间服务用于CCU的校时，卫星时间服务为1s时间同步周期进行一次，BC采用子地址29广播消息发送至各RT。同时实现了OBDH校时时刻和GPS秒脉冲时刻的发送。CCU的处理中，整个的时间为OBDH校时时刻（包括秒部和微妙部），其中的秒部为GPS秒脉冲时刻。因此包含的功能点为两个：
序号|功能描述|功能编号|
|接收OBDH校时时刻|FREQ7.1.1|设置OBDH校时标志TimeFlg.RcvOBDH
|接收GPS秒脉冲时刻|FREQ7.1.2|设置GPS校时标志
",0,0,0,0,0,0,1,0
"功能描述：判断陀螺的使用范围。
处理
对陀螺数据进行有效性判断。若某个陀螺故障或某个陀螺为新上电，则不进行有效性判断（陀螺不引入）。其中陀螺新加电有三种情况1、判断出陀螺故障且允许自主加电情况下，应用软件自主加电。2、数据指令加电。3、脉冲遥控指令加电。对于新加电陀螺，则在该陀螺加电时间小于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为0；当该陀螺加电时间大于等于20分钟（全姿态捕获模式为10分钟）时，将其引入标志置为1。
若SLTU陀螺不加电或该陀螺故障，不引入。当“允许使用电源状态诊断陀螺”时，应用软件根据与SLTU通讯得到的陀螺电源状态确定陀螺加断电状态；当“不允许使用电源状态诊断陀螺”时，应用软件只根据数据指令确定陀螺加断电状态。若SLTU得到的六个电源状态均断电，则不根据电源状态判断陀螺是否加电。",0,1,0,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺数据采集在BZ8=5（轨控模式轨控期间、帆板未展开模式和全姿态捕获模式太阳捕获期间）的采样周期为0.262秒，其余模式的采样周期为0.524秒。
（2）陀螺共有三个互为备份的LTU，通过每个LTU均可获得六个陀螺的数据；AOCC向陀螺LTU发送取数命令1和取数命令2来获得数据，其中取数命令1有两个字节，取数命令2有一个字节；只有取数命令1通讯不成功时才发取数命令2。AOCC根据ZT14（4）（3）来确定和哪个LTU进行通讯，同时确定通道选择号和取数命令1和取数命令2的第一个字节。 
ZT14(4)(3)的值|进行通讯的陀螺LTU|取数命令1和命令2
01|陀螺LTU1|53H和5CH
10|陀螺LTU2|63H和6CH
11|陀螺LTU3|73H和7CH
00|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1|53H（或63H或73H）和5CH（或6CH或7CH）

（3）AOCC根据ZT15、ZT16确定要采集哪几个陀螺的数据（加电的陀螺），即决定取数命令1中的第二个字节（工作陀螺编码字节）的低6位，。ZT15、ZT16与第二个字节的对应关系如下：
取数命令1的第二个字节
D0
ZT15（1）

（4）将陀螺LTU返回的数据根据LTU通讯协议中的计算公式转换为陀螺的角度增量（弧度）。根据ZT46、ZT47确定当前引入陀螺。
（5）陀螺LTU数据采集过程中的故障处理见本文的.1。",0,0,0,0,0,1,0,0
"功能描述：复位取回重要数据初始化
处理：
- 若取回模式为Mode1、2、3、4、6、12、13、14、15、16，更新模式字；若为模式4、6、12、13，从子模式0开始运行；
- 若取回模式为Mode5，切换至Mode3（动量轮启动模式）；
- 若取回模式为Mode7、8、9、10、11，切换至Mode16（紧急撤离模式），SubMode1。
- 按保存的重要数据更新其它变量；
- 陀螺：根据陀螺引入标志，发陀螺开指令、设置陀螺引入；
- 自锁阀：根据自锁阀状态设置自锁阀开关，再根据自锁阀开关设置喷管选择；
- LTU自主切换标志：更新ALTU、NSMU、微波、可见光、机械手分系统自主切换标志；
- LTU当班标志：更新NSMU、星敏A、星敏B、CCD相机A、CCD相机B、微波、可见光、机械手当班标志；
- LTU加电：对当班LTU（ALTU、NSMU、星敏A、星敏B、CCD相机A、CCD相机B、微波、可见光）补发加电指令；
- 更新磁力矩器线路俯仰通道主、备选择标志；
- 红外数字太阳定姿（非星敏定姿），禁止星务校时；",1,0,0,0,0,0,0,0
"功能描述：处理地面遥控注入的程序代码
处理：解包程序代码注入包，得到目的地址、注入内容长度；将注入内容放入目的地址内。
说明：星务分系统向GNCC送数采用256字节(有效使用249字节)帧格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,1,0
功能描述：机动姿态保持模式初始化,0,1,0,0,0,0,0,0
"控制计算机有实时遥测数据和延时遥测数据。包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包|FREQ7.3.1
|发送敏感器数据包1|FREQ7.3.2
|发送敏感器数据包2|FREQ7.3.3
|发送红外太阳修正数据包|FREQ7.3.4
|发送敏感器修正数据包|FREQ7.3.5
|发送姿态控制数据包|FREQ7.3.6
|发送轨道数据包|FREQ7.3.7
|发送天线数据包|FREQ7.3.8
|发送部件工作状态数据包|FREQ7.3.9
|发送星敏感器自检数据包|FREQ7.3.10
|发送系统工作状态包|FREQ7.3.11
|发送全姿态捕获模式状态数据包|FREQ7.3.12
|发送控制模拟量遥测数据包1|FREQ7.3.13
|发送控制模拟量遥测数据包2|FREQ7.3.14
|发送控制分系统延时遥测数据包|FREQ7.3.15

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,1
功能描述：接收数据指令注入块的模式运行类指令,0,0,0,0,0,0,1,0
"功能描述：启动动量轮至标称角动量，并保持。
",0,1,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示：
服务编码|发送的条件
85H|上电时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次
47H|每5.12秒
74H|复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次
83H|进入无控模式时申请，收到服务请求确认字后结束
",0,0,0,0,0,0,0,1
"功能描述：三轴喷气姿态控制。
",0,1,0,0,0,0,0,0
功能描述：喷气卸载进入和退出条件计算。,0,1,0,0,0,0,0,0
功能描述：在完成对日定向后，由地面指令转入地球捕获。当两个地球红外敏感器同时故障时，使用数字太阳敏感器和星敏感器定姿建立正常姿态。,0,1,0,0,0,0,0,0
功能描述：对星敏感器输出数据进行有效性判断。,0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
部件加断电指令的处理|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,1,0,0
"功能描述：地垂线捕获后，捕获偏航角，建立对地三轴稳定。
",0,1,0,0,0,0,0,0
"功能描述：发送星敏陀螺数据给OBDH保存
处理：将星敏陀螺数据打包后放到星敏陀螺数据内存地址空间中。
星敏陀螺数据组帧时，对本周期未取到星敏数据、陀螺数据的处理，以及校验和的计算方法与《 卫星控制分系统AOCC与数传分系统数据处理器通讯协议》文件中向数传分系统发送的星敏陀螺数据要求一致。",0,0,0,0,0,0,0,1
"功能描述：发送AOCC重要数据给OBDH保存
处理：将重要数据打包后放到AOCC重要数据内存地址空间中。AOCC共四块重要数据，每块重要数据均64个字节。每块重要数据均有校验和，校验和占4个字节。校验和的计算方法为：将60个字节按双字进行异或计算。重要数据的内容具体见重要数据文件。",0,0,0,0,0,0,0,1
"上电/复位后，系统软件进行相应的初始化工作，之后调用应用软件的AInit()函数进行应用软件的初始化。应用软件初始化工作主要包括硬件初始化、变量初始化、星箭分离查询、确定部件加断电状态状态。
硬件初始化的内容如下表所示：
表5-2 上电/复位后硬件初始化表
内  容|状  态
串口初始化|按前面要求进行设置
CANA、B总线初始化|按通讯协议要求进行设置

硬件初始化完成后应用软件需对初始值不为0的变量初始化（系统软件已对B段变量清零），相应变量的初始化值见《卫星控制分系统控制计算机应用软件用户需求》和《卫星控制分系统注入参数及数据指令的用户需求》。应用软件需读取一次星时计数器值。
硬件和变量初始化完成后，应用软件连续进行5次星箭分离查询，每次间隔大于1ms。若连续3次查到星箭分离，则认为星箭已分离，置当前控制模式为“复位进入模式”，设置星时为0.75秒；否则认为星箭未分离，进行主动段初始化工作。",1,0,0,0,0,0,0,0
"功能描述：
每次中断到来，向TM串口5(US[5])写入8字节的数据（功能编号：FReq-12）。
处理：发送DPRU由RT变为BC的使能请求，每次中断到来，通过同步串口US[5]发出8字节，首先复位FIFO，然后发送指令码为：0x1A、0xCF、0xFC、0x1D、0xBF、0xC0、0xA6、0xED
同步串口5模式寄存器设置为02，帧长设置为128字节。",0,0,1,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
|OBDH校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|两种校时方式的切换|FREQ Q1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
",0,0,0,0,0,1,0,0
"功能描述：校正星上星时。
输入：星上星时变量、均匀校时间隔、均匀校时时间、全量校时时间、增量校时时间、星务校时时间、相关数据指令。
输出：校正后的星上当前星时变量。
",0,0,0,0,0,1,0,0
"功能描述：卫星绕俯仰轴转动，直到满足姿态角条件，进入下一阶段偏航捕获。姿态确定由红外和陀螺。姿态控制是喷气控制
",0,1,0,0,0,0,0,0
功能描述：根据红外输初，计算太阳在本体坐标系中方位、姿态偏差、弦宽误差估计与量测新息。,0,1,0,0,0,0,0,0
功能描述：CMG启动模式控制,0,1,0,0,0,0,0,0
"功能描述：接收数据指令注入块的部件使用选择类指令
处理：
序号37使用四个陀螺定姿和序号38使用三个陀螺定姿初值更改，改为默认使用3个陀螺。",0,0,0,0,0,0,1,0
"功能描述：利用估计的四元数转换姿态角。
",0,1,0,0,0,0,0,0
"功能：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：计算卫星偏流角，适用于地球椭球模型，星体姿态描述为转序。,0,1,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。",0,0,0,0,0,0,0,1
"功能描述：星上自主检测陀螺故障。
",0,1,0,0,0,0,0,0
"功能描述：选择三轴控制力
处理：根据推力器分支设置控制力。
说明：3种分支共计3组控制力（每组包括正负X轴，Y轴，Z轴共4个）",0,1,0,0,0,0,0,0
"功能描述：实现CMGs的PD/PID控制。
输入：姿态角误差，角速度误差，；，系统合成角动量（Nms）；Jacobi矩阵sgJ，矩阵sgF；CMG使用标志Lcmg[i]；奇异回避向量，奇异测度JD，机动补偿力矩，(陀螺切除用)",0,1,0,0,0,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在AOCC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ61|初始化|与一体化太阳通信协议
FREQ62|数太使用要求|任务书、数太协议
FREQ63|通信|任务书、数太协议
FREQ64|通信故障处理|任务书
FREQ65|数据解包与转换|数太协议
FREQ66|数太数据有效性判断、处理|任务书
FREQ67|数太模拟量采集、处理|预留
FREQ68|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"    各个模式切换的功能点列表如下：
模式字|功能|功能编号
0|主动段模式切换|FREQ5.1
1|入轨段消初偏模式切换|FREQ5.2
2|正飞模式切换|FREQ5.3
3|大角度机动模式切换|FREQ5.4
4|正常运行模式切换|FREQ5.5
5|轨控模式切换|FREQ5.6
6|SAR未展开模式切换|FREQ5.7
7|帆板未展开模式切换|FREQ5.8
8|偏置动量控制模式切换|FREQ5.9
9|全姿态捕获模式切换|FREQ5.10
A|应急安全模式切换|FREQ5.11
B|停控模式切换|FREQ5.12

工作模式的转换如下表所示： 
模式字|到1|到2|到3|到4|到5|到6|到7|到8|到9|到10|到11
从0|ZC0-1||||||||ZC0-9||
从1||ZC1-2|||||||ZC1-9|ZC1-10|
从2|||ZC2-3|ZC2-4||ZC2-6|ZC2-7|ZC2-8|ZC2-9|ZC2-10|ZC2-11
从3||||ZC3-4|||||ZC3-9|ZC3-10|ZC3-11
从4||ZC4-2|ZC4-3||ZC4-5|ZC4-6|ZC4-7|ZC4-8|ZC4-9|ZC4-10|ZC4-11
从5||||ZC5-4|||||ZC5-9|ZC5-10|ZC5-11
从6||ZC6-2||ZC6-4|||||ZC6-9|ZC6-10|ZC6-11
从7||ZC7-2|||||||ZC7-9|ZC7-10|ZC7-11
从8||ZC8-2||ZC8-4|||||ZC8-9|ZC8-10|ZC8-11
从9||ZC9-2||ZC9-4||||||ZC9-10|ZC9-11
从10|||||||||ZC10-9||
从|||||||||ZC11-9|ZC11-10|

条件标识原则：ZCX—Y，其中ZC表示转换条件，X为转出的模式字，Y为转入的模式字。具体见用户需求3.3。AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,1,0,0,0,0,0,0
"功能描述：发送遥测数据
处理：
CTU从AOCC接收遥测数据后，向AOCC发送“当前”的实时遥测帧计数，AOCC随后组织“下一帧”62字节遥测数据并将数据放到相应的子地址（更新总线缓存）。数字量遥测数据格式内容具体见数字量遥测文件。",0,0,0,0,0,0,0,1
"功能描述：动量轮摩擦力矩的补偿电压计算。
",0,1,0,0,0,0,0,0
"功能：利用星敏感器A的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：不使用陀螺数据时的姿态角、角速度与姿态四元数预估。
",0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的红外陀螺数据有效性及系统故障诊断修正系数,0,0,0,0,0,0,1,0
根据地面注入的接收内存读出的地址和长度，将对应地址和长度的内存数据放入发送内存读出数据的存储空间内；,0,0,0,0,0,0,0,1
"功能描述：发送姿态数据
处理：
AOCC每个控制周期（250ms）组织24个字节姿态数据，OBDH每500ms取1次姿态数据（48个字节）。每个数据包中的2个姿态的时标需按照时间顺序排列。",0,0,0,0,0,0,0,1
"星务中心计算机在1s运行周期内与控制计算机完成数据交互一次，在每次交互时星务中心计算机先发送12字节的握手信号，紧接着连续发送有效传输数据。控制计算机在接收全部数据后250ms内，将需要发送给星务计算机的数据数据发给星务中心计算机（包含握手包头和有效传输数据）。
上行数据处理（星务计算机→控制计算机）的功能点如下：上行数据包轮询及数据处理流程、GPS轨道数据、接收AOCC重要数据、星务至CCU数据块、星务至VIPPCU数据块、原始任务注入块、规划结果单次任务输入、任务规划用整星遥测
下行数据处理（控制计算机→星务计算机）的功能点如下：下行数据处理流程、快帧1遥测数据包、快帧2遥测数据包、慢帧1遥测数据包、慢帧2遥测数据包、慢帧3遥测数据包、慢帧4遥测数据包、慢帧5遥测数据包、辅助数据、发送AOCC重要数据、控制分系统成像任务规划结果、控制分系统数传任务规划结果、慢帧6遥测数据包、CCU内存下卸帧、部件内存下卸帧、VIPPCU内存下卸帧",0,0,0,0,0,0,0,1
"功能描述：推力器喷气时间累计
",0,1,0,0,0,0,0,0
"功能描述：选择通讯的红外LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）红外共有两个LTU（正俯仰红外LTU和负俯仰红外LTU），AOCC每个控制周期向注入文件中的ZT5和IresLTUSeltFlag的最大组合中指定的和加电的红外LTU发送取数指令
（2）向选择的红外LTU发送完取数指令，获得红外LTU返回的数据，将数据转换为所需的数据格式。
",0,0,0,0,0,1,0,0
功能描述：偏航捕获模式初始化                                                                                                                                                                                处理：第i项当用星敏捕获时置SMODE =1改为SMODE =0。,0,1,0,0,0,0,0,0
"功能描述：将加计数据换算成卫星三轴加速度和速度增量
",0,1,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
甚高陀螺通讯故障诊断|大量程通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
部件故障诊断与处理|确定各敏感器和执行机构故障诊断及处理
陀螺故障检测|确定各敏感器和执行机构故障诊断及处理
动量轮故障检测|检测工作中的动量轮的故障
大力矩飞轮故障检测|检测工作中的大力矩飞轮的故障
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式7的系统故障诊断|在模式7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
磁力矩器数模一致性诊断|磁力矩器数模一致性诊断
DSS输出一致性诊断|DSS输出一致性诊断
ASS1输出一致性诊断|ASS1输出一致性诊断
ACU 1553B接收故障诊断及处理|由于卫星的执行机构控制均需通过ACU进行，当ACU接收控制指令内存区异常将导致卫星失去控制能力，因此有必要对ACU接收执行机构控制指令的正确性进行判断。在检测到执行机构控制指令接收校验和异常后CCU需要自主进行处理",0,0,0,1,0,0,0,0
"功能描述：对地对日相互转换的过渡模式。                                                                                                                                                                                                                                                                                                                                                                                                                                                            处理：
根据地面规划指令，使用CMG完成姿态快速机动，满足姿态条件自主退出该模式。
从进入该模式起，AOCC需每秒向引入的星敏发送星敏角速度限制指令TC_RATE_LIMIT指令。指令包含的参数计算见用户需求，指令格式见AOCC与星敏通信协议。使用单独的时间间隔计数器，并从第一个周期开始发送TC_RATE_LIMIT指令。
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺的数据处理；
调用四元数陀螺预估；
调用星敏感器数据处理；
if(MoveSTSInSystemFlag=1) 调用利用星敏感器的姿态确定；
elseif(MoveSTSInSystemFlag=2且 且SSTCatchSuc=0)   调用星敏感器对日定向的a项；
调用 .13（姿态修正及星敏粗姿态计算）；
调用机动目标姿态确定；
调用中继天线捕获跟踪控制；
调用对地数传天线捕获跟踪控制；
调用控制器输入量计算；
调用CMG奇异状态的判断及算法计算；
调用CMG的控制；
调用系统故障诊断；",0,1,0,0,0,0,0,0
"功能：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。
",0,1,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
部件故障诊断|对部件进行故障诊断
陀螺故障诊断|由平衡方程方法、星敏感器数据等对陀螺进行故障检测
CMG故障诊断|根据CMG输出数据和理论数据进行CMG故障检测
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止。
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式4、6、7的系统故障诊断|在模式4、6、7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
大量程陀螺通讯故障诊断|大量程通讯故障诊断及处理
CMG通讯故障诊断|CMG通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理",0,1,0,0,0,0,0,0
"功能描述：以星敏感器X 为基准标定星敏感器Y。
",0,1,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件进行LTU初始化、1553B初始化、调用系统软件的StartStarTimer、变量的初始化
处理：
进行1553B初始化，处理过程见4.3.2的OBDH初始化功能
GPS秒脉冲信号接口寄存器初始化
设置3个星敏的 RTS信号为无效
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0
功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
功能描述：计算磁卸载所需的磁矩与磁力矩器工作电压,0,1,0,0,0,0,0,0
"功能描述：每4.192秒运行一次的主程序。
处理： 
STEP1：记录当前的星时、数字太阳敏感器输出、四元数和星敏数据、星敏姿态角及惯性角速度：
，
FSTAVD = FSTAVD05，FSTBVD = FSTBVD05，FSTCVD = FSTCVD05
t星A = t星A05，t星B = t星B05，t星C = t星C05
=，=，=，=，=，=
，；
STEP2：若指定星敏诊断陀螺故障，则：对工作陀螺，
STEP3：进行外推轨道计算和中继卫星轨道计算；
STEP4：重要数据打包，进行数据校正和红外故障检测及信号选取；
STEP5：当BZ1 为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，如果没有喷气则进行光行差修正量计算及加速计零位估计；
STEP6：进行星敏感器数据处理；
STEP7：当BZ1为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，进行下列操作：
当BZ1= 1（三轴稳定正常轨道运行姿态）且BZ2 = 1（已有遥控轨道数据注入）且BZ6 = 3（姿态确定用红外、陀螺和数字太阳）且C1 = 0000（轨控数据有效标志为无效）且ZT3≠F（用红外+单个斜装陀螺定姿，且接入控制回路）且ZT3≠A（星敏无陀螺定姿，且接入控制回路，整星零动量控制方式）时进行姿态太阳修正。
当C1 = CCCC（轨控关机后或偏航机动结束后）时令星敏修正时间；否则
进行S姿态的q修正及光轴方位计算（由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位）
当时令，=，=，=，=，
若C1=0，则根据FSTD（星敏参与定姿的标志）的取值进行相应的星敏修正并令
FSTD取值|处理
2|用A，B头测量修正q
3|用A，C头测量修正q
4|用B，C头测量修正q
5|用A头测量修正q
6|用B头测量修正q
7|用C头测量修正q

当满足ZT4  0（用磁力矩器）且BZ2  2（有遥控注入过）且ZT2  2（飞轮启动保持或零动量控制方式）时进行地磁场计算和飞轮磁卸载；否则令磁力矩器的输出电压为0；
STEP8：当BZ1 = 1或9或 { BZ1 = 3，FSA≥5 } 或 { BZ1 = B，}，则进行推进系统故障检测及切换；
STEP9：若BZ1 = 1或9或 { BZ1 = B，}，则：系统故障检测；否则系统故障检测中的连续时间计数；
STEP10：若ZT17≥4，ZT18≥7，则：帆板故障检测及切换；
STEP11：当ZT38 = F（0.524主程序中插入帆板未展开模式）时，进行帆板未展开模式处理；
STEP12：当BZ1  1，8，9（入轨段控制模式、偏航机动模式、全姿态捕获、重
捕地球、轨控模式、姿态无控模式、自旋模式）时，令不用星敏定姿；
STEP13：若BZ1  1，8，9，B，则：FSY = ；
STEP14：当ZT4 = 0（不用磁力矩器时）或BZ1  （1、9）时，令磁力矩器的电压为0；
STEP15：当ZT2  6时，令动量轮的电压为0；
STEP16：设置，；
STEP17：记录数据， ；
STEP18：进行中帧、慢帧的遥测数据和黑匣子数据的打包。",0,0,0,1,0,0,0,0
功能描述：星上实时计算地磁场强度。,0,1,0,0,0,0,0,0
"功能描述：完成卫星在失去姿态基准情况下的全姿态捕获，对日定向功能。
处理过程：过程如下：
分两个过程：
第一步捕获太阳（BZ1=3且FSA=0）（在0.262秒中断中完成）
STEP1：进行姿态预估（4），得到姿态角和角速度。
STEP2：进行Z轴捕获太阳的处理过程
发左右帆板归零指令
设定三轴捕获的角速度，（见用户需求）
进行速率喷气控制（见用户需求）
如果ZT2 = 2且FWi  C对工作的飞轮成立，则进行飞轮动量保持控制及飞轮启动；如果ZT2  2或FWi < C 对某一工作的飞轮成立，则将六个轮子的控制电压置为0
满足下列两个条件时，设置FSA=5：
ZT13  4（用0-1太阳捕获）且且指定的敏感器见太阳
ZT13 = 4（用数字太阳捕获）且两个数字太阳均在视场内
第二步太阳定向（BZ1=3且FSA不等于0）
STEP1：进行红外数据采集及处理并将磁力矩器的输出电压设置为0。
STEP2：进行Z轴对日定向和陀螺故障检测及选择：
STEP3：根据ZT7的取值，进行相应的帆板控制。
在BZ1=3中，FSA有三中状态分别为0、5、A，这三个状态的转换关系如图12和表41所示：
图 12： FSA的状态转移图
表 40： FSA状态转换的条件
条件|具体说明
条件1|""ZT13  4（用0-1太阳捕获）且且指定的敏感器见太阳
ZT13 = 4（用数字太阳捕获）且两个数字太阳均在视场内""
条件2|""ZT13  4（用0-1太阳捕获）且且Ls = 1且指定的敏感器不见太阳
ZT13 = 4（用数字太阳捕获）且且 ""
条件3|""ZT13  4（用0-1太阳捕获）且且Ls = 1且
ZT13 = 4（用数字太阳捕获）且且且""
条件4|""ZT13  4（用0-1太阳捕获）且且Ls = 1且指定的敏感器不见太阳
ZT13 = 4（用数字太阳捕获）且且 ""
",0,1,0,0,0,0,0,0
"功能描述：动量轮喷气卸载进入和退出条件计算。
",0,1,0,0,0,0,0,0
"软件需求名称：推进系统操作 
需求类别：其他 
软件需求描述：对自锁阀、推力器进行操作。",0,0,1,0,0,0,0,0
"功能描述：使星体Z轴对日定向，星体偏航姿态为零，适当时重捕地球。
处理过程：
STEP1:若||〉0.8且FEA=0地球未捕获，则调用-Z轴对日定向，置BZ1=3全姿态捕获对日定向姿态模式。
STEP2:若〉-0.8且FEA=0地球未捕获，则根据BZ5显示的红外有效状态和红外实际的有效情况，计算，。计算公式见（2）。
STEP3:若||≤0.8且FEA=0地球未捕获，则，BZ1 = 4重捕地球转三轴稳定运行，调用Z轴对日定向。若，则FPA = A偏航捕获成功。
STEP4:若FPA = A，FEA = 0，则FEA = 5地球初捕完成，。
STEP5:若FEA = 5，则{调用姿态予估器(1)，调用轨控段喷气姿态控制，FSA = 0，FPA = 0；若，则FEA = A地球捕获成功，FSA = 0，FPA = 0，FSY = ；若ZT2 = 2，ZT1 = 4，则调用飞轮动量保持控制及飞轮启动}。",0,1,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器；并记录喷气时间和次数等。
",0,0,0,1,0,0,0,0
"软件需求名称：内存下传 
需求类别：其他 
软件需求描述：依据指令下传指定内存数据。",0,0,0,1,0,0,0,0
"软件需求名称：动量轮使用及通信（5m不配置） 
需求类别：其他 
软件需求描述：与动量轮通信，输出本周期电压。采集动量轮电源状态、转速、模拟量等信息。
处理：
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
动量轮初始化|FREQ57|动量轮初始化|B|2
动量轮数据采集|FREQ58|动量轮数据采集|B|3
通信(DA输出、脉冲输入)|FREQ59|通信(DA输出、脉冲输入)|B|4
数据解包与转换|FREQ60|数据解包与转换|B|
",0,0,1,0,0,0,0,0
功能描述：对弦宽、基准与给定的范围进行比较，同时根据太阳星历输出进行见太阳判断，确定红外输出的有效性。,0,1,0,0,0,0,0,0
"功能描述：实时计算卫星轨道参数及太阳方位，太阳敏感器理论输出。
处理：同用户需求的4.2。为防止t-t0过大导致系统切机，在轨道计算中增加时间超差不调用轨道计算，仅外推轨道幅角；太阳星历的计算仍然调用。
STEP1：计算卫星轨道根数。计算公式见4.2(1)；
STEP2：计算太阳轨道和太阳敏感器理论输出，其中岁差补偿公式有更改，Cbo的计算公式改用红外定姿姿态。计算公式见4.2(2)；
STEP3：若FlagIresOrbSun=0，则FHSL=FHSR=1左右红外都不见太阳。FlagIresOrbSun是注入内存修改变量，若注入修改令FlagIresOrbSun=1，则引入红外软件见太阳保护。
STEP4：若计算的轨道半径r和相差以上，或计算的轨道角速度和0.001108rad/s相差0.00008以上，则判定轨道计算偏差太大，置BZ2=4，同时置r=6871，=0.001108，。",0,1,0,0,0,0,0,0
"功能描述：
  应急软件初始化功能在软件上电或复位时调用，完成应急软件相关变量的初始化工作和硬件初始化。
处理： 完成80C32E处理器初始化、软件变量初始化、ASIC芯片初始化、1553B初始化，初始化流程的前后顺序可适当调整。
（1）80C32E处理器初始化：
初始化项目|寄存器名|初始值|说明
中断使能寄存器|IE|0x00|关闭中断。
计时器控制寄存器|TCON|0x05|外部中断0、1触发方式设置为下降沿触发。
计时器模式寄存器|TMOD|0x61|定时器1工作模式为2：自动装入TL1计数（8位）;定时器0工作模式为1: 16位定时器
定时器1初值|""TH1
TL1""|""0x00
0x00""|计数器（定时器）1从0开始进行计数，计数到256时溢出，触发计数器1中断，从而得到128ms
中断优先级寄存器|IP|0x01|中断优先级设置:全帧遥测数据接口帧同步中断为高优先级, 其余低优先级
P1口|P1_4|1|选择主份TM
P1口|P1_0|1|清狗电平
内部RAM|0x00~0xFF|0x00|上电后将内部RAM初始化为0

（2）软件变量初始化
软件变量初始化时，先将32KB外部RAM初始化为0，之后将非零变量显示初始化。帆板初始状态为正向复位，部件状态为不加电，推力器采用A分支，部件故障诊断不允许。
（3）ASIC芯片初始化
按照任务书、以及硬件技术说明书对ASIC芯片进行初始化，主要涉及GPIO口、GC计数器、GT定时器，同步串口等。
（4）1553B初始化
详见5.2.9.1节 FReq-9。
初始化完成后，允许总中断、T1(128ms)定时器中断、外部中断0，并启动T1。",1,0,0,0,0,0,0,0
功能描述：红外数据处理。,0,0,0,0,0,1,0,0
"功能描述：根据陀螺输入预估卫星对地姿态。
",0,0,0,1,0,0,0,0
功能模式：姿态机动的初始化计算。,0,1,0,0,0,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档|备注
FREQ41|太敏初始化|太敏协议|B
FREQ42|太敏数据采集|任务书、太敏协议|A
FREQ43|数据解包与转换|数太协议|A
FREQ44|太敏数据有效性判断|任务书|A
FREQ45|太敏故障重构|任务书|A
",0,0,0,0,0,1,0,0
"功能描述：按指令值，控制星体三轴角速率。
处理：同用户需求的
（1）计算得到用于控制角速度偏差，计算公式见（1）；
（2）进行各轴喷气状态的设置，当ZT43[4]=1允许陀螺自主加电且FlagGyroAdd=1正在给陀螺加电时，设置===0，计算公式见（2）；
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令
（4）对是否转无控模式的计数值FWM进行处理：首先将FWM限幅到1和7E之间；然后判断是否满足下列条件之一，如果满足则FWM减1，否则FWM加1
三轴惯性角速度，的最大值大于0.0116弧度/秒",0,1,0,0,0,0,0,0
"功能描述：确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号的选取。
处理：同用户需求的5.1。
——5.1（2）；;",0,0,0,1,0,0,0,0
功能描述：利用星敏感器B的测量，修正姿态四元数与估计角速度。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|各种状态数据|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|喷气脉宽、MW控制电压和磁力矩器控制脉宽|控制指令消息的输出|根据通讯协议，将计算得到的控制数据转换为消息需要的格式并输出。
|MW数据的采集与处理|FREQ1.8.4|""ACU的MW数据采集指令
""|MW的角动量|在通讯允许的条件下，每周期向ACU RT发MW数据采集指令，获得ACU数据并处理成对应的MW的角动量。
|部件加断电指令的处理|FREQ1.8.5|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.6|保存CCU的重要数据|接收CCU的重要数据|AOCC每三个控制周期将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.7|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|FREQ1.8.8|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.9|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.10||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令
",0,0,0,0,0,1,0,0
"功能描述：仅利用星敏感器A、B的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压，。,0,1,0,0,0,0,0,0
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理：
编码|相应的处理
28H|发送内存的数据区指针复位
",0,0,0,0,0,0,1,0
"功能描述：使用星敏感器C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：搜索地球，直到红外有地球信息。
",0,1,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件1553B初始化、变量的初始化
处理：
进行1553B初始化，处理过程见的OBDH初始化功能
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0
"功能描述：利用加速度计数据诊断加速度计部件状态
",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,0,0,1,0,0,0,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：OBC在CAN总线中断中接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,1
功能描述：帆板未展开模式初始化,0,1,0,0,0,0,0,0
"功能描述：利用磁强计定姿数据进行卫星姿态捕获，恢复正常姿态。
",0,1,0,0,0,0,0,0
"功能描述：使星体-Z轴捕获太阳，并保持偏置10度的对日定向。
输入：， 陀螺数据处理的输出，；控制周期 (量纲：秒)；
		模拟太阳敏感器状态，LSS输出数据
		模拟太阳敏感器输出： (量纲：弧度)
		计时器",0,1,0,0,0,0,0,0
"功能描述：地球-地球全姿态捕获模式捕获过程

说明：地地全姿态捕获分五个步骤，其中速率阻尼和太地相同",0,0,0,1,0,0,0,0
功能描述：由平衡方程方法进行陀螺的故障检测。,0,1,0,0,0,0,0,0
"功能描述：使星体-Z轴捕获太阳。
",0,1,0,0,0,0,0,0
"功能描述：在红外太阳定姿方式下计算四元数，在其余定姿方式下计算欧拉角。
",0,1,0,0,0,0,0,0
"功能描述：接收对应秒脉冲的整秒时刻
处理： 将接收对应秒脉冲的整秒时刻存储地址中内容解包成对应秒脉冲的整秒时刻的数据格式。",0,0,0,0,0,0,1,0
"软件需求名称：初始化 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。
调用条件：上电/复位。
处理：依据“用户需求”、“任务书”、“上行注入”对非0变量进行初始化。 ",1,0,0,0,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。。为保证帆板LTU线路归零指令的成功执行，要求应用软件连续3个周期对帆板LTU线路发送归零指令。",0,0,0,0,0,1,0,0
功能描述：秒脉冲信号处理。,0,0,0,1,0,0,0,0
"功能描述：对磁力矩器电压一阶滤波。
",0,1,0,0,0,0,0,0
"功能描述：修正光行差量的计算。
处理：同用户需求的4.13。
STEP1：计算",0,1,0,0,0,0,0,0
功能描述：主动段模式控制,0,1,0,0,0,0,0,0
功能描述：将GPS轨道确定参数转换成控制系统中太阳星历和地磁场计算所需的19个轨道参数,0,1,0,0,0,0,0,0
"功能描述：完成陀螺判断和处理功能（功能编号：FReq-14）。
处理：陀螺故障判断与处理逻辑，进行陀螺饱和故障、陀螺输出常值故障诊断、陀螺跳数故障、控制量与角速度增量不匹配的故障诊断。其中陀螺常值故障诊断由以前的角速度前后周期绝对值之差累计，变更为：角速度前后周期之差累计。并且陀螺平衡方程满足时，增加清相关计数器的可靠性操作。具体处理逻辑详见任务书 中的5.4.5.8.1节。",0,1,0,0,0,0,0,0
"功能描述：内总线指令处理
处理：
内总线指令设置、控制等操作。",0,0,0,0,0,1,0,0
"1）上电/复位软件初始化
功能描述：上电/复位软件初始化
2）取回重要数据初始化
功能描述：取回重要数据初始化
输入：重要数据的陀螺引入标志、推力器组件、数字太阳标志
输出：陀螺引入标志、推力器组件标志
3）未取回重要数据初始化
功能描述：未取回重要数据初始化
输出：陀螺引入标志、推力器组件标志",1,0,0,0,0,0,0,0
"功能描述：发送和接收时间差值
调用条件：有发送和接收时间差值命令字时
周期：CTU复位时
输入：星时，计数值
输出：时间差值
处理：具体处理要求见与外总线通讯协议。",0,0,0,0,0,0,0,1
功能描述：将F_CMGValid指定工作的CMG框架角保持在标称框架位置。,0,1,0,0,0,0,0,0
"功能描述：陀螺数据处理。
处理：
每个惯性姿态敏感器组件中，单个陀螺输出包括1个加速脉冲信号和1个减速脉冲信号。每个信号由1个20位计数器完成对信号的计数。计数器采用加计数方式，当脉冲数超过1048575时，计数器清零，重新计数，应用软件判断计数器溢出，数据为无符号数据。
本周期陀螺n（n＝1～6）加（减）速脉冲计数值(个)=（本周期加（减）脉冲数 － 上周期加（减）脉冲数）；
陀螺n角度增量( º)＝ （陀螺n加速脉冲计数值 – 陀螺n减速脉冲计数值）×陀螺脉冲当量。
对于陀螺n的脉冲数N需要分段处理：要求将每个陀螺量程范围-2.8º/s ~ +2.8º/s分为5段，每段使用不同的标度因数K，分段情况具体见任务书4.1.5.3节要求，当脉冲数超出范围时，则使用±2.8º/s时的标度因数",0,0,0,0,0,1,0,0
"功能描述：若本周期角动量与上一周期角动量之差（绝对值）大于0.15Nms，则用上一周期角动量作为本周期输入，角动量变化取0。若连续大于三次或本周期与上一周期角动量之差（绝对值）小于0.15Nms，则以本周期角动量为真值，角动量变化取
输入：实测飞轮角动量，
      上周期角动量数据，
      剔野判断计数器N_WheelPick_i (i=x,y,z,s)",0,1,0,0,0,0,0,0
功能：利用星敏感器A 、C的测量，修正姿态四元数与估计角速度。,0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的红外太阳姿态滤波参数,0,0,0,0,0,0,1,0
光行差修正的初始设置为：AOCC应用软件对APS星敏信息进行补偿计算，不向星敏发送相对J2000的时间和速度。,0,0,0,0,0,1,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态四元数。
",0,0,0,1,0,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。                                                                                                                                                                                                                                                                                                                                                                                                                              输入：上周期姿态角估值
陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出：",0,1,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：动量轮启动的程控指令
      实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：， ，",0,0,0,1,0,0,0,0
"功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。
处理：
STEP1:滚动通道滤波；
STEP2:俯仰通道滤波；
STEP3:偏航通道滤波。",0,1,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件1553B初始化、变量的初始化                                                                                                                                                                                                                                                                                                                                                                                                             处理：
进行1553B初始化，处理过程见的OBDH初始化功能
设置3个星敏的 RTS信号为无效
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0
"功能描述：利用红外数据自主诊断红外部件状态
",0,1,0,0,0,0,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输出：数字太阳敏感器输出；模拟太阳敏感器输出；模拟式太阳敏感器视场码；0-1式太阳敏感器的信号（0或1）；数字太阳敏感器视场码。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得数字太阳、模拟太阳、0-1太阳数据；每个控制周期根据DSSLTUSeltFlag确定进行通讯的太阳LTU，发送取数指令，具体如下表所示：
DSSLTUSeltFlag |进行通讯的太阳LTU|发送的取数指令
01H|太阳LTU1|43H
02H|太阳LTU2|43H
其它|根据LTU故障诊断的结果决定太阳LTU的选取。初始状态为太阳LTU1|43H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，具体参见LTU通讯协议件。
（3）太阳LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
"功能描述：采集28路数字太阳粗码、细码。
处理：
采集方法：连续采集28路，采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,1,0,0
"功能：利用估计的四元数转换姿态角，送给星敏感器的四元数。
",0,1,0,0,0,0,0,0
功能描述：地面站赤经赤纬计算。,0,1,0,0,0,0,0,0
"功能描述：根据红外输出，估计卫星姿态与陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：星上实时计算太阳轨道、方位与其它参数
说明：计算目标器GPS时，将输入、输出改为目标器的相应变量。",0,1,0,0,0,0,0,0
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""",1,0,0,0,0,0,0,0
"功能描述：与帆板通信，控制帆板并获得帆板状态数据。
处理：
见通信协议。
功能编号|功能|引用文档
FREQ70|初始化|中心控制单元与双轴帆板驱动线路通信协议
FREQ71|帆板使用要求|任务书、帆板协议
FREQ72|通信(串口)|任务书、帆板协议
FREQ73|通信故障处理|任务书
FREQ74|数据解包与转换|帆板协议
FREQ75|帆板数据有效性判断、处理|任务书
FREQ76|帆板模拟量采集、处理|任务书
FREQ77|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
功能描述：星敏感器数据处理,0,0,0,0,0,1,0,0
"功能描述：计算偏置动量模式下滚动/偏航轴进动控制及章动阻尼所需的磁力矩器脉宽。                                                                                                                                                                                                                                                                                                                                                           输入：
Y轴角动量偏差    
滚动角，滚动角速度，偏航角，偏航角速度
地磁场强度（T） ，及标量B，星下点经纬度L,
输出：磁力矩器工作脉宽，",0,1,0,0,0,0,0,0
"通讯串口
04H|波特率寄存器|RW|""波特率寄存器低位：0x04（115200）
0x18（19200）""
08H|波特率寄存器|RW|波特率寄存器高位：0x00
CAN总线初始化
寄存器名称|初始化内容|初始化意义
""CAN_ADDR        
(CAN总线地址)""|无。|无说明。
""控制寄存器
(Control Register)
""|0x07|""D7D6D5：保留。
D4：超载（接收设备不能按数据发送速率接收数据而造成的数据丢失）中断使能。
高：开放。低：禁止
D3：错误中断使能。
高：开放。低：禁止
D2：发送中断使能。
高：开放。低：禁止
D1：接收中断使能。
高：开放。低：禁止
D0：复位模式。
在初始化的时候，复位模式位置1，才可以进行初始化设置。""
命令寄存器(Command register)|0x=00001100|""D7D6D5：保留。必须。
D4：进入睡眠状态。
高：睡眠 。低：睡眠唤醒。
D3：清除超载状态。不产生超载中断。
高：清除。低：无动作。
D2：释放接收缓冲器。（读接收缓存器内容后，释放缓存器，以便其他报文立即可用）。
高：释放。低：无动作。
D1：夭折发送。
D0：发送请求。
高：报文即将发送。低：无动作。""
""验收代码寄存器
(Acceptance 
Code Register)""|0xa7=10100111|""当通过验收测试的报文被接收，且若存在空的接收缓存器，则各自的描述符和数据场被顺序存贮在空的缓存器中，在不存在空的接收缓存器的情况下，数据超载位被置位高(超载)，当完整的报文被正确接收，将出现下列操作：
接收缓存器状态位被置为高(满)
若接收中断开放位被置为高(开放)，接收中断被置为高(置位)
验收码位(AC.7~AC.0)和报文标识符的最高8位(ID.10~ID.3)必须等于由验收屏蔽位必须满足""
""验收屏蔽寄存器
((Acceptance 
Mask Register))""|0xf8|最后三位相关。
总线时序寄存器0(Bus Timing Register 0)|0x00|""总线时序寄存器的内容决定波特率预分频器(BRP)和同步跳转宽度(SJW)的数值。

通过总线定时器的内容，将波特率预分频器设置为2，即将输入的系统时钟二分频，由于输入的系统时钟已经是将计算机晶体频率14.7456MHz二分频，即7.3728MHz。所以这个时候时钟为3.6864 MHz。""
总线时序寄存器1(Bus Timing Register 1)|0x18|""采样（SAM）=1总线采样1次。
TSEG1和TSEG2确定每位周期的时钟周期数目和采样点位置：

由于一位周期是由

而

波特率＝""
""时钟分频器
(Clock Divider
register)""|0x40|""D7:CAN模式。
0：基本模式。
D5:1(旁路输入比较器，仅在复位模式下起作用)。""
""OCR
(output Control)""|0x|

在完成上述初始化后，要再次初始化控制寄存器。将最低位初始化为0。",1,0,0,0,0,0,0,0
"功能描述：接收AOCC系统注入参数
处理：
当收到接收遥控注入结束标识消息后，将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。只有当某个块类型的所有数据都收到，且每块数据的校验和都正确时，才能使用此种类型的注入数据。注入的数据具体见上行注入文件。需要注意的是：地面注入ZT9时：若ZT9中为1的个数小于3个，则不改变星上ZT9的取值；应用软件不响应ZT1=2、ZT1=6、ZT1=8的注入指令。",0,0,0,0,0,0,1,0
"功能描述：处理星务返回的重要数据
处理：解包并更新重要数据",0,0,0,0,0,0,1,0
"功能描述：模式7切换方式。
处理：
若或者收到轨控结束指令，关姿控发动机，置WorkMode=5；if(lipse=0){WorkModeT=4；}
else{WorkModeT=6；}；
若FailureFlag=2，若RollMnvStyleFlag＝0且PitchMnvStyleFlag＝0，置WorkMode=6，否则(WorkMode=5；WorkModeT=6，；)；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：满足以上任意条件退出时，置tФi、tθi、t pi 为10年后的大星时，
RollMnvStyleFlag＝0、PitchMnvStyleFlag＝0，。",0,1,0,0,0,0,0,0
功能描述：对数字太阳有效性进行判断。,0,1,0,0,0,0,0,0
"功能描述：利用星敏感器C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：计算地磁场强度。,0,1,0,0,0,0,0,0
功能描述：根据从0.25秒/1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。,0,1,0,0,0,0,0,0
功能描述：对自锁阀进行开关处理。,0,0,1,0,0,0,0,0
功能描述：星敏感器数据处理，安装偏差估计。,0,1,0,0,0,0,0,0
"功能描述：根据地面指令ZT3,ZT42,ZT43，给无故障陀螺自主加电。
处理：同用户需求的。
（1）可以进行陀螺自主加电的条件：①或②
①{6个陀螺中至多只有1个有故障，即姿控数据块中ZT42的低4位和ZT43的低2位中至多只有1位等于1}且{加电陀螺不足5个，即姿控数据块中ZT15的低4位和ZT16的低2位中至多只有4位等于1}；
②{ZT3=A，即“星敏无陀螺定姿，且接入控制回路，整星零动量控制方式”或ZT3=B或ZT3=F}且{6个陀螺中至少有3个正常，即姿控数据块中ZT42的低4位和ZT43的低2位中至少有3位等于1}。
（2）陀螺自主加电的步骤：
STEP1:若满足条件(1)②，则根据ZT42,ZT43按陀螺1至6的升序开启3个正常陀螺，设置ZT15,ZT16相应位为1，并设置BZ3=ZT15，BZ4=ZT16；否则若满足(1)①，则{若ZT42,ZT43显示6个陀螺都正常，则开陀螺12356；否则根据ZT42,ZT43开启5个正常的陀螺}，设置ZT15,ZT16相应位为1。
STEP2:加电后设置陀螺正在加电标志FlagGyroAdd=1（正在加电）。令工作陀螺计分为0FH。",0,1,0,0,0,0,0,0
"功能描述：与CMG通信，控制CMG并获得CMG数据。
处理：
功能编号|功能|引用文档
FREQ69|初始化|与CMG通讯协议
FREQ70|CMG使用要求|任务书
FREQ71|通信(串口)|与CMG通讯协议
FREQ72|通信故障处理|任务书
FREQ73|数据解包与转换|与CMG通讯协议
FREQ74|帆板数据有效性判断、处理|任务书
FREQ75|帆板模拟量采集、处理|任务书
FREQ76|部件在轨转发（在轨修改）|任务书
",0,0,1,0,0,0,0,0
将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据和定轨数据的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。,0,0,0,0,0,0,1,0
根据任务要求，应用软件进行LTU初始化、1553B初始化、调用系统软件的StartStarTimer、变量的初始化。,1,0,0,0,0,0,0,0
"功能描述：CAN通信上行/下行数据的组帧和解包。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：星务接收、星务发送、快帧遥测1打包、快帧遥测2打包、快帧遥测3打包、快帧遥测4打包、快帧遥测5打包、姿态广播、星敏广播、陀螺广播、重要数据打包、上行:数据指令响应处理、上行:固定地址注入解包、上行:可变地址注入解包、上行:轨道注入解包、上行:程序注入、上行:内存下卸指令注入、上行:任务块、上行:地面站、重要数据返回解包、GPS定位广播解包、整星广播对时解包、GPS高精度秒脉冲对时广播解包、CAN总线使用要求",0,0,0,1,0,0,0,0
"功能描述：接收遥控固定参数注入块的系统安全模式姿态控制器系数
处理：
调整安全模式偏航角偏差限幅的初装值。",0,0,0,0,0,0,1,0
功能描述：接收遥控固定参数注入块的外1533B发送子地址内存管理区,0,0,0,0,0,0,1,0
"功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。
输入：前两个周期、上个周期得到的，
红外处理数据，
红外常值偏差估值，（量纲：弧度）
红外数据有效性标志F_IresValid(由有效性判据给出)
红外工作周期（=0.75s）
",0,1,0,0,0,0,0,0
"功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。
",0,1,0,0,0,0,0,0
功能描述：对弦宽、基准与给定的范围进行比较，确定红外故障。若两红外数据均有效，则还可根据本周期与上周期红外姿态角确定红外故障。,0,1,0,0,0,0,0,0
"功能描述：使用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：当星敏感器需要粗姿态时，利用卫星的姿态估值，计算星敏感器的测量系在惯性坐标系中的四元数表示。
",0,1,0,0,0,0,0,0
功能描述：检测工作中的动量轮的故障并设置WheelState。,0,1,0,0,0,0,0,0
"功能描述：
  软件初始化结束后，开始进行各控制部件的初始化状态设置。
处理：（部件的开关 根据部件当前的加电状态、健康字进行，具体开关逻辑如下：） 
表5-1 程控流程
Ts周期（128ms）|操作内容|说明
""第0～78 Ts
(10s)""|""不控（10s）；
读取各部件加电状态及MRE重要数据；
判断ISU-C通讯状态：
累计健康次数大于等于5次，认为健康；否则为不健康；
说明：UPS健康字也在此期间读取，可进行滤波。""|""连续发送切换DPRU标志遥测数据；
等待DPRU通过1553B发送ISU-A、ISU-C的遥测数据；""
""第79～87Ts：
(1.024s)
""|""读取MRE重要数据(软件在程控期间读取2次即可)和模块加电状态：
发送SPE开关指令；
说明：为增加可靠性，软件中“发送SPE开关指令”操作2次。""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第88～198 Ts
(14.08s)""|""根据MRE重要数据和DPRU与当前份ISU-C通讯状态：（通过1553B总线向ISU-A发送下述指令）
开3+1S二浮陀螺X、Y、Z、S线路指令（无条件）；
2）开ISU-C指令（CIP）
（如果ISU-C通讯状态为不健康，则先关CIP-A/B，再根据MRE上CIP的健康状态，切换CIP）；""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第199～309 Ts：
(14.08s)""|""根据MRE重要数据和DPRU与当前份ISU-C通讯状态：（通过1553B总线向ISU-A发送下述指令）
开3+1S二浮陀螺X、Y、Z、S线路指令（无条件）；
2）开ISU-C指令（CIP）；
（如果ISU-C通讯状态为不健康，则先关CIP-A/B，再根据MRE上CIP的健康状态，切换CIP）；""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第310～419 Ts：
(14.08s)""|""根据MRE重要数据和ADIP、MPSDP、SADP的电源状态；（通过1553B总线向ISU-C发送下述指令）
开SADP指令；
开MPSDP指令；
说明：开SADP之前，先切换ADIP（根据供电关系）""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第420～529Ts：
(14.08s )""|""根据MRE重要数据和ADIP、MPSDP、SADP的电源状态；（通过1553B总线向ISU-C发送下述指令）
开SADP指令；
开MPSDP指令；
说明：开SADP之前，先切换ADIP（根据供电关系）""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第530～569Ts：
(5s)""|""根据MPSDP的电源状态；（通过1553B总线向ISU-C发送下述指令）
LV1/2开关指令；
MPSDP-A加电：开LV1；
MPSDP-B加电：开LV2；
双份加电：开LV1/2；
双份不加电：不操作""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；""
""第570～609s：
(5s)""|""根据MPSDP的电源状态；（通过1553B总线向ISU-C发送下述指令）
LV1/2开关指令；
MPSDP-A加电：开LV1；
MPSDP-B加电：开LV2；
双份加电：开LV1/2；
双份不加电：不操作""|""根据MRE板上健康字开部件的原则为：A份健康开A份，A份不健康开B份；
如果需要开启的部件已经开启，可不发指令；
""
第610～Ts：|空|
""第3910Ts：
（约500s）""|""置程控结束标志flgPCRun为TRUE；
模式初始化设置。""|参数设置

1）通用部件切换原则：A份健康开A份，A份不健康开B份；
2）MPSDP切换特殊原则：
      软件初始化5N推力器健康字时，是根据ISU-C送过来的5N推力器健康字来进行初始化；如果之后地面发送了设置5N推力器健康字遥控指令，则根据遥控指令来设置软件状态，同时将5N推力器健康字发送给ISU-C；
当两份MPSDP均健康时，根据5N推力器健康字状态：
如果两份健康字中有一份存在不健康的推力器，则开另一份；
如果两份健康字中均存在不健康的推力器，需要双份MPSDP加电。
3）MPSDP当班逻辑：
    MPSDP当班的逻辑在任务书的基础上进行适当完善：
如果两份健康字中均存在不健康的推力器，则A/B均当班；
单份加电，谁加电谁当班；
双分加电，默认A当班；	
若上电后双份均未加电，则按照MPSDP切换过程中开谁谁当班的原则。
4）ADIDP切换原则：
A份健康开A份，A份不健康开B份；
原则上不发ADIP关指令，如果双份均健康，则根据需要进行双份加电。
5）部件电源状态判断原则见任务书。
6）ISU-C二次电源供电：
ADIP-A供电给SADP-A、MPSDP-A、MPSDP-B；
ADIP-B供电给SADP-B、MPSDP-A、MPSDP-B；
7）程控期间，动量轮控制电压输出0V（数字量0x800）。",1,0,0,0,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令。
（2）向帆板LTU发完取数命令后，获得LTU返回数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。
（3）帆板LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
"功能描述：利用太阳敏感器信息，进行太阳捕获，对太阳定向
",0,1,0,0,0,0,0,0
"功能描述：采集GPS的状态信息和星敏同步信号
处理：（1）采集GPS状态寄存器转换为状态数据。
       （2）采集星敏同步信号作为计算星敏同步时刻的判据",0,0,0,0,0,1,0,0
"功能描述：模式6切换方式。
处理：
if() 置WorkMode=5；若，若，WorkModeT=6；
if() 置WorkMode=5；若，若，WorkModeT=6；
若且且 ，置WorkMode＝7；
if(且且且且AutoPermission=1) 置WorkMode=5；WorkModeT=4；；//阴影区进入阳照区自主转对日定向；可注入修改，初值为1；
if(且且且且且AtuoPermission=1) 置WorkMode=5；WorkModeT=4；；//南纬60度强制转对日定向，为纬度系数，可注入修改，该条件优先于下一个条件
if( 且且且) 置WorkMode=5；WorkModeT=6；；；//程控指令自主转对地姿态
收到星务的“对日定向” 指令，置WorkMode=5；WorkModeT=4；；；//成像任务完成后指令转入对日定向，并清除辐射定标目标角
收到星务的“辐射定标”指令，置WorkMode=5，WorkModeT=6，；//辐射定标模式，为注入的辐射定标目标角
若FailureFlag=1，置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,1,0,0,0,0,0,0
功能描述：AOCC收到CTU发来的“记录AOCC时间数据”消息后应在900ms内准备好AOCC 时间数据。CTU发出“记录AOCC时间数据”1s后读取该数据。,0,0,0,0,0,0,0,1
功能描述：启动飞轮或动量保持控制。,0,1,0,0,0,0,0,0
"功能描述：若AOCC与星敏感器通讯不成功，则记录星敏感器故障一次。若连续240次不成功，判断该星敏感器故障。若星敏感器连续1000次数据无效，需重新启动星敏感器。
",0,1,0,0,0,0,0,0
"功能描述：发送天线数据包
",0,0,0,1,0,0,0,0
"功能描述：接收GPS轨道板定位数据
处理：保存GPS轨道板定位数据，35V帆板电压遥测用于帆板故障检测。",0,0,0,0,0,0,1,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：，
输出：保持角动量所需电压，
      角动量偏差积分项：，",0,1,0,0,0,0,0,0
功能描述：发送控制对中继天线的控制角度。,0,0,1,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0 |主动段|FREQ52
1|入轨段控制|FREQ53
2|巡天观测模式|FREQ54
3|定点观测模式|FREQ55
4|小天区扫描模式|FREQ56
5|姿态机动|FREQ57
6|轨控|FREQ58
7|捕获太阳并对日定姿模式|FREQ59
8|帆板未展开|FREQ60
9|无控|FREQ61
10|应急模式|FREQ62

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制见用户需求的4。主要模式的姿态确定调用流程的功能点如下：
序号|功能编号|功能描述|用户需求中对应章节
|FREQ53.1|对日定向姿态确定调用流程|5.2.1.1
|FREQ54.1|巡天模式姿态确定调用流程|5.2.1.2
|FREQ55.1|定点观测模式姿态确定调用流程|5.2.1.3
|FREQ56.1|小天区扫描模式姿态确定调用流程|5.2.1.4
|FREQ57.1|姿态机动模式姿态确定调用流程|5.2.1.5
|FREQ58.1|轨控模式姿态确定调用流程|5.2.1.6
",0,1,0,0,0,0,0,0
"功能描述：在完成对日定向后，由地面指令转入地球捕获。通过红外和数字太阳敏感器定姿，消除卫星的偏航角。
输入：陀螺数据处理的输出 ，
数字太阳敏感器数据有效性标志F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出），数字太阳敏感器输出： （量纲：弧度）
红外地球敏感器数据有效性标志F_IresValid（由数据有效性判据给出）
上周期姿态角估值，
太阳星历的输出，
",0,1,0,0,0,0,0,0
功能描述：J2000年地心赤道惯性系中的速度增量计算,0,1,0,0,0,0,0,0
"功能描述：置卫星姿态无控，处于自由飞行状态。
",0,1,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|功能描述|功能编号
0|主动段模式控制|FREQ6.1
1|入轨段消初偏模式控制|FREQ6.2
2|正飞模式控制|FREQ6.3
3|大角度机动模式控制|FREQ6.4
4|正常运行模式控制|FREQ6.5
5|轨控模式控制|FREQ6.6
6|SAR未展开模式控制|FREQ6.7
7|帆板未展开模式控制|FREQ6.8
8|偏置动量控制模式控制|FREQ6.9
9|全姿态捕获模式控制|FREQ6.10
A|应急安全模式控制|FREQ6.11
B|停控模式控制|FREQ6.12

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断见用户需求的3.3。",0,1,0,0,0,0,0,0
功能描述：偏置动量处于力矩模式，根据滚动红外敏感器弦宽测量计算得到的滚动角，俯仰角的信息实现三轴姿态控制滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制。,0,1,0,0,0,0,0,0
功能描述：星上实时计算卫星轨道。,0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计角速度。
输入：星敏感器A、B修正新息，四元数、无陀螺时估计的角速度
输出：修正四元数、陀螺常漂
",0,1,0,0,0,0,0,0
"功能描述：选择通讯的星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输入：ZT6、inAPSLTUSeltFlag、星敏LTU返回的数据。
输出：星敏输出的四元数、相对时间和数据有效性标志。
处理：
（1）星敏共有两个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的星敏LTU发送取数指令。
（2）向选择的星敏LTU发送完取数指令后，获得星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,1,0,0
功能描述：三浮陀螺数据处理,0,0,0,0,0,1,0,0
"功能描述：置卫星姿态无控处于自由飞行
处理过程：过程如下：
STEP1：进行姿态预估（见用户需求），得到姿态角和角速度
STEP2：当ZT7为0、7、3、5时，发相应的帆板控制指令：
ZT7取值|处理
ZT7 = 0|发左右帆板转角均为0度的指令
ZT7 = 7|发左右帆板转角均为180度的指令
ZT7 = 3|发左为90度，右为 -90指令
ZT7 = 5|发左右均为90度指令

STEP3：关自锁阀LV-1，LV-2，LV-3，LV-4，关推力器J1，J2，… ，J16。
STEP4：如果ZT7 ≥ 8，则每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值发相应的指令一次
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

STEP5：置六个动量轮的电压为0",0,1,0,0,0,0,0,0
"功能描述：转换动量轮脉冲得到轮子角动量。
处理：
控制系统配置4Nms平台动量轮4个（X、Y、Z、S）。平台动量轮每转18个脉冲，转/分钟对应4Nms。",0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|CMG 1数据的采集与处理|FREQ1.9.1|""CMG 1
1553B取数指令
""|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 2数据的采集与处理|FREQ1.9.2|""CMG 2
1553B取数指令
""|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 3数据的采集与处理|FREQ1.3.3|""CMG 3
1553B取数指令
""|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 4数据的采集与处理|FREQ1.9.4|""CMG 4
1553B取数指令
""|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 5数据的采集与处理|FREQ1.9.5|""CMG 5
1553B取数指令
""|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 控制指令的输出处理|FREQ1.9.6|计算得到CMG的控制数据|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
|CMG的程序注入修改|FREQ1.9.8|从OBDH收到的CMG需修改程序内容|CMG需修改程序内容|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
|CMG的内存下传|FREQ1.9.9|从OBDH收到的CMG内存下传设置指令|内存下传设置指令|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。
",0,0,0,0,0,1,0,0
"功能描述：各模式初始化
序号|功能点编号|功能描述|说明
|FREQ3.4.2.1|等待段初始化|《用户需求》4.1.1【初始化】
|FREQ3.4.2.2|太阳定向模式初始化|《用户需求》4.1.2【初始化】
|FREQ3.4.2.3|恒星定向2初始化|《用户需求》4.1.3【初始化】
|FREQ3.4.2.4|惯性调姿模式初始化|《用户需求》4.1.4【初始化】
|FREQ3.4.2.5|恒星定向4初始化|《用户需求》4.1.5【初始化】
|FREQ3.4.2.6|轨控定向模式初始化|《用户需求》4.1.6【初始化】
|FREQ3.4.2.7|着陆准备模式初始化|《用户需求》4.1.7【初始化】
|FREQ3.4.2.8|主减速模式初始化|《用户需求》4.1.8【初始化】
|FREQ3.4.2.9|快速调整模式初始化|《用户需求》4.1.9【初始化】
|FREQ3.4.2.10|接近下降模式初始化|《用户需求》4.1.10【初始化】
|FREQ3.4.2.11|悬停模式初始化|《用户需求》4.1.11【初始化】
|FREQ3.4.2.12|避障模式初始化|《用户需求》4.1.12【初始化】
|FREQ3.4.2.13|缓速下降模式初始化|《用户需求》4.1.13【初始化】
|FREQ3.4.2.14|自主定位模式初始化|《用户需求》4.1.14【初始化】
|FREQ3.4.2.15|起飞准备模式初始化|《用户需求》4.1.15【初始化】
|FREQ3.4.2.16|垂直上升模式初始化|《用户需求》4.1.16【初始化】
|FREQ3.4.2.17|上升调姿模式初始化|《用户需求》4.1.17【初始化】
|FREQ3.4.2.18|轨道入射模式初始化|《用户需求》4.1.18【初始化】
|FREQ3.4.2.19|星光环月模式初始化|《用户需求》4.1.19【初始化】
|FREQ3.4.2.20|速率阻尼模式初始化|《用户需求》4.1.20【初始化】
|FREQ3.4.2.21|无控模式初始化|《用户需求》4.1.21【初始化】
",0,1,0,0,0,0,0,0
"功能编号：FREQ42
功能描述：为三轴姿态喷气控制选择喷管；并记录喷气时间等。
",0,1,0,0,0,0,0,0
"功能描述：接收内存数据块号
处理：将接收内存数据块号存储地址中内容的解包成内存数据块号，并将需下传的内容放到发送AOCC内存数据指定内存内容地址空间中。此处理在中断中进行。",0,0,0,0,0,0,1,0
"功能描述：接收OBDH时间
处理：按接收OBDH时间命令存储地址中内容的数据格式处理成星时的数据格式。此处理在中断中进行。",0,0,0,0,0,0,1,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ78|初始化|小卫星统一化平台中心控制单元通讯协议：地检协议
FREQ79|地检使用要求|任务书、地检协议
FREQ80|通信(串口)|任务书、地检协议
FREQ81|通信故障处理|任务书
FREQ82|数据解包与转换|地检协议
FREQ83|地检数据有效性判断、处理|任务书
FREQ84|地检模拟量采集、处理|预留
FREQ85|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
功能描述：检测推力器的泄露，必要时做相应的主备份切换。,0,1,0,0,0,0,0,0
功能描述：发送红外太阳敏感器数据包,0,0,0,0,0,0,0,1
当需要请求服务时，将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。,0,0,0,0,1,0,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理：包括CPU内部星时时钟和CPU外部星时时钟的星时采集计算与校时。。
（1）CPU外部星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期星时锁存寄存器中读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU外部星时时钟星时校时包括OBDH校时和GPS高精度校时两种校时方式：
OBDH校时：也分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；
GPS高精度校时。
OBDH星时校时为系统默认使用的校时方式。GPS秒脉冲高精度时间是否引入系统由注入指令执行控制：若注入指令表示“使用GPS秒脉冲高精度校时时间”，则当满足GPS秒脉冲高精度校时条件时AOCC应用软件仅进行GPS秒脉冲高精度校时时间的计算，系统使用该时间。GPS秒脉冲高精度方式优先级高于OBDH星时校时，当GPS秒脉冲校时时不再进行OBDH星时校时。如果连续超过1分钟均不满足GPS秒脉冲高精度校时条件，则可进行OBDH星时校时。一旦再满足GPS秒脉冲高精度校时条件则继续采用GPS秒脉冲高精度校时。其中GPS秒脉冲高精度校时条件及校时计算具体见任务书中规定。
（2）CPU内部星时时钟的星时采集计算与校时
CPU内部星时时钟星时计算方法。同CPU外部星时时钟星时计算；CPU内部星时时钟星时校时只包括OBDH校时：分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时。
星时的选取
根据注入的姿控数据块2中的CPU星时时钟选用标志来实现内部星时时钟和外部星时时钟的切换，默认为CPU外部星时时钟
均匀校时
内部和外部时钟星时计算中在计算完本周期绝对星时后增加每周期修正量，并在计算前先将它限幅到1毫秒，每周期的修正量初始为0，通过内存修改来修改该修正量。",0,0,0,0,1,0,0,0
"功能描述：
卫星异常情况进入停控模式的处理（功能编号：FReq-17）。
处理：
软件设置停控方式字（为三取二变量，可与太阳捕获方式共用），当判断为停控方式时，停止模式判断和处理，停止控制器计算，停止故障判断和处理，将5N推力器输出和开关脉冲输出口清零；
一旦软件进入停控方式，将无法自主恢复太阳捕获的控制方式。此时，如果想恢复正常控制，在确认部件工作状态后，地面遥控操作；
速率阻尼后，三轴中任意一轴角速度持续625个控制周期（80s）大于2.0°/s，转入停控方式，其中任意一轴角速度大于2.0°/s，实现为三轴角度绝对值的最大值大于2.0°/s； ",0,1,0,0,0,0,0,0
功能描述：对二次电源使用、故障切换。,0,0,1,0,0,0,0,0
"功能描述：根据红外输入，计算姿态偏差、弦宽误差估计与量测新息。
",0,1,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
部件故障诊断|对部件进行故障诊断
陀螺故障诊断|由平衡方程方法、星敏感器数据等对陀螺进行故障检测
CMG故障诊断|根据CMG输出数据和理论数据进行CMG故障检测
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止。
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式4、6、7的系统故障诊断|在模式4、6、7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理；BAPTAE进最小模式且不能自主切换后需要提“BAPTA故障”
红外通讯故障诊断|红外通讯故障诊断及处理
大量程陀螺通讯故障诊断|大量程通讯故障诊断及处理
CMG通讯故障诊断|CMG通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
CMG在轨跑合|自主跑合功能包含CMG跑合的执行序列、必要的安全处置策略，以及数据统计功能。",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。CCU应用软件取数消息与同步消息的发送时间间隔大于3ms
|红外2数据的采集与处理|FREQ1.3.2|""红外2
LTU取数指令""|红外2的数据|在通讯允许的条件下（红外2的当班标志为1），向红外2 LTU发取数指令，获得红外2数据并处理成对应的数据。
",0,0,0,0,0,1,0,0
"功能描述：轨控姿态机动模式控制
",0,1,0,0,0,0,0,0
"功能描述：使星体Z轴捕获太阳。
处理过程：
STEP1:帆板归零
STEP2:若FSA=0太阳未捕获且ZT13≠4不用数字太阳捕获，则使用0-1太阳敏感器进行捕获。公式见（2）
STEP3:若FSA=0太阳未捕获且ZT13=4用数字太阳捕获，则使用数字太阳敏感器进行捕获，直至两个数字太阳都见太阳，置FSA=5初捕获。公式见（3）
STEP4：当ZT43[4]=1允许陀螺自主加电且FlagGyroAdd=1正在给陀螺加电时，设置FSA=0。若FSA=0，则调用速率喷气控制。
STEP5:若ZT2=2飞轮整星零动量控制模式，且工作飞轮的分数都不小于12分，则调用飞轮动量保持控制及飞轮启动。
STRP6:若ZT2≠2或出现工作飞轮的分数小于12分，则6个飞轮的输出电压都置0。",0,0,0,0,1,0,0,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得DSS、ASS、LSS数据；根据ZT14（2）（1）确定进行通讯的太阳LTU，发送取数指令，具体如下表所示
ZT14(2)(1)的值|进行通讯的太阳LTU|发送的取数指令
01|与之前通讯太阳LTU1或太阳LTU2进行通讯|""33H或
43H""
10|与之前通讯太阳LTU1或太阳LTU2进行通讯|""33H或
43H""
00或11|根据LTU故障诊断的结果决定太阳LTU的选取。初始状态为太阳LTU1|33H或43H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的12个字节数据，将数据根据LTU通讯协议转换，、L11~L15,L21~25。
（3）太阳LTU数据采集过程中的故障处理见本文的.1。",0,0,0,0,0,1,0,0
"功能描述：分支号与喷管对应选择

处理：
序号|分支状态|姿控分支标志|姿控发动机|轨控分支标志|轨控发动机
1|A、B、C分支都好|A|A1|BC|B1
1|A、B、C分支都好|A|A2|BC|B2+B3+C2+C3
1|A、B、C分支都好|A|A3|BC|B5
1|A、B、C分支都好|A|A4|BC|B4
1|A、B、C分支都好|A|A6|BC|B6+B7+C6+C7
1|A、B、C分支都好|A|A5|BC|B8+B9+C8+C9
2|A、B分支好|A|同A分支|B|同BC
2|A、B分支好|A|同A分支|B|B2+B3
2|A、B分支好|A|同A分支|B|同BC分支
2|A、B分支好|A|同A分支|B|同BC分支
2|A、B分支好|A|同A分支|B|B6+B7
2|A、B分支好|A|同A分支|B|B8+B9
3|A、C好|A|同上|C|C1+C10
3|A、C好|A|同上|C|C2+C3
3|A、C好|A|同上|C|C5
3|A、C好|A|同上|C|C4
3|A、C好|A|同上|C|C6+C7
3|A、C好|A|同上|C|C8+C9
4|B、C好|C|C6+C9|B|同B分支
4|B、C好|C|C7+C8|B|同B分支
4|B、C好|C|C1|B|同B分支
4|B、C好|C|C10|B|同B分支
4|B、C好|C|C2|B|同B分支
4|B、C好|C|C3|B|同B分支
5|A好|A|同A分支|0|无效
6|B好|0|无效|B|同B分支
7|C好|C|同C分支|0|无效",0,1,0,0,0,0,0,0
"功能描述：根据红外输出，估计卫星姿态与陀螺漂移。
输入： 姿态估计值
红外测量的新息
陀螺漂移估值
标志F_IresUsed",0,0,0,0,1,0,0,0
"功能描述：使用星敏感器B的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：陀螺数据处理。
处理：
每个惯性姿态敏感器组件中，单个陀螺输出包括1个加速脉冲信号和1个减速脉冲信号。每个信号由1个19位计数器完成对信号的计数。计数器采用加计数方式，当脉冲数超过524287时，计数器清零，重新计数，应用软件判断计数器溢出，使用说明见表3-7。数据为无符号数据。
本周期陀螺n（n＝1～6）加（减）速脉冲计数值(个)=（本周期加（减）脉冲数 － 上周期加（减）脉冲数）；
陀螺n角度增量( º)＝ （陀螺n加速脉冲计数值 – 陀螺n减速脉冲计数值）×陀螺脉冲当量，陀螺脉冲当量为：5×10-5 度。
FREQ65|陀螺数据采集|
FREQ66|陀螺加电状态判断|
",0,0,0,0,0,1,0,0
"功能描述：采集并处理四个动量轮加电状态，三路伽马关机敏感器关机信号，四路触地开关信号                                                                                                                                                                                                                                                                                                                                          处理：
序号|功能点编号|功能描述
1|FREQ3.3.1|动量轮加电状态
2|FREQ3.3.2|三路伽马关机敏感器关机信号
3|FREQ3.3.3|四路触地开关信号
",0,0,0,0,0,1,0,0
"功能描述：利用星敏感器捕获地球分两个阶段。在第一阶段，60秒判断一次星敏感器姿态输出。如果星敏感器A、B、C均有姿态输出，且测量的光轴夹角满足一定条件，则利用星敏感器双矢量定姿确定姿态。若仅有A或仅有B或仅有C有姿态输出，则偏航转过小角度（3度），重复捕获。偏航转过3度后，若星敏感器A或B或C有姿态输出，且满足一定条件，利用星敏感器双矢量定姿。若三个星敏感器均无姿态输出或由输出但仍不满足一定的条件，进行偏航转动（45度）。若偏航转动1周天仍未捕获成功，则滚动转动90度。若全天球捕获成功，则当姿态角和姿态角速度满足一定条件，进入阶段2。在阶段2，利用四元数进行姿态确定（与姿态机动定姿相同）。喷气控制。
",0,1,0,0,0,0,0,0
" 软件需求名称：帆板控制 
需求类别：其他 
软件需求描述：根据控制律计算结果，驱动帆板机构，进行帆板控制。",0,0,1,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|液浮陀螺数据的采集与处理|FREQ2. 1|向选择的液浮陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式
|光纤陀螺数据的采集与处理|FREQ2.2|向选择的光纤陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式
",0,0,0,0,0,1,0,0
"功能描述：推力器喷气状态清零
",0,1,0,0,0,0,0,0
"功能描述：选择相平面参数、角加速度
处理：根据工作模式设置相平面参数；根据推力器分支及追踪器构型设置角加速度。
说明：10种构型，2种分支共计20组角加速度（每组包括正负三轴共6个）；",0,1,0,0,0,0,0,0
"功能描述：计算星上星时。
处理：
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。",0,0,0,0,0,1,0,0
"此章节01星为“发送AOCC中继事件数据”，现删除，替换为“发送AOCC数据段黑匣子数据”
功能描述：发送AOCC数据段黑匣子数据",0,0,0,0,0,0,0,1
"功能描述：根据姿态估值与数字输出，判断修正可用性。
",0,0,0,0,1,0,0,0
功能描述：根据红外、太阳、星敏感器的输出数据判断陀螺故障。,0,1,0,0,0,0,0,0
功能描述：无控模式初始化,0,1,0,0,0,0,0,0
功能描述：接收遥控轨道参数注入块,0,0,0,0,0,0,1,0
"功能描述：接收同步控制。
处理：根据应急线路同步字的编码内容进行相应的处理：
编码|相应的处理
28H|发送内存的数据区指针复位
",0,0,0,0,0,0,1,0
"功能描述：对帆板驱动装置1和帆板驱动装置2进行独立控制和诊断，一个帆板驱动装置失效不影响对另一个帆板驱动装置的控制与诊断。
",0,1,0,0,0,0,0,0
"功能描述：选择通讯的中等精度星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）中等精度星敏共有三个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的中等精度星敏LTU发送取数指令。
（2）向选择的中等精度星敏LTU发送完取数指令后，获得中等精度星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,1,0,0
"功能描述：根据帆板角误差、控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0
"软件需求名称：部件数据处理及状态选择 
需求类别：其他 
软件需求描述：部件数据采集、剔野和选择处理。",0,1,0,0,0,0,0,0
"功能描述：采集8路模拟太阳A\B码、监视码。
处理：
采集方法：连续采集8路，采集1路的操作步骤（以ASS1的电流1为例）：
向选通地址输出偏移地址：0x1200 0000 = 30H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果；",0,0,0,1,0,0,0,0
"功能描述：复位模式初始化
处理：
- StarTime（星上时间）：0.0；
- 向星务分系统申请重要数据；",1,0,0,0,0,0,0,0
"功能描述：CAN通信上行/下行数据的组帧和处理。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：遥测组帧、遥控接收、遥测帧头打包、遥测数据打包、下行：重要数据组帧、上行：数据指令处理、上行：模式转换指令处理、上行：软件标志字指令处理、上行：控制参数指令处理、上行：变轨和位保指令处理、上行：部件加断电指令处、上行：校时指令处理、上行：轨道注入指令处理、上行：部件数据转发指令处理、在轨维护指令处理、重要数据保存、重要数据恢复",0,0,0,0,0,0,0,1
"功能描述：喷气控制，要求将CMG控至标称角动量，保持这个标称角动量。
输入：地面注入的CMG引入标志[i]（0切除；1引入）；各CMG的框架角度Sgang[i]（弧度）；三轴角动量偏差、、（Nms）；CMG有效标志Lcmg[i]（1代表有效，0代表无效）",0,1,0,0,0,0,0,0
"功能描述：接收发送AOCC重要数据
处理：
控制分系统重要数据保存在系统内ICU以及外系统的CTU，应用软件上电/复位后首先从ICU恢复重要数据，如果连续5个控制周期申请重要数据失败（帧头错误、校验和错误或者收到的数据为非法数据）则认为从ICU恢复重要数据失败。应用软件通过外部1553B总线向OBDH申请星上时间和重要数据，如果连续15个控制周期申请重要数据失败，则根据星箭分离状态进行模式转换，并清除服务请求和矢量字。若星箭已分离则设置模式字为“入轨段”，星箭未分离则设置模式字为“主动段”。
申请重要数据成功后，按照重要数据中保存的部件当班状态初始化各部件软件当班状态，对于光纤陀螺产品需根据重要数据中的当班状态进行恢复对于三浮陀螺则根据重要数据中的Fi_GyroSelt状态进行恢复，并统一根据Fi_GyroSelt和当班状态补发产品开指令；对于CMG、红外、星敏产品根据重要数据中的当班状态恢复状态；统一根据当班状态和选择标志补发产品开指令；针对三浮陀螺产品，陀螺开指令连续发送3个控制周期后，连续3个控制周期发送陀螺马达开指令
  申请重要数据失败后，对于陀螺产品则根据ACU提供的部件加电状态初始化陀螺的当班状态和Fi_GyroSelt状态，并根据Fi_GyroSelt状态和当班状态补发产品开指令；对于红外产品，则根据ACU提供的部件加电状态初始化红外的当班状态和Fi_IRESSelt状态，并根据Fi_IRESSelt和当班状态补发产品开指令；对于CMG，根据ACU提供的部件加电状态初始化CMG的当班状态和Fi_CMGSelt状态，并根据Fi_CMGSelt状态和当班状态补发产品开指令；对于星敏感器，软件当班状态仍保持“不当班”状态，等待地面指令设置相应部件当班状态；
重要数据恢复成功后，使用第二块重要数据中的q\q\q\ q恢复“星体在惯性系下的姿态四元数q1/qng1、q2/qng2、q3/qng3、q4/qng4”。
第二块重要数据增加保存星敏定姿方式下的卫星三轴姿态角估值。",0,0,0,0,0,0,1,0
"上行注入功能是地面干预星上运行状态的重要手段，主要是指OBDH通讯协议中定义的控制分系统“接收遥控注入数据”功能。上行注入数据块由地面发送到OBDH分系统，再由OBDH分系统通过B总线发送到AOCC执行。包括下表的功能点。
序号|功能描述|功能编号
|接收数据指令注入|FREQ7.8.1
|接收固定参数注入|FREQ7.8.2
|可变地址注入|FREQ7.8.3
|轨道参数注入|FREQ7.8.4
|程序修改注入|FREQ7.8.5
|星敏感器指令注入|FREQ7.8.6

具体的内容见注入文件。",0,0,0,0,0,0,1,0
"功能：利用星敏感器C的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：当整星－Z 轴对日后，通过旋转Z 轴令目标矢量进入XOZ 平面
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
|极高星敏感器数据的采集与处理|FREQ1.5.5|极高星敏感器1553B取数指令|极高星敏感器的四元素、角速度状态信息|在通讯允许的条件下（极高星敏感器的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,1,0,0
"功能描述：模式8切换方式
处理：
if(>6900 且AutoInStopNum<2) 置WorkMode=2，CMGInControlFlag=0；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,1,0,0,0,0,0,0
"功能描述：选择通讯的星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。                                                                                                                                                                                                                                                                                                                                               处理：
（1）星敏共有三个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的星敏LTU发送取数指令。
（2）向选择的星敏LTU发送完取数指令后，获得星敏LTU返回的数据，将数据转换为所需的数据格式，具体参见星敏通讯协议
（3）星敏LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
"功能描述：根据指令完成数传天线的指向控制。
",0,1,0,0,0,0,0,0
"软件需求名称：星时校正 
需求类别：其他 
软件需求描述：校正星上星时。
",0,0,0,0,0,1,0,0
"功能描述：ICU模拟量遥测 
",0,0,0,0,0,1,0,0
"功能描述：计算三轴的轮控力矩。
处理：
STEP1:分别计算P,I,D项。，的限幅值可以通过内存修改；，的限幅值可以通过内存修改。计算公式见（1）；
STEP2:PID加补偿的控制律计算。若{BZ1≠8(侧摆机动)或（BZ1=8且ZT43(3)=1允许侧摆机动引入结构滤波器）}且ZT39(4)=1引入结构滤波器，则调用结构滤波器算法得到，。计算公式见（2）；
STEP3:若ZT8≤3姿控发动机可用，ZT2=2飞轮整星零动量控制模式，BZ1≠1（三轴稳定正常轨道运行姿态）或2（偏航机动并稳定运行）或8（侧摆机动）或9（侧摆角保持），则：
若或，则=0.01；
若或，则=0.01；
若或，则=0.01。",0,1,0,0,0,0,0,0
"功能描述：利用500秒滚动和俯仰角积分和罗盘原理，计算出偏航角。姿态确定由红外和陀螺。姿态控制是喷气控制
",0,1,0,0,0,0,0,0
"有效性处理放在控制周期中断中采样数据后、定姿前处理；故障诊断放在控制周期中断中定姿与控制后处理。红外定姿时应同时将数字太阳和星敏感器的数据有效性标志置为无效。
需求名称|功能描述
陀螺数据有效性|确定陀螺数据的有效性
红外数据有效性|确定红外数据的有效性
数字太阳数据有效性|确定数字太阳数据的有效性
星敏感器数据有效性|确定星敏感器数据的有效性
动量轮角动量数据有效性|确定动量轮角动量数据的有效性
模拟太阳敏感器数据有效性|确定模拟太阳敏感器数据的有效性
红外自主故障诊断|星上自主检测红外故障
陀螺自主故障诊断|星上自主检测陀螺故障
星敏感器通讯故障|星上自主检测星敏感器故障
动量轮故障诊断|星上自主检测动量轮故障。
推进系统故障诊断|星上自主检测推进系统故障
帆板驱动机构故障诊断|星上自主检测帆板驱动机构故障
模拟太阳敏感器故障诊断|星上自主检测模拟太阳敏感器故障",0,1,0,0,0,0,0,0
功能描述：入轨段初始化,0,1,0,0,0,0,0,0
"功能描述：根据指令完成中继天线的捕获跟踪控制。
输入：跟踪开始指令（R_GZKS=1），跟踪结束指令（R_GZJS=1），RelayGDASwapAcqFlag，FRelayGDASwapAcq, ， 
输出：RelayGDAView, FRelayGDASwapAcq ,、，",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|三浮陀螺数据的采集与处理|FREQ1.2.1|""三浮陀螺1553B取数指令
""|陀螺1-3的速度增量|在通讯允许的条件下（每个三浮陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是角速率数据，通过任务书给出的公式计算
|光纤陀螺数据的采集与处理|FREQ1.2.2|""光纤陀螺LTU取数指令
""|陀螺4-9的速度增量|在通讯允许的条件下（每个光纤陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是即为速度增量数据，直接乘当量就可以得到需要的结果；
",0,0,0,0,0,1,0,0
"软件需求名称：姿态控制算法 
需求类别：其他 
软件需求描述： 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.5.1|相平面和动量轮联合控制|《用户需求》4.5.1|
FREQ12.3-R4.5.2|喷气姿态控制|《用户需求》4.5.2|
FREQ12.3-R4.5.2.1|相平面姿控算法|《用户需求》4.5.2.1|
FREQ12.3-R4.5.2.2|相平面喷管选择|《用户需求》4.5.2.2|
FREQ12.3-R4.5.2.3|脉冲调宽姿控算法|《用户需求》4.5.2.3|
FREQ12.3-R4.5.2.4|脉冲调宽喷管选择|《用户需求》4.5.2.4|
FREQ12.3-R4.5.3|动量轮控制|《用户需求》4.5.3|
FREQ12.3-R4.5.3.1|动量轮启动与保持|《用户需求》4.5.3.1|
FREQ12.3-R4.5.3.2|动量轮姿态控制|《用户需求》4.5.3.2|
",0,1,0,0,0,0,0,0
"功能描述：利用估计的四元数转换姿态角，送给星敏感器的四元数。

",0,1,0,0,0,0,0,0
"功能描述：模式0切换方式。
处理：
一个控制周期内对星箭分离状态位读5次，若连续3次以上读入为“1”，则认为本周期查到星箭已分离，每次读的时间间隔要求大于1ms。如果在连续3个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入初始速率阻尼模式。
在主动段收到地面指令进入初始速率阻尼，进入初始速率阻尼模式。",0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的红外太阳姿态修正系数,0,0,0,0,0,0,1,0
"功能描述：收到动量轮开数据指令或自主开动量轮。
处理：
收到动量轮开数据指令或自主开动量轮时，
按《卫星控制分系统注入参数及数据指令的用户需求》中动量轮引入状态，在相邻的4个周期依次使引入状态的动量轮加电；动量轮故障诊断自主关动量轮时，关闭动量轮一次电源。",0,0,1,0,0,0,0,0
"功能描述：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
",0,0,0,0,1,0,0,0
"将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。
序号|功能描述|功能编号
|姿控数据块1|FREQ65.1
|变轨数据块|FREQ65.2
|轨道数据块|FREQ65.3
|动量轮参数块|FREQ65.4
|轮控系数块|FREQ65.5
|相平面控制参数块|FREQ65.6
|陀螺当量修正数据块|FREQ65.7
|红外太阳修正数据块|FREQ65.8
|星敏感器数据块|FREQ65.9
|故障判别因子系数块|FREQ65.10
|陀螺故障判别因子系数块|FREQ65.11
|全姿态捕获参数块|FREQ65.12
|SDC命令块|FREQ65.13
|LTU命令块|FREQ65.14
|程序块|FREQ65.15
|内存修改块|FREQ65.16
|姿控数据块2|FREQ65.17
|陀螺红外参数数据块|FREQ65.18
|星敏修正时无陀螺模式的修正参数块|FREQ65.19
|整星偏置动量数据块|FREQ65.20
|轨道注入保护参数块|FREQ65.21
|星敏感器程序块|FREQ65.22
|星敏感器程序注入控制块|FREQ65.23
|EEPROM程序操作块|FREQ65.24
|帆板命令块|FREQ65.25

具体内容见注入文件。",0,0,0,0,0,0,1,0
"功能描述：与星敏感器通讯，获得星敏感器数据。
处理：
在使用Astro10星敏感器之前需对星敏感器进行初始化，完成后向星敏感器发出R有效信号，并通过串行口得到星敏感器提供的数据。在AO与星敏感器通信过程中，AO始终处于主动状态。当AO发出R信号下降沿后星敏感器在5ms内返回数据，AO在接收完数据后把R信号置高电平，星敏感器在R信号的上升沿之后的1ms内停止发送数据。
tro10星敏感器通讯故障时，不使用Astro10星敏感器数据进行姿态修正。",0,0,0,0,0,1,0,0
功能描述：卫星绕y轴转动，使红外搜索地球。,0,1,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如表 43所示：
表 43：对应矢量字各个请求编码的条件
服务编码|发送的条件
0000|无服务请求
bit0=1|申请传送AOCC重要数据
bit0=0|无AOCC重要数据服务请求
bit1=1|申请传送OBDH时间
bit1=0|无OBDH时间服务请求
bit2=1|AOCS应急控制标志有效
bit2=0|AOCS应急控制标志无效
bit3=1|AOCC硬件状态数据状态准备好
bit3=0|AOCC硬件状态数据状态未准备好
bit4=1|AOCC内存数据状态为准备好
bit4=0|AOCC内存数据状态为未准备好
bit8=1|AOCC黑匣子数据状态为准备好
bit8=0|AOCC黑匣子数据状态为未准备好
",0,0,0,0,0,0,0,1
"功能描述：根据需求，计算去往巡天模式机动过程中所需的目标姿态
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|甚高陀螺数据的采集与处理|FREQ1.2.1|""甚高陀螺1553B取数指令（硬件同步信号或广播同步消息）
""|陀螺1-6的速度增量|在通讯允许的条件下（每个甚高陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|光纤陀螺数据的采集与处理|FREQ1.2.2|""光纤陀螺LTU取数指令
""|陀螺7-9的速度增量|在通讯允许的条件下（每个光纤陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是即为速度增量数据，直接乘当量就可以得到需要的结果；
",0,0,0,0,0,1,0,0
功能描述：根据数字太阳见太阳标志和故障标志判断数字太阳数据的有效性。。,0,1,0,0,0,0,0,0
功能描述： GPS定轨主程序，包括GPS数据有效、无效时的操作。,0,1,0,0,0,0,0,0
"功能描述：
将从1553B总线上接收到ISUA、ISUC遥测数据，以及的常规遥测数据根据遥测打包协议进行打包（FReq-8）。
处理： 1553B总线通过子地址11接收到ISUA、ISUC常规遥测数据，ISUC闭环控制反馈数据，当轮询子地址10到来时，将计算的常规遥测数据同子地址11接收到的ISUA、ISUC常规遥测数据、部分ISUC闭环控制反馈数据，一并打包并发送到子地址10。遥测内容的相关变化见遥测文件以及1553B通讯协议。
遥测打包时模式字与方式字占用1个字节，模式字占用高4位，方式字占用低4位。对于未明确定义的遥测当量，使用CMU的当量，表示范围根据占用的字节数决定。",0,0,0,0,0,0,0,1
"功能描述：根据红外数据计算卫星姿态。
",0,0,0,1,0,0,0,0
功能描述：计算地磁场矢量分量。,0,1,0,0,0,0,0,0
"功能描述：模拟太阳故障状态。
",0,1,0,0,0,0,0,0
"功能描述：当红外敏感器故障时，在太阳定向完成后，利用数字太阳与星敏感器信息，进行全姿态捕获，并建立正常姿态
",0,1,0,0,0,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量。
输入：动量轮的转速方向和脉冲计量、上一次轮子角动量值。
输出：动量轮的角动量。
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量（动量轮角速度为1800r/min时的角动量为15Nms）。
（3）令（i = 1，2，… ，6）。为上一次轮子角动量值。（i = 1，2，… ，6）。",0,0,0,0,0,1,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示（十六进制）：
服务编码|发送的条件
58H|上电/复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次。
38H|每隔1分钟或模式改变时发送
96H|待定
69H|进入全姿态捕获模式后发送，收到确认字后停止发送
8CH|进入无控模式后发送，收到确认字后停止发送
C8H|BAPTA异常跟踪后发送，收到确认字后停止发送
",0,0,0,0,0,0,0,1
"软件需求标识：FREQ4 
软件需求名称：星时计算 
软件需求描述：星时计算。见“任务书”4.1.3.1“星时计算”。",0,0,0,0,0,1,0,0
功能描述：计算定点观测模式下的目标姿态TI C 和帆板理论转角。,0,1,0,0,0,0,0,0
"功能描述：由平衡方程方法、陀螺自检信号和星敏感器数据进行陀螺的故障检测。

处理：(1)6个或5个陀螺参加诊断时，使用平衡方程进行诊断，并且若ZT35(3)=1地面允许自检信号引入诊断，则自检信号无效的陀螺分数减1。若ZT16(3)(4)=11，则星上自主选取定姿陀螺，否则由地面指定。
(2)4个陀螺参加诊断时，若ZT35(4)=0不允许星敏诊陀螺，则同(1)。
(3)3个陀螺参加诊断时，若ZT35(4)=0不允许星敏诊陀螺，则这3个陀螺就是定姿陀螺。
(4)4个或3个陀螺参加检测时，若ZT35(4)=1，则用星敏差分值诊陀螺。判分的阀值乘以，可以进行调整。当允许星上自主选取定姿陀螺时，仅当平衡方程不平衡时可以切换陀螺。",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|数字太阳数据的采集与处理|FREQ1.1.1|""数字太阳LTU取数指令
""|数字太阳角度和视场码DSS1输出滚动方向角度，DSS2输出俯仰方向角度|在通讯允许的条件下（当班标志为1），每周期向数字太阳LTU发取数指令，获得数字太阳数据并处理成滚动方向和俯仰方向角度以及相应的视场码。
|模拟太阳数据的采集与处理|FREQ1.1.2|""模拟太阳LTU取数指令
""|模拟太阳角度和视场码|每周期无条件的向模拟太阳LTU发取数指令，获得模拟太阳数据并处理成对应的角度。 
",0,0,0,0,0,1,0,0
"功能描述：星敏感器数据处理，安装偏差估计。
",0,1,0,0,0,0,0,0
功能描述：利用陀螺确定出卫星对目标的姿态四元数。,0,1,0,0,0,0,0,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,1
功能描述：发送星敏感器数据包,0,0,0,0,0,0,0,1
"功能描述：根据陀螺输入，预估卫星惯性姿态的变化。
",0,1,0,0,0,0,0,0
"软件需求标识：FREQ15 
软件需求名称：光纤陀螺数据处理 
需求类别：其他 
软件需求描述：光纤陀螺数据处理。",0,0,0,0,0,1,0,0
功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测。,0,1,0,0,0,0,0,0
"软件需求名称：星时获取 
需求类别：其他 
软件需求描述：计算星上星时。
处理：
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。 ",0,0,0,0,0,1,0,0
功能描述：对部件加断电指令的处理 ,0,0,1,0,0,0,0,0
功能描述：对数传天线控制指令的处理 ,0,0,1,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：根据注入的时间，控制轨控发动机，完成初始轨道捕获和正常运行期间的轨道保持
处理过程：过程如下：
STEP1：进行姿态预估（见用户需求），得到姿态角和角速度
STEP2：令，：
STEP3：根据ZT6的值，计算得到：
STEP4：实现轨控开关机功能（见用户需求1.5），输出相应的状态标志及数据：
STEP5：进行轨控段喷气姿态控制（见用户需求）
STEP5：进行飞轮动量保持控制及飞轮启动（见用户需求）",0,1,0,0,0,0,0,0
"功能描述：机动姿态保持模式控制
",0,1,0,0,0,0,0,0
"功能描述：实现卫星星上自主或地面遥控下的自旋。为了节省内存，将此模式的代码从PROM中去掉。若需要此模式，则通过在轨注入的方式，将此模式引入控制。
处理过程：过程如下：
STEP1：进行姿态预估，得到姿态角和角速度
STEP2：令动量轮和磁力矩器的控制电压为0
STEP3：当ZT1 = D且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

根据ZT12向偏航和滚动发控制脉冲，处理完置ZT12为0
ZT12取值|处理
3|发偏航正脉冲0.5秒
C|发偏航负脉冲0.5秒
5|当时发滚动正脉冲0.5秒
A|当时发滚动正脉冲0.1秒
F|当L11 + L21 = 1时发滚动正脉冲0.5秒

STEP4：当ZT1 = F且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

确定的符号",0,1,0,0,0,0,0,0
功能描述：为三轴姿态喷气控制选择推力器,0,1,0,0,0,0,0,0
"软件需求标识：FREQ21 
软件需求名称：部件加断电指令处理 
需求类别：其他 
软件需求描述：部件加断电指令处理。",0,0,0,0,0,1,0,0
"功能描述：发送遥测数据
处理：
遥测数据分为实时遥测数据和延时遥测数据。
实时遥测数据格式包含5种格式：发射模式、正常模式、变轨模式、全姿态捕获模式、停控模式/应急模式。对于AOCS分系统而言，发射模式和正常模式的处理方式相同。若AOCS分系统出现模式转换则需通过方式代码的服务申请，请求OBDH变化遥测格式。
OBDH在收到地面指令或者在接收到AOCS的服务请求后，在125ms的时间内给AOCC发送对应的‘同步’方式代码。若AOCC在服务请求后大于0.25s的时间内未收到对应的‘同步’方式代码，则再次申请改变模式，若同一次申请的申请次数大于40次，则停止本次的申请。遥测数据格式内容具体见遥测文件。",0,0,0,0,1,0,0,0
"“复位进入模式”中应用软件进行如下初始化工作：
置星时为2100秒；
置“向星务分系统申请重要数据”标志。
在“复位进入模式”中AO进行如下工作：
控制量输出均为0。部件开关设置为“不进行任何操作”。
响应星务分系统遥测轮询、数据遥控指令、数据注入、程序注入并进行相应处理，但不响应星务重要数据的轮询。
在“复位进入模式”中AO不进行控制律计算。",1,0,0,0,0,0,0,0
"功能描述：使用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：将动量轮保持至标称角动量所需的电压。
",0,1,0,0,0,0,0,0
功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。,0,1,0,0,0,0,0,0
"功能描述：采集高速转速、计算角动量偏差、合成角动量、CMG的Jacobi矩阵。
输入：CMG 高速的标称角动量Hwb[i]，CMG状态标志Fcmg[i]；(i=1~5)
输出：使用的CMG角动量sgH（Nms），为35 矩阵；
使用的CMG系统合成角动量H=[Hx，，Hz]T（Nms）；
实测角动量Hw[i]（Nms）；
CMG的Jacobi矩阵sgJ，为35 矩阵；
CMG的框架角度Sgang[i]（弧度）；
三轴角动量偏差，",0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序。
输入：姿态预估周期 (量纲：秒)
有效性判据给出的星敏感器A数据可用标志F_SAUsed(1:可用，0:不可用)
有效性判据给出的星敏感器B数据可用标志F_SBUsed(1:可用，0:不可用)
本周期采样到的星敏感器A的有效输出 (设有nA个，即)，以及它们测量时刻相应的星时 (量纲：秒)
本周期采样到的星敏感器B的有效输出(设有nB个，即)，以及它们测量时刻相应的星时(量纲：秒)
使用陀螺数据时：
本周期计算的与前Num_q-1个周期的，以及符号标志F_Qsgn
不使用陀螺数据时：
本周期计算的与前Num_q-1个周期的，以及符号标志F_Qsgn_ng
修正参数 
本周期轨道计算采用的星时 (量纲：秒)
",0,1,0,0,0,0,0,0
功能描述：外推轨道计算主程序。,0,0,0,1,0,0,0,0
"功能描述：对目标轨迹进行初始化，供姿态机动使用
",0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的轨控参数,0,0,0,0,0,0,1,0
功能描述：自旋模式控制,0,1,0,0,0,0,0,0
"软件需求标识：FREQ26 
软件需求名称：推进数据采集处理要求 
需求类别：其他 
软件需求描述：推进数据采集处理要求。",0,0,0,0,0,1,0,0
"功能描述：自主对计算机进行切换。
处理：
AOCC的A机和B机满足一定的条件下，可以进行切换。",0,0,1,0,0,0,0,0
"功能描述：根据红外信息，将卫星控制在正常飞行姿态。
输入：陀螺数据输出 ，
红外弦宽
红外数据处理（全姿态捕获）的输出，
红外数据有效性标志F_IresValid",0,1,0,0,0,0,0,0
"功能描述：串口各部件数据采集和处理
处理：
对于有自检需求的LTU部件，在发送自检指令前将自检应答数据初始化为0xFF（微波测距测速敏感器自检数据初始化为0）。发送前应答数据有初始化要求的自检或遥测获取指令类型：包括图像处理单元自检、激光测距敏感器遥测参数获取、激光测速敏感器校时及遥测参数获取、三维成像敏感器自检和三维成像敏感器遥测参数获取等。CCU上电初始化时默认进行部件自检或校时指令通讯。
序号|功能点编号|功能描述|说明
|FREQ3.2.2.10|部件数据采集顺序|异步串口1数据采集顺序为：DM取数；激光IMU取数；光纤IMU取数；星敏1取数；星敏2取数；微波雷达(a)应答机取数。 异步串口2数据采集顺序为：异步串口2数据采集顺序为：自检及校时指令，LRF取数，LVS取数，星敏3取数，微波雷达(b)应答机取数，RVS取数
",0,0,0,0,0,1,0,0
"功能描述：处理地面遥控注入的用于替换EEPROM的代码
处理：
-  解包EEPROM代码注入包，得到帧号、源地址（SRAM）、目的地址（EEPROM）、注入内容长度；
- 以源地址为起始地址，将注入内容放入该SRAM区域
说明：星务分系统向GNCC送数采用256字节(有效使用249字节)帧格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,1,0
"序|需求名称|编号|输入章节号|功能描述
|轨道与星历|FREQ2.0|5.1.1|卫星轨道、太阳星历、地面站位置、地磁场强度等计算程序的主流程。
|卫星轨道计算|FREQ2.1|5.1.2|计算卫星当前轨道
|GPS轨道数据有效性判断|FREQ2.2|5.1.3|对GPS轨道数据的有效性进行判断
|GPS轨道版轨道计算|FREQ2.3|5.1.4|利用GPS轨道版数据进行GPS定轨程序
|近圆中低轨卫星轨道根数外推算法产品规范|FREQ2.5|/|规范化算法：
|近圆中低轨卫星GPS轨道计算算法算法产品规范|FREQ2.6|/|规范化算法：
|岁差章动矩阵计算算法算法产品规范|FREQ2.7|/|规范化算法：
|4阶星上地磁场计算方法算法产品规范|FREQ2.8|/|规范化算法：
|光行差计算算法产品规范|FREQ2.9|/|规范化算法：
|轨道、目标姿态预计算|FREQ2.10|5.1|完成下一控制周期的轨道星历与目标姿态计算。
",0,1,0,0,0,0,0,0
"功能描述：根据姿态估值与数字太阳输出，计算量测的一步预测与新息，建立数字太阳输出的可用性标志。
输入： 5.2.14.3输出的
       姿态估值 
       数字太阳数据有效性标志F_Ds1Valid， F_Ds2Valid（由有效性判据给出）
      	  数字太阳敏感器输出：, (量纲：弧度)",0,1,0,0,0,0,0,0
功能描述：根据CMG输出数据和理论数据进行CMG故障检测及处理。,0,1,0,0,0,0,0,0
"功能描述：决定利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序。
",0,1,0,0,0,0,0,0
"功能描述：设置2类慢帧遥测数据下传顺序
触发条件：模式字改变、数据指令",0,0,0,0,0,0,0,1
" 软件需求名称：轨道控制算法 
需求类别：其他 
软件需求描述：轨控速度增量计算及轨控发动机选择。《用户需求》4.7。 ",0,1,0,0,0,0,0,0
"功能描述：与CAN通讯获得上行/下行数据。
调用条件：AOCC被动接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通讯，交换数据，以实现星地联系和对卫星的人工干预。主要完成下列功能：
AOCC向星务分系统发送数据（中断接收星务分系统命令，依据命令发送各类遥测参数）；
发送快帧遥测；
发送慢帧遥测；
将AOCC为星务保存的重要数据发送给星务分系统；
发送星敏感器和姿态辅助数据；
有内存下卸要求时，发送AOCC指定内存内容；
AOCC接收星务分系统数据（中断方式）包括接收固定地址参数注入；接收可变地址参数注入；接收轨道参数数据；接收程序注入；接收数据指令；接收重要数据返回；接收整星对时广播数据；接收GPS高精度秒脉冲对时广播；接收GPS导航数据等。
如果应用软件4s收不到星务分系统信息或连续100秒未收到符合通信协议的正确数据，对CAN总线控制器重新初始化。",0,0,0,0,0,0,0,1
"需求名称|功能及处理描述
CMG 1数据的采集与处理|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 2数据的采集与处理|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 3数据的采集与处理|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 4数据的采集与处理|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 5数据的采集与处理|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 控制指令的输出处理|根据控制方式发送相应的控制指令，具体见内总线通讯协议
CMG 6数据的采集与处理|在通讯允许的条件下（CMG 6的当班标志为1），每周期向CMG 6 RT发取数指令，获得CMG 6数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG的程序注入修改|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
CMG的内存下传|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,1,0,0
功能描述：置卫星姿态无控，处于自由飞行状态,0,1,0,0,0,0,0,0
功能描述：确定ASS21，ASS22，ASS31，ASS32 及帆板转角的信号选取。,0,1,0,0,0,0,0,0
"功能描述：追踪器构型切换管理及质量设置
处理：根据构型设置追踪器质量及转动惯量
",0,1,0,0,0,0,0,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：OBC在CAN总线中断中接收/发送数据；
通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,1
"功能描述：计算－Z 轴对日的目标姿态
",0,1,0,0,0,0,0,0
功能描述：接收同步字,0,0,0,0,0,0,1,0
"功能描述：减小卫星的俯仰角。
输入：陀螺数据输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）
红外数据处理（全姿态捕获）的输出，
上周期姿态角估值，
",0,0,0,0,1,0,0,0
"功能描述：根据+Y帆板角误差控制帆板跟踪太阳。
",0,0,0,1,0,0,0,0
"功能描述：接收AOCC系统注入参数
处理：
当收到接收遥控注入结束标识消息后，将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。只有当某个块类型的所有数据都收到，且每块数据的校验和都正确时，才能使用此种类型的注入数据。注入的数据具体见上行注入文件。需要注意的是：地面注入ZT9时：若ZT9中为1的个数小于3个，则不改变星上ZT9的取值，如果等于3个，则BZ9=ZT9；应用软件不响应ZT1=2、ZT1=6、ZT1=8的注入指令。",0,0,0,0,0,0,1,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.4|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.3|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1|地面站赤经赤纬计算
|运行段帆板控制|FREQ4.12|5.5.1|三轴稳定模式下的帆板控制
|太阳帆板自主跟踪控制|FREQ4.13|5.5.2|根据帆板角误差、控制帆板跟踪太阳
|数传天线指向控制|FREQ4.14|5.6.2|根据指令完成数传天线的指向控制
|中继轨道计算|FREQ4.21|5.7.1|中继轨道计算
|中继天线指向控制|FREQ4.22|5.7.2和5.7.3|根据指令完成中继天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|双脉冲变轨|FREQ4.23|""任务书的
4.2.3""|根据地面注入的指令可实现两次轨控的功能
|3CMG框架角速度指令解算|FREQ4.24|5.4.2.6|当采用3CMG进行姿态控制时，根据控制器计算出的力矩，实现CMG的框架角速度指令解算
|CMG群角动量释放流程|FREQ4.25|5.4.2.7|CMG群角动量释放流程
|CMG标称框架角计算算法|FREQ4.26|5.4.2.8|根据外部标志及时间，计算CMG的标称框架角
",0,1,0,0,0,0,0,0
"功能描述：接收遥控可变地址注入块
处理：软件设计时需要判断地址是否对齐，若未对齐，则不执行此注入块。",0,0,0,0,0,0,1,0
"功能描述：卫星丢失姿态后，使用红外地球敏感器直接捕获地球，建立正常对地姿态。
",0,1,0,0,0,0,0,0
"功能描述：根据姿态估值与数字太阳输出，计算量测的一步预测与新息。
",0,1,0,0,0,0,0,0
"软件需求标识：FREQ14.1 
软件需求名称：数据采集 ",0,0,0,0,0,1,0,0
"功能描述：接收记录AOCC时间指令
处理：CTU在需要恢复星上时间时，向AOCC发送“记录AOCC时间指令”，AOCC收到指令后立即记录AOCC时间并将时间数据写入发送AOCC时间指定的存储地址空间中。",0,0,0,0,0,0,1,0
"功能描述：处理地面遥控注入的固定地址参数
处理：
128-135：注入参数乘修正系数
515：全量校时处理：星时=全量校时星时
516：增量校时处理星时=星时+增量校时量
其它：更新注入的参数",0,0,0,0,0,0,1,0
"功能描述：红外数据处理
",0,0,0,0,1,0,0,0
功能描述：接收遥控固定参数注入块的数传天线系数,0,0,0,0,0,0,1,0
"序|需求名称|编号|输入章节号|功能描述
|卫星轨道计算|FREQ8|4.1.1|星上实时计算卫星轨道
|GPS计算|FREQ9|4.1.1.2|将GPS轨道确定参数转换成控制系统中太阳星历和地磁场计算所需的19个轨道参数
|光行差的修正参数和数字太阳敏感器输出角估值计算|FREQ10|4.1.2|计算光行差的修正参数，数字太阳敏感器输出角估值
|地磁场模型计算|FREQ11|4.1.3|星上实时计算地磁场强度
",0,1,0,0,0,0,0,0
"功能描述：主动段模式初始化
处理：
- WorkMode（工作模式）：0（主动段）；
- StarTime（星上时间）：0.0；
- 俯仰磁力矩器线路主份工作；
- 星务校时：禁止星务校时；
- 均匀校时：禁止均匀校时；",1,0,0,0,0,0,0,0
功能描述：进行部件通讯与选用、数据采集与处理、自检与校时。,0,0,0,0,0,1,0,0
"功能描述：根据从SLTU接收的0.25秒或1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
输入：0.25秒或1秒内陀螺的角度增量 (量纲：弧度)
(i=1,2,3,…6，依次表示陀螺G1，G2，…，G6的输出)；
采样周期 (量纲：秒)；
陀螺数据有效性标志F_GyroValid(由陀螺有效性判据给出)。
陀螺系统在星体三轴方向等效的常值漂移估值 (量纲：弧度/小时)
星敏感器数据有效性标志：F_SAValid，F_SBValid，F_SCValid
",0,1,0,0,0,0,0,0
"功能描述：当星敏感器需要粗姿态时，利用卫星的姿态估值，计算两个星敏感器的光轴在惯性坐标系中的投影。
",0,1,0,0,0,0,0,0
功能描述：根据位置速度计算轨道参数,0,1,0,0,0,0,0,0
"功能描述：根据标志选择轨控发动机。
",0,1,0,0,0,0,0,0
"软件需求名称：帆板使用及通信 
需求类别：其他 
软件需求描述：与帆板通信，控制帆板并获得帆板状态数据。
处理：
见通信协议。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
帆板初始化|FREQ46|帆板初始化|B|2
帆板数据采集|FREQ47|帆板数据采集|B|3
数据解包与转换|FREQ48|数据解包与转换|B|4
帆板数据有效性判断、处理|FREQ49|帆板数据有效性判断、处理|B|5
帆板控制量输出|FREQ50|帆板控制量输出|B|6
帆板故障重构|FREQ51|帆板故障重构|C|
",0,0,1,0,0,0,0,0
"功能描述：采集红外数据，计算姿态等。
处理：同用户需求的
STEP1:判断红外数据有效性
若左红外数据有效，则HL=1，否则HL=0。
若右红外数据有效，则HR=1，否则HR=0。
若ZT5=0不用红外，则HL=0，HR=0。
STEP2:计算公式同的（2）（3）（4）（5）（6）（7）（8）（9）（10）。
（9）若ZT3=F或B，则计算dΦH、dΘH。",0,1,0,0,0,0,0,0
"应用软件共分21个工作模式，分别是等待段、太阳定向、恒星定向2、惯性调姿、恒星定向4、轨控定向、着陆准备、主减速、快速调整、接近下降、悬停、避障、缓速下降、自主定位、起飞准备、垂直上升、上升调姿、轨道入射、星光环月、速率阻尼和无控。模式字和各模式的对应关系如下：
表5.2.4.4-1 工作模式
模式字|工作模式|使用场合
0|等待段|""加电之后，判出分离27s之前，
或复位之后，重要数据恢复之前。""
1|太阳定向|""组合体地月转移巡航和环月阶段正常运行状态；
上升器远程引导巡航""
2|恒星定向2|变轨建立点火姿态前
3|惯性调姿|变轨建立点火姿态
4|恒星定向4|变轨建立点火姿态后
5|轨控定向|""动力下降之前的轨控
月面上升之后的轨控""
6|着陆准备|建立着陆点火姿态
7|主减速|动力下降
8|快速调整|动力下降
9|接近下降|动力下降
10|悬停|动力下降
11|避障|动力下降
12|缓速下降|动力下降
13|自主定位|月面工作阶段
14|起飞准备|建立月面起飞初始状态
15|垂直上升|月面上升
16|上升调姿|月面上升
17|轨道入射|月面上升
18|星光环月|月球轨道交会对接自主段
19|速率阻尼|轨控姿态超差
20|无控|动力下降着陆、交会对接段轨道器最后逼近、故障
",0,1,0,0,0,0,0,0
轨道与星历计算包括卫星轨道计算、太阳星历计算、GPS计算、地磁场计算四部分。应用软件根据注入轨道参数或GPS数据进行卫星轨道实时计算，确定卫星轨道根数。太阳星历计算可确定太阳方位以及惯性系到轨道坐标系转换矩阵。地磁场的计算可确定地磁场强度。应用软件根据以上计算结果为姿态确定和姿态控制提供轨道和星历以及地磁场强度数据。卫星轨道、太阳星历、地磁场和GPS数据转换为轨道根数计算在1.0秒控制任务的任务1中完成。,0,1,0,0,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向帆板LTU发完取数命令后，获得LTU返回数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。具体参见LTU通讯协议件。
（3）帆板LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
功能描述：利用星敏感器数据计算卫星对惯性的角速度在本体系的分量,0,0,0,1,0,0,0,0
功能描述：将GPS轨道参数转换成16个轨道参数,0,0,0,1,0,0,0,0
功能描述：根据陀螺输入，预估卫星对地姿态。,0,1,0,0,0,0,0,0
功能描述：偏置动量轮处于力矩模式，根据红外或星敏测量信息计算得到的滚动角和俯仰角实现三轴姿态控制。滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制。,0,1,0,0,0,0,0,0
"功能描述：仅利用星敏感器A、C的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
"功能描述：处理广播的GPS数据
处理：解包广播的GPS数据，更新追踪器绝对GPS数据、目标器绝对GPS数据、追踪器和目标器的相对GPS数据",0,0,0,0,0,0,1,0
"功能描述：利用星敏感器数据进行卫星姿态捕获。
",0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
-Y帆板数据的采集与处理|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,1,0,0
"功能描述：卫星绕俯仰轴转动，直到红外搜索到地球。
",0,1,0,0,0,0,0,0
功能描述：标称角动量、安装、分配矩阵及轮子组合计算,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器1
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器1的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器2
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器2的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器3
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器3的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,1,0,0
"功能描述：发送实时遥测数据。
处理：应急线路实时帧数字量共一个数据包，共60字节，具体定义见遥测文件。",0,0,0,0,0,0,0,1
功能描述：发送姿态控制数据包1,0,0,0,0,0,0,0,1
"功能描述：发送和接收OBDH重要数据1、2、3
处理：软件初始化后不用做处理，应用软件只需在初始化时为它指定存储的地址空间即可。",0,0,0,0,0,0,0,1
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：动量轮启动的程控指令
      实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：， ，
",0,1,0,0,0,0,0,0
功能：利用红外、数字太阳敏感器确定姿态。,0,1,0,0,0,0,0,0
"功能描述：完成重新捕获地球，转对地三轴稳定的功能
处理过程：过程如下：
STEP1：进行红外数据采集及处理并将磁力矩器的输出电压设置为0。
STEP2：根据地球捕获的标志FEA的取值进行不同的处理：
FEA的取值|处理
FEA = A|""进行姿态预估，得到姿态角和角速度
令，
，
进行运行段喷气姿态控制	""
FEA = 5或0|""若ZT36=F，则进行星敏感器全姿态捕获
否则进行偏航捕获及转对地定向""

STEP3：根据ZT7的取值，进行相应的帆板控制。
根据ZT36的取值有两种捕获方式（星敏感器全姿态捕获和偏航捕获及转对地定向）：若ZT36=F，则进行星敏感器全姿态捕获，否则进行偏航捕获及转对地定向。FEA有三种状态0、5、A，两种捕获方式下，FEA的状态转换图如图13和图14所示：
图 13：星敏感器全姿态捕获中FEA的状态转移图
图 14：偏航捕获及转对地定向中FEA的状态转移图
其中FPA置A的条件是且",0,1,0,0,0,0,0,0
"各个模式切换的功能点列表如下：
序号|功能编号|功能
|FREQ51|主动段模式切换
|FREQ51.1|入轨段控制模式切换
|FREQ51.2|巡天观测模式切换
|FREQ51.3|定点观测模式切换
|FREQ51.4|小天区扫描模式切换
|FREQ51.5|姿态机动切换
|FREQ51.6|轨控模式切换
|FREQ51.7|捕获太阳并对日定姿模式切换
|FREQ51.8|帆板未展开切换
|FREQ51.9|无控模式切换
|FREQ51.10|应急模式模式切换
|FREQ51.0|主动段模式初始化
|FREQ51.1.0|入轨段控制模式初始化
|FREQ51.2.0|巡天观测模式初始化
|FREQ51.3.0|定点观测模式初始化
|FREQ51.4.0|小天区扫描模式初始化
|FREQ51.5.0|姿态机动初始化
|FREQ51.6.0|轨控模式初始化
|FREQ51.7.0|捕获太阳并对日定姿模式初始化
|FREQ51.8.0|帆板未展开初始化
|FREQ51.9.0|无控模式初始化
|FREQ51.10.0|应急模式模式初始化

工作模式的转换条件及对应的模式初始化内容具体见用户需求4。
AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,1,0,0,0,0,0,0
"功能描述：选择三轴正负控制力矩
处理：根据推力器分支和追踪器构型设置控制力矩。。
说明：10种构型，2种分支共计20组控制力矩（每组包括正负三轴共6个）",0,1,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
调用条件：有发送和接收OBDH重要数据命令字时
输入：OBDH重要数据地址中内容
输出：OBDH重要数据地址中内容。
处理：具体处理要求见与外总线通讯协议。",0,0,0,0,0,0,0,1
"软件需求标识：FREQ20 
软件需求名称：动量轮数据处理 
需求类别：其他 
软件需求描述：动量轮数据处理。",0,0,0,0,0,1,0,0
"功能描述：模式2切换方式。
处理：
FailureFlag=4且AutoInStopNum<2时，置WorkMode=8，SpeedControlTime＝0，AutoInStopNum=AutoInStopNum+1；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,0,0,1,0,0,0,0
"功能描述：利用星敏感器B、D的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
"功能描述：卫星处于应急状态
处理：
STEP1：进行姿态预估，得到姿态角和角速度
STEP2：令动量轮和磁力矩器的控制电压为0",0,1,0,0,0,0,0,0
功能描述：根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差。,0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,1,0,0,0,0
功能描述：为三轴姿态喷气控制选择推力器。,0,1,0,0,0,0,0,0
"功能描述：中继天线数据处理
处理：
处理数据时应对接收数据中的捕跟分系统工作模式进行保护判断。",0,0,0,0,0,1,0,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
-Y帆板数据的采集与处理|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,1,0,0
功能描述：为正常模式姿态确定提供初始姿态。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|5.2.1|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估对地姿态|FREQ3.3|5.2.3|根据陀螺测量输出，一步预估卫星姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|基于红外滤波的卫星姿态确定|FREQ3.6|5.2.6|根据陀螺预估结果和红外(和数字太阳)输出，确定卫星姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|红外与太阳双矢量定姿|FREQ3.9|5.2.9|利用红外、数字太阳敏感器确定姿态
|星敏感器相对基准标定|FREQ3.10|5.2.10|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.11.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.11.2|进行卫星姿态四元数的重置
|三轴欧拉姿态角预估算法产品规范|FREQ3.1.1|/|规范化算法：
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法产品规范|FREQ3.1.3|/|规范化算法：
|基于红外测量的红外滤波修正算法产品规范|FREQ3.1.4|/|规范化算法：
|基于单星敏感器测量矢量点乘信息的滤波修正算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量点乘信息的滤波修正算法产品规范|FREQ3.1.6|/|规范化算法：
|基于红外与太阳矢量的双矢量定姿算法产品规范|FREQ3.1.7|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.1|""计算模式的目标姿态
""
|点对点机动目标姿态计算|FREQ3.12.1|5.3.1.1|点对点机动目标姿态计算
|轨控目标姿态计算|FREQ3.12.2|5.3.1.2|轨控目标姿态计算
|姿态机动初始化|FREQ3.12.3|5.3.2|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|""理论偏流角计算
""|FREQ3.12.4.1|5.3.3.1|""适用于地球椭球模型，基于星体姿态描述为1-2-3 转序计算基于星体+Z 轴或基于指定基准轴（该轴应在XOZ 平面内）情况下的偏流角。
""
|偏流角平滑及偏流角速度计算|FREQ3.12.4.2|5.3.3.2|对偏流角修正启动与停止过程中的偏流角进行平滑处理，并计算偏流角速度。
|太阳高度角计算|FREQ3.12.4.3|5.3.3.3|根据偏流角修正基准计算太阳高度角
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|陀螺标定过程目标姿态计算|FREQ3.25.0|5.11.1|陀螺标定全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角
|目标姿态计算初始化|FREQ3.25.1|5.11.1.1|对陀螺标定过程中涉及到的两次机动过程进行机动姿态计算的初始化
|惯性姿态点对点机动轨迹规划|FREQ3.25.2|5.11.1.2|对陀螺标定过程所涉及到的两次点对点机动进行轨迹规划
|角速度起速保持与减速过程轨迹规划|FREQ3.25.3|5.11.1.3|对陀螺标定过程中的速度运行进行轨迹规划
|惯性定向时转阶段处理|FREQ3.25.5|5.11.1.5|陀螺标定在第1段中完成惯性定向，并在此期间标定陀螺真实常漂。在惯性定向转速度运行结束时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等。
|速度运行时转阶段处理|FREQ3.25.6|5.11.1.6|SubMode= 2~9，陀螺按照规定的角速度完成起速、恒速运行、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等
|速度曲线规划|FREQ3.25.7|5.11.1.7|根据所选择的机动轨迹，规划出角速度变化曲线
|陀螺标定算法|FREQ3.26.0|5.11.2|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺常漂修正标志确定|FREQ3.26.1|5.11.2.1|对陀螺标定过程中，陀螺常漂的修正标志进行确定。当星体达到了规定的惯性角速度时，开始进行陀螺常漂估计
|基于星敏陀螺滤波的等效常漂估计|FREQ3.26.2|5.11.2.2|采用星敏陀螺滤波的方法对陀螺等效常漂进行估计
|星敏陀螺滤波的陀螺等效常漂记录|FREQ3.26.3|5.11.2.3|对陀螺等效常漂，选取稳态时的一段数据进行平均，得到各个角速度下的等效常漂和星体真实角速度的估计值
|小角速度时的陀螺安装误差和刻度因子误差估计|FREQ3.26.4|5.11.2.4|经过N次速度机动后，对陀螺的测量模型进行标定，给出标定结果
|陀螺在轨标定时的控制量计算|FREQ3.27|5.11.3|对标定过程中的控制量进行计算
|陀螺安装误差标校结果引入|FREQ3.28|5.11.4|对陀螺完成标定后，待地面确认标定结果无误后，将陀螺的标定结果进行赋值。当地面注入FP__MountingCmp时执行本程序一次
|惯性姿态预处理初始化|FREQ3.29.1.1|5.12.1.1|计算惯性定向及扫描的机动参数
|相机扫描速度建立参数计算|FREQ3.29.1.2|5.12.1.2|计算由建立扫描速度初始姿态到建立恒定速度的时间，以及扫描结束后星体静止后的惯性姿态。
|星体阻尼结束至惯性定向姿态建立参数计算|FREQ3.29.1.3|5.12.1.3|计算星体阻尼结束后的姿态调整到凝视标定的惯性定向姿态，或天区扫描速度建立前所需初始惯性姿态
|惯性目标姿态计算|FREQ3.29.2.0|5.12.2|全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角。
|惯性定向轨迹规划|FREQ3.29.2.1|5.12.2.1|对惯性再定向过程进行轨迹规划
|惯性定向转阶段处理|FREQ3.29.2.2|5.12.2.2|惯性再定向转换处理
|惯性空间扫描轨迹规划|FREQ3.29.2.3|5.12.2.3|对惯性空间扫描过程进行轨迹规划
|惯性扫描转阶段处理|FREQ3.29.2.4|5.12.2.4|SubMode = 2，按照规定的角速度完成角速度的建立、恒速扫描、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化
|目标姿态计算初始化|FREQ3.29.2.5|5.12.2.5|对SubMode=1/10子模式进行机动姿态计算的初始化
|惯性定向姿态控制量计算|FREQ3.29.3|5.12.3|对惯性定向过程中的控制量进行计算
|星敏感器的粗姿态计算|FREQ3.30|5.2.14|计算提供给星敏感器的粗姿态
",0,1,0,0,0,0,0,0
"功能描述：处理地面遥控注入的内存下卸指令注入
处理：解包内存下卸指令注入，得到内存下卸起始地址用于第七类快帧数据打包。
说明： 遥测数据指令采用16字节(有效使用9字节)格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,1,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：，
输出：保持角动量所需电压，
      角动量偏差积分项：，
",0,1,0,0,0,0,0,0
功能描述：接收数据指令注入块的CMG串口指令,0,0,0,0,0,0,1,0
"序|需求名称|编号|功能及处理描述
|-Y帆板数据的采集与处理|FREQ7.3|选择通讯的-Y帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|+Y帆板数据的采集与处理|FREQ7.4|选择通讯的+Y帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|-Y帆板控制指令的输出处理|FREQ7.5|选择通讯的帆板-Y LTU，发送的控制指令。
|+Y帆板控制指令的输出处理|FREQ7.6|选择通讯的+Y帆板LTU，发送的控制指令。
",0,0,0,0,0,1,0,0
"功能描述：部件通讯选通
处理：
详见“任务书”5.1.2.2串口数据采集和处理的（一）部件通讯与选用。",0,0,0,1,0,0,0,0
功能描述：接收遥控固定参数注入块的系统功能参数设置区数据,0,0,0,0,0,0,1,0
"功能描述：伴飞模式下，计算视速度增量关机时间长度
",0,1,0,0,0,0,0,0
功能描述：姿态机动模式初始化,0,1,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器
输入：JetFlagXP_A、JFN_A、JFP_A 、JFN_A、JFgZP_A 、JFgZN_A（6个姿控分支标志），F_SatStage（卫星构型状态字）、，（星敏感器与陀螺定姿输出的姿态角及角速度）或，、，（其它定姿方式下输出的姿态角及角速度）、，、（协调控制力矩）、(机械臂运动产生的干扰力矩)、，（目标姿态角）
输出：X, Y, Z, FJX, , FJZ（喷气状态），、 
TJAi (i=1~6), TJCi (i=1~10)（A分支6个、C分支10个推力器脉宽）、
Ai (i=1~6), Ci (i=1~10)（A分支6个、C分支10个推力器开关标志）、（累计三轴姿控正/反向喷气时间）",0,1,0,0,0,0,0,0
"功能描述：对动量轮的角动量进行调整。
",0,1,0,0,0,0,0,0
"功能描述：与星敏感器通讯获得星敏感器数据状态，修改星敏感器程序。
输出：星敏感器命令包、星敏感器故障标志、定姿标志、位输出。
处理：
光行差修正的初始设置为：AOCC应用软件不对Astro10星敏信息进行补偿计算，而仅每150秒向星敏发送相对J2000的速度。",0,0,0,0,0,1,0,0
"功能描述：规划串口数据接收发送。
处理：
功能编号|功能|引用文档
FREQ101|初始化|任务书
FREQ102|规划串口使用要求|任务书
FREQ103|通信|任务书
FREQ104|通信故障处理|任务书
FREQ105|数据解包与转换|任务书
FREQ106|规划串口数据有效性处理|任务书
FREQ107|规划串口硬件采集、处理|预留
FREQ108|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"软件需求名称：姿态确定算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.4.1|陀螺姿态预估|《用户需求》4.4.1|
FREQ12.3-R4.4.2|星敏感器陀螺确定惯性姿态|《用户需求》4.4.2|
FREQ12.3-R4.4.3|中继跟踪目标姿态计算|《用户需求》4.4.3|
FREQ12.3-R4.4.4-K|太阳捕获及太阳定向|《用户需求》4.4.4|
FREQ12.3-R4.4.5|轨控目标姿态计算|《用户需求》4.4.5|
FREQ12.3-R4.4.6|误差四元数计算|《用户需求》4.4.6|
",0,1,0,0,0,0,0,0
"功能描述：与CAN通讯获得上行/下行数据。
调用条件：AOCC被动接收/发送数据；
处理：通过CAN总线与星务分系统通讯，交换数据，以实现星地联系和对卫星的人工干预。主要完成下列功能：
AOCC向星务分系统发送数据（中断接收星务分系统命令，依据命令发送各类遥测参数）；
发送快帧遥测；
发送慢帧遥测；
将AOCC为星务保存的重要数据发送给星务分系统；
发送星敏感器和姿态辅助数据；
有内存下卸要求时，发送AOCC指定内存内容；
AOCC接收星务分系统数据（中断方式）包括接收固定地址参数注入；接收可变地址参数注入；接收轨道参数数据；接收程序注入；接收数据指令；接收重要数据返回；接收整星对时广播数据；接收GPS高精度秒脉冲对时广播；接收GPS导航数据，GPS定位广播数据引入控制使用之前，软件需对广播数据中的W28表示的定位状态进行判断，即D6～D4：为101、011、110之一时，引入系统，否则为无效，控制系统不使用
如果应用软件3s收不到星务分系统信息或连续5周期挂起，对CAN总线控制器重新初始化。",0,0,0,0,0,0,0,1
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续三个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是A090H或者校验和错误或者未收到重要数据），则应用软件按照重要数据的初始值运行。",0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。
",0,0,0,0,0,1,0,0
"功能描述：选择通讯的红外LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）红外共有两个LTU（正俯仰红外LTU和负俯仰红外LTU），AOCC每个控制周期向注入文件中的ZT5和IresLTUSeltFlag的最大组合中指定的红外LTU发送取数指令
（2）向选择的红外LTU发送完取数指令，获得红外LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,1,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：姿态角与角速度估值：
正常模式星敏感器与陀螺定姿输出 
，
或：正常模式其它情形相应程序的输出，
惯性角速度估值：
    陀螺角速度估值 ，
    或：星敏感器定姿输出(F_NoGyro=1或3) =[，]T
实测飞轮角动量    ，
      斜轮标称角动量    
      姿态偏差积分项    ，
      斜轮角动量偏差积分项  
标志F_SatStage
=[，]T",0,1,0,0,0,0,0,0
"功能描述：发送姿态数据
处理：
AOCC每个控制周期（250ms）组织28个字节姿态数据，OBDH每500ms取1次姿态数据（56个字节）。每个数据包中的2个姿态的时标需按照时间顺序排列。",0,0,0,0,0,0,0,1
功能描述： 对部件电源加断电,0,0,1,0,0,0,0,0
"功能：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器A修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,1,0,0,0,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量。
（3）令（i = 1，2，… ，6）。为上一次轮子角动量值。",0,0,0,0,0,1,0,0
"功能描述：对星敏感器输出数据进行有效性判断。
输入：STSFailureDiagPermFlag, ZT6，星敏1 输出四元数，
星敏2输出四元数，星敏3输出四元数，预估四元数
t， t星A，t星B ，t星C ,  tmdts ,ZAR , ZBO Z , ZCR Z ,  ms ,  ms1 ,  ms2 ， ms3。
输出：ZA，XA，ZB，XB，ZC，XC，
星敏感器参与定姿标志FSTA，FSTB，FSTC，FSTD 。",0,1,0,0,0,0,0,0
功能描述：帆板故障检测，切换帆板LTU。,0,1,0,0,0,0,0,0
"功能描述：轨控模式初始化
",0,1,0,0,0,0,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理：包括CPU内部星时时钟和CPU外部星时时钟的星时采集计算与校时。
（1）CPU外部星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期星时锁存寄存器中读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU外部星时时钟星时校时包括OBDH校时和GPS高精度校时两种校时方式：
OBDH校时：当“OBDH星时校时开关”为允许的情况下，进行校时，要求“OBDH星时校时开关”为可内存修改的变量（默认为“OBDH星时校时开关”为“允许”），地面可通过内存修改的方式设置“OBDH星时校时开关”。也分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；
 GPS高精度校时。
OBDH星时校时为系统默认使用的校时方式。GPS秒脉冲高精度时间是否引入系统由注入指令执行控制：若注入指令表示“使用GPS秒脉冲高精度校时时间”，则当满足GPS秒脉冲高精度校时条件时AOCC应用软件仅进行GPS秒脉冲高精度校时时间的计算，系统使用该时间。GPS秒脉冲高精度方式优先级高于OBDH星时校时，当GPS秒脉冲校时时不再进行OBDH星时校时。如果连续超过1分钟均不满足GPS秒脉冲高精度校时条件，则可进行OBDH星时校时。一旦再满足GPS秒脉冲高精度校时条件则继续采用GPS秒脉冲高精度校时。其中GPS秒脉冲高精度校时条件及校时计算具体见任务书中规定。
（2）CPU内部星时时钟的星时采集计算与校时
CPU内部星时时钟星时计算方法。同CPU外部星时时钟星时计算；CPU内部星时时钟星时校时只包括OBDH校时：分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时。
星时的选取
根据注入的姿控数据块2中的CPU星时时钟选用标志来实现内部星时时钟和外部星时时钟的切换，默认为CPU外部星时时钟
均匀校时
内部和外部时钟星时计算中在计算完本周期绝对星时后增加每周期修正量，并在计算前先将它限幅到1毫秒，每周期的修正量初始为0，通过内存修改来修改该修正量。",0,0,0,0,1,0,0,0
"功能描述：使用红外、星敏、太阳定姿时，计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0
"功能描述：诊断姿控喷管微漏故障
",0,1,0,0,0,0,0,0
"功能描述：利用估计的四元数转换姿态角，送给星敏感器的四元数。
",0,1,0,0,0,0,0,0
"功能描述：根据红外信息，进行全姿态捕获
",0,0,0,0,1,0,0,0
"功能描述：
 完成推力器判断和处理功能（功能编号：FReq-15）。

处理：进行推力器喷气量过量的故障诊断，仿真推力器堵漏、安装错误等故障。诊断出一份故障后等待1000个周期，再进行另一份推力器故障诊断的要求。具体判断与处理逻辑详见任务书，任务书中cntwaitWTF的相关操作实际无效，软件可自主实现其相关操作。
根据推力器故障诊断逻辑，综合考虑了推力器的工作分支、太阳可见标志SP61/62、太阳数据跳数等相关因素。",0,1,0,0,0,0,0,0
"功能描述：根据注入轨道参数计算地磁场强度。
处理：
由星时和外推轨道数据星上实时计算地磁场强度。",0,1,0,0,0,0,0,0
"功能描述：发送星敏陀螺数据给OBDH保存
处理：将星敏陀螺数据打包后放到星敏陀螺数据内存地址空间中。",0,0,0,1,0,0,0,0
"功能描述：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。
",0,1,0,0,0,0,0,0
"功能描述：根据GPS接收到的数据计算轨道平根数和GPS数据有效性。
处理：
STEP1：若ZT41[4]=0，则使用通道板数据计算GPS数据对应得星时及在惯性系中的位置速度，瞬根数；否则瞬根数用轨道板数据；
STEP2：计算平根数；
STEP3：GPS数据有效性判断。其中误差增加模PI限幅。",0,1,0,0,0,0,0,0
功能描述：实时计算卫星轨道参数。,0,1,0,0,0,0,0,0
"功能描述：将注入到SRAM中的程序搬家至相应EEPROM区
处理：
- 将解包得到的目的地址、注入长度、源地址分别赋给变量E2_StartAddress, E2_Length, SourceAddress；
- 调用系统软件提供的函数E2prom_Prog(unsigned int E2_StartAddress, unsigned int E2_Length, unsigned int SourceAddress)
说明：应用软件需要考虑跨页操作，地面保证发送“启动EEPROM修改”指令后，10ms内不对EEPROM进行操作。",0,0,0,0,0,0,1,0
"功能描述：仅使用红外定姿时，计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0
"软件需求名称：自锁阀开关控制 
需求类别：其他 
软件需求描述：控制自锁阀开关。",0,0,1,0,0,0,0,0
"功能描述：轨控段喷气控制计算。
处理：同用户需求的
（1）各轴喷气参数设置如表36所示
表36：轨控段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|0.4 mθD04|0.4 mθD04|0.4 mθD04
|1.0 mθD13（注1）|1.0 mθD13（注1）|1.0 mθD13（注1）
|1.0 mθB36|1.0 mθB36|1.0 mθB36
|3.0 mθB33（注1）|3.0 mθB33（注1）|3.0 mθB33（注1）
|0.1|0.14|0.07
|0.2|0.2|0.2
|（注3）|（注3）|（注3）
|0.3|0.3|0.3
|0.43（注2）|0.43（注2）|0.43（注2）
|（注3）|（注3）|（注3）
KJ2(s)|2|2|2
aJS（/s2）|0.137|0.235|0.089

注1：在BZ1 =3、4的条件下
注2：在BZ1 =2的条件下
注3：在BZ1 =4的条件下
（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,0,0,1,0,0,0,0
功能描述：对工作的飞轮进行电压补偿，并输出控制电压。,0,1,0,0,0,0,0,0
"包括三个功能点：发送姿态数据、陀螺数据、星敏感器数据辅助数据，功能描述和列写如下：
序号|功能描述|功能编号
1|发送姿态数据|FREQ7.14.1
2|发送陀螺数据|FREQ7.14.2
3|发送星敏感器数据|FREQ7.14.3
",0,0,0,0,0,0,0,1
"功能描述：二次电源切换。
处理：
ACU内部含有两套二次电源，两套互为备份，可以同时加电工作，通常仅一份工作。AOCC每个控制周期采集工作电源的状态模拟量，并设置当班状态（5V和12V遥测模拟量≥3V即当班，若同时符合条件则置主份当班），若连续4个控制周期两套电源均不当班，且允许自主切换，则连续两个控制周期先后发送主份电源开、备份电源关两条指令，并置主份当班。
若当班电源的5V或12V遥测模拟量连续5个控制周期<3V时，且允许自主切换，则连续两个控制周期先后发送另一份电源开、本电源关两条指令，并禁止自主切换；若禁止自主切换，则设置切机命令字。
上电/复位初始化为允许自主切换，当班标志为保持。",0,0,0,1,0,0,0,0
"软件需求名称：太阳敏感器使用及通信 
需求类别：其他 
软件需求描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
太敏初始化|FREQ41|太敏初始化|B|2
太敏数据采集|FREQ42|太敏数据采集|A|3
数据解包与转换|FREQ43|数据解包与转换|A|4
太敏数据有效性判断|FREQ44|太敏数据有效性判断|A|5
太敏故障重构|FREQ45|太敏故障重构|C|
",0,0,0,0,0,1,0,0
功能描述：自旋模式初始化,0,1,0,0,0,0,0,0
"功能描述：用整星广播时间校正星上时间
处理：解包广播校时数据，
- 若为星务UTC校时，计算星务星箭分离星时；
- 若当前星时与星务星箭分离星时相差绝对值小于dt，则实施校时；否则不校时。
- 校时成功后，更新星敏、CCD、微波测距仪、可见光相机的同步信号基准时刻。
说明：上电/复位时，dt = 200秒；成功校时后，dt = 10秒",0,0,0,0,0,0,1,0
"AO在主动段初始化中进行如下工作：
星时清零；
工作模式为主动段；",0,0,0,1,0,0,0,0
"功能描述：接收服务请求确认字
处理： 将接收服务请求确认字存储地址中内容解包成服务请求确认字的数据格式，根据不同的服务请求确认字停止对应的服务请求的申请。",0,0,0,0,0,0,1,0
"功能描述：选择通讯的天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
  （1）加电状态的判断：OBDH在给捕跟分系统发送加电命令的同时，将该命令发送给AOCC。AOCC根据命令字的内容，记录加电状态和工作的主备状态。当第一次得到加电指令时，如果没有主备命令，默认工作在主份；当没有加电，但是发送了主备切换命令，切换有效。中继捕跟分系统断电，再加电后，保留中继上次加电工作状态；当AOCC发生复位、NMI和切机时，保留中继上次加电工作状态。
（2）数据通讯：当接收到中继快扫命令，并且AOCC判断中继捕获跟踪分系统加电状态下，AOCC每个0.524秒控制周期，向GDA发送一次天线驱动机构双轴指向数据。并接收GDA传回的X、Y轴测量角度信号和两轴的偏差角度（X轴框架角、Y轴框架角、X轴偏差角、Y轴偏差角、X轴框架角速度、Y轴框架角速度）。当接收到中继停止命令或判断中继不加电，则停止通讯。",0,0,0,0,0,1,0,0
"功能描述：与帆板通信，控制帆板并获得帆板状态数据。
处理：
功能编号|功能|引用文档|备注
FREQ46|帆板初始化|帆板协议|B
FREQ47|帆板数据采集|任务书、帆板协议|B
FREQ48|数据解包与转换|帆板协议|B
FREQ49|帆板数据有效性判断、处理|任务书|B
FREQ50|帆板控制量输出|帆板协议|B
FREQ51|帆板故障重构|任务书|B
",0,0,1,0,0,0,0,0
"功能描述：根据陀螺输入，预估卫星惯性姿态。
输入：采样周期，陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出： ",0,1,0,0,0,0,0,0
功能描述：帆板未展开模式控制,0,1,0,0,0,0,0,0
功能描述：三轴稳定模式下的帆板控制。,0,1,0,0,0,0,0,0
"功能描述：计算正常飞行模式轮控所需电压
说明：系数，装订值均为1，可注入修改。",0,1,0,0,0,0,0,0
"表格工作项|软件需求标识|软件需求名称|
FREQ23.1|固定地址参数|见“上行注入”5|
FREQ23.2|可变地址参数|见“上行注入”6|
FREQ23.3|轨道参数|见“上行注入”7|
FREQ23.4|程序注入|见“上行注入”8|
FREQ23.5|内存下卸|见“上行注入”9|
FREQ23.6|星敏部件控制注入|见“上行注入”10|
FREQ23.7|中继目标轨道|见“上行注入”11|
FREQ23.8|轨控命令|见“上行注入”12|
FREQ23.9|间接指令|见“上行注入”13|
FREQ23.10|固定地址|见“上行注入”14|
",0,0,0,0,0,0,1,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。
",0,0,0,1,0,0,0,0
"功能描述：接收数据指令注入块的系统状态设置类指令	
处理：
序号13允许CMG高速自主启动和序号34禁止CMG高速自主启动初值更改，改为默认允许。序号29允许自主喷气保护和序号34禁止自主喷气保护初值更改，改为默认允许。",0,0,0,0,0,0,1,0
功能描述：计算太阳星历、红外补偿量及光行差计算。。,0,1,0,0,0,0,0,0
"功能：利用红外、数字太阳敏感器确定姿态。
",0,1,0,0,0,0,0,0
"功能描述：定义AOCC初始上电至星箭分离为主动段工作模式。
处理：
定义星箭分离前为主动段工作模式，应用软件在控制周期任务函数中进行下列工作：
	星时计算。
	采集部件（太阳敏感器、陀螺、星敏、CMG）信息。
	采集部件、线路遥测模拟量。
	响应主动段测试指令和“运行初始速率阻尼模式”指令。
	对ALTU当班状态判断，并与当班ALTU通讯。
	响应星务分系统轮询、数据遥控指令、数据注入、程序注入、秒脉冲校时等，并进行相应处理。
	星箭分离的确认依据为：一个控制周期内对星箭分离状态位读5次，若连续3次以上读入为“1”，则认为本周期查到星箭已分离，每次读的时间间隔要求大于1ms。如果在连续3个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入初始速率阻尼模式。
	此外，通过地面遥控指令进行以下起飞前设置：
5个CMG加电，并将框架角均转到0度保持、锁定；
6个陀螺加电。",0,1,0,0,0,0,0,0
"功能描述：发送AOCC时间
处理：
CTU加电或复位后通过子地址12（T/R＝0）向AOCC发送“接收记录AOCC时间数据”消息，消息内容为5555H。AOCC收到该消息后应在0.1s内准备好AOCC 时间数据，然后OBDH通过子地址12（T/R＝1）取走AOCC时间数据。",0,0,0,0,0,0,1,0
"功能描述：由模拟太阳A/B码、监视码得到模拟太阳角、见太阳标志。
处理：
以0.25~0.30太阳常数作为门槛值，2路监视码电压信号均高于门槛值时，设置该模拟太阳输出信号有效。在模拟太阳敏感器输出有效前提下，按下面定出的计算公式，对采集的2路A/B码信号进行处理，最终获得模拟太阳敏感器的输出。
测量角，最小码当量0.
上式中XA，XB分别对应2路A/B码中A码和B码的信号输出。
当监视码输出有效且测量角绝对值大于19.6875时，需要进行饱和处理，输出19.6875，极性不变。",0,0,0,0,0,1,0,0
功能描述：接收总线指令                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     处理： 将接收总线指令存储地址中内容解包成总线指令的数据格式，根据不同的总线指令进行相应的处理。 ,0,0,0,0,0,0,1,0
"功能描述：模式5切换方式。
处理：
若（且WorkModeT=6且 (且)连续次，WorkMode=6；
若（且WorkModeT=4且 (且)连续次，WorkMode=4；
若{若，则WorkMode= WorkModeT，否则WorkMode=4}；
若FailureFlag=3，置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,1,0,0,0,0,0,0
功能描述：把三轴控制电压转换到工作飞轮的控制电压。,0,1,0,0,0,0,0,0
"功能描述：控制算法描述
",0,1,0,0,0,0,0,0
功能描述：校正星上星时。,0,0,0,0,0,1,0,0
"功能描述：运行段喷气姿态控制及飞轮控联合运行。
处理：同用户需求的
（1）各轴喷气参数设置如表35所示
表35：运行段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|2.0|2.0|2.0
|1.0 mθD11（注1）|1.0 mθD11（注1）|1.0 mθD11（注1）
|1.0 mθD11（注2）|1.0 mθD11（注2）|1.0 mθD11（注2）
|4.5（注4）|4.5（注4）|4.5（注4）
|3.0 mθB31|3.0 mθB31|3.0 mθB31
|0.14|0.2|0.1
|0.2（注3注4）|0.2（注3注4）|0.2（注3注4）
|（注3-1）|（注3-1）|（注3-1）
|0.03|0.03|0.03
|0.08|0.08|0.08
|0.43（注3注4）|0.43（注3注4）|0.43（注3注4）
|（注3-1）|（注3-1）|（注3-1）
|0.2（注1）|0.2（注1）|0.2（注1）
|0.06（注2）|0.06（注2）|0.06（注2）
KJ2(s)|3|3|3
KJ2(s)|0.5（注3-1）|0.5（注3-1）|0.5（注3-1）
aJS（/s2）|0.137|0.235|0.089

注1：在FHU = A或 { BZ1 = 4，FEA = 0 }的条件下
注2：在FHU = A，ZT3 = F或A或B的条件下
注3：在{ BZ1=8且FRTS=1}的条件下
注3-1：在{ BZ1 = 3，ZT36 = F }的条件下
注4：在ZT40(2)=1,BZ1=1,ZT8≤3,ZT2≤2,FWH≠22的条件下
（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,1,0,0,0,0,0,0
"功能描述：发送遥测数据
处理：
包括两个子地址，发送两条指令是连续的，共有76个字节。应用软件在收到发送遥测帧计数（低字节为实时遥测帧计数0~63，高字节为实时格式计数0~7）的低字节为62时，根据高字节实时格式计数根据延时遥测数据格式进行打包后放到发送延时遥测参数地址中，具体数据见延时遥测文件。",0,0,0,0,0,0,0,1
"功能描述：更新地面遥控注入的可变地址参数并处理

处理：解包可变地址数据包，更新相应地址的参数。
可变地址参数注入时，星务分系统向GNCC送数采用8字节(有效使用1字节)帧格式，最多同时注入15个数据。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,1,0
"功能描述：接收时间码
处理： OBDH分系统每1分钟给AOCC校时一次。",0,0,0,1,0,0,0,0
"功能：利用星敏感器B的测量，修正姿态四元数与姿态角速度。
",0,0,0,0,1,0,0,0
功能描述：确定陀螺数据转换矩阵A及B；计算漂移。,0,1,0,0,0,0,0,0
"功能描述：仅利用星敏感器B、C的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|部件状态、双组元推进状态1、推进状态2、ACU工作状态|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|计算得到的喷气脉宽、磁力矩器电压|控制指令消息的输出|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
|部件加断电指令的处理|FREQ1.8.4|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.5|保存CCU的重要数据|接收CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.6|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|REQ1.8.7|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.8|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.9||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,1,0,0
"功能描述：计算磁卸载所需的磁矩与磁力矩器工作电压。
",0,1,0,0,0,0,0,0
"功能描述：为机动过程姿态确定提供初始姿态。
",0,1,0,0,0,0,0,0
功能描述：发送矢量字,0,0,0,0,0,0,0,1
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ12|4.2.1|将陀螺有效输出数据，换算成卫星三轴角度增量
|欧拉角姿态预估|FREQ13|4.2.2|根据陀螺输出，预估卫星姿态和姿态角速度
|红外输出的数据处理|FREQ14|4.2.3.1|根据红外输入，计算姿态偏差、弦宽误差估计与量测新息
|太阳输出的数据处理|FREQ15|4.2.3.2|根据姿态估值与数字太阳输出，计算量测的一步预测与新息
|红外的姿态修正|FREQ16|4.2.4.1|根据红外输出，估计卫星姿态与陀螺漂移
|红外与数字太阳双矢量滤波姿态修正|FREQ17|4.2.4.2|利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差
|正常模式姿态四元数预估|FREQ18|4.2.5.1|姿态角速度与姿态四元数的预估，包括使用陀螺数据和不使用陀螺数据的姿态四元数预估
|星敏感器数据预处理与姿态修正|FREQ19|4.2.5.2|利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序
|星敏感器A、B姿态修正|FREQ20|4.2.5.3|利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移
|星敏感器A姿态修正|FREQ21|4.2.5.4|利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移
|星敏感器B姿态修正|FREQ22|4.2.5.5|利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移
|正常飞行模式的姿态角估计|FREQ23|4.2.5.9|利用估计的四元数转换姿态角
|由正常模式机动起始时刻的姿态四元数|FREQ24|4.2.6.1|为机动过程姿态确定提供初始姿态
|从偏置机动回正常模式时机动起始时刻的姿态四元数|FREQ25|4.2.6.2|为该机动过程姿态确定提供初始姿态
|机动过程与轨控模式的姿态确定|FREQ26|4.2.6.3|利用陀螺确定出卫星对目标的姿态四元数
|从偏置飞行机动回正常模式后的初始姿态换算|FREQ27|4.2.6.4|为正常模式姿态确定提供初始姿态
|计算星敏感器定姿需要的初始姿态|FREQ28|4.2.7|为星敏感器定姿提供初始的相对惯性的姿态四元数。
|红外与数字太阳双矢量定姿|FREQ29|4.2.8|利用红外、数字/太阳敏感器确定姿态
|星敏感器双矢量定姿|FREQ30|4.2.9|利用星敏感器A、B的测量，估计姿态
|不使用陀螺数据的星敏感器A、B姿态修正|FREQ87|4.2.5.6|利用星敏感器A、B的测量，修正姿态四元数
|不使用陀螺数据的星敏感器A姿态修正|FREQ88|4.2.5.7|利用星敏感器A的测量，修正姿态四元数
|不使用陀螺数据的星敏感器B姿态修正|FREQ89|4.2.5.8|利用星敏感器B的测量，修正姿态四元数
|红外差分姿态确定算法|FREQ90|4.2.10|无陀螺时用红外估计滚动、俯仰姿态角及角速度信息
|卫星跟踪姿态及对地表定向目标角计算|FREQ90.1|""4.2.13
4.2.13.1""|计算卫星正常对地跟踪姿态及对地表定向目标角
|偏航目标角计算|FREQ90.2|4.2.13.2|计算偏航跟踪目标姿态，实现帆板对日定向
",0,1,0,0,0,0,0,0
"功能描述：将陀螺有效输出数据，换算成卫星三轴角速度。
",0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,0,1,0,0,0
CCU控制周期为125ms，对于BC端每帧50ms通信同步服务，应用软件采用轮询方式查询帧序号，作为循环缓冲区子地址指针复位时判断使用。,0,0,0,0,0,0,1,0
"功能描述：检测红外HL及HR故障，并选取正确的红外信号。

处理：
FM3——5.3（1）更改：若ZT35(3)=0，则：当HL通讯自检信号中表明见太阳，则HL = 0。若ZT35(3)=0，则：当HR通讯自检信号中表示见太阳，则HR = 0。
5.3（3）更改：若HL  HR = 1且HL的LTU中的特征位为“数据正常”，则：FHL  FHL + 1。若HL  HR = 1且HR的LTU中的特征位为“数据正常”，则：FHR  FHR + 1。
5.3（4）①更改： ZT5  4，{FHR < 6，HL =0}或{ FHL < 6，HR =0}
5.3（4）③更改： ZT5  4，HL = 1，HR = 0，FHL  6
5.3（4）④更改：ZT5  4，HR = 1，HL = 0， FHR  6
将红外数据有效性互检中的判断逻辑，扣除标称侧摆角度。",0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的陀螺漂移系数,0,0,0,0,0,0,1,0
功能描述：由数字太阳粗细码得到数字太阳角、全开码、见太阳标志。,0,0,0,0,0,1,0,0
"功能描述：与CMG通信，控制CMG并获得CMG数据。
处理：
功能编号|功能|引用文档
FREQ74|初始化|与CMG通讯协议
FREQ75|CMG使用要求|任务书
FREQ76|通信(串口)|与CMG通讯协议
FREQ77|通信故障处理|任务书
FREQ78|数据解包与转换|与CMG通讯协议
FREQ79|帆板数据有效性判断、处理|任务书
FREQ80|帆板模拟量采集、处理|任务书
FREQ81|部件在轨转发（在轨修改）|任务书
",0,0,1,0,0,0,0,0
将AOCC计算得出的星历数据打包后放到星历数据地址空间中。,0,0,0,0,0,0,0,1
功能描述：根据帆板角误差、控制帆板跟踪太阳。,0,1,0,0,0,0,0,0
"功能描述：
  通过简化伪速率调制器计算5N推力器喷气脉冲，并输出(功能编号：FReq-3。
处理：根据三轴简化伪速率调制器的输出值计算出12个5N推力器的输出值。重新置定时器0的初值，设置5N推力器的输出，启动定时器0计数。逻辑如下：
根据5.2.5节获取控制力矩Yi：
若Yi–r>h1,  则输出Y＝1，Tri＝1；
  		若Yi–r<-h1, 则输出Y＝-1，Tri＝-1；
  		否则输出Y＝0，Tri＝0；
		r = 0.614*r + 0.0861*Y   // r 上电初始化为0
当 Tri = 1 
	ThrNoNi = ThrNoNi + 1                   		 
当Tri = -1
	ThrNoPi = ThrNoPi + 1                   		
当Y为+1时产生一个64ms的负脉冲，Y为-1时产生一个64ms的正脉冲。
具体喷管的选择参考任务书。
   推力器双分支工作时，若A份中的推力器不健康，则使用B份对应的推力器。
说明： 控制力矩的计算增加 伪速率调制器r的计算，同时修改h1的参数",0,0,1,0,0,0,0,0
"功能描述：地地全姿态捕获模式控制
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。",0,0,0,0,1,0,0,0
功能描述：接收遥控中继星轨道注入块,0,0,0,0,0,0,1,0
"功能描述：发送姿态数据包、红外太阳敏感器数据包、星敏感器数据包、姿态控制数据包、天线数据包、轨道数据包、部件工作状态数据包、系统工作状态数据包、全姿态捕获模式数据包、模拟量遥测数据包。
处理：数据内容见《卫星控制分系统数字量遥测数据格式定义》。
要求应用软件设计时，对角速度相关的遥测参数采取平滑处理，并将处理后的结果遥测输出（高精度数据包中记录的角速度相关数据不采用平滑处理），平滑处理要求为本周期输出的遥测值为最近8个控制周期该遥测参数的平均值。需采取平滑处理的遥测参数包括不同定姿方式下的三轴角速度遥测（dφ/dθ/dψ、//、/）以及角速度误差遥测（//）。",0,0,0,0,0,0,0,1
"功能描述：输出喷气指令
处理：
（1）将喷气的喷管打开
（2）将喷气长度写入各自通道的定时器；",0,0,1,0,0,0,0,0
"功能描述：利用估计的四元数转换姿态角，计算送给星敏感器的四元数。
",0,1,0,0,0,0,0,0
"功能描述：光纤陀螺数据处理
",0,0,0,0,0,1,0,0
功能描述：置卫星姿态无控，处于自由飞行状态。,0,1,0,0,0,0,0,0
AOCC在收到此指令并且判断数据正确后，即认为星箭分离有效，通过方式代码的服务请求，申请OBDH停止发送星箭分离信号。当AOCC应用软件接收到CTU发送至AOCC的通知进全捕指令时，AOCC自主转入全捕模式，并通过服务请求告诉CTU  AOCC已收到CTU通知进全捕指令，停止传送该信号，具体要求详见《星串行数据总线通信协议》。,0,0,0,0,0,0,1,0
"上行注入功能是地面干预星上运行状态的重要手段，主要是指OBDH通讯协议中定义的控制分系统“接收遥控注入数据”功能。上行注入数据块由地面发送到OBDH分系统，再由OBDH分系统通过B总线发送到AOCC执行。包括下表的功能点。
序号|功能描述|功能编号
|轨道数据块|FRE74
|姿控数据块1|FRE74.1
|姿控数据块2|FRE74.2
|LTU通信选择块|FRE74.3
|故障诊断标志块|FRE74.4
|星敏感器命令块|FRE74.5
|惯性调姿命令块|FRE74.6
|轨控命令块|FRE74.7
|SDC命令块|FRE74.8
|LTU命令块|FRE74.9
|内存修改块|FRE74.10
|应急控制器注入块|FRE74.11
|系统软件标志修改块|FRE74.12
|程序块|FRE74.13
|相平面系数块|FRE74.14
|轮控系数1及磁控系数|FRE74.15
|轮控系数块2|FRE74.16
|陀螺脉冲当量系数块|FRE74.17
|星敏修正系数块|FRE74.18
|条件判断、阀值和限幅相关数据块|FRE74.19

具体的内容见注入文件。",0,0,0,0,0,0,1,0
"功能描述：
 太阳捕获功能主要实现速率阻尼、俯仰搜索、滚动搜索、巡航等功能，使卫星由任意姿态进入保持对日定向巡航姿态运行。太阳捕获功能分为速率阻尼、俯仰搜索、滚动搜索和巡航四种方式（FReq-6）。
                        表5-2 方式字定义
名称|方式字定义|说明
RDSM|0|速率阻尼方式.(默认方式，程控结束后进入)
PASM|1|俯仰搜索方式
RASM|2|滚动搜索方式
CSM|3|巡航运行方式

处理： 
  （1） 模块初始化设置
   程序结束后，根据任务书5.4.5.3.1节进行模块初始化设置。考虑到地面遥控指令可以重新进入太阳捕获模式（速率阻尼初始化置陀螺故障诊断不允许），软件对模块初始化中的变量分为2个部分，其中以下部分为程控结束后只设置一次的变量：   
推力器输出状态清零；
CleNum = 0;  
采用MRE板数据设置陀螺顶替标志；（考虑S陀螺健康时才进行相应顶替）。
若有飞轮的电源状态为开，则允许飞轮进行转速控制WheelCon＝TRUE；
部分软件自身使用的变量。
（2）在太阳捕获中需要进行动量轮刹车控制以及方式控制：
动量轮刹车控制详见5.2.17节。（有动量轮加电，则进行动量轮刹车控制。）
（3）方式控制如下：
(I) 对卫星进行速率阻尼，连续35个控制周期三轴角速度绝对值（实际取最大值即可）小于0.14°/s，进入俯仰搜索方式；或者进入速率阻尼方式的时间超过2000个控制周期（256秒）后，进入俯仰搜索，开始搜索太阳。
(II)进入俯仰搜索方式，使卫星以+/-0.5/s（速率阻尼结束后进入时根据SPz13选择极性)绕Y轴转动，若5625个控制周期（720秒）后没有捕获到太阳，进入滚动搜索方式。进入滚动搜索方式后，使卫星以0.5°/s绕X轴转动。
(III) 若(II)中滚动搜索方式经过6250个控制周期（800秒）后还未见到太阳则再重复俯仰搜索和滚动搜索，则再次进入（II），即俯仰捕获方式（这种情况下b＝-0.5/s）。其中滚动搜索不成功的故障处理逻辑见5.2.14节。
(IV) 在(II)(III)过程中一旦捕获到太阳且持续时间大于2.048秒(16个控制周期)，则进入巡航方式。进入巡航模式后，控制SADA归零。
说明：捕获太阳时，对于持续时间大于2.048秒的判断，太阳连续可见（SP61/62 = 1）的条件下，俯仰搜索时，俯仰角绝对值大于1°的累计时间；滚动搜索时，滚动角绝对值大于1°的累计时间。",0,1,0,0,0,0,0,0
"功能描述：将陀螺有效输出数据，换算成卫星三轴角度增量。
",0,1,0,0,0,0,0,0
功能描述：轨控模式时使用轨控发动机及其备份。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.3|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.4|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据轨控需求和姿控推力器使用情况，开推力器进行轨道控制
|轨道控制喷气|FREQ4.3|5.4.6|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1.1|地面站赤经赤纬计算
|数传天线指向控制|FREQ4.14|5.6.1|根据指令完成数传天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|基于三轴角动量反馈的偏置动量控制方法产品规范|FREQ4.21|/|规范化算法：
|数传天线指向目标角计算|FREQ4.14.2|5.6.1.2|根据指定跟踪数传天线与其被指定跟踪站的方位，计算其跟踪转角
",0,1,0,0,0,0,0,0
"功能描述：模式4切换方式。
处理：
if() 置WorkMode=5，WorkModeT=6，；//程控指令转对地
if(lipse=1且且AutoPermission=1) 置WorkMode＝5；WorkModeT=6；；；//进入阴影区自主转对地
if() 置WorkMode=5；若，若，；WorkModeT=6；
if() 置WorkMode=5；若，若，WorkModeT=6；
收到星务的“辐射定标”指令，置WorkMode=5，WorkModeT=6，；//辐射定标模式，为注入的辐射定标目标角
if(FailureFlag＝1) 置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,1,0,0,0,0,0,0
"功能描述：搜索太阳，直到数字/模拟太阳敏感器有太阳信息
",0,1,0,0,0,0,0,0
"功能描述：检测推力器的微漏，必要时作相应的主备份切换。
",0,1,0,0,0,0,0,0
功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。,0,1,0,0,0,0,0,0
CTU复位后需要从AOCC恢复重要数据和星上时间。首先CTU发送“接收用于做时间差值的时间码”指令，将CTU目前的时间发送给AOCC。AOCC将星上时间和接收到的CTU时间做差值处理，将AOCC时间-CTU时间保存。CTU在1s后发送“发送时间差值”指令，AOCC将保存的时间差值发送给CTU。,0,0,0,0,0,0,0,1
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得9个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据，AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式。",0,0,0,0,0,1,0,0
功能描述：计算在整星角动量偏置下，CMG控制时的框架角速率指令。,0,1,0,0,0,0,0,0
"功能描述：卫星正常运行模式之一，完成三周对地指向，包含辐射定标方式。
处理：控制分系统按照地面规划的指令在轨道A、B、C、D四个点进行姿态机动来完成日地、地日、地地之间的姿态转换。辐射标定模式下的姿态固定，由数据指令控制进入标定模式。
在该模式下，控制系统根据数据块指令提供的开始和结束时间，开始、停止对指定天线控制角度进行计算，并0.5秒向天线发送一次控制指令。
正常模式初始化需向引入的星敏发送TC_RATE_LIMIT指令，将星敏工作的最大转速设置为固定地址注入的ratelimitnormal值（高精度状态）。
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺的数据处理；
调用四元数陀螺预估；
调用星敏感器数据处理；
if(MoveSTSInSystemFlag=2且SSTCatchSuc＝0) 调用 星敏感器对日定向 的a项；
调用利用星敏感器的姿态确定；
调用中继天线捕获跟踪控制；
调用对地数传天线捕获跟踪控制；
调用目标姿态确定；
调用控制器输入量计算；
调用喷气卸载条件计算；
调用CMG奇异状态的判断及算法计算；
if((UnLoadMode =0  或 TimeStopC > 0.0) 
{调用CMG的控制；调用磁卸载控制；}
else {if(Flag_equation=0且TimeStopC<=0)调用相平面喷气脉宽；
调用CMG启动与保持；}
调用系统故障诊断；",0,1,0,0,0,0,0,0
"功能描述：滚动机动目标姿态确定。
",0,0,0,1,0,0,0,0
"功能描述：三轴稳定模式下，检测系统故障。
处理：
（1）基本处理
将系统故障打分FSY限幅到[7，]。
（2）FSY加减分
条件|FSY的处理
（红外输出有效），ZT3≠C(用星敏感器+陀螺定姿，且接入控制回路)，ZT3≠A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式)，|FSY加一分
（红外输出有效），ZT3≠C(用星敏感器+陀螺定姿，且接入控制回路)，ZT3≠A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式),{或}|FSY减一分
（红外输出有效），ZT3=C(用星敏感器+陀螺定姿，且接入控制回路)或ZT3=A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式)，|FSY加一分
（红外输出有效），ZT3=C(用星敏感器+陀螺定姿，且接入控制回路)或ZT3=A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式),{，}|FSY减一分
或或，FGF=1|FSY减一分
或或，FGF≠1|FSY减4分
，FSTD>1，且{（且）或ZT5=0}|FSY加4分

处理FSY,ZT3,AttTurnFlag和
条件|FSY的处理
C，A，BZ5连续239次为0|FSY=1
，FSTD连续954次为1,ZT5=0|FSY=1
，FSTD连续954次为1,|""FSY=
ZT3=3,；AttTurnFlag=1""
A，FSTD连续250次为1|FSY=1
，FSTD≠1|AttTurnFlag=0
FSY≤64H,ZT3=C,ZT5≠0|""FSY=
ZT3=3,；AttTurnFlag=1""
，AttTurnFlag=1，ZT41[2]=1允许自主由红外转回星敏定姿时，若连续120次(且，且)|，AttTurnFlag=0

(4) 若ZT226，FSY07，ZT8 =F，ZT9 =F，则ZT8=0,ZT9=0,BZ7=Jeti2。
（5）根据FSY的结果和ZT22、ZT8、ZT9对BZ1进行处理
条件|BZ1的处理
ZT226，FSY07且ZT8  3，ZT9  3|BZ1 = 3
ZT226，FSY07且ZT8  4或ZT9  4|BZ1 = 7

（6）根据FSY的结果和ZT22、ZT8、ZT9以及BZ7重置BZ7
条件|BZ7的处理
ZT226，FSY07且ZT8 = 0（可自主切换主备份姿控发动机），BZ7=1（可用姿轨控主份推力器）|BZ7 = 2
ZT226，FSY07且ZT8 = 0，BZ7=3（可用姿轨控主份及备份推力器）|BZ7 = 2
ZT226，FSY07且ZT8 = 0，BZ7=2（可用姿轨控备份推力器）|BZ7 = 1

（7）若ZT226，FSY07，ZT43[4]=1允许自主给陀螺加电，则陀螺自主加电。
（8）若ZT226，FSY07，ZT44[4]=0，FlagWHCtl=A或ZT3=B，则FlagWHCtl=5;ZT3=3;ZT8=0;BZ7=Jeti;陀螺漂移赋值；Ix,Iy,Iz,Ihx,Ihz清0。
（9）指定FlagAttTurnIres=0后，系统不使用红外进行姿态监视，仅根据有效红外进行姿态修正。",0,0,0,1,0,0,0,0
"功能描述：完成卫星入轨后一圈内的控制，完成卫星入轨后的初始姿态捕获，消除星箭分离和太阳帆板展开所产生的姿态扰动，进行动量轮启动和控制，建立对地定向三轴稳定的正常运行姿态
进入条件：
满足下列条件之一：
自主条件（满足下列条件之一）：
星箭分离后的应用软件累计运行时间（24位浮点数）且（0.524秒控制周期累计计数）
ZT1 = 0（入轨初模式）且ZT32 = A（ZT1不等于1）且
退出条件：
满足下列条件之一：
自主条件：满足转入BZ1=1（Z轴对地控制模式）
地面上行注入ZT1不等于（B 、0、1、4）
处理过程：过程如下：
STEP1：进行姿态预估（同用户需求的），得到姿态角和角速度，并赋给姿态角和角速度偏差
STEP2：根据入轨时间分别进行不同的处理：
当[0，5）秒时，先关LV2、4，再开LV1、3，分两个周期进行（第一个周期先关LV2、4，第二个周期再开LV1、3）。
当（1，80（消初偏结束时刻））秒时， 进行消初段喷气姿态控制。
当（80，95）秒时，不控直接退出。
当大于95秒时，进行运行段喷气姿态控制。
当大于120秒（红外接入时刻）时，姿态红外修正、陀螺故障检测及选择和运行段帆板控制。
当（4200（动量轮接入时刻），5400）秒时，如果左右帆板转角输出的绝对值都小于10度，则将ZT19、ZT20分别赋给BZ9、BZ10；如果ZT2不等于2，则置ZT2为1。
当大于4750秒时，如果ZT2等于1且三轴角动量偏差均小于1，则置ZT2为2。
当大于等于4800秒时，置BZ1=1，ZT1=1。
STEP3：根据ZT2的值进行飞轮控制。",0,1,0,0,0,0,0,0
"功能描述：根据陀螺输入，予估q及姿态角（在星测量回路中），等。。
处理：同用户需求的1.6。
STEP1:计算星敏预估角速度，。计算结果的限幅值是0.027。计算公式见1.6（1）。
STEP2:计算q,和，计算公式见1.6（2）。
STEP3:计算，。对于计算结果，当BZ1=8（侧摆机动）时，否则。对于计算结果，。对于计算结果，。计算公式见1.6（3）。",0,1,0,0,0,0,0,0
功能描述：数传天线数据处理,0,0,0,0,0,1,0,0
"功能描述：
  根据三轴姿态角和姿态角速度误差计算三轴控制力矩(功能编号：FReq-5)。
处理： 
控制器结构为PD控制，见下图。
图5-2  PID控制器
控制器输入计算和限幅：角度信息、角速度信息由5.2.2节获取；
用于计算控制力矩的角度信息限幅为[-5,5]度、角速度信息限幅1.0度/秒。
；
		；",0,1,0,0,0,0,0,0
"功能描述：消除星体角速度，并使星体Z 轴指向太阳
",0,1,0,0,0,0,0,0
"功能描述：根据注入轨道参数计算太阳轨道、方位与其他参数。
处理：
由太阳平近地点角和星时计算赤道惯性坐标系的太阳矢量。利用外轨轨道数据计算惯性到轨道的转换阵并计算出太阳矢量在轨道坐标系的分量。利用外推轨道计算卫星速度、修正参数。计算垂直于地平面的目标角。",0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的系统模式转化条件修正系数,0,0,0,0,0,0,1,0
功能描述：光纤陀螺数据处理,0,0,0,0,0,1,0,0
"功能描述：根据帆板角误差、控制帆板跟踪太阳。
处理：
左帆板的处理流程：
""||""|FF1|
——|——|=0.0105sgn(-)
——|——|=0.00524sgn(-)
——|——|=+0.0000875sgn(-)
[0, 0.0175]|——|=
(0.0175,∞)|1|=+0.0000875sgn(-)
(0.0524,∞)|——|=+0.0000875sgn(-)
[0, 0.0524]|0|=

若，则：FF1=0；
若，则：FF1=1。
右帆板的处理流程：
同左帆板，相应变量替换为右帆板的变量。",0,1,0,0,0,0,0,0
"功能描述：根据需求，计算去往定点观测模式机动过程中所需的目标姿态。
",0,1,0,0,0,0,0,0
"功能描述：计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0
功能描述：根据标志选择轨控发动机。,0,1,0,0,0,0,0,0
功能描述：太阳全姿态捕获模式控制,0,1,0,0,0,0,0,0
"软件需求标识：FREQ17 
软件需求名称：数字太敏数据处理 
需求类别：其他 
软件需求描述：数字太敏数据处理。",0,0,0,0,0,1,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示（十六进制）：
服务编码|发送的条件
12H|模式字转为8（侧摆机动）时
C3H|每隔1分钟或转模式时发送
3CH|上电/复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发一次；直到第60次为止
C0H|如果AOCC发生复位，利用方式代码请求服务，索取OBDH重要数据进行保存。若在大于0.25s的时间内仍未收到接收OBDH重要数据的指令，则重新请求服务，同时索要OBDH重要数据的计数器累加，若此计数器大于等于40，则不再索要OBDH重要数据。若索要OBDH重要数据成功，将此计数器清零。
96H|进入正常模式后发送，收到确认字后停止发送
30H|进入变轨模式后发送，收到确认字后停止发送
90H|进入全姿态工作模式后发送，收到确认字后停止发送
F0H|进入应急模式后发送，收到确认字后停止发送
0FH|进入停控模式后发送，收到确认字后停止发送
",0,0,0,0,0,0,0,1
"功能描述：实现正常模式及侧摆模式下的偏流角计算。
",0,1,0,0,0,0,0,0
"功能描述：利用陀螺确定出卫星对目标的姿态四元数。
",0,1,0,0,0,0,0,0
"功能编号|功能|引用文档
FREQ86|初始化|预留
FREQ87|模太使用要求|任务书
FREQ88|通信(AD)|任务书
FREQ89|通信故障处理|预留
FREQ90|数据解包与转换|任务书
FREQ91|模太硬件故障处理|预留
FREQ92|模太数据有效性处理|任务书
FREQ93|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"软件需求名称：推力器控制 
需求类别：其他 
软件需求描述：根据控制律计算结果，驱动推力器，进行姿态控制。",0,0,1,0,0,0,0,0
功能描述： CMG控制,0,1,0,0,0,0,0,0
"功能描述：接收AOCC重要数据1-4，并处理重要数据1中的内容。
处理：应急线路加电后与OBDH通信，获得陀螺和推力器状态，若连续3个控制周期都没有成功取得重要数据，默认陀螺使用7、8、9号，推力器使用主备份推力器，模拟式太阳敏感器使用ASS1和ASS21。由于AOCC可使用的陀螺为12个（陀螺1~12），可使用的陀螺为9个（陀螺1~9），因此，无法使用陀螺10~12的数据。当恢复AOCC重要数据后，若ZT9表明使用了陀螺10~12，则设置ZT9中陀螺10~12为不可用，陀螺7、8、9为可用，陀螺工作状态BZ9按照设置后的ZT9中由小到大的顺序（从陀螺1到陀螺9）选用3个陀螺。",0,0,0,0,0,0,1,0
功能描述：卫星丢失姿态后，利用红外地球敏感器直接捕获地球，建立正常对地姿态。,0,1,0,0,0,0,0,0
功能：利用星敏感器A的测量，修正姿态四元数与估计角速度。,0,1,0,0,0,0,0,0
"功能描述：滚动/俯仰姿态机动目标姿态确定。
",0,1,0,0,0,0,0,0
"功能描述：滚动/俯仰姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉角，以及轨迹的加速、匀速和减速等特征时间点。
",0,1,0,0,0,0,0,0
"功能描述：姿态角速度与姿态四元数的预估，包括使用陀螺数据和不使用陀螺数据的姿态四元数预估。
",0,1,0,0,0,0,0,0
功能描述：各个模式的初始化设置。,0,1,0,0,0,0,0,0
功能：姿态角、角速度与姿态四元数预估。,0,1,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压
说明：  控制方式发生改变时，每回首次调用该模块时清轮子角动量积分量。",0,1,0,0,0,0,0,0
"功能描述：接收GPS通道板定位数据
处理：将接收GPS通道板定位数据存储地址中内容解包星时、卫星的位置和速度。",0,0,0,0,0,0,1,0
"通讯串口
04H|波特率寄存器|RW|波特率寄存器低位：0x04（115200）
08H|波特率寄存器|RW|波特率寄存器高位：0x00

CAN总线初始化
寄存器名称|初始化内容|初始化意义
""CAN_ADDR        
(CAN总线地址)""|无。|无说明。
""控制寄存器
(Control Register)
""|0x03|""D7D6D5：保留。
D4：超载（接收设备不能按数据发送速率接收数据而造成的数据丢失）中断使能。
高：开放。低：禁止
D3：错误中断使能。
高：开放。低：禁止
D2：发送中断使能。
高：开放。低：禁止
D1：接收中断使能。
高：开放。低：禁止
D0：复位模式。
在初始化的时候，复位模式位置1，才可以进行初始化设置。""
命令寄存器(Command register)|0x=00001100|""D7D6D5：保留。必须。
D4：进入睡眠状态。
高：睡眠 。低：睡眠唤醒。
D3：清除超载状态。不产生超载中断。
高：清除。低：无动作。
D2：释放接收缓冲器。（读接收缓存器内容后，释放缓存器，以便其他报文立即可用）。
高：释放。低：无动作。
D1：夭折发送。
D0：发送请求。
高：报文即将发送。低：无动作。""
""验收代码寄存器
(Acceptance 
Code Register)""|0x87= 10000111|""当通过验收测试的报文被接收，且若存在空的接收缓存器，则各自的描述符和数据场被顺序存贮在空的缓存器中，在不存在空的接收缓存器的情况下，数据超载位被置位高(超载)，当完整的报文被正确接收，将出现下列操作：
接收缓存器状态位被置为高(满)
若接收中断开放位被置为高(开放)，接收中断被置为高(置位)
验收码位(AC.7~AC.0)和报文标识符的最高8位(ID.10~ID.3)必须等于由验收屏蔽位必须满足""
""验收屏蔽寄存器
((Acceptance 
Mask Register))""|0xf8|最后三位相关。
总线时序寄存器0(Bus Timing Register 0)|0x00|""总线时序寄存器的内容决定波特率预分频器(BRP)和同步跳转宽度(SJW)的数值。

通过总线定时器的内容，将波特率预分频器设置为2，即将输入的系统时钟二分频，由于输入的系统时钟已经是将计算机晶体频率14.7456MHz二分频，即7.3728MHz。所以这个时候时钟为3.6864 MHz。""
总线时序寄存器1(Bus Timing Register 1)|0x18|""采样（SAM）=1总线采样1次。
TSEG1和TSEG2确定每位周期的时钟周期数目和采样点位置：

由于一位周期是由

而

波特率＝""
""时钟分频器
(Clock Divider
register)""|0x40|""D7:CAN模式。
0：基本模式。
D5:1(旁路输入比较器，仅在复位模式下起作用)。""
""OCR
(output Control)""|0x|

在完成上述初始化后，要再次初始化控制寄存器。将最低位初始化为0。
说明：地址表上“CAN总线地址”实际是一个写信号的地址，完成对CAN总线控制芯片的选择。因为CAN总线控制芯片的分时复用地址/数据总线（AD7~AD0）实际是和的数据线(D0~D7)接在一起的，该分时复用地址实际是选择控制寄存器用的。这样对于端口寄存器的选择，必须通过数据的写入来完成。对“CAN总线地址”的写入，起到选通CAN控制芯片的作用，而写入的内容，就是对端口寄存器的选择。",1,0,0,0,0,0,0,0
"应用软件共分15个工作模式，分别是主动段、入轨段控制模式、CMG启动模式、正常对地运行模式、姿态机动模式、机动姿态保持模式、轨控姿态机动模式、轨控模式、太阳全姿态捕获模式、地地全姿态捕获模式、偏航捕获模式、姿态无控模式、自旋模式、太阳帆板未展开模式、控制计算机应急模式。模式字和各模式的对应关系如下：
表26 工作模式
模式字|意义
0|主动段
1|入轨段控制模式
2|CMG启动模式
3|正常对地运行模式
4|姿态机动模式
5|机动姿态保持模式
6|轨控姿态机动模式
7|轨控模式
8|太阳全姿态捕获模式
9|地地全姿态捕获模式
A|偏航捕获模式
B|姿态无控模式
C|自旋模式
D|太阳帆板未展开模式
E|控制计算机应急模式
",0,1,0,0,0,0,0,0
"功能描述：当AOCC出现故障时，转入应急线路进行卫星姿态应急控制。
处理
在应急安全模式下，姿态控制工作交由M完成。
应用软件判断进入应急安全模式后，进行下列状态设置：
进入应急模式后，主备份ALTU被M断电，5个CMG的高速断电，低速框架当前位置保持；
	设置控制模式为“应急安全模式”；
	继续进行控制分系统星时计算；
	敏感器信息采集，继续进行轨道和姿态计算；
	磁力矩器和喷气控制量输出均为0，CMG输出全0无效指令，AOCC继续根据当班标志与ALTU 进行通信，并遥测每个控制周期通信状态，对通信失败次数进行循环累计，但不进行通讯故障诊断切换；
	停止对天线控制计算，通信；
	继续响应星务分系统的通信要求。
应用软件退出应急安全模式时，进行下列状态设置：
	发数据遥控指令“太阳捕获模式”，使AOCC退出应急安全模式，进入太阳捕获模式。
	确定ALTU通讯正常后，发星务直接遥控指令给断电；AOCC查询加电标志（地址见表3-3），进行3取2判断，若连续16个控制周期为断电状态且允许退出应急模式，AOCC退出应急安全模式，进入太阳捕获模式",0,1,0,0,0,0,0,0
功能描述：利用星敏感器数据进行卫星姿态捕获。,0,1,0,0,0,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。                                                                                                                                                                                                                                                                                                                                                                                                                    处理：
在AOCC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ66|初始化|与一体化太阳通信协议
FREQ67|数太使用要求|任务书、数太协议
FREQ68|通信|任务书、数太协议
FREQ69|通信故障处理|任务书
FREQ70|数据解包与转换|数太协议
FREQ71|数太数据有效性判断、处理|任务书
FREQ72|数太模拟量采集、处理|预留
FREQ73|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"太阳捕获控制的流程如下：
  if(WacFlag=2) 调用太阳搜索；
  else if(WacFlag=3) 调用对太阳定向；
  else if(WacFlag=4) 
{if (SSTCatchSuc＝0) 调用星敏感器对日定向；
else {  调用四元数陀螺预估；
调用、利用星敏感器的姿态确定；}
}
  else 调用速率阻尼。",0,0,0,1,0,0,0,0
功能描述：GPS定轨程序。,0,0,0,0,1,0,0,0
"功能描述：发送AOCC自身产生的重要数据块1、2
处理：将用户需求规定的AOCC重要数据存放制定的区域（02星去掉加速度计相关变量，新增重要数据ZT3），并当OBDH接收AOCC重要数据时将这些数据存放在OBDH固定的区域中。具体处理过程如下：
STEP1：AOCC应用程序每0.524秒查询一次有无OBDH接收数据请求，如果有则转入第二步，否则退出；
STEP2：将AOCC重要数据从缓存区搬到OBDH规定的内存中。",0,0,0,0,0,0,0,1
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内
    AOCC应用软件应对内存下卸的地址区域进行保护：当内存下卸指令中的首地址、末地址均在PROM硬件地址范围、RAM硬件地址范围、1553B总线接口芯片的RAM地址范围内，则应用软件按照内存下卸指令的要求下卸目标区域的数据；若内存下卸指令中的地址超出上述3个区域的地址范围，则应用软件不更新1553B总线接口芯片中内存下卸内容子地址中对应数据。",0,0,0,0,1,0,0,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书。
功能编号|功能|引用文档
FREQ57|初始化|星敏协议
FREQ58|星敏使用要求|任务书
FREQ59|通信|星敏协议
FREQ60|通信故障处理|任务书
FREQ61|数据解包与转换|星敏协议
FREQ62|星敏数据有效性判断、处理|任务书
FREQ63|星敏模拟量采集、处理|任务书
FREQ64|部件在轨转发（在轨修改）|任务书

3）GPS高精度校时与星敏感器数据的使用
功能描述：根据GPS秒脉冲，秒脉冲广播，进行GPS高精度校时和星敏感器时标处理。",0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|CMG 1数据的采集与处理|FREQ1.9.1|""CMG 1
1553B取数指令
""|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 2数据的采集与处理|FREQ1.9.2|""CMG 2
1553B取数指令
""|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 3数据的采集与处理|FREQ1.3.3|""CMG 3
1553B取数指令
""|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 4数据的采集与处理|FREQ1.9.4|""CMG 4
1553B取数指令
""|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 5数据的采集与处理|FREQ1.9.5|""CMG 5
1553B取数指令
""|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 控制指令的输出处理|FREQ1.9.6|计算得到CMG的控制数据|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
|CMG 6数据的采集与处理|FREQ1.9.7|""CMG 6
1553B取数指令
""|CMG 6的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 6的当班标志为1），每周期向CMG 6 RT发取数指令，获得CMG 6数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG的程序注入修改|FREQ1.9.8|从OBDH收到的CMG需修改程序内容|CMG需修改程序内容|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
|CMG的内存下传|FREQ1.9.9|从OBDH收到的CMG内存下传设置指令|内存下传设置指令|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,1,0,0
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理",0,0,0,0,0,0,1,0
"功能描述：重要数据保存
处理：回送重要数据
说明：上电/复位35秒内 或 主动段 或 任务超时 或 与LTU通讯连续失败20次且自主切换禁止，不保存重要数据。",0,0,0,0,0,0,1,0
功能描述：确定轨道外推初值，并调用轨道计算。,0,1,0,0,0,0,0,0
"功能描述：接收发送OBDH重要数据
处理：数据不需要应用软件处理。",0,0,0,0,0,0,1,0
"根据任务要求，上电或复位时应用软件进行1553B初始化、变量的初始化，功能点包括下表所示：
序号|功能描述|功能编号
|1553B总线（外总线）初始化|FREQ11. 1
|1553B总线（内总线）初始化|FREQ11.2
|变量及其余硬件初始化|FREQ11.3
上电/复位后，系统软件进行相应的初始化工作，之后调用应用软件的AppInit()函数进行应用软件的初始化。应用软件初始化工作主要包括硬件初始化、变量初始化。
硬件初始化的内容如下表所示：
内容|状态
1553B总线（外总线）|按通讯协议要求进行设置
1553B总线（内总线）|按通讯协议要求进行设置
ACU、ICU当班状态设置|见任务书的4.1.16.1

硬件初始化完成后应用软件需对初始值不为0的变量初始化，相应变量的初始化值详见《卫星控制分系统AOCC应用软件用户需求》和《卫星控制分系统上行注入文件》。",1,0,0,0,0,0,0,0
功能描述：使用GPS通道版数据进行GPS定轨。,0,1,0,0,0,0,0,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ93|初始化|任务书
FREQ94|磁力矩器使用要求|任务书
FREQ95|通信(DA)|任务书
FREQ96|通信故障处理|预留
FREQ97|数据解包与转换|预留
FREQ98|磁力矩器数据有效性处理|预留
FREQ99|磁力矩器硬件采集、处理|任务书
FREQ100|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。
输入：上周期姿态角估值
陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出：",0,1,0,0,0,0,0,0
在载荷成像时，OBDH向AOCC索要辅助数据，包括姿态数据、陀螺数据、星敏感器数据，索要辅助数据的频率为1s。AOCC只有在辅助数据发出后，将辅助数据内容更新。,0,0,0,0,0,0,0,1
功能描述：星上自主检测动量轮故障。,0,1,0,0,0,0,0,0
"功能：在完成对日定向后，由地面指令转入地球捕获。使用数字太阳敏感器和星敏感器定姿建立正常姿态。
",0,1,0,0,0,0,0,0
"软件需求名称：故障诊断和处理 
需求类别：其他 
软件需求描述：《用户需求》4.8。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.8.1|陀螺故障检测及选择|《用户需求》4.8.1|
FREQ12.3-R4.8.2|加计故障检测及选择|《用户需求》4.8.2|
FREQ12.3-R4.8.3|星敏感器故障检测及选择|《用户需求》4.8.3|
FREQ12.3-R4.8.4|帆板驱动机构故障检测及选择|《用户需求》4.8.4|
FREQ12.3-R4.8.5|动量轮故障检测及选择|《用户需求》4.8.5|
FREQ12.3-R4.8.6-K|推进系统故障检测及选择|《用户需求》4.8.6|
FREQ12.3-R4.8.7-K|系统故障检测及选择|《用户需求》4.8.7|
",0,1,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
调用条件：有发送和接收OBDH重要数据命令字时
输入：OBDH重要数据地址中内容
输出：OBDH重要数据地址中内容。
处理：OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,1
"功能描述：选择通讯的星敏，发取数指令，采集发送的数据，并处理成需要的数据格式。
处理：
 （1）AOCC置取数指令并发送；
（2）AOCC等待接收数据，如果200us没有数据应答，AOCC认为超时故障，把故障计数器加1，退出接收过程；
（3）如果在200us内收到星敏感器数据传递的一个字节数据，则继续接收星敏感器发送的数据，直到规定的数据接收完毕，如果接收过程中有超时，则把故障计数器加1，退出接收过程；
（4）当规定的数据接收完别后，判别星敏感器返回的指令头与发送的指令头是否一致，不一致则把故障计数器加1，退出接收过程；
（5）当校验正确时，把接收的星敏感器数据进行格式转换，并保存。
见本文 “AOCC与星敏感器串行通讯接口”。",0,0,0,0,0,1,0,0
功能描述：接收PVT数据,0,0,0,0,0,0,1,0
"功能描述：选择相平面参数、加速度
处理：根据工作模式设置相平面参数；根据推力器分支及追踪器构型设置加速度。
说明：4种构型，3种分支共计12组加速度（每组包括正负三轴共6个）；",0,1,0,0,0,0,0,0
"功能描述：发送AOCC重要数据给OBDH保存
处理：将重要数据打包后放到AOCC重要数据内存地址空间中。重要数据的内容具体见重要数据文件。",0,0,0,0,0,0,0,1
"功能描述：轨道数据解包及处理
处理：依据地面注入轨道种类，追踪器轨道平根数、目标器轨道平根数、追踪器J2000坐标系轨道参数、目标器J2000坐标系轨道参数，更新相应轨道数据。
说明：星务分系统向GNCC送数采用128字节(有效使用1字节)帧格式。注入数据格式见《卫星GNC分系统GN与星务分系统通讯协议》，注入内容见《卫星控制分系统注入参数及数据指令》",0,0,0,0,0,0,1,0
"功能描述：CAN通信上行/下行数据的组帧和解包。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：星务发送、快帧遥测1打包、快帧遥测2打包、快帧遥测3打包、快帧遥测4打包、快帧遥测5打包、慢帧遥测打包、姿态广播、星敏广播、陀螺广播、其他广播(行周期广播)、重要数据打包、上行:数据指令响应处理、上行:固定地址注入解包、上行:可变地址注入解包、上行:轨道注入解包、上行:程序注入、上行:内存下卸指令注入、上行:任务块、上行:地面站、重要数据返回解包、GPS定位广播解包、整星广播对时解包、GPS高精度秒脉冲对时广播解包、CAN总线使用要求",0,0,0,0,0,0,0,1
"功能描述：自主对计算机进行切换。
处理：
OBC的A机和B机满足一定的条件下，可以进行切换。",0,0,0,1,0,0,0,0
"功能描述：决定轨控开关机及姿控，输出相应的状态标志及数据。
处理：在各种条件下的处理见下表所示：判断的顺序为自上而下。
表37：轨控开关机的判别处理
条件|处理
""或
""|""FJO = 0
TJO = 0""
""ZT8  3且
ZT9  3且
""|FTO = 0，FXO = 0，
""且
ZT8  3且
0 < ZT9  3且
FTO  A
""|""	时间关机条件： 

姿态关机条件如下：
轨控推力器开关判断：

喷气长度和累计计算如下

""
""BZ1=6
轨控期间""|发的指令
{ FTO = A }，星体无偏航机动|C1 = CCCC
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|对地数传天线1数据的采集与处理|FREQ1.7.1|""对地数传天线1 LTU控制指令
""|对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
|对地数传天线2数据的采集与处理|FREQ1.7.2|""对地数传天线2
LTU控制指令""|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
",0,0,0,0,0,1,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度
",0,1,0,0,0,0,0,0
功能描述：单独使用星敏诊陀螺。,0,1,0,0,0,0,0,0
功能描述：星上实时计算中继星的轨道。,0,1,0,0,0,0,0,0
"功能描述：以1s为采样周期，计算角速度。。
",0,1,0,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得9个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据， AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。具体如下表所示： 
GROLTUSeltFlag|进行通讯的陀螺LTU
01H|陀螺LTU1
02H|陀螺LTU2
03H|陀螺LTU3
其它|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1

取数指令由三个字节组成：
第一个字节为对陀螺LTU的命令设置，有四种命令格式：取数指令1、取数指令2、复位指令、地检模式指令，应用软件只自主发取数指令1和取数指令2两种格式，并由注入控制方式指定及LTU通信选择块中的陀螺LTU取数方式来切换，默认为取数指令1；其余两种格式（复位指令和地检模式指令）通过地面注入LTU命令块来设置。
第二个字节为对光纤陀螺的命令设置，有四种命令格式：测量模式1（有温度补偿）、测量模式2（无温度补偿）、地检模式1（只传地面数据）、地地检模式2（地面数据+头部测量数据），由注入控制方式指定及LTU通信选择块中的光纤陀螺指令切换方式字来切换这四种格式，默认为测量模式1（有温度补偿）。
第三个字节为前两个字节的累加和。
另外，每个控制周期AOCC还向选取的陀螺LTU发送取陀螺状态指令，指令为3字节指令（D5、AA、7F），得到的状态信息用于遥测。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式，具体参见LTU通讯协议。
（3）陀螺LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
功能描述：接收遥控固定参数注入块的光纤红外控制命令参数,0,0,0,0,0,0,1,0
"功能描述：使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令。
处理：
软件设计时应注意保护Vm，保证此节使用的Vm未在周期性清0处理中被清除。",0,1,0,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|星敏感器1数据的采集与处理|FREQ4.1|选择通讯的星敏1LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
|星敏感器2数据的采集与处理|FREQ4.2|选择通讯的星敏2LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
",0,0,0,0,0,1,0,0
"功能描述：接收遥控注入数据块1、2、3、4、5、6、7
处理：将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。如果128＜遥控注入数据块长度≤256字节，将数据不足256字节部分以AA16填充，按照“遥控注入数据块结构分为遥控注入数据块1～4，按照子地址（1～4）顺序向AOCC连续发送；如果64＜遥控注入数据块长度≤128字节，将数据不足128字节部分以AA16填充，按照“遥控注入数据块结构分为遥控注入数据块5、6，按照子地址（5、6）顺序向AOCC连续发送；如果遥控注入数据块长度≤64字节，将不足64字节部分以AA16填充，按照“遥控注入数据块结构通过子地址11将数据发送给AOCC；各个上行注入块的格式如表 44所示：
表 44：各个上行注入块的格式
块类型识别字|块类型名称|块长度（字节）|指令
1B H|AOCC程序块|256N|接收遥控注入数据块1、2、3、4
EB H|AOCC轨道数据块|128|接收遥控注入数据块5、6
27 H|AOCC姿控数据块|64|接收遥控注入数据块7
28 H|AOCC系数数据块|64|接收遥控注入数据块7
41 H|AOCC轨控命令块|64|接收遥控注入数据块7
4E H|AOCC太阳翼命令块|256|接收遥控注入数据块1、2、3、4
7D H|AOCC内存修改块|64|接收遥控注入数据块7
BEH|AOCC中继星轨道数据块|128|接收遥控注入数据块5、6
69H|AOCC结构滤波器系数数据块|128|接收遥控注入数据块5、6
C3H|AOCC中继天线安装修订系数块|64|接收遥控注入数据块7

根据上行注入块的大小，可以把上行注入块分成三种，分别为256字节，128字节和64字节。相应AOCC接收遥控注入的处理程序也分为三种，分别对应256字节，128字节和64字节的处理程序。
接收64字节遥控注入处理程序流程如下图所示
图17: 接收64字节遥控注入处理程序流程
2）接收128字节遥控注入处理程序流程如下图所示
图18: 接收128字节遥控注入处理程序流程
3）接收256字节遥控注入处理程序流程如下图所示
图19: 接收256字节遥控注入处理程序流程
若ZT8≠0，则BZ7=ZT8。",0,0,0,0,0,0,1,0
"功能描述：实时计算卫星轨道参数及太阳方位、太阳敏感器理论输出。
处理：其中除的精确计算算法外为可复用需求，可使用软件中心的构件库中的软件代码。",0,1,0,0,0,0,0,0
"软件需求名称：星历与轨道 
需求类别：其他 
软件需求描述：日月星轨道计算“计算太阳、月球、卫星位置矢量在地心J2000.0惯性系下的表示”；中继目标轨道计算“计算中继目标轨道”。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.3.1|日月星轨道计算|《用户需求》4.3.1|
FREQ12.3-R4.3.2|中继目标轨道计算|《用户需求》4.3.2|
",0,1,0,0,0,0,0,0
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""
|复位初始化|FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""
",1,0,0,0,0,0,0,0
"软件需求名称：遥测打包 
需求类别：其他 
软件需求描述：打包内容见“遥测”。",0,0,0,0,0,0,0,1
"软件需求名称：CMG使用及通信 
需求类别：其他 
软件需求描述：输出CMG控制指令。
处理： 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
CMG初始化|FREQ61|CMG初始化|B|2
CMG数据采集|FREQ62|CMG数据采集|B|3
CMG数据解包与转换|FREQ63|CMG数据解包与转换|B|4
CMG指令输出|FREQ64|CMG指令输出|B|
",0,0,1,0,0,0,0,0
"功能描述：
  读入串口数据，将太阳敏感器数据转化为浮点数，将陀螺数据转化为浮点数，结合陀螺故障顶替标志，计算姿态信息（功能编号：FReq-2）。
处理： 
考虑到可靠性，为便于地面观察，程控期间也遥测姿态信息，本节输入处理功能可于每个控制周期执行，运行模式的制约。
（1）DSS数据处理（太阳数据处理时，监视码门槛值取值为0x16）
根据粗码、细码信息，将太阳敏感器数据转化为浮点数，并计算姿态信息：
IF1 SP61/62 = 1
	 ELSE1
	IF2 bbMode = M（巡航）
	ELSE2
	END2
END1
对太敏S61和S62的输入数据进行跳数判断，并影响推力器判断，具体逻辑见任务书5.4.5.2节。
（2）陀螺角速度数据处理
将获取的陀螺角速度信息转化为浮点数，写入wx、wy、wz、ws
结合故障陀螺顶替（陀螺顶替标志bSrepXYZ由程控结束时的陀螺健康字以及陀螺故障诊断信息确定，初始化陀螺不需要顶替）信息，计算陀螺角速度。
如果顶替x轴陀螺
则  wx=wy+wz-1.732*ws
否则 如果顶替y轴陀螺
则  wy=wx-wz+1.732*ws
否则 如果顶替z轴陀螺
则  wz=wx-wy+1.732*ws
否则 不处理
计算陀螺角度积分,并限在(-360, 360)之间；
（3）解析动量轮转速、方向、加电状态等信息。",0,0,0,0,0,1,0,0
功能描述：根据给定电压乘电压/力矩系数和角动量变化率之差判断轮子的故障。,0,1,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
处理：
OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,1
功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。,0,1,0,0,0,0,0,0
OBDH重要数据有两块，大小共为128字节，AOCC不做任何改动保存在RAM中。如果AOCC发生复位，应利用方式代码请求服务，索取OBDH重要数据进行保存。若在大于0.256s的时间内仍未收到接收OBDH重要数据的指令，则重新请求服务，同时索要OBDH重要数据的计数器累加，若此计数器大于等于40，则不再索要OBDH重要数据。若索要OBDH重要数据成功，将此计数器清零。,0,0,0,0,0,0,0,1
功能描述：若3000秒（全姿态捕获除速率阻尼外1000秒，可注入修改）内，三轴中任一轴喷气总量（正负轴单独判断）超过范围（正常模式50s，粗定向和轮子启动、偏置动量、全姿态捕获除速率阻尼100s，可注入修改），则根据自锁阀状态，开关,0,0,0,1,0,0,0,0
"功能描述：根据从SLTU接收的0.25秒或1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
输入：0.25秒或1秒内陀螺的角度增量 (量纲：弧度)
(i=1,2,3,…6，依次表示陀螺G1，G2，…，G6的输出)；
采样周期 (量纲：秒)；
陀螺数据有效性标志F_GyroValid(由陀螺有效性判据给出)。
陀螺系统在星体三轴方向等效的常值漂移估值 (量纲：弧度/小时)
星敏感器数据有效性标志：F_SAValid，F_SBValid，F_SCValid",0,1,0,0,0,0,0,0
功能描述：若某个模拟太阳故障，则模拟太阳数据无效。若某个模拟太阳不见太阳标志，则该模拟太阳无效。,0,1,0,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得12个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据， AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。具体如下表所示： 
GROLTUSeltFlag|进行通讯的陀螺LTU
01H|陀螺LTU1
02H|陀螺LTU2
03H|陀螺LTU3
其它|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1

取数指令由三个字节组成：
第一个字节为对陀螺LTU的命令设置，有四种命令格式：取数指令1、取数指令2、复位指令、地检模式指令，应用软件只自主发取数指令1和取数指令2两种格式，并由注入控制方式指定及LTU通信选择块中的陀螺LTU取数方式来切换，默认为取数指令1；其余两种格式（复位指令和地检模式指令）通过地面注入LTU命令块来设置。
第二个字节为对光纤陀螺的命令设置，有四种命令格式：测量模式1（有温度补偿）、测量模式2（无温度补偿）、地检模式1（只传地面数据）、地地检模式2（地面数据+头部测量数据），由注入控制方式指定及LTU通信选择块中的光纤陀螺指令切换方式字来切换这四种格式，默认为测量模式1（有温度补偿）。
第三个字节为前两个字节的累加和。
另外，每个控制周期AOCC还向选取的陀螺LTU发送取陀螺状态指令，指令为3字节指令（D5、AA、7F），得到的状态信息用于遥测。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式，具体参见LTU通讯协议。",0,0,0,0,0,1,0,0
功能描述：计算光行差的修正参数，数字太阳敏感器输出角估值。,0,1,0,0,0,0,0,0
"功能：利用星敏感器A的测量，修正姿态四元数与估计角速度。
",0,1,0,0,0,0,0,0
"功能描述：根据红外信息，作姿态滤波修正。
处理：同用户需求的",0,0,0,0,1,0,0,0
"功能描述：选择通讯的CMG线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）CMG共有三个LTU，AOCC每个控制周期根据注入文件中的ZT14和加电状态的最大组合向指定的CMG LTU发送取数指令
（2）向选择的CMG LTU发送完取数指令，获得CMG LTU返回的数据，将数据转换为所需的数据格式，具体参见LTU通讯协议。
（3）CMG LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
"功能描述：采集陀螺的数据，并处理成需要的数据格式。
处理：
（1）从A/D输入采集陀螺的数据，转换为角速度
（2）乘以控制周期得到速度增量",0,0,0,0,0,1,0,0
"功能描述：接收卫星时间
处理：AOCC上电或复位时通过发送重要数据申请给OBDH，OBDH把卫星时间和AOCC重要数据都发到AOCC终端。",0,0,0,0,0,0,1,0
"功能描述：卫星绕x轴转动，使红外搜索地球。
输入：	陀螺数据处理的输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）
故障标志IRES_Flag，计时器TES
红外数据有效性输出 ，",0,1,0,0,0,0,0,0
"功能描述：使用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的星敏间基准修正与有效性判断修正系数,0,0,0,0,0,0,1,0
"功能描述：根据姿态角和姿态角速度偏差数据进行系统故障的检测。
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。
轨控模式姿态角控制量超差阀值从0.077 mSYSS2改为0.0873 mSYSS2。
5.7.3（1）增加姿态超差判断。",0,1,0,0,0,0,0,0
"功能描述：卫星的10个工作模式切换方式。
处理：
对每个模式分别按照切换条件处理。见用户需求3.3节。
工作模式切换表
""换后
模式
切换
前模式""|Mode1|Mode2|Mode3|Mode4|Mode5|Mode6|Mode7|Mode8|Mode9
Mode0|1,2||||||||1,2
Mode1||1,2||||||2|1,2
Mode2|||2|2||||1,2|1,2
Mode3||2||1,2|||||1,2
Mode4||1,2|||1,2||||1,2
Mode5||1,2||1,2||1,2|||1,2
Mode6||1,2||2|1,2||1,2||1,2
Mode7||2|||1,2|1|||1,2
Mode8||1,2|||||||1,2
Mode9||1,2|||||||

说明：代号“1”表示自主进入；代号“2”表示地面/总线指令进入",0,1,0,0,0,0,0,0
"功能描述：接收地面指令，用星敏测量数据更新四元素。
",0,1,0,0,0,0,0,0
"功能描述：搜索太阳，直到数字太阳敏感器有太阳信息。
输入：陀螺数据处理的输出，
数字太阳敏感器状态F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出）
上周期姿态角估值，
三轴姿态喷气控制与推力器脉宽分配的输出，
计时器TSS",0,1,0,0,0,0,0,0
功能描述：将星务通过CAN总线广播的GPS定位数据转换成轨道根数。,0,1,0,0,0,0,0,0
"功能描述：在Z轴已捕获太阳的条件下，完成对日定向及绕Z轴转动。
对日定向下，若在阳照区若连续3000秒无法对日成功，则根据地面指令，进行模拟太阳和数字太阳的自主切换，重新进行太搜，并将地面允许标志置为不允许。
进入条件：
偏航捕获及转对地定向，或{，FEA = 0}；
星敏感器全姿态捕获，星敏感器数据无效，或{FEA = 0，ZT3 = C}条件不成立
全姿态捕获，FSA0, { ZT1 = 3或BZ1 = 3 }
退出条件：
偏航捕获及转对地定向， FEA 0；
星敏感器全姿态捕获，星敏感器数据有效且{FEA = 0，ZT3 = C}条件成立
全姿态捕获，FSA＝0,或ZT1 3且BZ1  3 
处理过程：同用户需求的。
STEP1:FlagFSA=5
STEP2:调用姿态预估器(3)
STEP3:若ZT13≠4，使用模拟太阳定向
STEP4:若ZT13=4，使用数字太阳定向
STEP5:若BZ1 = 3，则调用运行段喷气姿态控制
STEP6:若BZ1 = 4，则调用轨控段喷气姿态控制
STEP7:若ZT2 = 2，FWi  C对工作的飞轮成立，则调用飞轮控制
STEP8:若ZT2  2或FWi<C对某一工作的飞轮成立，则输出控制电压清0。",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|部件状态、双组元推进状态1、推进状态2、ACU工作状态|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|计算得到的喷气脉宽、磁力矩器电压|控制指令消息的输出|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
|部件加断电指令的处理|FREQ1.8.4|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.5|保存CCU的重要数据|接收CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.6|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|FREQ1.8.7|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.8|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.9||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令
",0,0,0,0,0,1,0,0
功能描述：利用陀螺、红外、数字太阳、星敏感器诊断陀螺,0,1,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的相平面参数
处理：
调整推力角加速度修正因子初装值。",0,0,0,0,0,0,1,0
"功能描述：选择视速度增量关机位置控制喷管
",0,1,0,0,0,0,0,0
功能描述：搜索太阳，直到数字太阳敏感器有太阳信息。,0,1,0,0,0,0,0,0
功能描述：利用星敏感器和陀螺输出计算卫星欧拉角和四元数。,0,1,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的CMG控制系数
处理：
调整CMG框架角回位控制系数、CMG群奇异规避律调整阀值1、CMG群奇异规避律调整系数2的初装值。",0,0,0,0,0,0,1,0
"    各个模式切换的功能点列表如下： 
序|需求名称|编号|输入章节号|功能描述
|主动段模式切换|FREQ43.0|3.3.0|主动段模式切换条件判断及转出设置
|入轨消初偏模式切换|FREQ43.1|3.3.1|入轨消初偏模式切换条件判断及转出设置
|红外引入对地粗定向模式切换|FREQ43.2|3.3.2|红外引入对地粗定向模式切换条件判断及转出设置
|动量轮启动模式切换|FREQ43.3|3.3.3|动量轮启动模式切换条件判断及转出设置
|正常轨道运行模式切换|FREQ43.4|3.3.4|正常轨道运行模式切换条件判断及转出设置
|轨控模式1模式切换|FREQ43.5|3.3.5|轨控模式1模式切换条件判断及转出设置
|由正常姿态进行姿态机动模式切换|FREQ43.6|3.3.6|由正常姿态进行姿态机动模式切换条件判断及转出设置
|轨控模式2模式切换|FREQ43.7|3.3.7|轨控模式2模式切换条件判断及转出设置
|由轨控姿态机动回正常轨道运行模式切换|FREQ43.8|3.3.8|由轨控姿态机动回正常轨道运行模式切换条件判断及转出设置
|全姿态捕获模式切换|FREQ43.9|3.3.9|全姿态捕获模式切换条件判断及转出设置
|应急安全模式模式切换|FREQ43.10|3.3.10|应急安全模式模式切换条件判断及转出设置
|停控模式切换|FREQ43.11|3.3.11|停控模式切换条件判断及转出设置
|帆板未展开模式切换|FREQ43.12|3.3.12|帆板未展开模式切换条件判断及转出设置
|偏置动量控制模式切换|FREQ43.13|3.3.13|偏置动量控制模式切换条件判断及转出设置

切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,1,0,0,0,0,0,0
"功能描述：与推进线路盒通信，输出本周期喷气脉宽。
处理：
见通信协议。
功能编号|功能|引用文档
FREQ85|初始化|任务书
FREQ86|推力器使用要求|任务书
FREQ87|通信|任务书
FREQ88|通信故障处理|预留
FREQ89|数据解包与转换|预留
FREQ90|推力器数据有效性处理|预留
FREQ91|推力器模拟量采集、处理|任务书
FREQ92|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
输入：
数传天线(j=1,2)跟踪地面站编号i，跟踪起始时刻ti，地面站i在惯性系指向，被数传天线(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线(j=1,2)跟踪的地面站i的矢量在本体系的表示。（i可为1~7）。
输出：
数传天线1和2的指令转角，指令转速，或者复位及保持控制指令。",0,1,0,0,0,0,0,0
"功能描述：根据采集的1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
",0,1,0,0,0,0,0,0
功能描述：接收BG与数传天线伺服控制器状态设置数据,0,0,0,0,0,0,1,0
功能描述：机械陀螺数据处理,0,0,0,0,0,1,0,0
"功能描述：接收GPS数据、接收积分时间、AOCC姿态数据、相机测温参数
处理：将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据和轨道数据的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。",0,0,0,0,0,0,1,0
功能描述：CMG数据处理。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,0,0,1,0,0
功能描述：帆板驱动机构切换。,0,0,1,0,0,0,0,0
功能描述：动量轮转速采集 ,0,0,0,0,0,1,0,0
