Requirements Description,初始化,控制计算,控制输出,故障诊断和处理,数据有效性判断,数据采集,遥控,遥测
"将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。
序号|功能描述|功能编号
|姿控数据块1|FREQ65.1
|变轨数据块|FREQ65.2
|轨道数据块|FREQ65.3
|动量轮参数块|FREQ65.4
|轮控系数块|FREQ65.5
|相平面控制参数块|FREQ65.6
|陀螺当量修正数据块|FREQ65.7
|红外太阳修正数据块|FREQ65.8
|星敏感器数据块|FREQ65.9
|故障判别因子系数块|FREQ65.10
|陀螺故障判别因子系数块|FREQ65.11
|全姿态捕获参数块|FREQ65.12
|SDC命令块|FREQ65.13
|LTU命令块|FREQ65.14
|程序块|FREQ65.15
|内存修改块|FREQ65.16
|姿控数据块2|FREQ65.17
|陀螺红外参数数据块|FREQ65.18
|星敏修正时无陀螺模式的修正参数块|FREQ65.19
|整星偏置动量数据块|FREQ65.20
|轨道注入保护参数块|FREQ65.21
|星敏感器程序块|FREQ65.22
|星敏感器程序注入控制块|FREQ65.23
|EEPROM程序操作块|FREQ65.24
|帆板命令块|FREQ65.25

具体内容见注入文件。",0,0,0,0,0,0,1,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"软件需求名称：陀螺使用及通信 
需求类别：其他 
软件需求描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书附录1时序。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
陀螺接口初始化|FREQ33.1|陀螺接口初始化|B|2
陀螺数据采集|FREQ33.2|陀螺数据采集|A|3
数据解包与转换|FREQ33.3|数据解包与转换|A|4
陀螺数据有效性判断、处理|FREQ33.4|陀螺数据有效性判断、处理|A|5
陀螺故障重构|FREQ33.5|陀螺故障重构|C|
",0,0,0,0,1,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|均匀校时|FREQ1.4.5|""本周期的绝对星时；
均匀校时补偿量""|""本周期的绝对星时；
""|应用软件每次进行星时计算时，将计算后的绝对星时加上均匀校时补偿量作为本周期的补偿后的绝对星时。
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,1,0,0,0,0
轨道计算包括卫星轨道和太阳方位计算、中继卫星轨道计算；GPS计算包括GPS数据转换为轨道平根数计算、GPS平根数数据转换为外推轨道数据计算；地磁场计算为通过轨道外推数据计算地磁场矢量分量。,0,0,0,0,1,0,0,0
功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。,0,1,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0|主动段|FREQ56
1|正常对地运行|FREQ57
2|偏航机动|FREQ58
3|全姿态捕获|FREQ59
4|对地捕获|FREQ60
5|帆板未展开|FREQ61
6|轨控|FREQ62
7|无控|FREQ63
8|侧摆机动|FREQ64
9| 侧摆保持|FREQ65
11|入轨段控制|FREQ66
12|自旋模式|FREQ67
13|应急模式|FREQ68
14|星敏全姿态捕获模式|FREQ69

主动段工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定和姿态和轨道控制的如下所示
|模式字
|E
卫星轨道外推计算|√
GPS轨道计算|√
太阳星历计算|√
地面站位置计算|√
岁差章动计算|√
地磁场计算|√
偏流角计算|
陀螺数据处理|√
惯性姿态陀螺预估|√
对地姿态陀螺预估|
四元数陀螺预估|
红外输出的数据处理|√
太阳输出的数据处理|√
红外的姿态修正|
红外与太阳双矢量定姿|
红外太阳姿态修正|
星敏感器数据处理|
星敏感器A姿态修正|
星敏感器B姿态修正|
星敏感器C姿态修正|
星敏感器A、B姿态修正|
星敏感器A、C姿态修正|
星敏感器B、C姿态修正|
对地姿态修正及星敏粗姿态计算|
仅星敏感器A的姿态修正|
仅星敏感器B的姿态修正|
仅星敏感器C的姿态修正|
仅星敏感器AB的姿态修正|
仅星敏感器AC的姿态修正|
仅星敏感器BC的姿态修正|
–Z轴捕获太阳及对日定向|
偏航捕获及转对地定向|
星敏感器全姿态捕获|√
侧摆目标姿态确定|
姿态控制量计算|√
相平面法|√
姿态喷气控制|√
动量轮摩擦补偿计算|√
动量轮角动量保持的PI控制|√
动量轮启动与保持|√
正常飞行动量轮分配电压计算|
结构滤波器计算|
 喷气卸载条件计算|
磁卸载控制|
运行段帆板控制|
太阳帆板自主跟踪控制|
无控模式下太阳帆板控制|
数传天线指向控制|
偏置动量轮分配电压计算|

在正常运行模式下主要有三种定姿方式：红外定姿、红外太阳定姿和星敏定姿。其中星敏定姿为高精度定姿方式。并可采用有陀螺和无陀螺方式，正常情况下为有陀螺。定姿方式的切换通过注入系统定姿方式字和系统故障诊断来实现切换。在模式2和6的初始化中删除了红外定姿的设置，调用流程中增加了星敏定姿的姿态角计算，可以在星敏定姿下变轨。太阳全姿态捕获模式(BZ1=3)和星敏感器全姿态捕获模式(BZ1=E)初始化中增加取消偏流角修正计算的操作。",0,1,0,0,0,0,0,0
"功能描述：发送控制计算机指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,1,0,0,0,0
"功能描述：发送和接收OBDH重要数据
调用条件：有发送和接收OBDH重要数据命令字时
输入：OBDH重要数据地址中内容
输出：OBDH重要数据地址中内容。
处理：OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,1
"功能描述：判断陀螺的使用范围。
",0,1,0,0,0,0,0,0
功能描述：数传天线数据处理,0,0,0,0,0,1,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。。为保证帆板LTU线路归零指令的成功执行，要求应用软件连续3个周期对帆板LTU线路发送归零指令。",0,0,0,0,0,1,0,0
"功能描述：采集8路模拟太阳A\B码、监视码。
处理：
采集方法：连续采集8路，采集1路的操作步骤（以ASS1的电流1为例）：
向选通地址输出偏移地址：0x1200 0000 = 30H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果；",0,0,0,1,0,0,0,0
功能描述：秒脉冲信号处理。,0,0,0,1,0,0,0,0
功能描述：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。,0,0,0,1,0,0,0,0
"功能描述：
将从1553B总线上接收到ISUA、ISUC遥测数据，以及的常规遥测数据根据遥测打包协议进行打包（FReq-8）。
处理： 1553B总线通过子地址11接收到ISUA、ISUC常规遥测数据，ISUC闭环控制反馈数据，当轮询子地址10到来时，将计算的常规遥测数据同子地址11接收到的ISUA、ISUC常规遥测数据、部分ISUC闭环控制反馈数据，一并打包并发送到子地址10。遥测内容的相关变化见遥测文件以及1553B通讯协议。
遥测打包时模式字与方式字占用1个字节，模式字占用高4位，方式字占用低4位。对于未明确定义的遥测当量，使用CMU的当量，表示范围根据占用的字节数决定。",0,0,0,0,0,0,0,1
"功能描述：更新地面遥控注入的可变地址参数并处理

处理：解包可变地址数据包，更新相应地址的参数。
可变地址参数注入时，星务分系统向GNCC送数采用8字节(有效使用1字节)帧格式，最多同时注入15个数据。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,1,0
"功能描述：根据任务要求，应用软件进行1553B初始化、变量的初始化
处理：
GPS无效判断的连续次数变量由1改为7。
删除读取一次星时计数器的要求。",1,0,0,0,0,0,0,0
功能描述：标称角动量、安装、分配矩阵及轮子组合计算,0,1,0,0,0,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度
",0,1,0,0,0,0,0,0
功能描述：利用数字太阳信息，进行太阳捕获，对太阳定向；,0,1,0,0,0,0,0,0
"软件需求标识：FREQ5 
软件需求名称：星时校正 
软件需求描述：星时校时。
",0,0,0,0,0,1,0,0
"功能：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。
",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.4|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.3|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1|地面站赤经赤纬计算
|运行段帆板控制|FREQ4.12|5.5.1|三轴稳定模式下的帆板控制
|太阳帆板自主跟踪控制|FREQ4.13|5.5.2|根据帆板角误差、控制帆板跟踪太阳
|数传天线指向控制|FREQ4.14|5.6.2|根据指令完成数传天线的指向控制
|中继轨道计算|FREQ4.21|5.7.1|中继轨道计算
|中继天线指向控制|FREQ4.22|5.7.2和5.7.3|根据指令完成中继天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|双脉冲变轨|FREQ4.23|""任务书的
4.2.3""|根据地面注入的指令可实现两次轨控的功能
|3CMG框架角速度指令解算|FREQ4.24|5.4.2.6|当采用3CMG进行姿态控制时，根据控制器计算出的力矩，实现CMG的框架角速度指令解算
|CMG群角动量释放流程|FREQ4.25|5.4.2.7|CMG群角动量释放流程
|CMG标称框架角计算算法|FREQ4.26|5.4.2.8|根据外部标志及时间，计算CMG的标称框架角
",0,1,0,0,0,0,0,0
"功能描述：使星体-Z轴捕获太阳，并保持偏置10度的对日定向。
输入：， 陀螺数据处理的输出，；控制周期 (量纲：秒)；
		模拟太阳敏感器状态，LSS输出数据
		模拟太阳敏感器输出： (量纲：弧度)
		计时器",0,1,0,0,0,0,0,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：AOCC在CAN总线中断中接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,1
"功能描述：控制算法描述
",0,1,0,0,0,0,0,0
功能：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|CMG 1数据的采集与处理|FREQ1.9.1|""CMG 1
1553B取数指令
""|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 2数据的采集与处理|FREQ1.9.2|""CMG 2
1553B取数指令
""|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 3数据的采集与处理|FREQ1.3.3|""CMG 3
1553B取数指令
""|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 4数据的采集与处理|FREQ1.9.4|""CMG 4
1553B取数指令
""|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 5数据的采集与处理|FREQ1.9.5|""CMG 5
1553B取数指令
""|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
|CMG 控制指令的输出处理|FREQ1.9.6|计算得到CMG的控制数据|CMG的控制指令输出消息指令|根据控制方式发送相应的控制指令，具体见内总线通讯协议
|CMG的程序注入修改|FREQ1.9.8|从OBDH收到的CMG需修改程序内容|CMG需修改程序内容|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
|CMG的内存下传|FREQ1.9.9|从OBDH收到的CMG内存下传设置指令|内存下传设置指令|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。
",0,0,0,0,0,1,0,0
"功能描述：根据采集的1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
",0,1,0,0,0,0,0,0
"功能描述：根据陀螺输入，予估卫星对地姿态。
",0,0,0,0,1,0,0,0
"功能描述：发送星敏陀螺数据
处理：将星敏陀螺数据打包后放到发送星敏陀螺数据存储地址中
AOCC每个控制周期（250ms）组织128个字节星敏陀螺数据，OBDH每500ms取1次星敏陀螺数据（256个字节）。其中前128字节数据对应小星时的星敏陀螺数据，后128字节数据对应大星时的星敏陀螺数据。",0,0,0,0,0,0,1,0
"AppInit中星箭分离的查询
硬件初始化后，按5取3的方式查星箭分离状态位(对星箭分离状态位读5次，有连续3次或3次以上读入为“1”，则认为查到星箭已分离，每次读的时间间隔要求大于1ms)。
AppInit中星箭未分离的初始化
如果星箭未分离，对应用软件相关变量、硬件初始化。进入主动段工作模式。在主动段工作模式下，每个控制周期按5取3的方式查星箭分离状态位，如果连续3个周期内都查到星箭已分离，则可确认为星箭已分离。进入初始速率阻尼模式，并置星时0.375s。
AppInit中星箭已分离的初始化
对应用软件相关变量、硬件初始化，星时清0，进入复位模式。
在复位模式下，与星务分系统通讯，取回保存在星务分系统的重要数据，具体见《卫星姿轨控分系统AOCC与星务通讯协议》。如果取数成功，根据控制模式字进入初始化。若连续5秒从星务分系统取重要数据失败则认为申请失败。取重要数据不成功，设置工作模式为“太阳捕获模式”，星时为2100秒，发送CMG1~5“复位及高速断电”指令。ALTU当班状态根据前面章节的内容进行复位后设置；切除6个陀螺，发送“陀螺1~5开”指令，新加电陀螺等10分钟后引入，并置状态分为120，10分钟内系统不引入，不进行速率阻尼。",0,0,0,1,0,0,0,0
"功能描述：接收同步控制。
处理：根据应急线路同步字的编码内容进行相应的处理：
编码|相应的处理
28H|发送内存的数据区指针复位
",0,0,0,0,0,0,1,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：姿态角与角速度估值：
正常模式星敏感器与陀螺定姿输出 
，
或：正常模式其它情形相应程序的输出，
惯性角速度估值：
    陀螺角速度估值 ，
    或：星敏感器定姿输出(F_NoGyro=1或3) =[，]T
实测飞轮角动量    ，
      斜轮标称角动量    
      姿态偏差积分项    ，
      斜轮角动量偏差积分项  
标志F_SatStage
=[，]T",0,1,0,0,0,0,0,0
"功能描述：使星体Z轴对日定向，适当时重捕地球。
处理过程：
(1)若星敏数据无效且FEA=0，则Ψ=0.12，调用“-Z轴对日定向”，BZ1=3；
(2)当FEA=0时；FM3②增加判断；
(3)当FEA=5时，其中姿态角的阀值增加调整系数。",0,1,0,0,0,0,0,0
功能描述：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
"功能描述：根据太阳矢量在帆板1法平面内投影与帆板法线之间的夹角，通过帆板驱动机构1控制帆板1，使帆板1能捕获及跟踪太阳。
",0,1,0,0,0,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ62|初始化|小卫星统一化平台中心控制单元RS422通讯协议：数太协议
FREQ63|数太使用要求|任务书、数太协议
FREQ64|通信|任务书、数太协议
FREQ65|通信故障处理|任务书
FREQ66|数据解包与转换|数太协议
FREQ67|数太数据有效性判断、处理|任务书
FREQ68|数太模拟量采集、处理|预留
FREQ69|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"功能描述：模式7切换方式。
处理：
若或者收到轨控结束指令，关姿控发动机，置WorkMode=5；if(lipse=0){WorkModeT=4；}
else{WorkModeT=6；}；
若FailureFlag=2，若RollMnvStyleFlag＝0且PitchMnvStyleFlag＝0，置WorkMode=6，否则(WorkMode=5；WorkModeT=6，；)；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：满足以上任意条件退出时，置tФi、tθi、t pi 为10年后的大星时，
RollMnvStyleFlag＝0、PitchMnvStyleFlag＝0，。",0,1,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的在轨维护功能参数设置区数据
处理：
调整程序替换区模块代号1~8的初装值。",0,0,0,1,0,0,0,0
功能描述：接收BG与数传天线伺服控制器状态设置数据,0,0,0,0,0,0,1,0
"功能描述：使星体−Z 轴对日定向，星体偏航姿态为零，适当时重捕地球。
",0,1,0,0,0,0,0,0
功能描述：姿态机动模式初始化,0,1,0,0,0,0,0,0
功能描述：若AOCC与星敏感器通讯不成功，则记录星敏感器故障一次。若连续240次不成功，判断该星敏感器故障。若星敏感器连续2000次故障，需重新启动星敏感器。,0,1,0,0,0,0,0,0
"功能描述：与CMG通信，控制CMG并获得CMG数据。
处理：
功能编号|功能|引用文档
FREQ69|初始化|与CMG通讯协议
FREQ70|CMG使用要求|任务书
FREQ71|通信(串口)|与CMG通讯协议
FREQ72|通信故障处理|任务书
FREQ73|数据解包与转换|与CMG通讯协议
FREQ74|帆板数据有效性判断、处理|任务书
FREQ75|帆板模拟量采集、处理|任务书
FREQ76|部件在轨转发（在轨修改）|任务书
",0,0,1,0,0,0,0,0
"功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测。
",0,1,0,0,0,0,0,0
"功能描述：定义AOCC初始上电至星箭分离为主动段工作模式。
处理：
定义星箭分离前为主动段工作模式，应用软件在控制周期任务函数中进行下列工作：
	星时计算。
	采集部件（太阳敏感器、陀螺、星敏、CMG）信息。
	采集部件、线路遥测模拟量。
	响应主动段测试指令和“运行初始速率阻尼模式”指令。
	对ALTU当班状态判断，并与当班ALTU通讯。
	响应星务分系统轮询、数据遥控指令、数据注入、程序注入、秒脉冲校时等，并进行相应处理。
	星箭分离的确认依据为：一个控制周期内对星箭分离状态位读5次，若连续3次以上读入为“1”，则认为本周期查到星箭已分离，每次读的时间间隔要求大于1ms。如果在连续3个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入初始速率阻尼模式。
	此外，通过地面遥控指令进行以下起飞前设置：
5个CMG加电，并将框架角均转到0度保持、锁定；
6个陀螺加电。",0,1,0,0,0,0,0,0
"功能描述：对自锁阀进行开关处理。
处理：
控制分系统共有两个自锁阀，分别是姿控A套自锁阀(自锁阀1)、姿控B套自锁阀(自锁阀2)。
在星箭分离后，分离开关有效，1秒“分离停控”内；或由“初始速率阻尼”指令退出主动段时，应用软件通过与ALTU通讯发送自锁阀1和自锁阀2开指令。
只有一个自锁阀开时，选择相应的发动机组，两个自锁阀都开时，选择第一组发动机组（A套）。若地面注入修改时，选择注入的发动机组。
复位后若取回重要数据中的模式是对地、对日定向模式、应急和停控模式则不对自锁阀进行操作，否则按重要数据中的自锁阀状态设置自锁阀1、2的开关；否则，根据重要数据中自锁阀的状态发送自锁阀开指令。
自主或遥控进入“停控模式”时，需要发送两个自锁阀关指令。
应用软件通过星务分系统接收自锁阀开关的数据指令，与ALTU通讯，控制自锁阀的开关。",0,0,1,0,0,0,0,0
"功能描述：接收遥控间接指令单元
处理：
间接指令单元指令种类包括以下四个指令：
中继程序跟踪停止指令
中继天线复位指令
整星侧摆指令
中继快扫到位指令
指令|收到后的处理
中继程序跟踪停止|置FAST=1
中继天线复位|置FARP=1，记录X轴复位角度，Y轴复位角度
整星侧摆|置FM=1，记录起摆时刻，侧摆到位用时，侧摆角
中继快扫到位|置FAFP=1，记录快扫到位绝对时间，侧摆角
",0,0,0,0,0,0,1,0
功能描述：释放CMG群积累的角动量。,0,1,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：，
输出：保持角动量所需电压， 
      角动量偏差积分项：，
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|甚高陀螺数据的采集与处理|FREQ1.2.1|""甚高陀螺1553B取数指令（硬件同步信号或广播同步消息）
""|陀螺1-6的速度增量|在通讯允许的条件下（每个甚高陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|光纤陀螺数据的采集与处理|FREQ1.2.2|""光纤陀螺LTU取数指令
""|陀螺7-9的速度增量|在通讯允许的条件下（每个光纤陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是即为速度增量数据，直接乘当量就可以得到需要的结果；
",0,0,0,0,0,1,0,0
"功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。
输入：前两个周期、上个周期得到的，
红外处理数据，
红外常值偏差估值，（量纲：弧度）
红外数据有效性标志F_IresValid(由有效性判据给出)
红外工作周期（=0.75s）
",0,1,0,0,0,0,0,0
"通讯串口
04H|波特率寄存器|RW|波特率寄存器低位：0x04（115200）
08H|波特率寄存器|RW|波特率寄存器高位：0x00

CAN总线初始化
寄存器名称|初始化内容|初始化意义
""CAN_ADDR        
(CAN总线地址)""|无。|无说明。
""控制寄存器
(Control Register)
""|0x03|""D7D6D5：保留。
D4：超载（接收设备不能按数据发送速率接收数据而造成的数据丢失）中断使能。
高：开放。低：禁止
D3：错误中断使能。
高：开放。低：禁止
D2：发送中断使能。
高：开放。低：禁止
D1：接收中断使能。
高：开放。低：禁止
D0：复位模式。
在初始化的时候，复位模式位置1，才可以进行初始化设置。""
命令寄存器(Command register)|0x=00001100|""D7D6D5：保留。必须。
D4：进入睡眠状态。
高：睡眠 。低：睡眠唤醒。
D3：清除超载状态。不产生超载中断。
高：清除。低：无动作。
D2：释放接收缓冲器。（读接收缓存器内容后，释放缓存器，以便其他报文立即可用）。
高：释放。低：无动作。
D1：夭折发送。
D0：发送请求。
高：报文即将发送。低：无动作。""
""验收代码寄存器
(Acceptance 
Code Register)""|0x87= 10000111|""当通过验收测试的报文被接收，且若存在空的接收缓存器，则各自的描述符和数据场被顺序存贮在空的缓存器中，在不存在空的接收缓存器的情况下，数据超载位被置位高(超载)，当完整的报文被正确接收，将出现下列操作：
接收缓存器状态位被置为高(满)
若接收中断开放位被置为高(开放)，接收中断被置为高(置位)
验收码位(AC.7~AC.0)和报文标识符的最高8位(ID.10~ID.3)必须等于由验收屏蔽位必须满足""
""验收屏蔽寄存器
((Acceptance 
Mask Register))""|0xf8|最后三位相关。
总线时序寄存器0(Bus Timing Register 0)|0x00|""总线时序寄存器的内容决定波特率预分频器(BRP)和同步跳转宽度(SJW)的数值。

通过总线定时器的内容，将波特率预分频器设置为2，即将输入的系统时钟二分频，由于输入的系统时钟已经是将计算机晶体频率14.7456MHz二分频，即7.3728MHz。所以这个时候时钟为3.6864 MHz。""
总线时序寄存器1(Bus Timing Register 1)|0x18|""采样（SAM）=1总线采样1次。
TSEG1和TSEG2确定每位周期的时钟周期数目和采样点位置：

由于一位周期是由

而

波特率＝""
""时钟分频器
(Clock Divider
register)""|0x40|""D7:CAN模式。
0：基本模式。
D5:1(旁路输入比较器，仅在复位模式下起作用)。""
""OCR
(output Control)""|0x|

在完成上述初始化后，要再次初始化控制寄存器。将最低位初始化为0。
说明：地址表上“CAN总线地址”实际是一个写信号的地址，完成对CAN总线控制芯片的选择。因为CAN总线控制芯片的分时复用地址/数据总线（AD7~AD0）实际是和的数据线(D0~D7)接在一起的，该分时复用地址实际是选择控制寄存器用的。这样对于端口寄存器的选择，必须通过数据的写入来完成。对“CAN总线地址”的写入，起到选通CAN控制芯片的作用，而写入的内容，就是对端口寄存器的选择。",1,0,0,0,0,0,0,0
功能描述：将星务通过CAN总线广播的GPS定位数据转换成轨道根数。,0,1,0,0,0,0,0,0
功能描述：星敏感器数据处理，安装偏差估计。,0,1,0,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|星时的采集和计算|FREQ6.1|对星时进行计算和处理
|星时校正|FREQ6.2|OBDH每隔8分钟向AOCC发送一次校时命令，校正AOCC星上时间。
",0,0,0,0,0,1,0,0
功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。    ,0,1,0,0,0,0,0,0
功能描述：偏置动量处于力矩模式，根据滚动红外敏感器弦宽测量计算得到的滚动角，俯仰角的信息实现三轴姿态控制滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制。,0,1,0,0,0,0,0,0
"功能描述：根据红外输出，估计卫星姿态与陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：模式6切换方式。
处理：
if() 置WorkMode=5；若，若，WorkModeT=6；
if() 置WorkMode=5；若，若，WorkModeT=6；
若且且 ，置WorkMode＝7；
if(且且且且AutoPermission=1) 置WorkMode=5；WorkModeT=4；；//阴影区进入阳照区自主转对日定向；可注入修改，初值为1；
if(且且且且且AtuoPermission=1) 置WorkMode=5；WorkModeT=4；；//南纬60度强制转对日定向，为纬度系数，可注入修改，该条件优先于下一个条件
if( 且且且) 置WorkMode=5；WorkModeT=6；；；//程控指令自主转对地姿态
收到星务的“对日定向” 指令，置WorkMode=5；WorkModeT=4；；；//成像任务完成后指令转入对日定向，并清除辐射定标目标角
收到星务的“辐射定标”指令，置WorkMode=5，WorkModeT=6，；//辐射定标模式，为注入的辐射定标目标角
若FailureFlag=1，置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,1,0,0,0,0,0,0
功能描述：决定磁卸载或喷气卸载方式,0,1,0,0,0,0,0,0
"功能描述：模拟太阳故障状态。
",0,1,0,0,0,0,0,0
"功能描述：轨道与星历计算。
",0,1,0,0,0,0,0,0
"功能描述：接收数据指令注入块的部件开关类指令
",0,0,0,0,0,0,1,0
"软件需求名称：推力器控制 
需求类别：其他 
软件需求描述：根据控制律计算结果，驱动推力器，进行姿态控制。",0,0,1,0,0,0,0,0
光行差修正的初始设置为：AOCC应用软件对APS星敏信息进行补偿计算，不向星敏发送相对J2000的时间和速度。,0,0,0,0,0,1,0,0
"序|需求名称|编号|功能和处理描述
|滚动俯仰通道喷气中断服务程序|FREQ81|将滚动俯仰通道相应的推力器关掉
|偏航通道喷气中断服务程序|FREQ82|根据状态字关相应的推力器
|轨控发动机喷气中断服务程序|FREQ83|将轨控发动机关掉，如果有1N轨控则根据轨控状态字关相应的推力器
",0,0,0,0,1,0,0,0
功能描述：确定陀螺数据转换矩阵A及B；计算漂移。,0,1,0,0,0,0,0,0
"功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压。
",0,1,0,0,0,0,0,0
功能描述：计算CMG群的合成角动量标称值。,0,1,0,0,0,0,0,0
"功能描述：帆板故障检测，切换帆板LTU。
",0,1,0,0,0,0,0,0
功能描述：计算得到的控制电压输出给动量轮。,0,0,1,0,0,0,0,0
"功能描述：入轨后或太阳丢失后，搜索太阳并捕获太阳。
处理：
自主或指令转入该模式，进行如下设置。
根据自锁阀状态设置自锁阀1和/或自锁阀2开。
系统诊断出故障后进入该模式，100秒内不控，具体要求见用户需求。
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
if(CMGStartFlag=1) 调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
	调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；
调用目标姿态确定；
调用控制器输入量计算；
喷气卸载条件计算
if(CMGStartFlag=1) 调用CMG奇异状态的判断及算法计算；
	if(CMGInControlFlag=1 且UnLoadMode=0)
{ 调用CMG的控制；
if(SSTCatchSuc＝1) 调用 磁卸载控制； }
else { if(CMGStartFlag=1) 调用 CMG启动与保持；
if(TimeStopC<=0且Flag_equation=0) 
{调用 相平面喷气脉宽； }
else {置喷气脉宽为0；SpeedControlTime=0；WacFlag=1；}
}
	调用 系统故障诊断；",0,1,0,0,0,0,0,0
"功能描述：完成整星绕滚动轴的姿态侧摆机动
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP2：进行运行段姿态确定，具体过程如下：
进行红外数据采集及处理和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
根据轮子的工作状况，计算滚动轴最大控制力矩
计算滚动轴角加速度、加速时间
设置侧摆标志FRTS的值，0为通过轮控进行侧摆，1为通过喷气进行侧摆，设置的条件如下表所示：
条件|FRTS的取值
ZT35(2) = 1，|1
其余情况|0

计算滚动轴期望轨迹和
得到输入控制律的姿态角和角速度，
STEP3：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3（姿控发动机可用）且ZT9  3（轨控发动机可用）且FRTS = 1（用喷气进行侧摆）且ZT（不用红外+单个斜装陀螺定姿）时，进行轨控段喷气姿态控制
进行陀螺故障检测及选择
当ZT40(4) = 1时，进行数传天线捕获跟踪控制
STEP4：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
"功能描述：接收时间码
处理： OBDH分系统每1分钟给AOCC校时一次。",0,0,0,1,0,0,0,0
"功能描述：发送姿态数据
处理：
AOCC每个控制周期（250ms）组织24个字节姿态数据，OBDH每500ms取1次姿态数据（48个字节）。每个数据包中的2个姿态的时标需按照时间顺序排列。",0,0,0,0,0,0,0,1
"功能描述：发送和接收OBDH重要数据
调用条件：有发送和接收OBDH重要数据命令字时
输入：OBDH重要数据地址中内容
输出：OBDH重要数据地址中内容。
处理：具体处理要求见与外总线通讯协议。",0,0,0,0,0,0,0,1
"功能描述：与CAN通讯获得上行/下行数据。
调用条件：AOCC被动接收/发送数据；
处理：通过CAN总线与星务分系统通讯，交换数据，以实现星地联系和对卫星的人工干预。主要完成下列功能：
AOCC向星务分系统发送数据（中断接收星务分系统命令，依据命令发送各类遥测参数）；
发送快帧遥测；
发送慢帧遥测；
将AOCC为星务保存的重要数据发送给星务分系统；
发送星敏感器和姿态辅助数据；
有内存下卸要求时，发送AOCC指定内存内容；
AOCC接收星务分系统数据（中断方式）包括接收固定地址参数注入；接收可变地址参数注入；接收轨道参数数据；接收程序注入；接收数据指令；接收重要数据返回；接收整星对时广播数据；接收GPS高精度秒脉冲对时广播；接收GPS导航数据，GPS定位广播数据引入控制使用之前，软件需对广播数据中的W28表示的定位状态进行判断，即D6～D4：为101、011、110之一时，引入系统，否则为无效，控制系统不使用
如果应用软件3s收不到星务分系统信息或连续5周期挂起，对CAN总线控制器重新初始化。",0,0,0,0,0,0,0,1
功能描述：单独使用星敏诊陀螺。,0,1,0,0,0,0,0,0
"功能描述：伴飞模式下，计算视速度增量关机时间长度
",0,1,0,0,0,0,0,0
"功能描述：处理地面遥控注入的固定地址参数
处理：
128-135：注入参数乘修正系数
515：全量校时处理：星时=全量校时星时
516：增量校时处理星时=星时+增量校时量
其它：更新注入的参数",0,0,0,0,0,0,1,0
"功能描述：滚动/俯仰姿态机动目标姿态确定。
",0,1,0,0,0,0,0,0
功能描述：发送模拟量遥测数据包1,0,0,0,0,0,0,0,1
功能描述：进行单轴相平面喷气控制规律计算。,0,1,0,0,0,0,0,0
"功能描述：动量轮摩擦力矩的补偿电压计算
",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器B的测量，修正姿态四元数与估计角速度。
",0,0,0,0,1,0,0,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|+Y帆板1553B取数指令（广播同步消息）
+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
-Y帆板数据的采集与处理|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|+Y帆板控制数据
+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|-Y帆板控制数据
-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,1,0,0
"功能描述：计算星上星时。
处理：
应用软件通过软钟结合硬钟的方式获得星时。即在需要计算星时时，读取当前星时计数器，将上次与本次之差作为两次读入的时间差（增计数，当量1us），累计在星时变量上。",0,0,0,0,0,1,0,0
"功能描述：绕本体x轴转动，减小卫星的滚动角。
输入：	陀螺数据输出的输出 ，红外数据有效性标志F_IresValid（由有效性判据给出）
红外数据处理（全姿态捕获）的输出，
上周期姿态角估值，",0,1,0,0,0,0,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.6.1~4.6.3。
序号|功能点编号|功能描述|说明
|FREQ3.4.8.1|喷气控制|《用户需求》4.6.1
|FREQ3.4.8.1.1|相平面姿控算法|《用户需求》4.6.1.1
|FREQ3.4.8.1.2|相平面法喷管选择|《用户需求》4.6.1.2
|FREQ3.4.8.1.3|脉冲调宽姿控算法|《用户需求》4.6.1.3
|FREQ3.4.8.1.4|脉冲调宽法喷管选择|《用户需求》4.6.1.4
|FREQ3.4.8.2|动量轮控制|《用户需求》4.6.2
|FREQ3.4.8.2.1|动量轮安装矩阵和电压分配矩阵|《用户需求》4.6.2.1
|FREQ3.4.8.2.2|动量轮摩擦补偿计算|《用户需求》4.6.2.2
|FREQ3.4.8.2.3|动量轮角动量保持的PI控制|《用户需求》4.6.2.3
|FREQ3.4.8.2.4|动量轮启动与保持|《用户需求》4.6.2.4
|FREQ3.4.8.2.5|正常飞行动量轮分配电压计算|《用户需求》4.6.2.5
|FREQ3.4.8.3|喷气卸载计算|《用户需求》4.6.3
|FREQ3.4.8.4|喷气动量轮联合控制|《用户需求》4.6.4
",0,1,0,0,0,0,0,0
"功能描述：根据姿态估值与数字太阳输出，计算量测的一步预测与新息。
",0,1,0,0,0,0,0,0
功能描述：根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差。,0,1,0,0,0,0,0,0
"功能描述：地面注入数据处理
说明：计算目标器GPS时，将输入、输出改为目标器的相应变量。",0,1,0,0,0,0,0,0
"功能描述：根据红外、太阳、星敏感器的输出数据判断陀螺故障。
输入：
      陀螺：		故障标志F_GyroDiagnV
本周期陀螺数据的输出 (量纲：弧度)
		   			陀螺等效漂移估值
      红外：  	故障标志IRES_FLAG，数据有效性F_IresValid
          			本周期红外数据处理输出， (单位：弧度)
      数字太阳：	故障标志DSS_FLAG
数据有效性F_Ds1Valid, F_Ds2Valid
          			本周期太阳输出,  (单位：弧度)
	  星敏感器： 	故障标志数组SS_FLAG[2]
数据可用标志F_SAValid, F_SBValid
本周期星敏感器A角速度输出, 
本周期星敏感器B角速度输出, (单位：弧度/秒)
星敏感器A安装矩阵
星敏感器B安装矩阵
本周期采样到的星敏感器A的有效输出(
本周期采样到的星敏感器B的有效输出(
轨道角速度
太阳星历计算输出
标志F_GyroDiagnIresDssORSS",0,1,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.4|偏置飞行模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.5|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|陀螺标定模式控制|FREQ5.2.11|4.8|陀螺标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.12|4.6|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.4|偏置飞行模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.5|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|陀螺标定模式初始化|FREQ5.3.11|4.8|陀螺标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.12|4.6|惯性定向模式初始化设置

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,1,0,0,0,0,0,0
"功能描述：采集并处理四个动量轮加电状态，三路伽马关机敏感器关机信号，四路触地开关信号                                                                                                                                                                                                                                                                                                                                          处理：
序号|功能点编号|功能描述
1|FREQ3.3.1|动量轮加电状态
2|FREQ3.3.2|三路伽马关机敏感器关机信号
3|FREQ3.3.3|四路触地开关信号
",0,0,0,0,0,1,0,0
"功能描述：发送遥测数据
处理：
CTU从AOCC接收遥测数据后，向AOCC发送“当前”的实时遥测帧计数，AOCC随后组织“下一帧”62字节遥测数据并将数据放到相应的子地址（更新总线缓存）。数字量遥测数据格式内容具体见数字量遥测文件。",0,0,0,0,0,0,0,1
"功能描述：为三轴姿态喷气控制选择推力器。
输入：标志F_JetGroup，F_SatStage
姿态角与角速度：
正常模式星敏感器与陀螺定姿输出(F_NoGyro=0或2) 
，(量纲：弧度)
，(量纲：弧度/秒)
或：正常模式星敏感器定姿输出(F_NoGyro=1或3时)
(量纲：弧度)
(量纲：弧度/秒)
或：机动与轨控模式姿态输出(无量纲)，(量纲：弧度/秒)
或：其它情形相应程序的输出
，(量纲：弧度)
，(量纲：弧度/秒)
，(量纲：度)
输出：	喷气状态，
各推力器分配脉宽，
累计三轴姿控正向喷气时间：，
累计三轴姿控负向喷气时间：，
=[，]T(量纲：弧度/秒2)",0,1,0,0,0,0,0,0
"功能描述：实现运行段姿态、帆板和天线的控制。
处理：
（1）Call  （飞轮控制）
（2）若ZT8  3，ZT9  3，ZT，ZT3  B ，{{BZ1 ≠ 8，{{FHU=A，ZT2=2，FWH ≠ 22}或ZT2≠ 2或FWH =22}}或{ BZ1 = 8，FRTS = 1}}，则：
Call  （运行段喷气姿态控制）
（若ZT3 = F，则每4秒Call  一次）（不调用喷气控制时确认电磁阀全关）
（3）若ZT7  8，则： 
Call  （运行段帆板控制）
若ZT7 = 0，则：发两翼帆板归零指令
若ZT7 = 3，则：发左翼为90度，右翼为 -90度指令
若ZT7 = 5，则：发左右皆为90度指令
若ZT7 = 7，则：发左右皆为180度指令
（4）Call  5.9（陀螺故障检测及选择）
（5）若BZ1 = 1或8或9，ZT40(4) = 1，则：
Call  1.7（数传天线捕获跟踪控制）",0,1,0,0,0,0,0,0
"功能描述：收到动量轮开数据指令或自主开动量轮。
处理：
收到动量轮开数据指令或自主开动量轮时，
按《卫星控制分系统注入参数及数据指令的用户需求》中动量轮引入状态，在相邻的4个周期依次使引入状态的动量轮加电；动量轮故障诊断自主关动量轮时，关闭动量轮一次电源。",0,0,1,0,0,0,0,0
功能描述：利用估计的四元数转换姿态角。,0,1,0,0,0,0,0,0
"功能描述：根据注入轨控开始时间和轨控长度，由6个喷管完成轨控。
处理：
根据注入轨控开始时间和轨控长度，由6个喷管完成轨控，进入轨控模式后需进行如下设置。
		自锁阀1、2均开；
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；//在有星敏和无星敏时均可启动CMG
调用目标姿态确定；
调用控制器输入量计算；
if(OrContrlCmg=0)  调用 姿控发动机轨控1；
else{调用 姿控发动机轨控2；调用 CMG的控制；}
调用系统故障诊断；",0,1,0,0,0,0,0,0
"功能描述：各模式控制量计算
序号|功能编号|功能简述|功能详述
|FREQ3.4.3.1|等待段调用流程|用户需求4.1.1【调用流程】
|FREQ3.4.3.2|太阳定向模式调用流程|用户需求4.1.2【调用流程】
|FREQ3.4.3.3|恒星定向2/4模式调用流程|用户需求4.1.3【调用流程】
|FREQ3.4.3.4|惯性调姿模式调用流程|用户需求4.1.5【调用流程】
|FREQ3.4.3.5|轨控定向模式调用流程|用户需求4.1.6【调用流程】
|FREQ3.4.3.6|着陆准备模式调用流程|用户需求4.1.7【调用流程】
|FREQ3.4.3.7|主减速模式调用流程|用户需求4.1.8【调用流程】
|FREQ3.4.3.8|快速调整模式调用流程|用户需求4.1.9【调用流程】
|FREQ3.4.3.9|接近下降模式调用流程|用户需求4.1.10【调用流程】
|FREQ3.4.3.10|悬停模式调用流程|用户需求4.1.11【调用流程】
|FREQ3.4.3.11|避障模式调用流程|用户需求4.1.12【调用流程】
|FREQ3.4.3.12|缓速下降模式调用流程|用户需求4.1.13【调用流程】
|FREQ3.4.3.13|自主定位模式调用流程|用户需求4.1.14【调用流程】
|FREQ3.4.3.14|起飞准备模式调用流程|用户需求4.1.15【调用流程】
|FREQ3.4.3.15|垂直上升模式调用流程|用户需求4.1.16【调用流程】
|FREQ3.4.3.16|上升调姿模式调用流程|用户需求4.1.17【调用流程】
|FREQ3.4.3.17|轨道入射模式调用流程|用户需求4.1.18【调用流程】
|FREQ3.4.3.18|星光环月模式调用流程|用户需求4.1.19【调用流程】
|FREQ3.4.3.19|速率阻尼模式调用流程|用户需求4.1.20【调用流程】
|FREQ3.4.3.20|无控模式调用流程|用户需求4.1.21【调用流程】
",0,1,0,0,0,0,0,0
"功能描述：选择通讯的中等精度星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）中等精度星敏共有三个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的中等精度星敏LTU发送取数指令。
（2）向选择的中等精度星敏LTU发送完取数指令后，获得中等精度星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,1,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示（十六进制）：
服务编码|发送的条件
58H|上电/复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次。
38H|每隔1分钟或模式改变时发送
96H|待定
69H|进入全姿态捕获模式后发送，收到确认字后停止发送
8CH|进入无控模式后发送，收到确认字后停止发送
C8H|BAPTA异常跟踪后发送，收到确认字后停止发送
",0,0,0,0,0,0,0,1
"功能描述：自主对计算机进行切换。
处理：
AOCC的A机和B机满足一定的条件下，可以进行切换。",0,0,1,0,0,0,0,0
"功能描述：
  根据三轴姿态角和姿态角速度误差计算三轴控制力矩(功能编号：FReq-5)。
处理： 
控制器结构为PD控制，见下图。
图5-2  PID控制器
控制器输入计算和限幅：角度信息、角速度信息由5.2.2节获取；
用于计算控制力矩的角度信息限幅为[-5,5]度、角速度信息限幅1.0度/秒。
；
		；",0,1,0,0,0,0,0,0
"星务中心计算机在1s运行周期内与控制计算机完成数据交互一次，在每次交互时星务中心计算机先发送12字节的握手信号，紧接着连续发送有效传输数据。控制计算机在接收全部数据后250ms内，将需要发送给星务计算机的数据数据发给星务中心计算机（包含握手包头和有效传输数据）。
上行数据处理（星务计算机→控制计算机）的功能点如下：上行数据包轮询及数据处理流程、GPS轨道数据、接收AOCC重要数据、星务至CCU数据块、星务至VIPPCU数据块、原始任务注入块、规划结果单次任务输入、任务规划用整星遥测
下行数据处理（控制计算机→星务计算机）的功能点如下：下行数据处理流程、快帧1遥测数据包、快帧2遥测数据包、慢帧1遥测数据包、慢帧2遥测数据包、慢帧3遥测数据包、慢帧4遥测数据包、慢帧5遥测数据包、辅助数据、发送AOCC重要数据、控制分系统成像任务规划结果、控制分系统数传任务规划结果、慢帧6遥测数据包、CCU内存下卸帧、部件内存下卸帧、VIPPCU内存下卸帧",0,0,0,0,0,0,0,1
"功能描述：使用星敏感器B的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：仅利用星敏感器B、C的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|平台陀螺数据的采集与处理|FREQ1.2.1|""平台陀螺1553B取数指令
""|陀螺1-4的速度增量|在通讯允许的条件下（每个陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|测微陀螺数据的采集与处理|FREQ1.2.2|""
遥测数据""|陀螺5-8的速度增量|从遥测数据中，获得陀螺数据并处理成对应的速度增量。
",0,0,0,0,0,1,0,0
"功能描述：上电/复位初始化
处理：
- 串口初始化
- CAN总线初始化
- ALTU、NSMU当班设置
- 红外加电
- 磁力矩器二次电源加电
- 上电/复位星箭分离查询",1,0,0,0,0,0,0,0
"功能描述：接收GPS数据
处理：将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据、定轨数据和GPS秒脉冲对应的整秒时刻的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。",0,0,0,0,0,0,1,0
"软件需求名称：部件数据处理及状态选择 
需求类别：其他 
软件需求描述：部件数据采集、剔野和选择处理。",0,1,0,0,0,0,0,0
功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压、、。,0,1,0,0,0,0,0,0
"功能描述：模式5切换方式。
处理：
若（且WorkModeT=6且 (且)连续次，WorkMode=6；
若（且WorkModeT=4且 (且)连续次，WorkMode=4；
若{若，则WorkMode= WorkModeT，否则WorkMode=4}；
若FailureFlag=3，置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,1,0,0,0,0,0,0
功能描述：通过注入轨道参数，计算轨道外推数据。,0,1,0,0,0,0,0,0
功能描述：发送遥测数据,0,0,0,0,0,0,0,1
"功能描述：接收遥控固定参数注入块的结构滤波器系数
处理：
调整各系数的初装值。",0,0,0,0,0,0,1,0
"功能描述：复位模式处理
处理：
- 采集陀螺、红外、太阳敏感器数据；
- 继续与ALTU通讯（控制量都为0，无控制指令）；
- 响应除“重要数据保存”的所有星务遥控及遥测；
- 不查询应急加电标志，不保存APP_WorkMode1/2/3变量；
",1,0,0,0,0,0,0,0
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。",0,0,0,0,0,0,0,1
CCU控制周期为125ms，对于BC端每帧50ms通信同步服务，应用软件采用轮询方式查询帧序号，作为循环缓冲区子地址指针复位时判断使用。,0,0,0,0,0,0,1,0
"功能描述：与星敏感器通讯获得星敏感器数据是否可以用来定姿。
",0,0,0,0,0,1,0,0
"功能描述：完成卫星正常轨道运行期间的三轴稳定姿态，并进行偏流角修正控制，实现姿态指向精度、姿态稳定度等性能指标。
进入条件：
自主条件：从BZ1=B、2、4、6、8满足条件转入
退出条件：
满足下列条件之一：
自主条件：
满足ZT6  3（有偏航机动）且C1 = FFFF（轨控数据有效标志为有效）且（偏航机动开始时刻之前1800秒）（偏航回调机动开始时刻后600秒）转入BZ1=2
满足（轨控发动机开机时刻-60秒）（轨控发动机关机时刻+100秒）且C1 = FFFF（轨控数据有效标志为有效）且转入BZ1 = 6
满足FM=1（ZT35不等于0且收到侧摆命令块）转入BZ1=8
满足ZT226（系统故障自检有效，可自主切换工作模式）且FSY07（系统故障打分小于等于7）且ZT8  3，ZT9  3（姿轨控发动机可用）转入BZ1=3
满足ZT226（系统故障自检有效，可自主切换工作模式），FSY07（系统故障打分小于等于7），且（ZT8  4（姿控发动机不可用）或ZT9  4（轨控发动机不可用））转入BZ1=7
地面上行注入ZT1不等于1、4 
处理过程：过程如下：
STEP1：当ZT F且ZTA且ZT3B ，进行姿态预估，得到姿态角和角速度。
STEP2：进行运行段姿态确定，具体过程如下：
姿态红外修正（1）和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP3：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3（姿控发动机可用）且ZT9  3（轨控发动机可用）且ZT（不用红外+单个斜装陀螺定姿）时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
t的取值范围|处理
|""发姿轨控发动机加温指令
进行运行段姿态确定 
进行运行段控制""
|""发姿轨控发动机加温指令
发左右帆板归零指令
飞轮动量保持控制及飞轮启动
令，
 轨控段喷气姿态控制""
|""令 ，

轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令""
|""令，
轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令
""
|""红外数据采集及处理
红外故障检测及信号选取
姿态红外修正（2）
，
运行段喷气姿态控制
飞轮动量保持控制及飞轮启动
运行段帆板控制""
|BZ1 = 1，C1 = CCCC。

当ZT40(4) = 1（天线扫描捕获）时，进行数传天线捕获跟踪控制
STEP4：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量。
输入：动量轮的转速方向和脉冲计量、上一次轮子角动量值。
输出：动量轮的角动量。
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量（动量轮角速度为1800r/min时的角动量为15Nms）。
（3）令（i = 1，2，… ，6）。为上一次轮子角动量值。（i = 1，2，… ，6）。",0,0,0,0,0,1,0,0
"功能：利用星敏感器C的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
功能描述：帆板驱动线路数据处理 ,0,0,0,0,0,1,0,0
"功能描述：当收到“停控”数据指令或满足自主进入停控模式的条件时，应用软件进入停控模式。
处理
关闭自锁阀1、2；
与ALTU继续通信，进行轨道与环境计算、采集信息，不进行定姿与控制，输出磁力矩器、推力器控制量为0，发送CMG1~5复位及高速断电指令；之后发送CMG无效0指令。
停止对天线控制计算、通信。",0,1,0,0,0,0,0,0
"功能描述：接收数传天线状态数据
处理： 将接收数传天线状态存储地址中内容解包成数传天线状态的数据格式，根据不同的数传天线状态设置对应数传天线的加断电状态。",0,0,0,0,0,0,1,0
"功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、。
",0,1,0,0,0,0,0,0
功能描述：在正常模式中，利用1N推力器实现小推力变轨功能。,0,1,0,0,0,0,0,0
"功能描述：减小卫星的俯仰角。
输入：陀螺数据输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）
红外数据处理（全姿态捕获）的输出，
上周期姿态角估值，
",0,0,0,0,1,0,0,0
功能描述：确定红外数据的有效性,0,1,0,0,0,0,0,0
功能描述：星上实时计算中继星的轨道。,0,1,0,0,0,0,0,0
"功能描述：启动动量轮至标称角动量，并保持
",0,1,0,0,0,0,0,0
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续60个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是A090H或者校验和错误或者未收到重要数据），则应用软件按照重要数据的初始值运行。",0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|均匀校时|FREQ1.4.5|""本周期的绝对星时；
均匀校时补偿量""|""本周期的绝对星时；
""|应用软件每次进行星时计算时，将计算后的绝对星时加上均匀校时补偿量作为本周期的补偿后的绝对星时。。具体见任务书要求
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。",0,0,0,0,0,1,0,0
"软件需求标识：FREQ17 
软件需求名称：数字太敏数据处理 
需求类别：其他 
软件需求描述：数字太敏数据处理。",0,0,0,0,0,1,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|各种状态数据|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|喷气脉宽、MW控制电压和磁力矩器控制脉宽|控制指令消息的输出|根据通讯协议，将计算得到的控制数据转换为消息需要的格式并输出。
|MW数据的采集与处理|FREQ1.8.4|""ACU的MW数据采集指令
""|MW的角动量|在通讯允许的条件下，每周期向ACU RT发MW数据采集指令，获得ACU数据并处理成对应的MW的角动量。
|部件加断电指令的处理|FREQ1.8.5|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.6|保存CCU的重要数据|接收CCU的重要数据|AOCC每三个控制周期将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.7|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|FREQ1.8.8|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.9|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.10||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令
",0,0,0,0,0,1,0,0
功能描述：各个模式的初始化设置。,0,1,0,0,0,0,0,0
"功能描述：星敏感器数据处理。
处理：同用户需求的5.11。
(1)获得FSTA,FSTB,FSTC
条件|FSTA|FSTB|FSTC
ZT23=0|0|0|0
ZT23=6,|1|0|0
ZT23=6,|0|0|0
ZT23=9,|1|*|*
ZT23=9,|0|*|*
ZT23=9,|*|1|*
ZT23=9,|*|0|*
ZT23=9,|*|*|1
ZT23=9,|*|*|0
ZT23=A,|0|1|0
ZT23=A,|0|0|0
ZT23=B,|0|0|1
ZT23=B,|0|0|0
ZT23=C,|0|1|*
ZT23=C,|0|0|*
ZT23=C,|0|*|1
ZT23=C,|0|*|0
ZT23=D,|1|0|*
ZT23=D,|0|0|*
ZT23=D,|*|0|1
ZT23=D,|*|0|0
ZT23=E,|1|*|0
ZT23=E,|0|*|0
ZT23=E,|*|1|0
ZT23=E,|*|0|0

(2)修订FSTA,FSTB,FSTC
若ZT41[3]=1允许星敏数据有效性判断且BZ13全姿态捕获对日定向姿态且BZ14重捕地球转三轴稳定运行且BZ1≠7无控则进行如下诊断：
若FSTA = 1，FSTC = 1，（或）则FSTA = 0，FSTC = 0；
若FSTA = 1，FSTB = 1，（或）则FSTA = 0，FSTB = 0；
若FSTB = 1，FSTC = 1，（或）则FSTB= 0；FSTC = 0。
(3)获得FSTD
FSTA|FSTB|FSTC|ZT12|BZ2|FSTD
1|1|*|1或9或8|≤2|2
1|*|1|1或9或D|≤2|3
*|1|1|1或9或E|≤2|4
1|*|*|6或9|≤2|5
*|1|*|7或9|≤2|6
*|*|1|B或9|≤2|7
不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|不满足上述任一条件|1

(4)当BZ1=1(三轴稳定正常运行轨道姿态)或9(侧摆角保持)时，进行星敏感器数据修正。公式见5.11(9)。
(4)当BZ1=1(三轴稳定正常运行轨道姿态)时，根据ZT40(3)是否为1（引入星敏在轨标定）进行星敏感器在轨标定。公式见5.11(10)。",0,1,0,0,0,0,0,0
功能描述：使用GPS通道版数据进行GPS定轨。,0,1,0,0,0,0,0,0
功能：利用星敏感器和陀螺或者仅利用星敏感器的输出计算卫星欧拉角和四元数。,0,0,0,1,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：接收OBDH时间数据,0,0,0,0,0,0,1,0
"功能描述：帆板未展开时的三轴喷气姿态控制。

处理：同用户需求的
（1）各轴喷气参数设置如表34所示
表34：消初段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|0.4|0.4|0.4
|1.0|1.0|1.0
|0.27|0.2|0.15
|0.15|0.15|0.15
|0.35|0.35|0.35
KJ2(s)|1|2|2
aJS（/s2）|0.281|0.216|0.118

（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,1,0,0,0,0,0,0
功能描述：偏航捕获模式初始化                                                                                                                                                                                处理：第i项当用星敏捕获时置SMODE =1改为SMODE =0。,0,1,0,0,0,0,0,0
"功能描述：利用估计的四元数转换姿态角，计算送给星敏感器的四元数。
",0,1,0,0,0,0,0,0
"功能描述：实现卫星星上自主或地面遥控下的自旋。为了节省内存，将此模式的代码从PROM中去掉。若需要此模式，则通过在轨注入的方式，将此模式引入控制。
处理过程：过程如下：
STEP1：进行姿态预估，得到姿态角和角速度
STEP2：令动量轮和磁力矩器的控制电压为0
STEP3：当ZT1 = D且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

根据ZT12向偏航和滚动发控制脉冲，处理完置ZT12为0
ZT12取值|处理
3|发偏航正脉冲0.5秒
C|发偏航负脉冲0.5秒
5|当时发滚动正脉冲0.5秒
A|当时发滚动正脉冲0.1秒
F|当L11 + L21 = 1时发滚动正脉冲0.5秒

STEP4：当ZT1 = F且ZT32 = A时进行下列操作：
每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值向帆板发相应的指令一次：
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

确定的符号",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
|OBDH校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|两种校时方式的切换|FREQ Q1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
",0,0,0,0,0,1,0,0
"功能描述：接收TG状态数据
处理：将接收TG状态数据存储地址中内容解包TG状态。",0,0,0,0,0,0,1,0
"功能描述：选择相平面参数、加速度
处理：根据工作模式设置相平面参数；根据推力器分支及追踪器构型设置加速度。
说明：4种构型，3种分支共计12组加速度（每组包括正负三轴共6个）；",0,1,0,0,0,0,0,0
"功能描述：仅利用星敏感器A、C的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
"功能描述：计算机动模式轮控所需电压。
输入：本体相对目标姿态的四元数
      本体相对目标坐标系转速的估值
      陀螺角速度估值    ，
      实测飞轮角动量    ，
      ，",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|对地数传天线1数据的采集与处理|FREQ1.7.1|""对地数传天线1 LTU控制指令
""|对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
|对地数传天线2数据的采集与处理|FREQ1.7.2|""对地数传天线2
LTU控制指令""|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
",0,0,0,0,0,1,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理： 
（1）CPU星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU星时时钟星时校时是通过OBDH校时，OBDH校时分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；",0,0,0,0,0,1,0,0
"应用软件共分21个工作模式，分别是等待段、太阳定向、恒星定向2、惯性调姿、恒星定向4、轨控定向、着陆准备、主减速、快速调整、接近下降、悬停、避障、缓速下降、自主定位、起飞准备、垂直上升、上升调姿、轨道入射、星光环月、速率阻尼和无控。模式字和各模式的对应关系如下：
表5.2.4.4-1 工作模式
模式字|工作模式|使用场合
0|等待段|""加电之后，判出分离27s之前，
或复位之后，重要数据恢复之前。""
1|太阳定向|""组合体地月转移巡航和环月阶段正常运行状态；
上升器远程引导巡航""
2|恒星定向2|变轨建立点火姿态前
3|惯性调姿|变轨建立点火姿态
4|恒星定向4|变轨建立点火姿态后
5|轨控定向|""动力下降之前的轨控
月面上升之后的轨控""
6|着陆准备|建立着陆点火姿态
7|主减速|动力下降
8|快速调整|动力下降
9|接近下降|动力下降
10|悬停|动力下降
11|避障|动力下降
12|缓速下降|动力下降
13|自主定位|月面工作阶段
14|起飞准备|建立月面起飞初始状态
15|垂直上升|月面上升
16|上升调姿|月面上升
17|轨道入射|月面上升
18|星光环月|月球轨道交会对接自主段
19|速率阻尼|轨控姿态超差
20|无控|动力下降着陆、交会对接段轨道器最后逼近、故障
",0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
CMG 1数据的采集与处理|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 2数据的采集与处理|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 3数据的采集与处理|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 4数据的采集与处理|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 5数据的采集与处理|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 控制指令的输出处理|根据控制方式发送相应的控制指令，具体见内总线通讯协议
CMG 6数据的采集与处理|在通讯允许的条件下（CMG 6的当班标志为1），每周期向CMG 6 RT发取数指令，获得CMG 6数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG的程序注入修改|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
CMG的内存下传|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,1,0,0
"功能描述：计算正常飞行模式轮控所需电压
说明：系数，装订值均为1，可注入修改。",0,1,0,0,0,0,0,0
"功能描述：输出CMG控制指令。
处理：
功能编号|功能|引用文档|备注
FREQ61|CMG初始化|CMG协议|B
FREQ62|CMG数据采集|任务书|B
FREQ63|CMG数据解包与转换|CMG协议|B
FREQ64|CMG指令输出|CMG协议|B
",0,0,1,0,0,0,0,0
功能描述：帆板未展开模式控制,0,1,0,0,0,0,0,0
功能描述：接收总线指令。,0,0,0,0,0,0,1,0
功能描述：将动量轮保持至标称角动量所需的电压。,0,1,0,0,0,0,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书附录1时序。
功能编号|功能|引用文档|备注
FREQ33|陀螺接口初始化|陀螺协议|B
FREQ34|陀螺数据采集|陀螺协议|A
FREQ35|数据解包与转换|陀螺协议|A
FREQ36|陀螺数据有效性判断、处理|任务书|A
FREQ37|陀螺故障重构|任务书|C
",0,0,0,0,0,1,0,0
"功能描述：将CMG启动到标称转数。
处理：
发送指令“运行CMG启动模式”进入CMG启动模式。
	根据地面数据指令，设置CMG引入状态；
	应用软件连续5个控制周期给引入的CMG加电；
	根据自锁阀状态设置自锁阀1和/或自锁阀2开；
	上述动作完成后，自主控制引入的4或5个CMG框架角转到标称位置；
	当框架角度达到要求值后，地面发“CMG高速启动”指令，应用软件连续5个控制周期自主向引入的4或5个CMG发送“CMG高速启动”指令，令4或5个CMG的高速转速达到6000rpm；（本步骤也可通过地面指令完成）
	CMG高速启动时间为10~15分钟
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；//在有星敏和无星敏时均可启动CMG
调用目标姿态确定；
调用控制器输入量计算；
调用CMG奇异状态的判断及算法计算；
调用CMG启动与保持；
if(CMGStartComm =1) 给CMG发启动指令；
if(Flag_equation=0)调用相平面喷气脉宽；
调用系统故障诊断；",0,1,0,0,0,0,0,0
"功能描述：光纤陀螺取数指令及一体化红外指令
",0,0,0,0,0,1,0,0
"功能描述：由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位。
处理：更动：去掉星敏粗姿态计算。",0,1,0,0,0,0,0,0
"软件需求名称：初始化 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。
调用条件：上电/复位。
处理：依据“用户需求”、“任务书”、“上行注入”对非0变量进行初始化。 ",1,0,0,0,0,0,0,0
"功能描述：接收发送AOCC重要数据
处理：
控制分系统重要数据保存在系统内ICU以及外系统的CTU，应用软件上电/复位后首先从ICU恢复重要数据，如果连续5个控制周期申请重要数据失败（帧头错误、校验和错误或者收到的数据为非法数据）则认为从ICU恢复重要数据失败。应用软件通过外部1553B总线向OBDH申请星上时间和重要数据，如果连续15个控制周期申请重要数据失败，则根据星箭分离状态进行模式转换，并清除服务请求和矢量字。若星箭已分离则设置模式字为“入轨段”，星箭未分离则设置模式字为“主动段”。
申请重要数据成功后，按照重要数据中保存的部件当班状态初始化各部件软件当班状态，对于光纤陀螺产品需根据重要数据中的当班状态进行恢复对于三浮陀螺则根据重要数据中的Fi_GyroSelt状态进行恢复，并统一根据Fi_GyroSelt和当班状态补发产品开指令；对于CMG、红外、星敏产品根据重要数据中的当班状态恢复状态；统一根据当班状态和选择标志补发产品开指令；针对三浮陀螺产品，陀螺开指令连续发送3个控制周期后，连续3个控制周期发送陀螺马达开指令
  申请重要数据失败后，对于陀螺产品则根据ACU提供的部件加电状态初始化陀螺的当班状态和Fi_GyroSelt状态，并根据Fi_GyroSelt状态和当班状态补发产品开指令；对于红外产品，则根据ACU提供的部件加电状态初始化红外的当班状态和Fi_IRESSelt状态，并根据Fi_IRESSelt和当班状态补发产品开指令；对于CMG，根据ACU提供的部件加电状态初始化CMG的当班状态和Fi_CMGSelt状态，并根据Fi_CMGSelt状态和当班状态补发产品开指令；对于星敏感器，软件当班状态仍保持“不当班”状态，等待地面指令设置相应部件当班状态；
重要数据恢复成功后，使用第二块重要数据中的q\q\q\ q恢复“星体在惯性系下的姿态四元数q1/qng1、q2/qng2、q3/qng3、q4/qng4”。
第二块重要数据增加保存星敏定姿方式下的卫星三轴姿态角估值。",0,0,0,0,0,0,1,0
功能描述：利用星敏感器数据进行卫星姿态捕获。,0,1,0,0,0,0,0,0
"功能描述：太阳定向完成后，利用数字太阳与红外信息，进行俯仰、滚动捕获，并建立正常姿态
",0,1,0,0,0,0,0,0
功能描述：检测推力器的微漏，必要时作相应的主备份切换。,0,1,0,0,0,0,0,0
