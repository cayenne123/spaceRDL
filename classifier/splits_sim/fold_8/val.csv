Requirements Description,初始化,控制计算,控制输出,故障诊断和处理,数据有效性判断,数据采集,遥控,遥测
"功能描述：根据天线安装定义和地面站坐标，实时计算天线和地面站的夹角。
",0,1,0,0,0,0,0,0
功能模式：姿态机动的初始化计算。,0,1,0,0,0,0,0,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ77|初始化|任务书
FREQ78|地检使用要求|任务书
FREQ79|通信(串口)|任务书
FREQ80|通信故障处理|任务书
FREQ81|数据解包与转换|任务书
FREQ82|地检数据有效性判断、处理|任务书
FREQ83|地检模拟量采集、处理|预留
FREQ84|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"功能描述：选择通讯的中等精度星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）中等精度星敏共有三个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的中等精度星敏LTU发送取数指令。
（2）向选择的中等精度星敏LTU发送完取数指令后，获得中等精度星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,1,0,0
"功能描述：与CMG通信，控制CMG并获得CMG数据。
处理：
功能编号|功能|引用文档
FREQ69|初始化|与CMG通讯协议
FREQ70|CMG使用要求|任务书
FREQ71|通信(串口)|与CMG通讯协议
FREQ72|通信故障处理|任务书
FREQ73|数据解包与转换|与CMG通讯协议
FREQ74|帆板数据有效性判断、处理|任务书
FREQ75|帆板模拟量采集、处理|任务书
FREQ76|部件在轨转发（在轨修改）|任务书
",0,0,1,0,0,0,0,0
"功能描述：根据陀螺输入，予估卫星对地姿态。

处理：
STEP1:计算；
STEP2:计算，区分工作模式BZ1=1（三轴稳定正常轨道运行姿态）或8（侧摆机动）或9（侧摆角保持），BZ1≠1和8和9两种情况；
STEP3:计算；
STEP4:若BZ1=1（三轴稳定正常轨道运行姿态）或2（偏航机动并稳定运行）或6（轨控期间），；
STEP5:若BZ1=1（三轴稳定正常轨道运行姿态），则；
STEP6:若BZ1=8（侧摆机动），则，；
STEP7:若BZ1=9（侧摆角保持），则，；
STEP8:若BZ1=B（入轨段控制模式）且(消初偏结束时刻)。",0,1,0,0,0,0,0,0
"功能描述：数传天线数据处理
",0,0,0,0,0,1,0,0
"功能描述：发送和接收OBDH重要数据
处理：
OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,1
功能描述：在CMG控制过程中判断CMG是否饱和而需喷气卸载；在喷气卸载过程中判断CMG是否卸载完毕。,0,1,0,0,0,0,0,0
将重要数据打包后放到AOCC重要数据内存地址空间中。AOCC共三块重要数据，每块重要数据均有校验和，校验和占4个字节。校验和的计算方法为：将60个字节按双字进行异或计算。,0,0,0,0,0,0,0,1
"AO在主动段初始化中进行如下工作：
星时清零；
工作模式为主动段；",0,0,0,1,0,0,0,0
"功能描述：使用星敏感器C的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
功能：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。,0,1,0,0,0,0,0,0
"功能描述：模式3切换方式。
处理：
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：若地面指令转入对日定向运行模式或者太阳捕获模式，置CMGStartFlag=1。",0,1,0,0,0,0,0,0
"功能描述：接收星箭分离信号及天线状态数据
处理：控制计算机在收到星箭分离指令并且判断数据正确后，即认为星箭分离有效，通过方式代码的服务请求，申请OBDH停止发送星箭分离信号。天线状态的数据具体见与外总线通讯协议。",0,0,0,0,0,0,1,0
"软件需求名称：星历与轨道 
需求类别：其他 
软件需求描述：日月星轨道计算“计算太阳、月球、卫星位置矢量在地心J2000.0惯性系下的表示”；中继目标轨道计算“计算中继目标轨道”。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.3.1|日月星轨道计算|《用户需求》4.3.1|
FREQ12.3-R4.3.2|中继目标轨道计算|《用户需求》4.3.2|
",0,1,0,0,0,0,0,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ98|初始化|任务书
FREQ99|磁力矩器使用要求|任务书
FREQ100|通信(DA)|任务书
FREQ101|通信故障处理|预留
FREQ102|数据解包与转换|预留
FREQ103|磁力矩器数据有效性处理|预留
FREQ104|磁力矩器硬件采集、处理|任务书
FREQ105|部件在轨转发（在轨修改）|预留
",0,0,0,0,1,0,0,0
"功能描述：接收时间码
处理： OBDH分系统每1分钟给控制计算机校时一次。",0,0,0,0,1,0,0,0
"功能描述：滚动通道喷气中断处理程序。
处理：将推力器1-8关掉",0,0,0,1,0,0,0,0
"功能描述：根据星敏感器的输入，计算姿态偏差，角速度等。
",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器数据进行卫星姿态捕获。
",0,1,0,0,0,0,0,0
"软件需求标识：FREQ26 
软件需求名称：推进数据采集处理要求 
需求类别：其他 
软件需求描述：推进数据采集处理要求。",0,0,0,0,0,1,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计角速度。
",0,1,0,0,0,0,0,0
"功能描述：模拟太阳故障状态。
",0,1,0,0,0,0,0,0
功能描述：实时计算卫星轨道参数。,0,1,0,0,0,0,0,0
"计算机上电/复位后应用软件的工作流程如下。
图5-1应用软件初始化和复位处理流程",0,0,0,1,0,0,0,0
功能描述：帆板未展开模式控制,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.3|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.4|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据轨控需求和姿控推力器使用情况，开推力器进行轨道控制
|轨道控制喷气|FREQ4.3|5.4.6|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1.1|地面站赤经赤纬计算
|数传天线指向控制|FREQ4.14|5.6.1|根据指令完成数传天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|基于三轴角动量反馈的偏置动量控制方法产品规范|FREQ4.21|/|规范化算法：
|数传天线指向目标角计算|FREQ4.14.2|5.6.1.2|根据指定跟踪数传天线与其被指定跟踪站的方位，计算其跟踪转角
",0,1,0,0,0,0,0,0
"功能描述：计算机动模式轮控所需电压。
输入：本体相对目标姿态的四元数
      本体相对目标坐标系转速的估值
      陀螺角速度估值    ，
      实测飞轮角动量    ，
      ，",0,1,0,0,0,0,0,0
"功能描述：视线目标的姿态确定。
",0,1,0,0,0,0,0,0
功能描述：为三轴姿态喷气控制选择喷管；并记录喷气时间等。,0,1,0,0,0,0,0,0
"功能描述：使星体Z轴对日定向，适当时重捕地球。
处理过程：
(1)若星敏数据无效且FEA=0，则Ψ=0.12，调用“-Z轴对日定向”，BZ1=3；
(2)当FEA=0时；FM3②增加判断；
(3)当FEA=5时，其中姿态角的阀值增加调整系数。",0,1,0,0,0,0,0,0
"功能描述：接收遥测采集设置指令
处理：将接收遥测采集设置指令存储地址中内容解包成帧计数值，而AOCC则返回与帧计数值相对应的60字节DS遥测量。此指令与发送遥测数据块配合执行。",0,0,0,1,0,0,0,0
"功能描述：根据注入轨道参数计算地磁场强度。
处理：
由星时和外推轨道数据星上实时计算地磁场强度。",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器和陀螺输出计算姿态四元数。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
|极高星敏感器数据的采集与处理|FREQ1.5.5|极高星敏感器1553B取数指令|极高星敏感器的四元素、角速度状态信息|在通讯允许的条件下（极高星敏感器的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,1,0,0
"功能描述：采集22路数字太阳粗码、监视码和全开码。
处理：
采集方法：连续采集28路（中间有细码信息，处理时略过），采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,1,0,0
功能描述：接收轨道根数数据,0,0,0,0,0,0,1,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0|主动段|FREQ56
1|正常对地运行|FREQ57
2|偏航机动|FREQ58
3|全姿态捕获|FREQ59
4|对地捕获|FREQ60
5|帆板未展开|FREQ61
6|轨控|FREQ62
7|无控|FREQ63
8|侧摆机动|FREQ64
9| 侧摆保持|FREQ65
11|入轨段控制|FREQ66
12|自旋模式|FREQ67
13|应急模式|FREQ68
14|星敏全姿态捕获模式|FREQ69
10|CMG启动模式|FREQ107

主动段工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定和姿态和轨道控制的如下所示
|模式字
|E
卫星轨道外推计算|√
GPS轨道计算|√
太阳星历计算|√
地面站位置计算|√
地磁场计算|√
偏流角计算|
岁差章动计算|√
陀螺数据处理|√
惯性姿态陀螺预估|√
对地姿态陀螺预估|
四元数陀螺预估|
红外输出的数据处理|√
太阳输出的数据处理|√
红外的姿态修正|
红外与太阳双矢量定姿|
红外太阳姿态修正|
星敏感器数据处理|
星敏感器A姿态修正|
星敏感器B姿态修正|
星敏感器C姿态修正|
星敏感器A、B姿态修正|
星敏感器A、C姿态修正|
星敏感器B、C姿态修正|
对地姿态修正及星敏粗姿态计算|
仅星敏感器A的姿态修正|
仅星敏感器B的姿态修正|
仅星敏感器C的姿态修正|
仅星敏感器AB的姿态修正|
仅星敏感器AC的姿态修正|
仅星敏感器BC的姿态修正|
侧摆目标姿态确定|
–Z轴捕获太阳及对日定向|
偏航捕获及转对地定向|
星敏感器全姿态捕获|√
姿态控制量计算|√
相平面法|√
姿态喷气控制|√
动量轮摩擦补偿计算|√
动量轮角动量保持的PI控制|√
动量轮启动与保持|√
正常飞行动量轮分配电压计算|
结构滤波器计算|
喷气卸载条件计算|
磁卸载控制|
CMG数据处理|√
CMG控制|
运行段帆板控制|
自主跟踪控制|
无控模式下太阳帆板控制|
数传天线指向控制|
偏置动量轮分配电压计算|
正常模式1N变轨|

在正常运行模式下主要有三种定姿方式：红外定姿、红外太阳定姿和星敏定姿。其中星敏定姿为高精度定姿方式。并可采用有陀螺和无陀螺方式，正常情况下为有陀螺。定姿方式的切换通过注入系统定姿方式字和系统故障诊断来实现切换。",0,0,0,0,1,0,0,0
"功能描述：处理地面遥控注入的内存下卸指令注入
处理：解包内存下卸指令注入，得到内存下卸起始地址用于第七类快帧数据打包。
说明： 遥测数据指令采用16字节(有效使用9字节)格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,1,0
"功能描述：选择通讯的LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）甚高精度星敏共有1个LTU，AOCC每个控制周期根据注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中是否通讯的甚高精度星敏LTU发送取数指令。
（2）向甚高精度LTU发送完取数指令后，获得甚高精度星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,1,0,0
功能描述：对弦宽、基准与给定的范围进行比较，确定红外故障。若两红外数据均有效，则还可根据本周期与上周期红外姿态角确定红外故障。,0,1,0,0,0,0,0,0
OBDH重要数据有两块，大小共为128字节，AOCC不做任何改动保存在RAM中。如果AOCC发生复位，应利用方式代码请求服务，索取OBDH重要数据进行保存。若在大于0.256s的时间内仍未收到接收OBDH重要数据的指令，则重新请求服务，同时索要OBDH重要数据的计数器累加，若此计数器大于等于40，则不再索要OBDH重要数据。若索要OBDH重要数据成功，将此计数器清零。,0,0,0,0,0,0,0,1
"功能描述：当收到“停控”数据指令或满足自主进入停控模式的条件时，应用软件进入停控模式。
处理
关闭自锁阀1、2；
与ALTU继续通信，进行轨道与环境计算、采集信息，不进行定姿与控制，输出磁力矩器、推力器控制量为0，发送CMG1~5复位及高速断电指令；之后发送CMG无效0指令。
停止对天线控制计算、通信。",0,1,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.5|偏置飞行模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|匀角速度匀积分时间跟踪模式控制|FREQ5.2.7|4.7|一般轨迹跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.9|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|凝视姿态跟踪模式控制|FREQ5.2.11|4.12|凝视姿态跟踪模式控制调用流程
|测试与标定模式控制|FREQ5.2.12|4.8|测试与标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.13|4.13|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.5|偏置飞行模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|匀角速度匀积分时间跟踪模式初始化|FREQ5.3.7|4.7|一般轨迹跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.9|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|凝视姿态跟踪模式初始化|FREQ5.3.11|4.12|凝视姿态跟踪模式初始化设置
|测试与标定模式初始化|FREQ5.3.12|4.8|测试与标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.13|4.13|惯性定向模式初始化设置

主动段和无控工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,1,0,0,0,0,0,0
"功能描述：接收AOCC重要数据1-4，并处理重要数据1中的内容。
处理：应急线路加电后与OBDH通信，获得陀螺和推力器状态，若连续3个控制周期都没有成功取得重要数据，默认陀螺使用7、8、9号，推力器使用主备份推力器，模拟式太阳敏感器使用ASS1和ASS21。由于AOCC可使用的陀螺为12个（陀螺1~12），可使用的陀螺为9个（陀螺1~9），因此，无法使用陀螺10~12的数据。当恢复AOCC重要数据后，若ZT9表明使用了陀螺10~12，则设置ZT9中陀螺10~12为不可用，陀螺7、8、9为可用，陀螺工作状态BZ9按照设置后的ZT9中由小到大的顺序（从陀螺1到陀螺9）选用3个陀螺。",0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|三浮陀螺数据的采集与处理|FREQ1.2.1|""三浮陀螺1553B取数指令
""|陀螺1-3的速度增量|在通讯允许的条件下（每个三浮陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是角速率数据，通过任务书给出的公式计算
|光纤陀螺数据的采集与处理|FREQ1.2.2|""光纤陀螺LTU取数指令
""|陀螺4-9的速度增量|在通讯允许的条件下（每个光纤陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。获的是即为速度增量数据，直接乘当量就可以得到需要的结果；
",0,0,0,0,0,1,0,0
功能描述：启动飞轮或动量保持控制。,0,1,0,0,0,0,0,0
"功能描述：在完成对日定向后，由地面指令转入地球捕获。通过红外和数字太阳敏感器定姿，消除卫星的偏航角。
输入：陀螺数据处理的输出 ，
数字太阳敏感器数据有效性标志F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出），数字太阳敏感器输出： （量纲：弧度）
红外地球敏感器数据有效性标志F_IresValid（由数据有效性判据给出）
上周期姿态角估值，
太阳星历的输出，
",0,1,0,0,0,0,0,0
功能描述：使用GPS通道版数据进行GPS定轨。,0,1,0,0,0,0,0,0
功能描述：设置7类快帧遥测数据下传顺序,0,0,0,0,0,0,0,1
"功能描述：由数字太阳粗细码得到数字太阳角、全开码、见太阳标志。
处理：
每个数字太阳敏感器包括7道粗码（C1～C7）、4道细码（F1～F4）、2道监视码（M1、M2）和1道全开码（T），数字太阳敏感器的第8道粗码(C8)与第1道细码(F1)合为一道码。所有14道码均由电路处理为电压信号，量纲为伏。
在数字太阳敏感器中，8道粗码以格雷码形式编码，探头输出的信号为原始的光电流信号，进行I/V变换放大后为模拟电压信号，再经A/D转换为数字量信号。粗码与格雷码的对应关系见表5-4所示：
表5-4 粗码与格雷码对应关系
粗  码|C1|C2|C3|C4|C5|C6|C7|C8(F1)
格雷码|G7|G6|G5|G4|G3|G2|G1|G0

首先，对粗码进行二值化处理，以全开码输出的一半作为阈值，当高于阈值时，对应的格雷码输出为“1”，否则为“0”。
其次，对数字太阳粗码角度部分从格雷码向二进制码进行转换。格雷码向二进制码转换时，最高位不变，其后的几位按下列规律转换：
二进制码第i位(i=0～6)： ，式中是异或功能逻辑符。
再次，细码角度（几何角）部分可由下列公式得到：
      F1=A/2 [1-cos（180×α）]	（1）
      F2=A/2 [1-（180×α）]	（2）
      F3=A/2 [1+cos（180×α）]	（3）
      F4=A/2 [1+（180×α）] 	（4）
式中是细码角度（几何角）， 量纲为度，细码角度范围为0～2º，最小码当量为0.78125º；F1～F4的量纲为伏；A表示信号幅值。
	在0～0.5º范围内时，由式（1）～（4）可以得到：
               α=a()      
，通过粗细码同步处理进行补偿。粗细码同步处理原则如下：
当细码最高两位都为0，且粗码最低两位都为1时，将粗码加1。
当细码最高两位都为1，且粗码最低两位都为0时，将粗码减1。
其余情况不作任何处理。
粗细码角度同步处理完毕之后，所得到的角度为偏移二进制码，偏移量为64度，然后将偏移二进制码转换成原码形式。
每个数字太阳敏感器数据处理后的为：2字节原码，D15：“0”表示见太阳，“1”表示未见太阳；D14：“0”表示负角度，“1”表示正角度；D13~D1为有效数据；D0：恒为0。
数字太阳敏感器视场有效性判断：以0.28太阳常数（34H，对应电压值为1.02V）作为监视码的固定门槛值，用采集到的监视码M1和M2分别与其比较，仅当监视码M1和M2的值均高于固定门槛值时，数字太阳敏感器视场为视场内，否则为视场外。",0,0,0,0,0,1,0,0
功能描述：地面站赤经赤纬计算。,0,1,0,0,0,0,0,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ78|初始化|小卫星统一化平台中心控制单元通讯协议：地检协议
FREQ79|地检使用要求|任务书、地检协议
FREQ80|通信(串口)|任务书、地检协议
FREQ81|通信故障处理|任务书
FREQ82|数据解包与转换|地检协议
FREQ83|地检数据有效性判断、处理|任务书
FREQ84|地检模拟量采集、处理|预留
FREQ85|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
功能描述：确定ASS21，ASS22，ASS31，ASS32 及帆板转角的信号选取。,0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：将F_CMGValid指定工作的CMG框架角保持在标称框架位置。,0,1,0,0,0,0,0,0
"功能描述：利用加速度计数据诊断加速度计部件状态
",0,1,0,0,0,0,0,0
"功能描述：将CMG启动到标称转数。
处理：
发送指令“运行CMG启动模式”进入CMG启动模式。
	根据地面数据指令，设置CMG引入状态；
	应用软件连续5个控制周期给引入的CMG加电；
	根据自锁阀状态设置自锁阀1和/或自锁阀2开；
	上述动作完成后，自主控制引入的4或5个CMG框架角转到标称位置；
	当框架角度达到要求值后，地面发“CMG高速启动”指令，应用软件连续5个控制周期自主向引入的4或5个CMG发送“CMG高速启动”指令，令4或5个CMG的高速转速达到6000rpm；（本步骤也可通过地面指令完成）
	CMG高速启动时间为10~15分钟
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；//在有星敏和无星敏时均可启动CMG
调用目标姿态确定；
调用控制器输入量计算；
调用CMG奇异状态的判断及算法计算；
调用CMG启动与保持；
if(CMGStartComm =1) 给CMG发启动指令；
if(Flag_equation=0)调用相平面喷气脉宽；
调用系统故障诊断；",0,1,0,0,0,0,0,0
"功能：在不使用陀螺数据时，对姿态角、角速度与姿态四元数预估。
",0,1,0,0,0,0,0,0
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
在模式切换中以地面上行注入优先，所有模式都可以通过地面注入的模式运行类指令进行转换。下面主要分析自主转换换条件与过程，具体转换条件见用户需求4.1~4.11的模式转换条件。4.4姿态机动模式喷气机动转对地或保持的条件中姿态角控制量判据中由0.000262mΦM4改为0.0262mΦM4。    ",0,1,0,0,0,0,0,0
"功能描述：进行I/O板SpaceWire接口读入和输入数据的处理；由于不同敏感器输入的姿态角度信息的格式和量化单位都不相同，需要将它们进行格式转换。输入信息格式转换后的单位规定为：地球敏感器、太阳敏感器、陀螺积分的角度单位为弧度（rad），动量轮转速单位为（rpm） 
处理：
(1)  判断IO当班状态；
(2)  697控制双口RAM；
(3) 根据当班状态，选择SPACEWIRE相应通道，主份IO当班，从通道2读取双口RAM中的数据；备份IO当班，从通道3读取双口RAM中的数据；
(4) 对读取的双口RAM中的数据进行解包
(5) 输入数据处理；（包括：太敏、地敏、三浮、光纤、星敏、时间、ADU控制信息、IO状态信息等）。
接口输入功能
功能描述：进行接口数据的读取 
处理：输入功能具体见PM板与IO板接口。(1) 从双口RAM中读取I/O发送的数据；(2) 根据协议对接收的数据进行解包；
输入数据处理功能分解
接口输入后，根据通讯协议和数据格式进行数据处理，下表示输入数据处理的功能分解：
表5.2-4 输入数据处理功能分解1
序号|编号|功能说明|任务书中的章节号|功能描述
|FREQ10.1|太敏数据处理地敏数据处理|6.1.1|太阳敏感器数据进行解码，读入的偏移二进制码转换为控制计算用的浮点数格式；
|FREQ10.2|地敏数据处理|6.1.2|将从接口读入的ES数据转化为弧度值
|FREQ10.3|甚高三浮陀螺数据处理|6.1.3|将三浮陀螺在一个采样周期内的脉冲数转化为角度增量，并做限幅与剔野处理
|FREQ10.4|光纤陀螺数据处理|6.1.4|对光纤陀螺数据包进行解码，测量数据由定点数转换为控制计算用的浮点数格式；
|FREQ10.7.2|星敏曝光时刻计算|6.1.5|星敏曝光时刻计算

表5.2-5 输入数据处理功能分解2
序号|需求ID号|功能点说明|用户需求中章节号|功能描述
|FREQ10.3.1|三浮陀螺数据剔野|11.1.1|三浮陀螺数据剔野
|FREQ10.4.1|光纤陀螺数据剔野|11.1.1|光纤陀螺数据剔野
|FREQ10.5|陀螺的应用选择|11.1.1|控制分系统配置了9个陀螺，根据陀螺健康字和电源状态字确定陀螺状态字，计算分配矩阵。也可通过陀螺组合遥控指令处理，设置陀螺状态字，进而计算出分配矩阵。故障后通过地面遥控进行陀螺重新组合分配
|FREQ10.6|单独测量时的陀螺数据处理|11.1.1|根据陀螺测量值，得到三轴姿态角速度，用于姿态采用陀螺几分测量时
|FREQ10.7|星敏感器数据处理|11.1.2|对星敏数据进行解包、数据有效性判断、通讯故障判断、星敏数据剔野
|FREQ10.7.1|星敏数据剔野|11.1.2|星敏数据剔野
",0,0,0,0,0,1,0,0
"功能描述：选择通讯的天线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
  （1）加电状态的判断：OBDH在给捕跟分系统发送加电命令的同时，将该命令发送给AOCC。AOCC根据命令字的内容，记录加电状态和工作的主备状态。当第一次得到加电指令时，如果没有主备命令，默认工作在主份；当没有加电，但是发送了主备切换命令，切换有效。中继捕跟分系统断电，再加电后，保留中继上次加电工作状态；当AOCC发生复位、NMI和切机时，保留中继上次加电工作状态。
（2）数据通讯：当接收到中继快扫命令，并且AOCC判断中继捕获跟踪分系统加电状态下，AOCC每个0.524秒控制周期，向GDA发送一次天线驱动机构双轴指向数据。并接收GDA传回的X、Y轴测量角度信号和两轴的偏差角度（X轴框架角、Y轴框架角、X轴偏差角、Y轴偏差角、X轴框架角速度、Y轴框架角速度）。当接收到中继停止命令或判断中继不加电，则停止通讯。",0,0,0,0,0,1,0,0
"功能描述：根据从SLTU接收的0.25秒或1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
输入：0.25秒或1秒内陀螺的角度增量 (量纲：弧度)
(i=1,2,3,…6，依次表示陀螺G1，G2，…，G6的输出)；
采样周期 (量纲：秒)；
陀螺数据有效性标志F_GyroValid(由陀螺有效性判据给出)。
陀螺系统在星体三轴方向等效的常值漂移估值 (量纲：弧度/小时)
星敏感器数据有效性标志：F_SAValid，F_SBValid，F_SCValid
",0,1,0,0,0,0,0,0
"软件需求名称：内存下传 
需求类别：其他 
软件需求描述：依据指令下传指定内存数据。",0,0,0,1,0,0,0,0
"功能描述：接收遥控固定参数注入块的轨迹规划修正系数
",0,0,0,0,0,0,1,0
功能描述：根据陀螺输入，预估卫星惯性姿态。,0,1,0,0,0,0,0,0
功能描述：根据数字太阳见太阳标志和故障标志判断数字太阳数据的有效性。。,0,1,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件进行LTU初始化、1553B初始化、调用系统软件的StartStarTimer、变量的初始化
处理：
进行1553B初始化，处理过程见4.3.2的OBDH初始化功能
GPS秒脉冲信号接口寄存器初始化
设置3个星敏的 RTS信号为无效
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|加电状态的采集与处理|FREQ7.1|从SDC获取部件供电状态信息
|切换指令的处理|FREQ7.2|发送SDC指令。
",0,0,0,1,0,0,0,0
"功能描述：接收遥控固定参数注入块的轨道参数
处理：
GPS无效判断的连续次数变量由1改为7。
调整序号14注入轨道根数有效性阀值、序号16~18岁差章动系数的初装值。",0,0,0,0,0,0,1,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,1
功能描述：根据姿态估值与数字太阳输出，判断太阳修正可用性。,0,1,0,0,0,0,0,0
"功能描述：接收卫星时间
处理：AOCC上电或复位时通过发送重要数据申请给OBDH，OBDH把卫星时间和AOCC重要数据都发到AOCC终端。",0,0,0,0,0,0,1,0
功能描述：各个模式的初始化设置。,0,1,0,0,0,0,0,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书。
功能编号|功能|引用文档
FREQ52|初始化|星敏协议
FREQ53|星敏使用要求|任务书
FREQ54|通信|星敏协议
FREQ55|通信故障处理|任务书
FREQ56|数据解包与转换|星敏协议
FREQ57|星敏数据有效性判断、处理|任务书
FREQ58|星敏模拟量采集、处理|任务书
FREQ59|部件在轨转发（在轨修改）|任务书

3）GPS高精度校时与星敏感器数据的使用
功能描述：根据GPS秒脉冲，秒脉冲广播，进行GPS高精度校时和星敏感器时标处理。
",0,0,0,0,0,1,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。。为保证帆板LTU线路归零指令的成功执行，要求应用软件连续3个周期对帆板LTU线路发送归零指令。",0,0,0,0,0,1,0,0
功能描述：发送全姿态捕获模式数据包,0,0,0,0,0,0,0,1
"功能描述：中继天线数据处理
处理：
处理数据时应对接收数据中的捕跟分系统工作模式进行保护判断。",0,0,0,0,0,1,0,0
根据任务要求，应用软件进行LTU初始化、1553B初始化、调用系统软件的StartStarTimer、变量的初始化。,1,0,0,0,0,0,0,0
"功能：利用星敏感器A、C的测量，修正姿态四元数与姿态角速度。
调用条件：见用户需求5.2.6节。
周期：0.125秒
输入：WorkMode， ， 。
输出：，
处理
见用户需求5.2.6.11。",0,1,0,0,0,0,0,0
功能描述：确定轨道外推初值，并调用轨道计算。,0,1,0,0,0,0,0,0
"功能描述：根据-Y帆板角误差控制帆板跟踪太阳。
",0,1,0,0,0,0,0,0
"功能描述：滚动机动目标姿态确定。
",0,0,0,1,0,0,0,0
"控制计算机实时遥测包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包1|FRE65
|发送姿态数据包3|FRE65.1
|星敏感器姿态数据包|FRE65.2
|星敏感器自检数据包|FRE65.3
|姿态控制数据包|FRE65.4
|轨道数据包|FRE65.5
|LTU自检数据包|FRE65.6
|AOCC及状态数据包|FRE65.7
|发送星敏修正数据包|FRE65.8
|发送对日定向数据包|FRE65.9
|数传天线地面夹角数据|FRE65.10

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,1
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.5|偏置飞行模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|角速度跟踪模式控制|FREQ5.2.7|4.7|角速度跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.9|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|测试与标定模式控制|FREQ5.2.11|4.8|测试与标定模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.5|偏置飞行模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|角速度跟踪模式初始化|FREQ5.3.7|4.7|角速度跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.9|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|测试与标定模式初始化|FREQ5.3.11|4.8|测试与标定模式初始化设置

主动段和无控工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,1,0,0,0,0,0,0
功能描述：计算CMG的框架角速度。                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：修改奇异规避算法。,0,1,0,0,0,0,0,0
"星务中心计算机在1s运行周期内与控制计算机完成数据交互一次，在每次交互时星务中心计算机先发送12字节的握手信号，紧接着连续发送有效传输数据。控制计算机在接收全部数据后250ms内，将需要发送给星务计算机的数据数据发给星务中心计算机（包含握手包头和有效传输数据）。
上行数据处理（星务计算机→控制计算机）的功能点如下：上行数据包轮询及数据处理流程、GPS轨道数据、接收AOCC重要数据、星务至CCU数据块、星务至VIPPCU数据块、原始任务注入块、规划结果单次任务输入、任务规划用整星遥测
下行数据处理（控制计算机→星务计算机）的功能点如下：下行数据处理流程、快帧1遥测数据包、快帧2遥测数据包、慢帧1遥测数据包、慢帧2遥测数据包、慢帧3遥测数据包、慢帧4遥测数据包、慢帧5遥测数据包、辅助数据、发送AOCC重要数据、控制分系统成像任务规划结果、控制分系统数传任务规划结果、慢帧6遥测数据包、CCU内存下卸帧、部件内存下卸帧、VIPPCU内存下卸帧",0,0,0,0,0,0,0,1
"功能描述：紧急撤离模式下，计算视速度增量关机时间长度
",0,1,0,0,0,0,0,0
功能描述：确定各部件的工作状态，并开关相关部件电源。,0,0,0,0,0,1,0,0
"功能描述：使用星敏感器C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：对磁力矩器电压一阶滤波。
",0,1,0,0,0,0,0,0
功能描述：根据指令完成中继天线的捕获跟踪控制。,0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的帆板参数,0,0,0,0,0,0,1,0
"软件需求名称：帆板控制算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.6.1|帆板控制策略|《用户需求》4.6.1|
FREQ12.3-R4.6.2|帆板控制量确定|《用户需求》4.6.2|
FREQ12.3-R4.6.3|帆板控制指令转速计算|《用户需求》4.6.3|
",0,1,0,0,0,0,0,0
"软件需求标识：FREQ4 
软件需求名称：星时计算 
软件需求描述：星时计算。见“任务书”4.1.3.1“星时计算”。",0,0,0,0,0,1,0,0
"功能描述：接收遥控可变地址注入块
处理：软件设计时需要判断地址是否对齐，若未对齐，则不执行此注入块。",0,0,0,0,0,0,1,0
"功能描述：处理广播的GPS数据
处理：解包广播的GPS数据，更新追踪器绝对GPS数据、目标器绝对GPS数据、追踪器和目标器的相对GPS数据",0,0,0,0,0,0,1,0
"功能描述：CMG奇异状态的判断及算法计算。
输入：采集得的各CMG的框架角Sgang[i]（弧度）；CMG有效性标志Lcmg[i]，Jacobi矩阵sgJ",0,1,0,0,0,0,0,0
功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压、、。,0,1,0,0,0,0,0,0
"功能描述：发送遥测数据
处理：
包括两个子地址，发送两条指令是连续的，共有76个字节。应用软件在收到发送遥测帧计数（低字节为实时遥测帧计数0~63，高字节为实时格式计数0~7）的低字节为62时，根据高字节实时格式计数根据延时遥测数据格式进行打包后放到发送延时遥测参数地址中，具体数据见延时遥测文件。",0,0,0,0,0,0,0,1
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续三个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是A090H或者校验和错误或者未收到重要数据），则应用软件按照重要数据的初始值运行。",0,0,0,0,0,0,1,0
"功能描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。
功能编号|功能|引用文档|备注
FREQ34|星敏初始化|星敏协议|B
FREQ35|星敏数据采集|任务书|A
FREQ36|数据解包与转换|星敏协议|A
FREQ37|星敏数据有效性判断|任务书|
FREQ38|星敏数据曝光时刻计算|任务书|
FREQ39|星敏数据有效性判断、处理|任务书|A
FREQ40|星敏故障重构|任务书|A
",0,0,0,0,0,1,0,0
"软件需求标识：FREQ5 
软件需求名称：星时校正 
软件需求描述：星时校时。
",0,0,0,0,0,1,0,0
"功能描述：计算CMG的框架角速度,。",0,1,0,0,0,0,0,0
"功能描述：接收遥控注入数据块1、2、3、4、5、6、7
处理：将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。如果128＜遥控注入数据块长度≤256字节，将数据不足256字节部分以AA16填充，按照“遥控注入数据块结构分为遥控注入数据块1～4，按照子地址（1～4）顺序向AOCC连续发送；如果64＜遥控注入数据块长度≤128字节，将数据不足128字节部分以AA16填充，按照“遥控注入数据块结构分为遥控注入数据块5、6，按照子地址（5、6）顺序向AOCC连续发送；如果遥控注入数据块长度≤64字节，将不足64字节部分以AA16填充，按照“遥控注入数据块结构通过子地址11将数据发送给AOCC；各个上行注入块的格式如表 44所示：
表 44：各个上行注入块的格式
块类型识别字|块类型名称|块长度（字节）|指令
1B H|AOCC程序块|256N|接收遥控注入数据块1、2、3、4
EB H|AOCC轨道数据块|128|接收遥控注入数据块5、6
27 H|AOCC姿控数据块|64|接收遥控注入数据块7
28 H|AOCC系数数据块|64|接收遥控注入数据块7
41 H|AOCC轨控命令块|64|接收遥控注入数据块7
4E H|AOCC太阳翼命令块|256|接收遥控注入数据块1、2、3、4
7D H|AOCC内存修改块|64|接收遥控注入数据块7
BEH|AOCC中继星轨道数据块|128|接收遥控注入数据块5、6
69H|AOCC结构滤波器系数数据块|128|接收遥控注入数据块5、6
C3H|AOCC中继天线安装修订系数块|64|接收遥控注入数据块7

根据上行注入块的大小，可以把上行注入块分成三种，分别为256字节，128字节和64字节。相应AOCC接收遥控注入的处理程序也分为三种，分别对应256字节，128字节和64字节的处理程序。
接收64字节遥控注入处理程序流程如下图所示
图17: 接收64字节遥控注入处理程序流程
2）接收128字节遥控注入处理程序流程如下图所示
图18: 接收128字节遥控注入处理程序流程
3）接收256字节遥控注入处理程序流程如下图所示
图19: 接收256字节遥控注入处理程序流程
若ZT8≠0，则BZ7=ZT8。",0,0,0,0,0,0,1,0
功能：在不使用陀螺数据时，对姿态角、角速度与姿态四元数预估。,0,1,0,0,0,0,0,0
"功能描述：选择星敏感器有效数据进行几何姿态确定，并在星敏无效情况下并采用陀螺数据进行姿态预估。
",0,1,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器。                                                                                                                                                                                                                                                                                                                                                                                                                                                       输入：标志F_JetGroup，F_SatStage
姿态角与角速度：
正常模式星敏感器与陀螺定姿输出(F_NoGyro=0或2) 
，(量纲：弧度)
，(量纲：弧度/秒)
或：正常模式星敏感器定姿输出(F_NoGyro=1或3时)
(量纲：弧度)
(量纲：弧度/秒)
或：机动与轨控模式姿态输出(无量纲)，(量纲：弧度/秒)
或：其它情形相应程序的输出
，(量纲：弧度)
，(量纲：弧度/秒)
，(量纲：度)
输出：	喷气状态，
各推力器分配脉宽，
累计三轴姿控正向喷气时间：，
累计三轴姿控负向喷气时间：，
=[，]T(量纲：弧度/秒2)",0,1,0,0,0,0,0,0
"功能描述：决定利用星敏感器A、B、C单独或组合定姿的方式，调用相应姿态修正程序。
",0,1,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示（十六进制）：
服务编码|发送的条件
12H|模式字转为8（侧摆机动）时
C3H|每隔1分钟或转模式时发送
3CH|上电/复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发一次；直到第60次为止
C0H|如果AOCC发生复位，利用方式代码请求服务，索取OBDH重要数据进行保存。若在大于0.25s的时间内仍未收到接收OBDH重要数据的指令，则重新请求服务，同时索要OBDH重要数据的计数器累加，若此计数器大于等于40，则不再索要OBDH重要数据。若索要OBDH重要数据成功，将此计数器清零。
96H|进入正常模式后发送，收到确认字后停止发送
30H|进入变轨模式后发送，收到确认字后停止发送
90H|进入全姿态工作模式后发送，收到确认字后停止发送
F0H|进入应急模式后发送，收到确认字后停止发送
0FH|进入停控模式后发送，收到确认字后停止发送
",0,0,0,0,0,0,0,1
"功能描述：与动量轮通信，输出本周期电压。采集动量轮电源状态、转速、模拟量等信息。
处理：
功能编号|功能|引用文档|备注
FREQ57|动量轮初始化|任务书|B
FREQ58|动量轮数据采集|任务书|B
FREQ59|通信(DA输出、脉冲输入)|任务书|B
FREQ60|数据解包与转换|任务书|B
",0,0,1,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得12个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据， AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。具体如下表所示： 
GROLTUSeltFlag|进行通讯的陀螺LTU
01H|陀螺LTU1
02H|陀螺LTU2
03H|陀螺LTU3
其它|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1

取数指令由三个字节组成：
第一个字节为对陀螺LTU的命令设置，有四种命令格式：取数指令1、取数指令2、复位指令、地检模式指令，应用软件只自主发取数指令1和取数指令2两种格式，并由注入控制方式指定及LTU通信选择块中的陀螺LTU取数方式来切换，默认为取数指令1；其余两种格式（复位指令和地检模式指令）通过地面注入LTU命令块来设置。
第二个字节为对光纤陀螺的命令设置，有四种命令格式：测量模式1（有温度补偿）、测量模式2（无温度补偿）、地检模式1（只传地面数据）、地地检模式2（地面数据+头部测量数据），由注入控制方式指定及LTU通信选择块中的光纤陀螺指令切换方式字来切换这四种格式，默认为测量模式1（有温度补偿）。
第三个字节为前两个字节的累加和。
另外，每个控制周期AOCC还向选取的陀螺LTU发送取陀螺状态指令，指令为3字节指令（D5、AA、7F），得到的状态信息用于遥测。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式，具体参见LTU通讯协议。",0,0,0,0,0,1,0,0
"表格工作项|软件需求标识|软件需求名称|
FREQ23.1|固定地址参数|见“上行注入”5|
FREQ23.2|可变地址参数|见“上行注入”6|
FREQ23.3|轨道参数|见“上行注入”7|
FREQ23.4|程序注入|见“上行注入”8|
FREQ23.5|内存下卸|见“上行注入”9|
FREQ23.6|星敏部件控制注入|见“上行注入”10|
FREQ23.7|中继目标轨道|见“上行注入”11|
FREQ23.8|轨控命令|见“上行注入”12|
FREQ23.9|间接指令|见“上行注入”13|
FREQ23.10|固定地址|见“上行注入”14|
",0,0,0,0,0,0,1,0
"功能描述：发送AOCC内存数据块
处理：OBDH从遥控接收到AOCC内存数据下卸指令后，向AOCC发送内存设置命令，通知AOCC内存数据下卸的段地址、偏移量及下卸长度；OBDH发出内存设置命令后100ms，开始接收AOCC内存数据。其处理过程如下：
STEP1：AOCC应用程序接收到OBDH内存下卸的指令后，进入OBDH中断服务程序（INT1）；
STEP2：AOCC应用程序读出OBDH注入的段地址、偏移地址和数据长度；
STEP3：根据段地址，偏移地址计算下卸内容的地址，并进行合法性判别。
STEP4：根据计算出的下卸内容的起始地址和长度，将下卸内容放入OBDH规定的内存中 。",0,0,0,0,0,0,0,1
"功能描述：利用星敏感器C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：主动段模式控制,0,1,0,0,0,0,0,0
"|需求名称|编号|输入章节号|功能描述
|卫星轨道参数外推计算|FREQ2.0|5.1.1|实时计算卫星轨道参数。
|轨道外推根数获取与星历计算|FREQ2.1|5.1.2|岁差章动计算、GPS 轨道数据判断、太阳星历、地面站位置、地磁场强度计算
|GPS轨道数据有效性判断|FREQ2.2|5.1.2.2|对GPS轨道数据的有效性进行判断
|GPS 通道版和轨道版轨道计算|FREQ2.3|5.1.2.2.1和5.1.2.2.2|利用GPS 通道版和轨道版数据进行GPS 定轨程序
| 系的卫星位置及速度计算|FREQ2.4|5.1.2.5|将J2000 系的卫星位置与速度转换为WGS84 系的位置和速度
|近圆中低轨卫星轨道根数外推算法产品规范|FREQ2.5|/|规范化算法：
|近圆中低轨卫星GPS轨道计算算法产品规范|FREQ2.6|/|规范化算法：
|岁差章动矩阵计算算法产品规范|FREQ2.7|/|规范化算法：
|4阶星上地磁场计算方法算法产品规范|FREQ2.8|/|规范化算法：
|光行差计算算法产品规范|FREQ2.9|/|规范化算法：
|自主轨控计算及发送请求|FREQ2.10.0|5.1.2.6|根据实际与标称轨道参数计算轨控参数，并进行轨控申请
|自主轨控计算初始化|FREQ2.10.1|5.1.2.6.1|进行自主轨控远地点选取和轨控时间计算
|发送自主轨控请求|FREQ2.10.2|5.1.2.6.2|发送轨控加温请求，判断是否可以进行自主轨控
",0,1,0,0,0,0,0,0
"功能描述：太阳地球捕获主程序。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|对地数传天线1数据的采集与处理|FREQ1.7.1|""对地数传天线1 LTU控制指令
""|对地数传天线1的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
|对地数传天线2数据的采集与处理|FREQ1.7.2|""对地数传天线2
LTU控制指令""|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
",0,0,0,0,0,1,0,0
功能描述：计算地磁场矢量分量。,0,1,0,0,0,0,0,0
"功能描述：接收GPS轨道板定位数据
处理：保存GPS轨道板定位数据，35V帆板电压遥测用于帆板故障检测。",0,0,0,0,0,0,1,0
"功能描述：利用星敏感器D的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
轨道与星历计算包括卫星轨道计算、太阳星历计算、GPS计算、地磁场计算四部分。应用软件根据注入轨道参数或GPS数据进行卫星轨道实时计算，确定卫星轨道根数。太阳星历计算可确定太阳方位以及惯性系到轨道坐标系转换矩阵。地磁场的计算可确定地磁场强度。应用软件根据以上计算结果为姿态确定和姿态控制提供轨道和星历以及地磁场强度数据。卫星轨道、太阳星历、地磁场和GPS数据转换为轨道根数计算在1.0秒控制任务的任务1中完成。,0,1,0,0,0,0,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.8.1~4.8.8。
序号|功能点编号|功能描述|说明
|FREQ3.4.10.1|陀螺故障检测及选择|《用户需求》4.8.1
|FREQ3.4.10.2|加速度计故障检测及选择|《用户需求》4.8.2
|FREQ3.4.10.3|星敏感器故障检测及选择|《用户需求》4.8.3
|FREQ3.4.10.4|系统故障检测及选择|《用户需求》4.8.4
|FREQ3.4.10.5|加计通讯故障处理|《用户需求》4.8.5
|FREQ3.4.10.6|陀螺通讯故障处理|《用户需求》4.8.6
|FREQ3.4.10.7|测速波束有效性检测及选择|《用户需求》4.8.7
|FREQ3.4.10.8.1|单机类故障诊断_陀螺|《用户需求》4.8.8 
|FREQ3.4.10.8.2|单机类故障诊断_加计|《用户需求》4.8.8
|FREQ3.4.10.8.3|单机类故障诊断_星敏|《用户需求》4.8.8
|FREQ3.4.10.8.4|单机类故障诊断_微波测距测速|《用户需求》4.8.8
|FREQ3.4.10.8.5|单机类故障诊断_激光测距|《用户需求》4.8.8
|FREQ3.4.10.8.6|单机类故障诊断_激光测速|《用户需求》4.8.8
|FREQ3.4.10.8.7|自主启动IMU数据存储|《用户需求》4.8.8
",0,1,0,0,0,0,0,0
功能描述：对星敏感器输出数据进行有效性判断。,0,1,0,0,0,0,0,0
"功能描述：进行系统故障的检测。
",0,1,0,0,0,0,0,0
"功能描述：对动量轮的角动量进行调整。
",0,1,0,0,0,0,0,0
功能描述：仅使用红外定姿时，计算正常飞行轮控所需电压。,0,1,0,0,0,0,0,0
"功能描述：发送AOCC时间
处理：
CTU复位后需要从AOCC恢复重要数据和星上时间。首先CTU发送“接收用于做时间差值的时间码”指令，将CTU目前的时间发送给AOCC。AOCC将星上时间和接收到的CTU时间做差值处理，将AOCC时间-CTU时间保存。CTU在1s后发送“发送时间差值”指令，AOCC将保存的时间差值发送给CTU。",0,0,0,0,0,0,1,0
"功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|ACU模拟量数据的采集与处理|FREQ1.8.1|""ACU 1553B模拟量数据采集指令
""|模拟量|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
|ACU状态数据的采集与处理|FREQ1.8.2|""ACU 1553B各种状态数据采集指令
""|部件状态、双组元推进状态1、推进状态2、ACU工作状态|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
|ACU中控制指令的输出处理|FREQ1.8.3|计算得到的喷气脉宽、磁力矩器电压|控制指令消息的输出|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
|部件加断电指令的处理|FREQ1.8.4|需要发送的加断电指令|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|ACU保存CCU的重要数据|FREQ1.8.5|保存CCU的重要数据|接收CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
|从ACU恢复CCU的重要数据|FREQ1.8.6|恢复CCU重要数据|发送的CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
|ACU的程序注入修改|FREQ1.8.7|从OBDH收到的ACU需修改程序内容|ACU需修改程序内容|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
|ACU的内存下传|FREQ1.8.8|从OBDH收到的ACU内存下传设置指令|内存下传设置指令|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
|自锁阀操作|FREQ1.8.9||自锁阀操作指令|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令
",0,0,0,0,0,1,0,0
"功能描述：根据需求，计算去往定点观测模式机动过程中所需的目标姿态。
",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器B的测量，修正姿态四元数与估计角速度。
",0,0,0,0,1,0,0,0
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
1553B（外总线）初始化：按通讯协议要求进行设置，初始化RAM区为0
当班状态设置
GPS秒脉冲信号设置
脉冲计数初始化
星敏同步信号寄存器初始化
变量初始化""",1,0,0,0,0,0,0,0
"功能描述：根据红外输出，估计卫星姿态与陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：对帆板驱动装置1和帆板驱动装置2进行独立控制和诊断，一个帆板驱动装置失效不影响对另一个帆板驱动装置的控制与诊断。
",0,1,0,0,0,0,0,0
"软件需求名称：化学推进使用及通信 
需求类别：其他 
软件需求描述：与发动机通信，输出本周期喷气脉宽。
处理：
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
UPS初始化|FREQ52|UPS初始化|B|2
化学推进数据采集|FREQ53|化学推进数据采集|B|3
推力器脉冲输出|FREQ54|推力器脉冲输出|B|4
推力器健康字设置|FREQ55|推力器健康字设置|B|5
部件操作（程控490N点火，故障重构）|FREQ56|部件操作（程控490N点火，故障重构）|B|
",0,0,1,0,0,0,0,0
"功能描述：计算小天区扫描模式下的目标姿态，并给出当前的扫描阶段：行扫中，转弯等。
",0,1,0,0,0,0,0,0
功能描述：对工作的飞轮进行电压补偿，并输出控制电压。,0,1,0,0,0,0,0,0
"软件需求名称：应用软件初始化 
需求类别：其他 
软件需求描述：初始化函数为void AppInit(void )。在上电/复位时，系统软件调用此函数来完成应用软件的初始化。见“任务书”4.1.2.1“初始化函数”。",1,0,0,0,0,0,0,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|+Y帆板1553B取数指令（广播同步消息）
+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
-Y帆板数据的采集与处理|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|+Y帆板控制数据
+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|-Y帆板控制数据
-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,1,0,0
功能描述：姿态机动模式初始化,0,1,0,0,0,0,0,0
"软件需求标识：FREQ21 
软件需求名称：部件加断电指令处理 
需求类别：其他 
软件需求描述：部件加断电指令处理。",0,0,0,0,0,1,0,0
"功能描述：采集高速转速、计算角动量偏差、合成角动量、CMG的Jacobi矩阵。
输入：CMG 高速的标称角动量Hwb[i]，CMG状态标志Fcmg[i]；(i=1~5)
输出：使用的CMG角动量sgH（Nms），为35 矩阵；
使用的CMG系统合成角动量H=[Hx，，Hz]T（Nms）；
实测角动量Hw[i]（Nms）；
CMG的Jacobi矩阵sgJ，为35 矩阵；
CMG的框架角度Sgang[i]（弧度）；
三轴角动量偏差，",0,1,0,0,0,0,0,0
"功能描述：接收AOCC系统注入参数
处理：
当收到接收遥控注入结束标识消息后，将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。只有当某个块类型的所有数据都收到，且每块数据的校验和都正确时，才能使用此种类型的注入数据。注入的数据具体见上行注入文件。需要注意的是：地面注入ZT9时：若ZT9中为1的个数小于3个，则不改变星上ZT9的取值；应用软件不响应ZT1=2、ZT1=6、ZT1=8的注入指令。",0,0,0,0,0,0,1,0
"功能描述：ICU模拟量遥测 
",0,0,0,0,0,1,0,0
功能描述：根据从0.25秒/1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。,0,1,0,0,0,0,0,0
"功能描述：根据轨道数据计算偏流角。
",0,1,0,0,0,0,0,0
"功能描述：搜索并捕获太阳，完成并保持帆板对太阳定向
",0,1,0,0,0,0,0,0
"功能：利用星敏感器B的测量，修正姿态四元数与姿态角速度。
",0,0,0,0,1,0,0,0
"功能描述：以1s为采样周期，计算角速度。。
",0,1,0,0,0,0,0,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ82|初始化|任务书
FREQ83|地检使用要求|任务书
FREQ84|通信(串口)|任务书
FREQ85|通信故障处理|任务书
FREQ86|数据解包与转换|任务书
FREQ87|地检数据有效性判断、处理|任务书
FREQ88|地检模拟量采集、处理|预留
FREQ89|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
功能描述：由GPS得到轨道外推的16根数。,0,1,0,0,0,0,0,0
"序|需求名称|编号|调用条件|功能和处理描述
|上电初始化|FREQ11.0|上电时|""1553B（内总线）初始化：按通讯协议要求进行设置
SpaceWire总线（外总线）初始化：按通讯协议要求进行设置
CAN总线（外总线）初始化：按通讯协议要求进行设置，
变量初始化""
|复位初始化|FREQ11.1|复位时|""1553B（内总线）初始化：按通讯协议要求进行设置
SpaceWire总线（外总线）初始化：按通讯协议要求进行设置
CAN总线（外总线）初始化：按通讯协议要求进行设置，
变量初始化""",1,0,0,0,0,0,0,0
"功能描述：完成遇有单翼帆板未展开时，抖动星体帮助帆板展开的功能。为了节省内存，将此模式的代码从PROM中去掉。若需要此模式，则通过在轨注入的方式，将此模式引入控制。
处理过程：过程如下：
STEP1：如果ZT1 = 5且ZT32 = A且C1 = A1则进行下列处理：
滚动通道每个采样周期中发喷气脉冲（主备份同时发）。其脉冲宽度序列为+0.131，-0.262，+0.262，-0.262，… ，-0.262，+0.262，-0.131，共计120个脉冲。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。
STEP2：如果ZT1 = 5且ZT32 = A且C1 = A2则进行下列处理：
俯仰通道每个采样周期中发喷气脉冲（主备份同时发）。其脉冲宽度序列为+0.131，-0.262，+0.262，-0.262，… ，-0.262，+0.262，-0.131，共计120个脉冲。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。
STEP3：如果ZT1 = 5且ZT32 = A且C1 = A3则进行下列处理：
偏航通道每个采样周期中发喷气脉冲（主备份同时发）。其脉冲宽度序列为+0.131，-0.262，+0.262，-0.262，… ，-0.262，+0.262，-0.131，共计120个脉冲。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。
STEP4：如果ZT1 = 5且ZT32 = A且C1 = FFFF则进行下列处理：
发四个轨控喷管同时工作的脉冲序列：脉冲宽度为0.262，0，0.262，0，… ，0.262，0，共计120个（包括宽度为0的脉冲）。。
发完上述120个脉冲以后，令ZT1 = 3，C1 = 0000。",0,1,0,0,0,0,0,0
"功能描述：地面站赤经赤纬计算
处理：同用户需求的",0,0,0,0,1,0,0,0
"此章节01星为“发送AOCC中继事件数据”，现删除，替换为“发送AOCC数据段黑匣子数据”
功能描述：发送AOCC数据段黑匣子数据",0,0,0,0,0,0,0,1
功能描述：对自锁阀进行开关处理。,0,0,1,0,0,0,0,0
"功能描述：决定轨控开关机及姿控，输出相应的状态标志及数据。
处理：在各种条件下的处理见下表所示：判断的顺序为自上而下。
表37：轨控开关机的判别处理
条件|处理
""或
""|""FJO = 0
TJO = 0""
""ZT8  3且
ZT9  3且
""|FTO = 0，FXO = 0，
""且
ZT8  3且
0 < ZT9  3且
FTO  A
""|""	时间关机条件： 

姿态关机条件如下：
轨控推力器开关判断：

喷气长度和累计计算如下

""
""BZ1=6
轨控期间""|发的指令
{ FTO = A }，星体无偏航机动|C1 = CCCC
",0,1,0,0,0,0,0,0
"功能描述：接收GPS通道板定位数据
处理：将接收GPS通道板定位数据存储地址中内容解包星时、卫星的位置和速度。",0,0,0,0,0,0,1,0
功能描述：在完成对日定向后，由地面指令转入地球捕获。当两个地球红外敏感器同时故障时，使用数字太阳敏感器和星敏感器定姿建立正常姿态。,0,1,0,0,0,0,0,0
"功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。
处理：
STEP1:滚动通道滤波；
STEP2:俯仰通道滤波；
STEP3:偏航通道滤波。",0,1,0,0,0,0,0,0
功能描述：三轴喷气姿态控制。,0,1,0,0,0,0,0,0
"功能：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：搜索太阳，直到数字太阳敏感器有太阳信息。,0,1,0,0,0,0,0,0
"功能描述：每4.192秒运行一次的主程序。
处理： 
STEP1：记录当前的星时、数字太阳敏感器输出、四元数和星敏数据、星敏姿态角及惯性角速度：
，
FSTAVD = FSTAVD05，FSTBVD = FSTBVD05，FSTCVD = FSTCVD05
t星A = t星A05，t星B = t星B05，t星C = t星C05
=，=，=，=，=，=
，；
STEP2：若指定星敏诊断陀螺故障，则：对工作陀螺，
STEP3：进行外推轨道计算和中继卫星轨道计算；
STEP4：重要数据打包，进行数据校正和红外故障检测及信号选取；
STEP5：当BZ1 为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，如果没有喷气则进行光行差修正量计算及加速计零位估计；
STEP6：进行星敏感器数据处理；
STEP7：当BZ1为 1（Z轴对地控制模式）或9（侧摆角保持模式）时，进行下列操作：
当BZ1= 1（三轴稳定正常轨道运行姿态）且BZ2 = 1（已有遥控轨道数据注入）且BZ6 = 3（姿态确定用红外、陀螺和数字太阳）且C1 = 0000（轨控数据有效标志为无效）且ZT3≠F（用红外+单个斜装陀螺定姿，且接入控制回路）且ZT3≠A（星敏无陀螺定姿，且接入控制回路，整星零动量控制方式）时进行姿态太阳修正。
当C1 = CCCC（轨控关机后或偏航机动结束后）时令星敏修正时间；否则
进行S姿态的q修正及光轴方位计算（由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位）
当时令，=，=，=，=，
若C1=0，则根据FSTD（星敏参与定姿的标志）的取值进行相应的星敏修正并令
FSTD取值|处理
2|用A，B头测量修正q
3|用A，C头测量修正q
4|用B，C头测量修正q
5|用A头测量修正q
6|用B头测量修正q
7|用C头测量修正q

当满足ZT4  0（用磁力矩器）且BZ2  2（有遥控注入过）且ZT2  2（飞轮启动保持或零动量控制方式）时进行地磁场计算和飞轮磁卸载；否则令磁力矩器的输出电压为0；
STEP8：当BZ1 = 1或9或 { BZ1 = 3，FSA≥5 } 或 { BZ1 = B，}，则进行推进系统故障检测及切换；
STEP9：若BZ1 = 1或9或 { BZ1 = B，}，则：系统故障检测；否则系统故障检测中的连续时间计数；
STEP10：若ZT17≥4，ZT18≥7，则：帆板故障检测及切换；
STEP11：当ZT38 = F（0.524主程序中插入帆板未展开模式）时，进行帆板未展开模式处理；
STEP12：当BZ1  1，8，9（入轨段控制模式、偏航机动模式、全姿态捕获、重
捕地球、轨控模式、姿态无控模式、自旋模式）时，令不用星敏定姿；
STEP13：若BZ1  1，8，9，B，则：FSY = ；
STEP14：当ZT4 = 0（不用磁力矩器时）或BZ1  （1、9）时，令磁力矩器的电压为0；
STEP15：当ZT2  6时，令动量轮的电压为0；
STEP16：设置，；
STEP17：记录数据， ；
STEP18：进行中帧、慢帧的遥测数据和黑匣子数据的打包。",0,0,0,1,0,0,0,0
"功能描述：滚动/俯仰姿态机动目标姿态确定。
",0,1,0,0,0,0,0,0
"功能描述：轨控推进系统与加速度计联合诊断加计及轨控部件状态
",0,1,0,0,0,0,0,0
"功能描述：与发动机通信，输出本周期喷气脉宽。
处理：
功能编号|功能|引用文档
FREQ94|初始化|任务书
FREQ95|推力器使用要求(自锁阀和发动机组的选择)|任务书
FREQ96|通信(脉冲输出)|任务书
FREQ097|通信故障处理|预留
FREQ098|数据解包与转换|预留
FREQ099|推力器数据有效性处理|预留
FREQ100|推力器模拟量采集、处理|任务书
FREQ101|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
功能描述：无控模式初始化,0,1,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的在轨维护功能参数设置区数据
处理：
调整程序替换区模块代号1~8的初装值。",0,0,0,1,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|轮控说明|FREQ4.2|5.4.2.1|计算动量轮安装阵及电压分配阵，标称角动量
|轮系摩擦补偿电压计算|FREQ4.3|5.4.2.2|""轮系摩擦力矩的补偿电压计算
""
|动量轮启动与保持|FREQ4.4|5.4.2.3|启动动量轮至标称角动量，并保持
|正常飞行动量轮分配电压计算|FREQ4.5|5.4.2.4|计算正常飞行轮控所需电压
|偏置动量轮分配电压计算|FREQ4.6|5.4.2.5|""计算偏置动量控制时候所需的轮控电压
""
|大力矩飞轮启动与保持|FREQ4.7|""5.4.3.1
""|启动飞轮至标称角动量或角动量维持
|大力矩飞轮控制电压计算|FREQ4.8|""5.4.3.2
""|计算机动或正常模式下保持时的大力矩飞轮控制电压
|喷气卸载条件计算|FREQ4.9|5.4.4|喷气卸载进入和退出条件计算
|磁卸载控制|FREQ4.10|5.4.5|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1|地面站赤经赤纬计算
|运行段帆板控制|FREQ4.12|5.5.1|三轴稳定模式下的帆板控制
|太阳帆板自主跟踪控制|FREQ4.13|5.5.2|根据帆板角误差、控制帆板跟踪太阳
|数传天线指向控制|FREQ4.14|5.6.1.1|根据指令完成数传天线的指向控制
|中继轨道计算|FREQ4.22|5.7.1|中继卫星轨道确定。
|中继天线指向控制|FREQ4.23|5.7|根据指令完成中继天线的指向控制
|动量轮转速保持算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|""基于零空间的N个动量轮的角动量自调整算法产品规范
""|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|""基于三轴角动量反馈的偏置动量控制方法产品规范
""|FREQ4.21|/|规范化算法：
|双脉冲变轨|FREQ4.22|""任务书的
4.2.3""|根据地面注入的指令可实现两次轨控的功能
|数传天线指向目标角计算|FREQ4.14.2|5.6.2|根据指定跟踪数传天线与其被指定跟踪站的方位，计算其跟踪转角
|数传天线指向目标角平滑处理|FREQ4.14.3|5.6.3|由设定加速度与角速度极限约束，对目标转角平滑处理
|数传运动扰动力矩计算|FREQ4.14.4|5.6.4|根据天线运动信息计算对星体质心扰动力矩
|数传角速度控制指令计算|FREQ4.14.5|5.6.5|计算以角速度指令跟踪控制量
|中继天线指令转角计算|FREQ4.23.2|5.7.2|根据指令完成中继天线的捕获跟踪控制
|中继天线扫描指令计算|FREQ4.23.3|5.7.3|根据指令完成中继天线的捕获跟踪控制
|中继天线指向目标角平滑处理|FREQ4.23.4|5.7.4|由设定加速度与角速度极限约束，对目标转角平滑处理
|中继运动扰动力矩计算|FREQ4.23.5|5.7.5|根据天线运动信息计算对星体质心扰动力矩
|中继角速度控制指令计算|FREQ4.23.6|5.7.6|计算以角速度指令跟踪控制量
|外扰力矩估计|FREQ4.24|5.4.2.6|星体扰动力矩实时估计
|姿态机动时的动量轮角动量自调整|FREQ4.25|5.4.2.7|对星体进行姿态机动时的动量轮角动量进行调整
",0,1,0,0,0,0,0,0
功能描述：在CMG控制期间按照一定算法对磁力矩器施加控制电压，所产生磁矩与实际地磁场相互作用产生磁控力矩对CMG进行卸载。,0,1,0,0,0,0,0,0
