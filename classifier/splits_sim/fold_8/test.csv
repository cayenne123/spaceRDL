Requirements Description,初始化,控制计算,控制输出,故障诊断和处理,数据有效性判断,数据采集,遥控,遥测
功能描述：根据给定电压乘电压/力矩系数和角动量变化率之差判断轮子的故障。,0,1,0,0,0,0,0,0
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续60个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是A090H或者校验和错误或者未收到重要数据），则应用软件按照重要数据的初始值运行。",0,0,0,0,0,0,1,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的要的功能。
序|需求名称|编号|输入章节号|功能描述
|主动段模式控制|FREQ44.0|3.3.0|主动段模式调用流程
|入轨消初偏模式控制|FREQ44.1|3.3.1|入轨消初偏模式调用流程
|红外引入对地粗定向模式控制|FREQ44.2|3.3.2|红外引入对地粗定向模式调用流程
|动量轮启动模式控制|FREQ44.3|3.3.3|动量轮启动模式调用流程
|正常轨道运行模式控制|FREQ44.4|3.3.4|正常轨道运行模式调用流程
|轨控模式1模式控制|FREQ44.5|3.3.5|轨控模式1模式调用流程
|由正常姿态进行姿态机动模式控制|FREQ44.6|3.3.6|由正常姿态进行姿态机动模式调用流程
|轨控模式2模式控制|FREQ44.7|3.3.7|轨控模式2模式调用流程
|由轨控姿态机动回正常轨道运行模式控制|FREQ44.8|3.3.8|由轨控姿态机动回正常轨道运行模式调用流程
|全姿态捕获模式控制|FREQ44.9|3.3.9|全姿态捕获模式调用流程
|应急安全模式模式控制|FREQ44.10|3.3.10|应急安全模式模式调用流程
|停控模式控制|FREQ44.11|3.3.11|停控模式调用流程
|帆板未展开模式控制|FREQ44.12|3.3.12|帆板未展开模式调用流程
|偏置动量控制模式控制|FREQ44.13|3.3.13|偏置动量控制模式调用流程

主动段模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的3。",0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的中继天线系数,0,0,0,0,0,0,1,0
"功能描述：根据红外信息绕滚动俯仰转动，进行滚动俯仰捕获
",0,1,0,0,0,0,0,0
"功能描述：推力器喷气时间累计
",0,1,0,0,0,0,0,0
功能描述：发送姿态控制数据包2,0,0,0,1,0,0,0,0
功能描述：计算磁卸载所需的磁矩与磁力矩器工作脉宽。,0,1,0,0,0,0,0,0
"软件需求标识：FREQ13 
软件需求名称：采集时序 
软件需求描述：
              不再要求“不论部件是否通讯，均进行延时计数。”",0,0,0,0,0,1,0,0
功能：利用星敏感器A 、C的测量，修正姿态四元数与估计角速度。,0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
部件加断电指令的处理|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,1,0,0
"功能描述：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
",0,0,0,0,1,0,0,0
功能描述：接收遥控固定参数注入块的星敏姿态修正系数,0,0,0,0,0,0,1,0
"功能描述：上行注入数据接收和处理
处理： 
序号|功能点编号|功能描述|备注
|FREQ4.1.1|姿控数据包1|该数据块采用内存修改实现
|FREQ4.1.2|姿控数据包2|该数据块采用内存修改实现
|FREQ4.1.3|IMU系数包|该数据块采用内存修改实现
|FREQ4.1.4|相平面系数包|该数据块采用内存修改实现
|FREQ4.1.5|姿态数据包|该数据块采用内存修改实现
|FREQ4.1.6|星敏滤波系数包|该数据块采用内存修改实现
|FREQ4.1.7|主减速系数包|""该数据块采用内存修改实现
删除BKFlag启动动力下降标志，该变量移至导航初始数据包""
|FREQ4.1.8|接近下降系数包|该数据块采用内存修改实现
|FREQ4.1.9|垂直下降系数包|该数据块采用内存修改实现
|FREQ4.1.10|轨道数据包|该数据块采用内存修改实现
|FREQ4.1.11|自主定位数据包|该数据块采用内存修改实现
|FREQ4.1.12|天文历书包|该数据块采用内存修改实现
|FREQ4.1.13|起飞参数包|该数据块采用内存修改实现
|FREQ4.1.14|导航修正系数包|该数据块采用内存修改实现
|FREQ4.1.15|软着陆轨道控制系数包|该数据块采用内存修改实现
|FREQ4.1.16|部件加断电命令包|
|FREQ4.1.17|LTU命令包|""CCU与推进线路盒的指令不通过LTU命令包发送。
与驱动和太阳模块的接口取数指令和控制指令都可通过地面注入发起""
|FREQ4.1.18|加电状态字设置包|该数据块采用内存修改实现
|FREQ4.1.19|串口周期通讯指定包|""该数据块采用内存修改实现
ZZ2的D0位与D5位定义互换""
|FREQ4.1.20|星敏感器RTS命令包|
|FREQ4.1.21|PID系数包|该数据块采用内存修改实现
|FREQ4.1.22|调制系数包|该数据块采用内存修改实现
|FREQ4.1.23|动量轮系数包1|该数据块采用内存修改实现
|FREQ4.1.24|动量轮系数包2|该数据块采用内存修改实现
|FREQ4.1.25|陀螺脉冲当量系数包|该数据块采用内存修改实现
|FREQ4.1.26|加计脉冲当量系数包|该数据块采用内存修改实现
|FREQ4.1.27|故障判别因子系数包|
|FREQ4.1.27|垂直上升及备份姿控PID系数包|
|FREQ4.1.28|内存修改包|修改内存字数由58改为57
|FREQ4.1.29|对日定向系数包|该数据块采用内存修改实现
|FREQ4.1.30|轨控命令包|""该数据块采用内存修改实现
删除变轨系数""
|FREQ4.1.31|惯性调姿命令包|该数据块采用内存修改实现
|FREQ4.1.32|程序包|
|FREQ4.1.33|星敏标定数据包|该数据块采用内存修改实现
|FREQ4.1.34|导航初始数据包|""该数据块采用内存修改实现
增加BKFlag启动动力下降标志""
|FREQ4.1.35|导航敏感器系统误差初值包|该数据块采用内存修改实现
|FREQ4.1.36|微波标定数据包|与LTU命令块合并
|FREQ4.1.37|内存下卸包|
|FREQ4.1.38|驱动与太阳模块状态控制包|
|FREQ4.1.39|着陆器推进控制包|
|FREQ4.1.40|上升器推进控制包|
|FREQ4.1.41|IMU数据存储控制包|IMU数据存储控制标志IMU_flag的定义更改

备注中注明“该数据块采用内存修改实现”的命令块，软件编码不实现该数据包的注入功能，数据包中变量需要修改时通过内存修改包实现。软件编码应保证该数据包中变量处于连续的内存区。",0,0,0,0,0,0,1,0
"此章节01星为“发送AOCC侧摆事件数据”，现删除，替换为“发送AOCC硬件工作状态数据”
功能描述：发送AOCC硬件工作状态数据
处理：当控制计算机发生加电工作时，此功能有效标志默认为无效，当班计算机不会存储重要数据。此功能需要通过内存修改功能有效标志才能启动，每4S保存一次，存满后申请发送。复位后不清此功能的有效标志。OBDH中的数据为切机前的控制计算机保存的重要数据，可供地面下卸分析使用。",0,0,0,0,0,0,0,1
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的控制数据转换为消息需要的格式并输出。
MW数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发MW数据采集指令，获得ACU数据并处理成对应的MW的角动量。
部件加断电指令的处理|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每三个控制周期将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,1,0,0
"1）上电/复位软件初始化
功能描述：上电/复位软件初始化
2）取回重要数据初始化
功能描述：取回重要数据初始化
输入：重要数据的陀螺引入标志、推力器组件、数字太阳标志
输出：陀螺引入标志、推力器组件标志
3）未取回重要数据初始化
功能描述：未取回重要数据初始化
输出：陀螺引入标志、推力器组件标志",1,0,0,0,0,0,0,0
"功能描述：根据陀螺输入预估卫星惯性姿态四元数。
",0,1,0,0,0,0,0,0
"功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压、、。
",0,1,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如下表所示：
服务编码|发送的条件
85H|上电时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次
47H|每5.12秒
74H|复位时发送，一次成功则不再发送第二次，如果一次不成功，则再发第二次；同样若第二次也不成功，则再发最后一次
83H|进入无控模式时申请，收到服务请求确认字后结束
",0,0,0,0,0,0,0,1
"功能描述：为三轴姿态喷气控制选择推力器；并记录喷气时间和次数等。
",0,0,0,1,0,0,0,0
功能描述：计算太阳星历及光行差计算。,0,1,0,0,0,0,0,0
功能描述：接收数据指令注入块的自主诊断允许类指令,0,0,0,0,0,0,1,0
功能描述：发送模拟量遥测数据包1,0,0,0,0,0,0,0,1
"功能描述：检测推力器的微漏，必要时作相应的主备份切换。
",0,1,0,0,0,0,0,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：OBC在CAN总线中断中接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,1
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,0,0,1,0,0
功能描述：根据指令完成数传天线的指向控制。,0,1,0,0,0,0,0,0
"功能描述：确定ASS21,ASS22,ASS31,ASS32及帆板角度传感器等的信号选取。",0,1,0,0,0,0,0,0
"功能描述：接收记录AOCC时间指令
处理：CTU在需要恢复星上时间时，向AOCC发送“记录AOCC时间指令”，AOCC收到指令后立即记录AOCC时间并将时间数据写入发送AOCC时间指定的存储地址空间中。",0,0,0,0,0,0,1,0
"模式字定义如下，装订值为0：
模式字|工作模式描述
0|主动段
1|正常对地运行
2|偏航机动
3|全姿态捕获
4|对地捕获
5|帆板未展开
6|轨控
7|无控
8|侧摆机动
9| 侧摆保持
11|入轨段控制
12|自旋模式
13|应急模式
14|星敏全姿态捕获模式

工作模式的转换可分为以下二种情况：
按地面上行注入进行转换：通过注入姿控数据块中的模式字进行转换；
按应用软件用户需求给定的条件判别，由软件自主控制转换：自主转换分两种：一种为正常运行转换；一种为故障时转换。下面分别进行说明
正常转换图为：
正常运行自主转换如下表所示：条件标识原则：ZCCX—Y，其中ZCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。
标识|具体条件
ZCC0—B|星箭分离
ZCCB—1|Tin >4800 
ZCC1—2|
ZCC1—6|
ZCC1—8|且且且
ZCC2—1|
ZCC2—6|
ZCC4—1|FEA=A
ZCC6—1|
ZCC6—2|)且
ZCC8—1|""满足下列条件之一：
若动量轮侧摆且目标侧摆角为0，当姿态角误差小于0.5度，角速度误差小于0.01度/s连续次
若喷气侧摆且目标侧摆角为0，当姿态角误差小于1度，角速度误差小于0.015度/s连续次
若星时大于侧摆机动时间＋600秒且侧摆目标角为0""
ZCC8—9|""满足下列条件之一：
若动量轮侧摆且目标侧摆角不为0，当姿态角误差小于0.5度，角速度误差小于0.01度/s连续次
若喷气侧摆且目标侧摆角不为0，当姿态角误差小于1度，角速度误差小于0.015度/s连续次
若星时大于侧摆机动时间＋600秒且侧摆目标角不为0""
ZCC9—8|""满足下列条件之一：
且
""

故障自主转换如下表所示：条件标识原则：GCX—Y，其中GCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。其中进入应急模式的条件为读到应急线路加电，记为GCC-D。其余的自主故障切换如下图所示：
故障条件定义如下：
标识|具体条件
GCC1—3|FailureFlag=1并且WacqSunFlag =0并且ZT7属于[1，4]区间内
GCC1—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC1—E|FailureFlag=1并且WacqSunFlag=1并且ZT7属于[1，4]区间内
GCC3—7|FailureFlag＝4且AutoInStopNum<2
GCC3—E|SMODE＝3且TSMODE>8000（若ZT11=4则取值为32000）
GCC4—1|FEA=A
GCC4—3|WacqUseIresOrSTSFlag=1且TCOUNT>24000
GCC5—3|脉冲发完后
GCC6—1|FailureFlag＝2且无机动要求
GCC6—2|FailureFlag＝2且无机动要求
GCC7—3|>6900 且AutoInStopNum<2且WacqSunFlag =0
GCC7—E|>6900 且AutoInStopNum<2且WacqSunFlag =1
GCC8—1|FailureFlag=3
GCC9—3|FailureFlag=1并且WacqSunFlag=1并且ZT7属于[1，4]区间内
GCC9—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC9—E|FailureFlag=1并且WacqSunFlag=0并且ZT7属于[1，4]区间内
GCCB—3|FailureFlag=1并且ZT7属于[1，4]区间内
GCCB—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCCE—1|StarCatchFlag=1且(1-()<0.000685)且norm()<0.000875
GCCE—7|TCOUNT>31200或（FailureFlag＝4且AutoInStopNum<2）

AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,1,0,0,0,0,0,0
"功能描述：模拟量遥测 
",0,0,0,0,0,1,0,0
功能描述：利用陀螺确定出卫星对目标的姿态四元数。,0,1,0,0,0,0,0,0
"功能描述：与发动机通信，输出本周期喷气脉宽。
处理：
功能编号|功能|引用文档|备注
FREQ52|UPS初始化|任务书|B
FREQ53|化学推进数据采集|任务书|B
FREQ54|推力器脉冲输出|任务书|B
FREQ55|推力器健康字设置|任务书|B
FREQ56|部件操作（程控490N点火，故障重构）|任务书|B
",0,0,1,0,0,0,0,0
"功能描述：根据姿态估值与数字太阳输出，计算量测的一步预测与新息。
",0,1,0,0,0,0,0,0
"功能描述：接收应急控制器重要数据。
处理：应急线路加电后与OBDH通信，获得陀螺和推力器状态，若连续3个控制周期都没有成功取得重要数据，默认陀螺使用7、8、9号，推力器使用主备份推力器，模拟式太阳敏感器使用ASS1和ASS21。",0,0,0,0,0,0,1,0
"需求名称|功能及处理描述
ACU模拟量数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发模拟量数据采集指令，获得ACU数据并处理成对应的模拟量信息。
ACU状态数据的采集与处理|在通讯允许的条件下，每周期向ACU RT发各种状态数据采集指令，获得ACU数据并处理成对应的状态信息。
ACU中控制指令的输出处理|根据通讯协议，将计算得到的喷气和磁力矩器数据转换为消息需要的格式并输出。
部件加断电指令的处理|加断电指令消息的输出|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
ACU保存CCU的重要数据|AOCC每个控制周期都将重要数据发送给ACU（驱动控制单元）
从ACU恢复CCU的重要数据|上电/复位后应用软件首先从ACU恢复重要数据
ACU的程序注入修改|将从OBDH收到的ACU需修改程序内容，按内总线的格式发送给ACU RT需修改的程序内容
ACU的内存下传|地面注入ACU内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至ACU RT。
自锁阀操作|根据任务书的要求通过1553B向ACU输出自锁阀开关控制指令",0,0,0,0,0,1,0,0
"功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。
输入：姿态角，姿态角速度，
实测飞轮角动量   =[，]T
标称角动量       =[，]T
      标志             UnLoadMode， F_WheelSaturation， F_AttrOutLmt",0,1,0,0,0,0,0,0
功能描述：确定动量轮角动量数据的有效性。,0,1,0,0,0,0,0,0
"功能描述：发送和接收OBDH重要数据
调用条件：有发送和接收OBDH重要数据命令字时
输入：OBDH重要数据地址中内容
输出：OBDH重要数据地址中内容。
处理：OBDH重要数据有四块， AOCC不做任何改动保存在RAM中。",0,0,0,0,0,0,0,1
"功能描述：收到动量轮开数据指令或自主开动量轮。
处理：
收到动量轮开数据指令或自主开动量轮时，
按《卫星控制分系统注入参数及数据指令的用户需求》中动量轮引入状态，在相邻的4个周期依次使引入状态的动量轮加电；动量轮故障诊断自主关动量轮时，关闭动量轮一次电源。",0,0,1,0,0,0,0,0
"功能描述：利用星敏感器C、D的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
输入：
数传天线(j=1,2)跟踪地面站编号i，跟踪起始时刻ti，地面站i在惯性系指向，被数传天线(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线(j=1,2)跟踪的地面站i的矢量在本体系的表示。（i可为1~7）。
输出：
数传天线1和2的指令转角，指令转速，或者复位及保持控制指令。",0,1,0,0,0,0,0,0
功能描述：接收遥控中继星轨道注入块,0,0,0,0,0,0,1,0
"功能描述：接收GPS数据
处理：将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度、轨道数据的数据格式。",0,0,0,0,0,0,1,0
"软件需求名称：部件加断电 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。",0,0,0,1,0,0,0,0
功能描述：计算机应急模式控制,0,1,0,0,0,0,0,0
"功能描述：进行单轴相平面分区及控制规律计算。由、、决定是否要喷气；喷气的脉冲宽度；确定本时刻的。
",0,1,0,0,0,0,0,0
"    各个模式切换的功能点列表如下：
模式字|功能|功能编号
0|主动段模式切换|FREQ5.1
1|入轨段消初偏模式切换|FREQ5.2
2|正飞模式切换|FREQ5.3
3|大角度机动模式切换|FREQ5.4
4|正常运行模式切换|FREQ5.5
5|轨控模式切换|FREQ5.6
6|SAR未展开模式切换|FREQ5.7
7|帆板未展开模式切换|FREQ5.8
8|偏置动量控制模式切换|FREQ5.9
9|全姿态捕获模式切换|FREQ5.10
A|应急安全模式切换|FREQ5.11
B|停控模式切换|FREQ5.12

工作模式的转换如下表所示： 
模式字|到1|到2|到3|到4|到5|到6|到7|到8|到9|到10|到11
从0|ZC0-1||||||||ZC0-9||
从1||ZC1-2|||||||ZC1-9|ZC1-10|
从2|||ZC2-3|ZC2-4||ZC2-6|ZC2-7|ZC2-8|ZC2-9|ZC2-10|ZC2-11
从3||||ZC3-4|||||ZC3-9|ZC3-10|ZC3-11
从4||ZC4-2|ZC4-3||ZC4-5|ZC4-6|ZC4-7|ZC4-8|ZC4-9|ZC4-10|ZC4-11
从5||||ZC5-4|||||ZC5-9|ZC5-10|ZC5-11
从6||ZC6-2||ZC6-4|||||ZC6-9|ZC6-10|ZC6-11
从7||ZC7-2|||||||ZC7-9|ZC7-10|ZC7-11
从8||ZC8-2||ZC8-4|||||ZC8-9|ZC8-10|ZC8-11
从9||ZC9-2||ZC9-4||||||ZC9-10|ZC9-11
从10|||||||||ZC10-9||
从|||||||||ZC11-9|ZC11-10|

条件标识原则：ZCX—Y，其中ZC表示转换条件，X为转出的模式字，Y为转入的模式字。具体见用户需求3.3。AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,1,0,0,0,0,0,0
"功能描述：按指令值，控制星体三轴角速率。
处理：同用户需求的
（1）计算得到用于控制角速度偏差，计算公式见（1）；
（2）进行各轴喷气状态的设置，当ZT43[4]=1允许陀螺自主加电且FlagGyroAdd=1正在给陀螺加电时，设置===0，计算公式见（2）；
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令
（4）对是否转无控模式的计数值FWM进行处理：首先将FWM限幅到1和7E之间；然后判断是否满足下列条件之一，如果满足则FWM减1，否则FWM加1
三轴惯性角速度，的最大值大于0.0116弧度/秒",0,1,0,0,0,0,0,0
功能描述：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
"软件需求名称：推力器控制 
需求类别：其他 
软件需求描述：根据控制律计算结果，驱动推力器，进行姿态控制。",0,0,1,0,0,0,0,0
"功能描述：利用星敏感器A、B的测量，估计姿态。
",0,1,0,0,0,0,0,0
"功能描述：启动动量轮至标称角动量，并保持。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|5.2.1|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估对地姿态|FREQ3.3|5.2.3|根据陀螺测量输出，一步预估卫星姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|基于红外滤波的卫星姿态确定|FREQ3.6|5.2.6|根据陀螺预估结果和红外(和数字太阳)输出，确定卫星姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|红外与太阳双矢量定姿|FREQ3.9|5.2.9|利用红外、数字太阳敏感器确定姿态
|星敏感器相对基准标定|FREQ3.10|5.2.10|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.11.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.11.2|进行卫星姿态四元数的重置
|三轴欧拉姿态角预估算法产品规范|FREQ3.1.1|/|规范化算法：
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法算法产品规范|FREQ3.1.3|/|规范化算法：
|基于红外测量的红外滤波修正算法产品规范|FREQ3.1.4|/|规范化算法：
|基于单星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.6|/|规范化算法：
|基于红外与太阳矢量的双矢量定姿算法算法产品规范|FREQ3.1.7|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.1|目标姿态计算流程
|正常、偏置飞行目标姿态计算|FREQ3.12.1|5.3.1.1|正常与偏置姿态飞行时的目标姿态计算
|点对点机动目标姿态计算|FREQ3.12.2|5.3.1.2|点对点机动目标姿态计算
|姿态预置过程目标姿态计算|FREQ3.12.3|5.3.1.3|姿态预置过程目标姿态计算
|轨迹跟踪目标姿态计算|FREQ3.12.4|5.3.1.5|角速度建立过程目标姿态计算
|轨控目标姿态计算|FREQ3.12.5|5.3.1.6|轨控目标姿态计算
|角速度扫描阶段目标姿态计算|FREQ3.12.6.1|5.3.1.4|角速度扫描阶段目标姿态计算
|轨控姿态机动轨迹初始化|FREQ3.12.6.2|5.3.2.3|轨控模式目标姿态计算初始化
|正弦轨迹规划算法算法产品规范|FREQ3.12.7|/|规范化算法：
|基于加速度导数为正弦函数的轨迹规划算法算法产品规范|FREQ3.12.8|/|规范化算法：
|点对点姿态机动初始化处理|FREQ3.13|5.3.2.1|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|非沿迹跟踪初始化|FREQ3.14|5.3.2.2|非沿迹跟踪初始化，计算地心张角和方向矢量
|计算多项式轨迹系数|FREQ3.15|5.3.3.1|根据轨迹规划时间，初始姿态/姿态角速度和目标姿态/姿态角速度计算基于多项式轨迹规划的轨迹系数
|姿态预置机动目标姿态确定|FREQ3.16|5.3.3.2|基于多项式曲线的轨迹规划，计算目标姿态
|轨迹跟踪目标姿态角计算|FREQ3.17|5.3.4|根据所指定的扫描起始经纬度和末端点经纬度
|偏流角计算|FREQ3.18|5.3.5|适用于地球椭球模型，星体姿态描述为转序，计算基于星体光轴(与星本体＋Z轴平行)下的偏流角
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|增量式偏流角计算算法产品规范|FREQ3.21|/|规范化算法：
|匀地速姿态预置目标姿态计算|FREQ3.22|5.12|计算模式2/5经模式4转入模式6时姿态预置的目标姿态及角速度
|匀角速度预置目标姿态计算|FREQ3.23|5.13|计算模式2/5经模式4转入模式7时姿态预置的目标姿态及角速度
|零姿态预置目标姿态计算|FREQ3.24|5.14|计算模式6/7经模式4转入模式2时姿态预置的目标姿态及角速度
|陀螺标定过程目标姿态计算|FREQ3.25.0|5.15.1|陀螺标定全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角
|目标姿态计算初始化|FREQ3.25.1|5.15.1.1|对陀螺标定过程中涉及到的两次机动过程进行机动姿态计算的初始化
|惯性姿态点对点机动轨迹规划|FREQ3.25.2|5.15.1.2|对陀螺标定过程所涉及到的两次点对点机动进行轨迹规划
|角速度起速保持与减速过程轨迹规划|FREQ3.25.3|5.15.1.3|对陀螺标定过程中的速度运行进行轨迹规划
|大角速度标定的分档确定|FREQ3.25.4|5.15.1.4|根据实现指向的4挡速度，根据当前的速度的幅值，确定所标定的陀螺刻度因子的位置
|惯性定向时转阶段处理|FREQ3.25.5|5.15.1.5|陀螺标定在第1段中完成惯性定向，并在此期间标定陀螺真实常漂。在惯性定向转速度运行结束时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等。
|速度运行时转阶段处理|FREQ3.25.6|5.15.1.6|SubMode= 2~9，陀螺按照规定的角速度完成起速、恒速运行、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等
|速度曲线规划|FREQ3.25.7|5.15.1.7|根据所选择的机动轨迹，规划出角速度变化曲线
|陀螺标定算法|FREQ3.26.0|5.15.2|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺常漂修正标志确定|FREQ3.26.1|5.15.2.1|对陀螺标定过程中，陀螺常漂的修正标志进行确定。当星体达到了规定的惯性角速度时，开始进行陀螺常漂估计
|基于星敏陀螺滤波的等效常漂估计|FREQ3.26.2|5.15.2.2|采用星敏陀螺滤波的方法对陀螺等效常漂进行估计
|星敏陀螺滤波的陀螺等效常漂记录|FREQ3.26.3|5.15.2.3|对陀螺等效常漂，选取稳态时的一段数据进行平均，得到各个角速度下的等效常漂和星体真实角速度的估计值
|小角速度时的陀螺安装误差和刻度因子误差估计|FREQ3.26.4|5.15.2.4|经过N次速度机动后，对陀螺的测量模型进行标定，给出标定结果
|大角速度时的陀螺标定算法|FREQ3.26.5|5.15.2.5|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺在轨标定时的控制量计算|FREQ3.27|5.15.3|对标定过程中的控制量进行计算
|陀螺安装误差标校结果引入|FREQ3.28|5.15.4|对陀螺完成标定后，待地面确认标定结果无误后，将陀螺的标定结果进行赋值。当地面注入FP__MountingCmp时执行本程序一次
|陀螺刻度因子误差标校结果引入|FREQ3.29|5.15.5|完成陀螺标定，待地面确认无误后，对陀螺的刻度因子进行在轨标校。标校时，取陀螺输出的角速度与与之最接近的两个已标定的特征角速度进行线性插值标校
|偏航对日目标姿态计算|FREQ3.30|5.3.1.7|偏航对日模式下的目标姿态机动
",0,1,0,0,0,0,0,0
功能描述：根据红外数据和姿态角速度偏差进行系统故障的检测。,0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的系统轨控调姿及轨控姿态控制系数,0,0,0,0,0,0,1,0
"功能描述：接收同步控制
处理：根据同步字的编码内容进行相应的处理",0,0,0,0,0,0,1,0
"功能描述：根据上行注入指定工作模式和星上自主模式切换的条件进行模式管理。
处理：
工作模式的转换可分为以下两种情况：
按《用户需求》给定的条件判别，由应用软件自主控制转换；
由地面注入的模式运行类指令强行执行。
下图中模式之间的连接线分为实线和虚线，实线表示正常转移，虚线表示故障转移，在下表中具体列出了模式转移的条件。
                            图5-1 自主模式转换图
表5.2.4.4-2 模式自主转换条件（除复位后重要数据恢复成功转模式外）
序号|功能编号|功能简述|功能详述
|FREQ3.4. 1.22|WM0_to_WM1|连续27s满足组合体分离状态为已分离且触地开关状态为未触地后，系统转太阳定向模式，置LAFlag=00H，为组合体状态；
|FREQ3.4. 1.27|WM1_to_WM20|太阳定向模式中，若故障标志FailureFlag=3，则转入无控模式
|FREQ3.4. 1.28|WM2_to_WM3|""恒星定向2模式中，若惯性调姿开始时刻到tgon≤t≤tgon +ΔtMS且
tgon≥0，则转惯性调姿模式""
|FREQ3.4. 1.29|WM2_to_WM19|恒星定向2模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.30|WM3_to_WM4|""惯性调姿模式中，若姿态好或恒星定向4的时间到，即连续20个周期满足|qBT|≤qhon且|ω|≤ωhon或t≥thon，则转入恒星定向4模式""
|FREQ3.4. 1.31|WM3_to_WM19|惯性调姿模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.32|WM4_to_WM5|恒星定向4模式中，若轨控开始时刻到tgi≤t≤tgi+ΔtMS且tgi>0，则转入轨控定向模式
|FREQ3.4. 1.33|WM4_to_WM6|""恒星定向4模式中，若着陆上升组合体状态下着陆准备开始时刻到且启动动力下降标志有效，即LAFlag=0且
t0+Δtdb-t0p≤t≤t0+Δtdb-t0p+ΔtMS且
BKFlag=1，则转入着陆准备模式""
|FREQ3.4. 1.34|WM4_to_WM19|恒星定向4模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.35|WM5_to_WM1|轨控定向模式中，若轨控子模式字GMODE=2后计时>240s，则转入太阳定向模式
|FREQ3.4. 1.36|WM5_to_WM19|轨控定向模式中，若故障标志FailureFlag=1，则转入速率阻尼模式
|FREQ3.4. 1.37|WM6_to_WM7|着陆准备模式中，若着陆准备模式开始时刻到且启动动力下降标志BKFlag=1，则转入主减速模式
|FREQ3.4. 1.38|WM7_to_WM8|主减速模式中，若FailureFlag=0且PDMSFlag=1，则转入快速调整模式
|FREQ3.4. 1.39|WM7_to_WM9_1|主减速模式中，若FailureFlag=0但是高度已经在主减速切换到接近下降的高度内h<hSafe1，则转入接近下降模式
|FREQ3.4. 1.40|WM7_to_WM9_2|主减速模式中，若（出现陀螺饱和Flag=1，则转入接近下降模式
|FREQ3.4. 1.42|WM7_to_WM10_2|主减速模式中，若FailureFlag=5且 速度满足故障时切换到悬停模式的条件且高度已在悬停高度偏差内，则转入悬停模式
|FREQ3.4. 1.44|WM7_to_WM10_4|主减速模式中，若FailureFlag=5且制导时间已经在切换到悬停模式的阀值内，则转入悬停模式
|FREQ3.4. 1.45|WM8_to_WM9_1|快速调整模式中，若PDMSFlag=2，则转入接近下降模式
|FREQ3.4. 1.46|WM8_to_WM9_2|快速调整模式中，若允许调用安全模式制导律ZT11(D10)=1，则转入接近下降模式
|FREQ3.4. 1.47|WM8_to_WM9_3|快速调整模式中，若高度已经小于快速调整转入接近下降的高度h<hSafe2，则转入接近下降模式
|FREQ3.4. 1.48|WM8_to_WM9_4|快速调整模式中，若出现陀螺饱和Flag=1，则转入接近下降模式
|FREQ3.4. 1.49|WM9_to_WM10_1|接近下降模式中，若接近段无超差AppFFlag=0且动力下降段模式切换标志PDMSFlag=4，则转入悬停模式
|FREQ3.4. 1.50|WM9_to_WM10_2|接近下降模式中，若接近段有超差AppFFlag=1且速度满足故障时切换到悬停模式的条件且高度已在悬停高度偏差内h≤hsus+ dhsus，则转入悬停模式
|FREQ3.4. 1.51|WM9_to_WM10_3|接近下降模式中，若接近段有超差AppFFlag=1且制导时间已经在切换到悬停模式的阀值内tgo1<tgo1AS，则转入悬停模式
|FREQ3.4. 1.52|WM10_to_WM11_1|悬停模式中，若已获安全着陆点SLPFlag=1，则转入避障模式
|FREQ3.4. 1.53|WM10_to_WM11_2|悬停模式中，若悬停计时超过悬停模式切换到避障模式的计时阀值tSH，则转入避障模式
|FREQ3.4. 1.54|WM10_to_WM11_3|悬停模式中，若成像时间已经只剩一个控制周期Tsus≤Δt，则转入避障模式
|FREQ3.4. 1.74|WM10_to_WM11_4|悬停模式中，若BZ1=7或8或9或10时发生过复位，则当vmb_B 低于阀值后转避障
|FREQ3.4. 1.55|WM11_to_WM12_1|避障模式中，若高度距离缓速下降起始高度已经达到模式切换阀值，则转入缓速下降模式
|FREQ3.4. 1.56|WM11_to_WM12_2|避障模式中，若制导时间与避障垂向规划轨迹标称时间之差大于2个控制周期，则转入缓速下降模式
|FREQ3.4. 1.57|WM12_to_WM20_1|""缓速下降模式中，若收到关机信号且缓速下降持续时间大于缓速下降切换到无控的时间切换阀值1，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.58|WM12_to_WM20_2|""缓速下降模式中，若缓速下降持续时间大于缓速下降切换到无控的时间切换阀值2，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.59|WM12_to_WM20_3|""缓速下降模式中，若缓速下降持续时间大于缓速下降切换到无控的时间切换阀值3且注入指令允许加速度关机，则转入无控模式
转模式增加TouchDownFlag=1
删除积分项清0""
|FREQ3.4. 1.60|WM14_to_WM15|""起飞准备模式中，若起飞时间到且收到着陆上升器分离信号，则转垂直上升模式
转模式删除tLaunch=t""
|FREQ3.4. 1.70|WM14_to_WM20|起飞准备模式中，若FailureFlag=7，则转无控模式，置BZ1=20
|FREQ3.4. 1.61|WM15_to_WM16|""垂直上升模式中，t>tswitch或（max(|φc|,|θc|,|ψc|)<Φswitch且dh>vswitch 且FailureFlag=0，则切换为BZ1=16""
|FREQ3.4. 1.71|WM15_to_WM17|""垂直上升模式中，t>tswitch或（max(|φc|,|θc|,|ψc|)<Φswitch且dh>vswitch 且FailureFlag≠0，则置PEGConvergeFlag=0，切换为BZ1=16""
|FREQ3.4. 1.69|WM15_to_WM20|垂直上升模式中，若t≥tLaunch+Δtac 且RCSOnFlag≠1，则切换为无控模式BZ1=20
|FREQ3.4. 1.62|WM16_to_WM17|上升调姿模式中，若t-tswitch>tPD1且δθgui≤ΔθPD）或t-tswitch>tPD2，则转入轨道入射模式
|FREQ3.4. 1.72|WM16_to_WM17_2|上升调姿模式中，若FailureFlag≠0，则置PEGConvergeFlag=0，并切换轨道入射模式BZ1=17。
|FREQ3.4. 1.63|WM17_to_WM1_1|轨道入射模式中，若GMODE=2且TGMODE·Δt>Δtaf，则转入太阳定向模式
|FREQ3.4. 1.75|WM17_to_WM3|轨道入射模式中，若GMODE=2且FailureFlag=8，则转入惯性调姿
|FREQ3.4. 1.65|WM18_to_WM1|星光环月模式下，若FailureFlag=6，则转入太阳定向模式
|FREQ3.4. 1.66|WM18_to_WM20|星光环月模式下，若收到轨道器或地面发送的转无控命令，或收到微波应答机发送的停控指令后，则转入无控模式
|FREQ3.4. 1.67|WM19_to_WM2|速率阻尼模式下，若连续100个周期满足惯性角速度好，且ZT11(D11)=1，则转恒星定向2
|FREQ3.4. 1.68|WM19_to_WM1|速率阻尼模式下，若FailureFlag=2，则转入太阳定向模式
|FREQ3.4. 1.73|WM19_to_WM1_2|速率阻尼模式下，若连续100个周期满足惯性角速度好，且ZT11(D11) ≠1，则转入太阳定向模式
",0,1,0,0,0,0,0,0
"功能描述：根据指令完成数传天线的指向控制。
输入：
数传天线(j=1,2)跟踪地面站编号i，跟踪起始时刻ti，地面站i在惯性系指向，被数传天线(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线(j=1,2)跟踪的地面站i的矢量在本体系的表示。（i可为1~7）。",0,1,0,0,0,0,0,0
"功能描述：实现正常模式及侧摆模式下的偏流角计算。
",0,1,0,0,0,0,0,0
"功能描述：复位未取回重要数据初始化
处理：
- 卫星构型=9；
- 对系统软件提供的工作模式字APP_WorkMode进行3取2
- 若工作模式字为Mode7-11，切换至Mode16，SubMode1，StarTime= 2100.0， 开自锁阀3、4、5；
- 否则，切换至Mode2，StarTime = 2100.0， 开自锁阀3、5，关自锁阀4。
- 磁力矩器俯仰通道主份工作；
- 陀螺：陀螺引入状态初始化",1,0,0,0,0,0,0,0
功能描述：计算固定目标视线在本体系的表示。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|给VIPPCU发送轮询和校时包|FREQ1.8.1|""无
""|校时等数据|在每个控制周期与VIPPCU通讯时，在“轮询与校时包”中发送本周期的控制UTC时间
|VIPPCU加电状态状态数据的采集与处理|FREQ1.8.2|""加电状态
""||CCU通过采集来自VIPPCU的 “VIPPCU A机加电状态”、“VIPPCU B机加电状态”两个0～5V模拟量，来确定VIPPCU的A、B机加电状态。
|给VIPPCU发送的下平台控制数据|FREQ1.8.3|无|控制数据|CCU给VIPPCU发送的下平台控制数据。
|给VIPPCU发送CCU的重要数据|FREQ1.8.5|无|CCU的重要数据|根据通讯协议，将需要发送的加断电指令转换为消息需要的格式并输出
|给VIPPCU发送VIPPCU的重要数据|FREQ1.8.6|无|VIPPCU的重要数据|给VIPPCU发送VIPPCU的重要数据
|转发VIPPCU上注指令参数块|FREQ1.8.7|无|VIPPCU上注指令参数块|需要时，转发VIPPCU上注指令参数块
|接收VIPPCU遥测数据|FREQ1.8.8|VIPPCU遥测数据|无|每个控制周期，接收VIPPCU遥测数据，解包成需要的数据
|接收CCU重要数据返回包|FREQ1.8.9|CCU重要数据|指令|上电/复位后应用软件首先从VIPPC恢复重要数据。
",0,0,0,0,0,1,0,0
"功能描述：在完成对日定向后，。
输入：陀螺数据处理的输出 ，
太阳星历的输出，
数字太阳敏感器输出：, （量纲：弧度）
红外地球敏感器数据有效性标志F_IresValid（由数据有效性判据给出）
数字太阳敏感器数据有效性标志F_Ds1Valid，F_Ds2Valid（由数据有效性判据给出），
红外数据有效性输出 ，
",0,1,0,0,0,0,0,0
功能描述：确定模拟太阳敏感器数据的有效性。,0,1,0,0,0,0,0,0
"功能描述：不使用陀螺数据时的姿态角、角速度与姿态四元数预估。
",0,1,0,0,0,0,0,0
功能描述：接收内存读出地址及长度，发送内存读出数据包。                                                                                                                                                                                                                                                                                                                                                                                                                    处理：将接收内存地址及长度存储地址中内容的解包成需下传的内存首地址和长度，并判断需下传内容是否在内1553RAM有效地址范围内。若在范围内，则将需下传的内容放到指定地址中。,0,0,0,0,0,0,0,1
"功能描述：完成卫星在失去姿态基准情况下的全姿态捕获，对日定向功能。
处理过程：过程如下：
分两个过程：
第一步捕获太阳（BZ1=3且FSA=0）（在0.262秒中断中完成）
STEP1：进行姿态预估（4），得到姿态角和角速度。
STEP2：进行Z轴捕获太阳的处理过程
发左右帆板归零指令
设定三轴捕获的角速度，（见用户需求）
进行速率喷气控制（见用户需求）
如果ZT2 = 2且FWi  C对工作的飞轮成立，则进行飞轮动量保持控制及飞轮启动；如果ZT2  2或FWi < C 对某一工作的飞轮成立，则将六个轮子的控制电压置为0
满足下列两个条件时，设置FSA=5：
ZT13  4（用0-1太阳捕获）且且指定的敏感器见太阳
ZT13 = 4（用数字太阳捕获）且两个数字太阳均在视场内
第二步太阳定向（BZ1=3且FSA不等于0）
STEP1：进行红外数据采集及处理并将磁力矩器的输出电压设置为0。
STEP2：进行Z轴对日定向和陀螺故障检测及选择：
STEP3：根据ZT7的取值，进行相应的帆板控制。
在BZ1=3中，FSA有三中状态分别为0、5、A，这三个状态的转换关系如图12和表41所示：
图 12： FSA的状态转移图
表 40： FSA状态转换的条件
条件|具体说明
条件1|""ZT13  4（用0-1太阳捕获）且且指定的敏感器见太阳
ZT13 = 4（用数字太阳捕获）且两个数字太阳均在视场内""
条件2|""ZT13  4（用0-1太阳捕获）且且Ls = 1且指定的敏感器不见太阳
ZT13 = 4（用数字太阳捕获）且且 ""
条件3|""ZT13  4（用0-1太阳捕获）且且Ls = 1且
ZT13 = 4（用数字太阳捕获）且且且""
条件4|""ZT13  4（用0-1太阳捕获）且且Ls = 1且指定的敏感器不见太阳
ZT13 = 4（用数字太阳捕获）且且 ""
",0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序。
",0,1,0,0,0,0,0,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ93|初始化|任务书
FREQ94|磁力矩器使用要求|任务书
FREQ95|通信(DA)|任务书
FREQ96|通信故障处理|预留
FREQ97|数据解包与转换|预留
FREQ98|磁力矩器数据有效性处理|预留
FREQ99|磁力矩器硬件采集、处理|任务书
FREQ100|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
轨道计算包括卫星轨道和太阳方位计算、中继卫星轨道计算；GPS计算包括GPS数据转换为轨道平根数计算、GPS平根数数据转换为外推轨道数据计算；地磁场计算为通过轨道外推数据计算地磁场矢量分量。,0,0,0,0,1,0,0,0
将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据和定轨数据的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。,0,0,0,0,0,0,1,0
"功能描述：根据指令完成数传天线的指向控制。
输入：数传天线j (j=1,2)，预置指令，跟踪开始指令，跟踪结束指令，地面站i在惯性系指向，被数传天线j(j=1,2)跟踪的地面站i指向卫星矢量，卫星指向被数传天线j(j=1,2)跟踪的地面站i的矢量在本体系的表示，数传天线收到的预置角度
输出：数传天线1和2的指令转角",0,1,0,0,0,0,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如表 43所示：
表 43：对应矢量字各个请求编码的条件
服务编码|发送的条件
0000|无服务请求
bit0=1|申请传送AOCC重要数据
bit0=0|无AOCC重要数据服务请求
bit1=1|申请传送OBDH时间
bit1=0|无OBDH时间服务请求
bit2=1|AOCS应急控制标志有效
bit2=0|AOCS应急控制标志无效
bit3=1|AOCC硬件状态数据状态准备好
bit3=0|AOCC硬件状态数据状态未准备好
bit4=1|AOCC内存数据状态为准备好
bit4=0|AOCC内存数据状态为未准备好
bit8=1|AOCC黑匣子数据状态为准备好
bit8=0|AOCC黑匣子数据状态为未准备好
",0,0,0,0,0,0,0,1
功能描述：发送控制对中继天线的控制角度。,0,0,1,0,0,0,0,0
"功能描述：由四元素来修正姿态（星测量回路），等；计算星敏感器光轴方位。
处理：更动：去掉星敏粗姿态计算。",0,1,0,0,0,0,0,0
功能描述：星敏感器数据处理,0,0,0,0,0,1,0,0
"软件需求名称：姿态确定算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.4.1|陀螺姿态预估|《用户需求》4.4.1|
FREQ12.3-R4.4.2|星敏感器陀螺确定惯性姿态|《用户需求》4.4.2|
FREQ12.3-R4.4.3|中继跟踪目标姿态计算|《用户需求》4.4.3|
FREQ12.3-R4.4.4-K|太阳捕获及太阳定向|《用户需求》4.4.4|
FREQ12.3-R4.4.5|轨控目标姿态计算|《用户需求》4.4.5|
FREQ12.3-R4.4.6|误差四元数计算|《用户需求》4.4.6|
",0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,1,0,0,0,0
"功能描述：计算速度增量关机喷气时间
",0,1,0,0,0,0,0,0
"软件需求名称：模式初始化 
需求类别：其他 
软件需求描述：见“用户需求”4.1和“任务书”4.1.10“工作模式要求”1）工作模式初始化。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.2-WMInit-1|太阳定向模式初始化|《用户需求》4.1.1【初始化】|
FREQ12.2-WMInit-2|恒星定向1模式初始化|《用户需求》4.1.2【初始化】|
FREQ12.2-WMInit-3|惯性调姿模式初始化|《用户需求》4.1.3【初始化】|
FREQ12.2-WMInit-4|恒星定向2模式初始化|《用户需求》4.1.4【初始化】|
FREQ12.2-WMInit-5|轨控定向模式初始化|""《用户需求》4.1.5【初始化】
《任务书》4.1.10""|
FREQ12.2-WMInit-6|中继跟踪模式初始化|《用户需求》4.1.6【初始化】|
FREQ12.2-WMInit-7|速率阻尼模式初始化|《用户需求》4.1.7【初始化】|
FREQ12.2-WMInit-8|无控模式初始化|《用户需求》4.1.8【初始化】|
",0,1,0,0,0,0,0,0
"功能描述、输入、输出、计算公式见《用户需求》4.7.1~4.7.4。
序号|功能点编号|功能描述|说明
|FREQ3.4.9.1|轨控开关机|《用户需求》4.7.1
|FREQ3.4.9.2|轨控发动机选择A|《用户需求》4.7.2
|FREQ3.4.9.3|轨控发动机选择B|《用户需求》4.7.3
|FREQ3.4.9.4|轨控发动机选择C|《用户需求》4.7.4
",0,1,0,0,0,0,0,0
功能描述：为该机动过程姿态确定提供初始姿态。,0,1,0,0,0,0,0,0
"功能描述：利用陀螺确定出卫星对目标的姿态四元数。
",0,1,0,0,0,0,0,0
功能描述：利用轨道外推的计算结果，计算其他待用参数。,0,1,0,0,0,0,0,0
功能描述：利用GPS通道板数据进行GPS定轨程序。,0,0,0,0,1,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。                                                                                                                                                                                                                                                                                                                                                                                                                              输入：上周期姿态角估值
陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出：",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|均匀校时|FREQ1.4.5|""本周期的绝对星时；
均匀校时补偿量""|""本周期的绝对星时；
""|应用软件每次进行星时计算时，将计算后的绝对星时加上均匀校时补偿量作为本周期的补偿后的绝对星时。
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,1,0,0,0,0
"功能描述：根据任务要求，应用软件1553B初始化、变量的初始化                                                                                                                                                                                                                                                                                                                                                                                                             处理：
进行1553B初始化，处理过程见的OBDH初始化功能
设置3个星敏的 RTS信号为无效
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0
功能描述：利用星敏感器B的测量，修正姿态四元数与估计角速度。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|平台陀螺数据的采集与处理|FREQ1.2.1|""平台陀螺1553B取数指令
""|陀螺1-4的速度增量|在通讯允许的条件下（每个陀螺的当班标志为1），每周期向对应的陀螺RT发取数指令，获得陀螺数据并处理成对应的速度增量。
|测微陀螺数据的采集与处理|FREQ1.2.2|""
遥测数据""|陀螺5-8的速度增量|从遥测数据中，获得陀螺数据并处理成对应的速度增量。
",0,0,0,0,0,1,0,0
"功能描述：姿态角速度与姿态四元数的预估，包括使用陀螺数据和不使用陀螺数据的姿态四元数预估。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|液浮陀螺数据的采集与处理|FREQ2. 1|向选择的液浮陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式
|光纤陀螺数据的采集与处理|FREQ2.2|向选择的光纤陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式
",0,0,0,0,0,1,0,0
功能描述：检测推力器的泄露，必要时做相应的主备份切换。,0,1,0,0,0,0,0,0
功能描述：数传天线数据处理,0,0,0,0,0,1,0,0
"功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。
",0,1,0,0,0,0,0,0
功能描述：接收总线指令。,0,0,0,0,0,0,1,0
"功能描述：若本周期角动量与上一周期角动量之差（绝对值）大于0.15Nms，则用上一周期角动量作为本周期输入，角动量变化取0。若连续大于三次或本周期与上一周期角动量之差（绝对值）小于0.15Nms，则以本周期角动量为真值，角动量变化取
输入：实测飞轮角动量，
      上周期角动量数据，
      剔野判断计数器N_WheelPick_i (i=x,y,z,s)",0,1,0,0,0,0,0,0
功能描述：接收遥控轨道参数注入块,0,0,0,0,0,0,1,0
功能描述：为星敏感器定姿提供初始的相对惯性的姿态四元数。,0,1,0,0,0,0,0,0
功能描述：计算太阳星历、红外补偿量及光行差计算。。,0,1,0,0,0,0,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
功能编号|功能|引用文档
FREQ44|初始化|陀螺协议
FREQ45|陀螺使用要求|任务书
FREQ46|通信|陀螺协议
FREQ47|通信故障处理|任务书
FREQ48|数据解包与转换|陀螺协议
FREQ49|陀螺数据有效性判断、处理|任务书
FREQ50|陀螺模拟量采集、处理|任务书
FREQ51|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"软件需求名称：上电和复位初始化 
需求类别：其他 
软件需求描述：系统软件上电复位后，调用应用软件AppInit函数，并根据初始化内容，启动任务
处理：
OBC上电/复位后，由系统软件引导应用软件运行。首先进行初始化，包括系统软件初始化和系统软件调用应用软件提供的初始化函数（AppInit）。启动任务并开始进行任务调度管理。 ",1,0,0,0,0,0,0,0
功能描述：动量轮摩擦力矩的补偿电压计算。,0,1,0,0,0,0,0,0
功能描述：标称角动量、安装、分配矩阵及轮子组合计算,0,1,0,0,0,0,0,0
"功能描述：红外数据处理
",0,0,0,0,1,0,0,0
"功能描述：
  通过简化伪速率调制器计算5N推力器喷气脉冲，并输出(功能编号：FReq-3。
处理：根据三轴简化伪速率调制器的输出值计算出12个5N推力器的输出值。重新置定时器0的初值，设置5N推力器的输出，启动定时器0计数。逻辑如下：
根据5.2.5节获取控制力矩Yi：
若Yi–r>h1,  则输出Y＝1，Tri＝1；
  		若Yi–r<-h1, 则输出Y＝-1，Tri＝-1；
  		否则输出Y＝0，Tri＝0；
		r = 0.614*r + 0.0861*Y   // r 上电初始化为0
当 Tri = 1 
	ThrNoNi = ThrNoNi + 1                   		 
当Tri = -1
	ThrNoPi = ThrNoPi + 1                   		
当Y为+1时产生一个64ms的负脉冲，Y为-1时产生一个64ms的正脉冲。
具体喷管的选择参考任务书。
   推力器双分支工作时，若A份中的推力器不健康，则使用B份对应的推力器。
说明： 控制力矩的计算增加 伪速率调制器r的计算，同时修改h1的参数",0,0,1,0,0,0,0,0
"功能描述：根据姿轨控喷气规律计算结果，发出相应的喷气指令。
处理：同用户需求的。",0,1,0,0,0,0,0,0
"功能描述：发送卫星应急控制字
处理：先将AOCC矢量字中“AOCS应急控制标志”位置1，将总线状态字服务请求位置1；OBDH检测到AOCC总线通讯状态字中的服务请求后，自动发送方式指令，从AOCC接收矢量字，判定矢量字中 “AOCS应急控制标志”位为1后，通过子地址19向AOCC发送“卫星应急控制确认字”；AOCC在接收到OBDH“卫星应急控制确认字”后，将状态字服务请求位清0，将矢量字“申请传送OBDH时间”位清0。",0,0,0,0,0,0,0,1
功能描述：正常对地运行模式初始化,0,1,0,0,0,0,0,0
"功能描述：使星体-Z轴捕获太阳。
",0,1,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
甚高陀螺通讯故障诊断|大量程通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
部件故障诊断与处理|确定各敏感器和执行机构故障诊断及处理
陀螺故障检测|确定各敏感器和执行机构故障诊断及处理
动量轮故障检测|检测工作中的动量轮的故障
大力矩飞轮故障检测|检测工作中的大力矩飞轮的故障
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式7的系统故障诊断|在模式7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
磁力矩器数模一致性诊断|磁力矩器数模一致性诊断
DSS输出一致性诊断|DSS输出一致性诊断
ASS1输出一致性诊断|ASS1输出一致性诊断
ACU 1553B接收故障诊断及处理|由于卫星的执行机构控制均需通过ACU进行，当ACU接收控制指令内存区异常将导致卫星失去控制能力，因此有必要对ACU接收执行机构控制指令的正确性进行判断。在检测到执行机构控制指令接收校验和异常后CCU需要自主进行处理",0,0,0,1,0,0,0,0
功能描述：由平衡方程方法、星敏感器数据进行陀螺的故障检测,0,1,0,0,0,0,0,0
"功能描述：光纤陀螺数据处理
",0,0,0,0,0,1,0,0
"功能描述：利用估计的四元数转换姿态角，送给星敏感器的四元数。

",0,1,0,0,0,0,0,0
"功能描述：动量轮喷气卸载进入和退出条件计算。
",0,1,0,0,0,0,0,0
"功能描述：根据指令完成中继天线的捕获跟踪控制。
输入：跟踪开始指令（R_GZKS=1），跟踪结束指令（R_GZJS=1），RelayGDASwapAcqFlag，FRelayGDASwapAcq, ， 
输出：RelayGDAView, FRelayGDASwapAcq ,、，",0,1,0,0,0,0,0,0
功能描述：卫星丢失姿态后，利用红外地球敏感器直接捕获地球，建立正常对地姿态。,0,1,0,0,0,0,0,0
"功能描述：追踪器构型切换管理及质量设置
处理：根据构型设置追踪器质量及转动惯量
",0,1,0,0,0,0,0,0
"功能描述：滚动/俯仰姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉角，以及轨迹的加速、匀速和减速等特征时间点。
",0,1,0,0,0,0,0,0
"功能：利用星敏感器C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：接收数据指令注入块的CMG串口指令,0,0,0,0,0,0,1,0
"功能描述：消除星体角速度，并使星体Z 轴指向太阳
",0,1,0,0,0,0,0,0
"软件需求名称：接收上行注入数据指令 
需求类别：其他 
软件需求描述：接收并处理上行注入数据指令。",0,0,0,0,0,0,1,0
"功能描述：进行单轴相平面分区及控制规律计算。
",0,1,0,0,0,0,0,0
"功能描述：
每次中断到来，向TM串口5(US[5])写入8字节的数据（功能编号：FReq-12）。
处理：发送DPRU由RT变为BC的使能请求，每次中断到来，通过同步串口US[5]发出8字节，首先复位FIFO，然后发送指令码为：0x1A、0xCF、0xFC、0x1D、0xBF、0xC0、0xA6、0xED
同步串口5模式寄存器设置为02，帧长设置为128字节。",0,0,1,0,0,0,0,0
"功能描述：利用星敏感器捕获地球分两个阶段。在第一阶段，60秒判断一次星敏感器姿态输出。如果星敏感器A、B、C均有姿态输出，且测量的光轴夹角满足一定条件，则利用星敏感器双矢量定姿确定姿态。若仅有A或仅有B或仅有C有姿态输出，则偏航转过小角度（3度），重复捕获。偏航转过3度后，若星敏感器A或B或C有姿态输出，且满足一定条件，利用星敏感器双矢量定姿。若三个星敏感器均无姿态输出或由输出但仍不满足一定的条件，进行偏航转动（45度）。若偏航转动1周天仍未捕获成功，则滚动转动90度。若全天球捕获成功，则当姿态角和姿态角速度满足一定条件，进入阶段2。在阶段2，利用四元数进行姿态确定（与姿态机动定姿相同）。喷气控制。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|数字太阳数据的采集与处理|FREQ1.1|""选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
""
|模拟太阳数据的采集与处理|FREQ1.2|""选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
""
|01太阳数据的采集与处理|FREQ1.3|""选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
""
",0,0,0,0,0,1,0,0
"功能描述：选择通讯的星敏LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输入：ZT6、inAPSLTUSeltFlag、星敏LTU返回的数据。
输出：星敏输出的四元数、相对时间和数据有效性标志。
处理：
（1）星敏共有两个LTU，AOCC每个控制周期向注入文件中的ZT6和inAPSLTUSeltFlag的最大组合中的星敏LTU发送取数指令。
（2）向选择的星敏LTU发送完取数指令后，获得星敏LTU返回的数据，将数据转换为所需的数据格式。",0,0,0,0,0,1,0,0
功能描述：根据标志选择轨控发动机。,0,1,0,0,0,0,0,0
"软件需求名称：陀螺使用及通信 
需求类别：其他 
软件需求描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书附录1时序。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
陀螺接口初始化|FREQ33.1|陀螺接口初始化|B|2
陀螺数据采集|FREQ33.2|陀螺数据采集|A|3
数据解包与转换|FREQ33.3|数据解包与转换|A|4
陀螺数据有效性判断、处理|FREQ33.4|陀螺数据有效性判断、处理|A|5
陀螺故障重构|FREQ33.5|陀螺故障重构|C|
",0,0,0,0,1,0,0,0
"功能描述：模式0切换方式。
处理：
一个控制周期内对星箭分离状态位读5次，若连续3次以上读入为“1”，则认为本周期查到星箭已分离，每次读的时间间隔要求大于1ms。如果在连续3个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入初始速率阻尼模式。
在主动段收到地面指令进入初始速率阻尼，进入初始速率阻尼模式。",0,1,0,0,0,0,0,0
功能：利用星敏感器B的测量，修正姿态四元数与估计陀螺漂移,0,1,0,0,0,0,0,0
"功能描述：由模拟太阳信号码、监视码得到模拟太阳角、见太阳标志。
",0,0,0,0,0,1,0,0
"功能描述：完成卫星正常轨道运行期间的三轴稳定姿态，并进行偏流角修正控制，实现姿态指向精度、姿态稳定度等性能指标。
进入条件：
自主条件：从BZ1=B、2、4、6、8满足条件转入
退出条件：
满足下列条件之一：
自主条件：
满足ZT6  3（有偏航机动）且C1 = FFFF（轨控数据有效标志为有效）且（偏航机动开始时刻之前1800秒）（偏航回调机动开始时刻后600秒）转入BZ1=2
满足（轨控发动机开机时刻-60秒）（轨控发动机关机时刻+100秒）且C1 = FFFF（轨控数据有效标志为有效）且转入BZ1 = 6
满足FM=1（ZT35不等于0且收到侧摆命令块）转入BZ1=8
满足ZT226（系统故障自检有效，可自主切换工作模式）且FSY07（系统故障打分小于等于7）且ZT8  3，ZT9  3（姿轨控发动机可用）转入BZ1=3
满足ZT226（系统故障自检有效，可自主切换工作模式），FSY07（系统故障打分小于等于7），且（ZT8  4（姿控发动机不可用）或ZT9  4（轨控发动机不可用））转入BZ1=7
地面上行注入ZT1不等于1、4 
处理过程：过程如下：
STEP1：当ZT F且ZTA且ZT3B ，进行姿态预估，得到姿态角和角速度。
STEP2：进行运行段姿态确定，具体过程如下：
姿态红外修正（1）和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP3：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3（姿控发动机可用）且ZT9  3（轨控发动机可用）且ZT（不用红外+单个斜装陀螺定姿）时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
t的取值范围|处理
|""发姿轨控发动机加温指令
进行运行段姿态确定 
进行运行段控制""
|""发姿轨控发动机加温指令
发左右帆板归零指令
飞轮动量保持控制及飞轮启动
令，
 轨控段喷气姿态控制""
|""令 ，

轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令""
|""令，
轨控段喷气姿态控制
飞轮动量保持控制及飞轮启动
发左右帆板归零指令
""
|""红外数据采集及处理
红外故障检测及信号选取
姿态红外修正（2）
，
运行段喷气姿态控制
飞轮动量保持控制及飞轮启动
运行段帆板控制""
|BZ1 = 1，C1 = CCCC。

当ZT40(4) = 1（天线扫描捕获）时，进行数传天线捕获跟踪控制
STEP4：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
"功能描述：星敏感器数据处理，安装偏差估计。
",0,1,0,0,0,0,0,0
功能：利用星敏感器和陀螺或者仅利用星敏感器的输出计算卫星欧拉角和四元数。,0,0,0,1,0,0,0,0
"AppInit中星箭分离的查询
硬件初始化后，按5取3的方式查星箭分离状态位(对星箭分离状态位读5次，有连续3次或3次以上读入为“1”，则认为查到星箭已分离，每次读的时间间隔要求大于1ms)。
AppInit中星箭未分离的初始化
如果星箭未分离，对应用软件相关变量、硬件初始化。进入主动段工作模式。在主动段工作模式下，每个控制周期按5取3的方式查星箭分离状态位，如果连续3个周期内都查到星箭已分离，则可确认为星箭已分离。进入初始速率阻尼模式，并置星时0.375s。
AppInit中星箭已分离的初始化
对应用软件相关变量、硬件初始化，星时清0，进入复位模式。
在复位模式下，与星务分系统通讯，取回保存在星务分系统的重要数据，具体见《卫星姿轨控分系统AOCC与星务通讯协议》。如果取数成功，根据控制模式字进入初始化。若连续5秒从星务分系统取重要数据失败则认为申请失败。取重要数据不成功，设置工作模式为“太阳捕获模式”，星时为2100秒，发送CMG1~5“复位及高速断电”指令。ALTU当班状态根据前面章节的内容进行复位后设置；切除6个陀螺，发送“陀螺1~5开”指令，新加电陀螺等10分钟后引入，并置状态分为120，10分钟内系统不引入，不进行速率阻尼。",0,0,0,1,0,0,0,0
功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压，。,0,1,0,0,0,0,0,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：AOCC在CAN总线中断中接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,1
"功能描述：由平衡方程方法、陀螺自检信号和星敏感器数据进行陀螺的故障检测。

处理：(1)6个或5个陀螺参加诊断时，使用平衡方程进行诊断，并且若ZT35(3)=1地面允许自检信号引入诊断，则自检信号无效的陀螺分数减1。若ZT16(3)(4)=11，则星上自主选取定姿陀螺，否则由地面指定。
(2)4个陀螺参加诊断时，若ZT35(4)=0不允许星敏诊陀螺，则同(1)。
(3)3个陀螺参加诊断时，若ZT35(4)=0不允许星敏诊陀螺，则这3个陀螺就是定姿陀螺。
(4)4个或3个陀螺参加检测时，若ZT35(4)=1，则用星敏差分值诊陀螺。判分的阀值乘以，可以进行调整。当允许星上自主选取定姿陀螺时，仅当平衡方程不平衡时可以切换陀螺。",0,1,0,0,0,0,0,0
功能描述：太阳数据处理,0,0,0,0,0,1,0,0
"功能描述：通过注入轨道参数，实时计算卫星轨道参数。
处理： 
由地面注入轨道参数或GPS数据计算的轨道参数（如果GPS引入且数据验证有效），结合当前星时，通过外推公式计算出卫星轨道数据。",0,1,0,0,0,0,0,0
功能描述：将星务通过CAN总线广播的GPS定位数据转换成轨道根数。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,1,0,0
"功能描述：根据需求，计算去往巡天模式机动过程中所需的目标姿态
",0,1,0,0,0,0,0,0
"功能描述：姿态机动过程目的姿态确定。
",0,1,0,0,0,0,0,0
"功能描述：与CAN通讯获得上行/下行数据。
调用条件：AOCC被动接收/发送数据；
处理：通过CAN总线与星务分系统通讯，交换数据，以实现星地联系和对卫星的人工干预。主要完成下列功能：
AOCC向星务分系统发送数据（中断接收星务分系统命令，依据命令发送各类遥测参数）；
发送快帧遥测；
发送慢帧遥测；
将AOCC为星务保存的重要数据发送给星务分系统；
发送星敏感器和姿态辅助数据；
有内存下卸要求时，发送AOCC指定内存内容；
AOCC接收星务分系统数据（中断方式）包括接收固定地址参数注入；接收可变地址参数注入；接收轨道参数数据；接收程序注入；接收数据指令；接收重要数据返回；接收整星对时广播数据；接收GPS高精度秒脉冲对时广播；接收GPS导航数据，GPS定位广播数据引入控制使用之前，软件需对广播数据中的W28表示的定位状态进行判断，即D6～D4：为101、011、110之一时，引入系统，否则为无效，控制系统不使用
如果应用软件3s收不到星务分系统信息或连续5周期挂起，对CAN总线控制器重新初始化。",0,0,0,0,0,0,0,1
功能描述：释放CMG群积累的角动量。,0,1,0,0,0,0,0,0
"功能描述：选择通讯的CMG线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）CMG共有三个LTU，AOCC每个控制周期根据注入文件中的ZT14和加电状态的最大组合向指定的CMG LTU发送取数指令
（2）向选择的CMG LTU发送完取数指令，获得CMG LTU返回的数据，将数据转换为所需的数据格式，具体参见LTU通讯协议。
（3）CMG LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书附录1时序。
功能编号|功能|引用文档|备注
FREQ33|陀螺接口初始化|陀螺协议|B
FREQ34|陀螺数据采集|陀螺协议|A
FREQ35|数据解包与转换|陀螺协议|A
FREQ36|陀螺数据有效性判断、处理|任务书|A
FREQ37|陀螺故障重构|任务书|C
",0,0,0,0,0,1,0,0
"功能描述：以星敏感器X 为基准标定星敏感器Y。
",0,1,0,0,0,0,0,0
"功能描述：诊断姿控喷管微漏故障
",0,1,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：姿态角与角速度估值：
正常模式星敏感器与陀螺定姿输出 
，
或：正常模式其它情形相应程序的输出，
惯性角速度估值：
    陀螺角速度估值 ，
    或：星敏感器定姿输出(F_NoGyro=1或3) =[，]T
实测飞轮角动量    ，
      斜轮标称角动量    
      姿态偏差积分项    ，
      斜轮角动量偏差积分项  
标志F_SatStage
=[，]T",0,1,0,0,0,0,0,0
"功能描述：卫星绕x轴转动，使红外搜索地球。
输入：	陀螺数据处理的输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）
故障标志IRES_Flag，计时器TES
红外数据有效性输出 ，",0,1,0,0,0,0,0,0
"功能描述：发送事件数据给OBDH保存
处理：将事件数据打包后放到事件数据内存地址空间中。",0,0,0,0,0,0,0,1
"上电/复位后，系统软件进行相应的初始化工作，之后调用应用软件的AInit()函数进行应用软件的初始化。应用软件初始化工作主要包括硬件初始化、变量初始化、星箭分离查询、确定部件加断电状态状态。
硬件初始化的内容如下表所示：
表5-2 上电/复位后硬件初始化表
内  容|状  态
串口初始化|按前面要求进行设置
CANA、B总线初始化|按通讯协议要求进行设置

硬件初始化完成后应用软件需对初始值不为0的变量初始化（系统软件已对B段变量清零），相应变量的初始化值见《卫星控制分系统控制计算机应用软件用户需求》和《卫星控制分系统注入参数及数据指令的用户需求》。应用软件需读取一次星时计数器值。
硬件和变量初始化完成后，应用软件连续进行5次星箭分离查询，每次间隔大于1ms。若连续3次查到星箭分离，则认为星箭已分离，置当前控制模式为“复位进入模式”，设置星时为0.75秒；否则认为星箭未分离，进行主动段初始化工作。",1,0,0,0,0,0,0,0
"功能描述：
 太阳捕获功能主要实现速率阻尼、俯仰搜索、滚动搜索、巡航等功能，使卫星由任意姿态进入保持对日定向巡航姿态运行。太阳捕获功能分为速率阻尼、俯仰搜索、滚动搜索和巡航四种方式（FReq-6）。
                        表5-2 方式字定义
名称|方式字定义|说明
RDSM|0|速率阻尼方式.(默认方式，程控结束后进入)
PASM|1|俯仰搜索方式
RASM|2|滚动搜索方式
CSM|3|巡航运行方式

处理： 
  （1） 模块初始化设置
   程序结束后，根据任务书5.4.5.3.1节进行模块初始化设置。考虑到地面遥控指令可以重新进入太阳捕获模式（速率阻尼初始化置陀螺故障诊断不允许），软件对模块初始化中的变量分为2个部分，其中以下部分为程控结束后只设置一次的变量：   
推力器输出状态清零；
CleNum = 0;  
采用MRE板数据设置陀螺顶替标志；（考虑S陀螺健康时才进行相应顶替）。
若有飞轮的电源状态为开，则允许飞轮进行转速控制WheelCon＝TRUE；
部分软件自身使用的变量。
（2）在太阳捕获中需要进行动量轮刹车控制以及方式控制：
动量轮刹车控制详见5.2.17节。（有动量轮加电，则进行动量轮刹车控制。）
（3）方式控制如下：
(I) 对卫星进行速率阻尼，连续35个控制周期三轴角速度绝对值（实际取最大值即可）小于0.14°/s，进入俯仰搜索方式；或者进入速率阻尼方式的时间超过2000个控制周期（256秒）后，进入俯仰搜索，开始搜索太阳。
(II)进入俯仰搜索方式，使卫星以+/-0.5/s（速率阻尼结束后进入时根据SPz13选择极性)绕Y轴转动，若5625个控制周期（720秒）后没有捕获到太阳，进入滚动搜索方式。进入滚动搜索方式后，使卫星以0.5°/s绕X轴转动。
(III) 若(II)中滚动搜索方式经过6250个控制周期（800秒）后还未见到太阳则再重复俯仰搜索和滚动搜索，则再次进入（II），即俯仰捕获方式（这种情况下b＝-0.5/s）。其中滚动搜索不成功的故障处理逻辑见5.2.14节。
(IV) 在(II)(III)过程中一旦捕获到太阳且持续时间大于2.048秒(16个控制周期)，则进入巡航方式。进入巡航模式后，控制SADA归零。
说明：捕获太阳时，对于持续时间大于2.048秒的判断，太阳连续可见（SP61/62 = 1）的条件下，俯仰搜索时，俯仰角绝对值大于1°的累计时间；滚动搜索时，滚动角绝对值大于1°的累计时间。",0,1,0,0,0,0,0,0
"功能描述：光纤陀螺、星敏及一体化红外通讯状态设置指令
",0,0,0,0,0,1,0,0
功能描述：无控模式控制,0,1,0,0,0,0,0,0
"功能描述：轨控段喷气控制计算。
处理：同用户需求的
（1）各轴喷气参数设置如表36所示
表36：轨控段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|0.4 mθD04|0.4 mθD04|0.4 mθD04
|1.0 mθD13（注1）|1.0 mθD13（注1）|1.0 mθD13（注1）
|1.0 mθB36|1.0 mθB36|1.0 mθB36
|3.0 mθB33（注1）|3.0 mθB33（注1）|3.0 mθB33（注1）
|0.1|0.14|0.07
|0.2|0.2|0.2
|（注3）|（注3）|（注3）
|0.3|0.3|0.3
|0.43（注2）|0.43（注2）|0.43（注2）
|（注3）|（注3）|（注3）
KJ2(s)|2|2|2
aJS（/s2）|0.137|0.235|0.089

注1：在BZ1 =3、4的条件下
注2：在BZ1 =2的条件下
注3：在BZ1 =4的条件下
（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,0,0,1,0,0,0,0
功能描述：确定红外数据的有效性,0,1,0,0,0,0,0,0
功能描述：进行部件通讯与选用、数据采集与处理、自检与校时。,0,0,0,0,0,1,0,0
"功能：利用星敏感器A的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量。
（3）令（i = 1，2，… ，6）。为上一次轮子角动量值。",0,0,0,0,0,1,0,0
功能描述：发送模拟量遥测数据包2,0,0,0,0,0,0,0,1
"软件需求标识：FREQ16 
软件需求名称：加速度计数据处理 
需求类别：其他 
软件需求描述：加速度计数据处理。",0,0,0,0,0,1,0,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内
    AOCC应用软件应对内存下卸的地址区域进行保护：当内存下卸指令中的首地址、末地址均在PROM硬件地址范围、RAM硬件地址范围、1553B总线接口芯片的RAM地址范围内，则应用软件按照内存下卸指令的要求下卸目标区域的数据；若内存下卸指令中的地址超出上述3个区域的地址范围，则应用软件不更新1553B总线接口芯片中内存下卸内容子地址中对应数据。",0,0,0,0,1,0,0,0
"功能描述：进行模式初始化。
处理：
（1）置帆板归零； 
（2）置 ===0；=0;= 0；",0,1,0,0,0,0,0,0
功能描述：根据星敏感器的输出数据判断陀螺故障。,0,1,0,0,0,0,0,0
"功能描述：模式7切换方式。
处理：
若或者收到轨控结束指令，关姿控发动机，置WorkMode=5；if(lipse=0){WorkModeT=4；}
else{WorkModeT=6；}；
若FailureFlag=2，若RollMnvStyleFlag＝0且PitchMnvStyleFlag＝0，置WorkMode=6，否则(WorkMode=5；WorkModeT=6，；)；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：满足以上任意条件退出时，置tФi、tθi、t pi 为10年后的大星时，
RollMnvStyleFlag＝0、PitchMnvStyleFlag＝0，。",0,1,0,0,0,0,0,0
"功能描述：执行偏航机动及返调至运行姿态
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP2：根据当前星时t的取值进行不同的处理：
STEP3：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
"功能描述：接收同步控制。
处理：根据应急线路同步字的编码内容进行相应的处理：
编码|相应的处理
28H|发送内存的数据区指针复位
",0,0,0,0,0,0,1,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
-Y帆板数据的采集与处理|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,1,0,0
