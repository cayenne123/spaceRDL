Requirements Description,初始化,控制计算,控制输出,故障诊断和处理,数据有效性判断,数据采集,遥控,遥测
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如表 43所示：
表 43：对应矢量字各个请求编码的条件
服务编码|发送的条件
0000|无服务请求
bit0=1|申请传送AOCC重要数据
bit0=0|无AOCC重要数据服务请求
bit1=1|申请传送OBDH时间
bit1=0|无OBDH时间服务请求
bit2=1|AOCS应急控制标志有效
bit2=0|AOCS应急控制标志无效
bit3=1|AOCC硬件状态数据状态准备好
bit3=0|AOCC硬件状态数据状态未准备好
bit4=1|AOCC内存数据状态为准备好
bit4=0|AOCC内存数据状态为未准备好
bit8=1|AOCC黑匣子数据状态为准备好
bit8=0|AOCC黑匣子数据状态为未准备好
",0,0,0,0,0,0,0,1
"功能描述：计算巡天模式下的目标姿态
",0,1,0,0,0,0,0,0
"功能描述：根据指令完成中继天线的捕获跟踪控制。
输入：跟踪开始指令（R_GZKS=1），跟踪结束指令（R_GZJS=1），RelayGDASwapAcqFlag，FRelayGDASwapAcq, ， 
输出：RelayGDAView, FRelayGDASwapAcq ,、，",0,1,0,0,0,0,0,0
"功能描述：发送AOCC重要数据给OBDH保存
处理：将重要数据打包后放到AOCC重要数据内存地址空间中。重要数据的内容具体见重要数据文件。",0,0,0,0,0,0,0,1
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0|主动段|FREQ56
1|正常对地运行|FREQ57
2|偏航机动|FREQ58
3|全姿态捕获|FREQ59
4|对地捕获|FREQ60
5|帆板未展开|FREQ61
6|轨控|FREQ62
7|无控|FREQ63
8|侧摆机动|FREQ64
9| 侧摆保持|FREQ65
11|入轨段控制|FREQ66
12|自旋模式|FREQ67
13|应急模式|FREQ68
14|星敏全姿态捕获模式|FREQ69
10|CMG启动模式|FREQ107

主动段工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定和姿态和轨道控制的如下所示
|模式字
|E
卫星轨道外推计算|√
GPS轨道计算|√
太阳星历计算|√
地面站位置计算|√
地磁场计算|√
偏流角计算|
岁差章动计算|√
陀螺数据处理|√
惯性姿态陀螺预估|√
对地姿态陀螺预估|
四元数陀螺预估|
红外输出的数据处理|√
太阳输出的数据处理|√
红外的姿态修正|
红外与太阳双矢量定姿|
红外太阳姿态修正|
星敏感器数据处理|
星敏感器A姿态修正|
星敏感器B姿态修正|
星敏感器C姿态修正|
星敏感器A、B姿态修正|
星敏感器A、C姿态修正|
星敏感器B、C姿态修正|
对地姿态修正及星敏粗姿态计算|
仅星敏感器A的姿态修正|
仅星敏感器B的姿态修正|
仅星敏感器C的姿态修正|
仅星敏感器AB的姿态修正|
仅星敏感器AC的姿态修正|
仅星敏感器BC的姿态修正|
侧摆目标姿态确定|
–Z轴捕获太阳及对日定向|
偏航捕获及转对地定向|
星敏感器全姿态捕获|√
姿态控制量计算|√
相平面法|√
姿态喷气控制|√
动量轮摩擦补偿计算|√
动量轮角动量保持的PI控制|√
动量轮启动与保持|√
正常飞行动量轮分配电压计算|
结构滤波器计算|
喷气卸载条件计算|
磁卸载控制|
CMG数据处理|√
CMG控制|
运行段帆板控制|
自主跟踪控制|
无控模式下太阳帆板控制|
数传天线指向控制|
偏置动量轮分配电压计算|
正常模式1N变轨|

在正常运行模式下主要有三种定姿方式：红外定姿、红外太阳定姿和星敏定姿。其中星敏定姿为高精度定姿方式。并可采用有陀螺和无陀螺方式，正常情况下为有陀螺。定姿方式的切换通过注入系统定姿方式字和系统故障诊断来实现切换。",0,0,0,0,1,0,0,0
"功能描述：启动动量轮至标称角动量，并保持
",0,1,0,0,0,0,0,0
功能描述：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
功能描述：计算地磁场强度。,0,1,0,0,0,0,0,0
"功能描述：当整星－Z 轴对日后，通过旋转Z 轴令目标矢量进入XOZ 平面
",0,1,0,0,0,0,0,0
"功能描述：发送遥测数据
处理：
包括两个子地址，发送两条指令是连续的，共有76个字节。应用软件在收到发送遥测帧计数（低字节为实时遥测帧计数0~63，高字节为实时格式计数0~7）的低字节为62时，根据高字节实时格式计数根据延时遥测数据格式进行打包后放到发送延时遥测参数地址中，具体数据见延时遥测文件。",0,0,0,0,0,0,0,1
"功能描述：接收卫星时间
处理：AOCC上电或复位时通过发送重要数据申请给OBDH，OBDH把卫星时间和AOCC重要数据都发到AOCC终端。",0,0,0,0,0,0,1,0
"功能描述：接收遥控可变地址注入块
处理：软件设计时需要判断地址是否对齐，若未对齐，则不执行此注入块。",0,0,0,0,0,0,1,0
"功能描述：中继天线数据处理
处理：
处理数据时应对接收数据中的捕跟分系统工作模式进行保护判断。",0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|陀螺数据处理|FREQ3.1|5.2.1|把陀螺数据、、、变换到星体系中的、、
|陀螺预估惯性姿态|FREQ3.2|5.2.2|根据陀螺输入，预估卫星惯性姿态
|陀螺预估对地姿态|FREQ3.3|5.2.3|根据陀螺测量输出，一步预估卫星姿态
|陀螺预估惯性四元数|FREQ3.4|5.2.4|根据陀螺测量输出，一步预估卫星惯性姿态
|动力学预估惯性四元数|FREQ3.5|5.2.5|根据动力学模型，预估卫星惯性姿态
|基于红外滤波的卫星姿态确定|FREQ3.6|5.2.6|根据陀螺预估结果和红外(和数字太阳)输出，确定卫星姿态
|星敏感器与陀螺姿态修正|FREQ3.7|5.2.7|利用星敏感器和陀螺的输出或仅利用陀螺预估输出计算卫星欧拉角和四元数
|单星敏感器的姿态修正|FREQ3.7.1|5.2.7.1|利用单个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|双星敏感器的姿态修正|FREQ3.7.2|5.2.7.2|利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|对地姿态修正|FREQ3.7.3|5.2.7.3|利用估计的四元数转换姿态角
|星敏感器与动力学姿态修正|FREQ3.8|5.2.8|利用星敏感器的输出计算卫星欧拉角和四元数
|仅单星敏感器的姿态修正|FREQ3.8.1|5.2.8.1|仅利用单个星敏感器的测量，修正姿态四元数与姿态角速度
|仅双星敏感器的姿态修正|FREQ3.8.2|5.2.8.2|仅利用两个星敏感器的测量，修正姿态四元数与估计陀螺漂移
|无陀螺对地姿态修正|FREQ3.8.3|5.2.8.3|利用估计的四元数转换姿态角，送给星敏感器的四元数
|红外与太阳双矢量定姿|FREQ3.9|5.2.9|利用红外、数字太阳敏感器确定姿态
|星敏感器相对基准标定|FREQ3.10|5.2.10|对星敏的相对基准进行标定，修正星敏安装矩阵
|星敏感器双矢量姿态确定|FREQ3.11.1|5.2.11.1|利用星敏的测量，确定单点的卫星姿态四元数。
|星敏姿态四元数重置|FREQ3.11.2|5.2.11.2|进行卫星姿态四元数的重置
|三轴欧拉姿态角预估算法产品规范|FREQ3.1.1|/|规范化算法：
|姿态四元数预估算法产品规范|FREQ3.1.2|/|规范化算法：
|重力梯度力矩计算算法算法产品规范|FREQ3.1.3|/|规范化算法：
|基于红外测量的红外滤波修正算法产品规范|FREQ3.1.4|/|规范化算法：
|基于单星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.5|/|规范化算法：
|基于双星敏感器测量矢量叉乘信息的滤波修正算法算法产品规范|FREQ3.1.6|/|规范化算法：
|基于红外与太阳矢量的双矢量定姿算法算法产品规范|FREQ3.1.7|/|规范化算法：
|星敏感器相对基准的在轨标定算法产品规范|FREQ3.1.8|/|规范化算法：
|目标姿态计算流程|FREQ3.12|5.3.1|目标姿态计算流程
|正常、偏置飞行目标姿态计算|FREQ3.12.1|5.3.1.1|正常与偏置姿态飞行时的目标姿态计算
|点对点机动目标姿态计算|FREQ3.12.2|5.3.1.2|点对点机动目标姿态计算
|姿态预置过程目标姿态计算|FREQ3.12.3|5.3.1.3|姿态预置过程目标姿态计算
|轨迹跟踪目标姿态计算|FREQ3.12.4|5.3.1.5|角速度建立过程目标姿态计算
|轨控目标姿态计算|FREQ3.12.5|5.3.1.6|轨控目标姿态计算
|角速度扫描阶段目标姿态计算|FREQ3.12.6.1|5.3.1.4|角速度扫描阶段目标姿态计算
|轨控姿态机动轨迹初始化|FREQ3.12.6.2|5.3.2.3|轨控模式目标姿态计算初始化
|正弦轨迹规划算法算法产品规范|FREQ3.12.7|/|规范化算法：
|基于加速度导数为正弦函数的轨迹规划算法算法产品规范|FREQ3.12.8|/|规范化算法：
|点对点姿态机动初始化处理|FREQ3.13|5.3.2.1|三轴姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉轴/角，以及轨迹的加速，匀速和减速等特征时间点。
|非沿迹跟踪初始化|FREQ3.14|5.3.2.2|非沿迹跟踪初始化，计算地心张角和方向矢量
|计算多项式轨迹系数|FREQ3.15|5.3.3.1|根据轨迹规划时间，初始姿态/姿态角速度和目标姿态/姿态角速度计算基于多项式轨迹规划的轨迹系数
|姿态预置机动目标姿态确定|FREQ3.16|5.3.3.2|基于多项式曲线的轨迹规划，计算目标姿态
|轨迹跟踪目标姿态角计算|FREQ3.17|5.3.4|根据所指定的扫描起始经纬度和末端点经纬度
|偏流角计算|FREQ3.18|5.3.5|适用于地球椭球模型，星体姿态描述为转序，计算基于星体光轴(与星本体＋Z轴平行)下的偏流角
|姿态控制量计算|FREQ3.19|5.2.12|根据姿态确定结果和目标姿态计算结果计算误差姿态角和误差姿态角速度
|引入系统闭环姿态确定|FREQ3.20|5.2.13|根据定姿标志确定引入系统的闭环姿态
|增量式偏流角计算算法产品规范|FREQ3.21|/|规范化算法：
|匀地速姿态预置目标姿态计算|FREQ3.22|5.12|计算模式2/5经模式4转入模式6时姿态预置的目标姿态及角速度
|匀角速度预置目标姿态计算|FREQ3.23|5.13|计算模式2/5经模式4转入模式7时姿态预置的目标姿态及角速度
|零姿态预置目标姿态计算|FREQ3.24|5.14|计算模式6/7经模式4转入模式2时姿态预置的目标姿态及角速度
|陀螺标定过程目标姿态计算|FREQ3.25.0|5.15.1|陀螺标定全过程的目标姿态计算，包括目标惯性角速度和目标四元数，并在回轨道对地零姿态过程中计算目标欧拉角
|目标姿态计算初始化|FREQ3.25.1|5.15.1.1|对陀螺标定过程中涉及到的两次机动过程进行机动姿态计算的初始化
|惯性姿态点对点机动轨迹规划|FREQ3.25.2|5.15.1.2|对陀螺标定过程所涉及到的两次点对点机动进行轨迹规划
|角速度起速保持与减速过程轨迹规划|FREQ3.25.3|5.15.1.3|对陀螺标定过程中的速度运行进行轨迹规划
|大角速度标定的分档确定|FREQ3.25.4|5.15.1.4|根据实现指向的4挡速度，根据当前的速度的幅值，确定所标定的陀螺刻度因子的位置
|惯性定向时转阶段处理|FREQ3.25.5|5.15.1.5|陀螺标定在第1段中完成惯性定向，并在此期间标定陀螺真实常漂。在惯性定向转速度运行结束时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等。
|速度运行时转阶段处理|FREQ3.25.6|5.15.1.6|SubMode= 2~9，陀螺按照规定的角速度完成起速、恒速运行、减速和惯性定向四个步骤后，在转入下一个阶段时，对各变量进行初始化，并记录陀螺的等效常漂，星体的惯性角速度估计等
|速度曲线规划|FREQ3.25.7|5.15.1.7|根据所选择的机动轨迹，规划出角速度变化曲线
|陀螺标定算法|FREQ3.26.0|5.15.2|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺常漂修正标志确定|FREQ3.26.1|5.15.2.1|对陀螺标定过程中，陀螺常漂的修正标志进行确定。当星体达到了规定的惯性角速度时，开始进行陀螺常漂估计
|基于星敏陀螺滤波的等效常漂估计|FREQ3.26.2|5.15.2.2|采用星敏陀螺滤波的方法对陀螺等效常漂进行估计
|星敏陀螺滤波的陀螺等效常漂记录|FREQ3.26.3|5.15.2.3|对陀螺等效常漂，选取稳态时的一段数据进行平均，得到各个角速度下的等效常漂和星体真实角速度的估计值
|小角速度时的陀螺安装误差和刻度因子误差估计|FREQ3.26.4|5.15.2.4|经过N次速度机动后，对陀螺的测量模型进行标定，给出标定结果
|大角速度时的陀螺标定算法|FREQ3.26.5|5.15.2.5|在标定过程中，对各个阶段的陀螺等效常漂进行估计
|陀螺在轨标定时的控制量计算|FREQ3.27|5.15.3|对标定过程中的控制量进行计算
|陀螺安装误差标校结果引入|FREQ3.28|5.15.4|对陀螺完成标定后，待地面确认标定结果无误后，将陀螺的标定结果进行赋值。当地面注入FP__MountingCmp时执行本程序一次
|陀螺刻度因子误差标校结果引入|FREQ3.29|5.15.5|完成陀螺标定，待地面确认无误后，对陀螺的刻度因子进行在轨标校。标校时，取陀螺输出的角速度与与之最接近的两个已标定的特征角速度进行线性插值标校
|偏航对日目标姿态计算|FREQ3.30|5.3.1.7|偏航对日模式下的目标姿态机动
",0,1,0,0,0,0,0,0
"功能描述：为机动过程姿态确定提供初始姿态。
输入：	机动起始时刻本体对轨道估计姿态角()
输出：	机动目标相对轨道的姿态四元数
变换矩阵
本体对目标坐标系的姿态四元数",0,0,0,1,0,0,0,0
功能描述：发送姿态机动过程参数包。,0,0,0,0,0,0,0,1
"上行注入功能是地面干预星上运行状态的重要手段，主要是指OBDH通讯协议中定义的控制分系统“接收遥控注入数据”功能。上行注入数据块由地面发送到OBDH分系统，再由OBDH分系统通过B总线发送到AOCC执行。包括下表的功能点。
序号|功能描述|功能编号
|轨道数据块|FRE74
|姿控数据块1|FRE74.1
|姿控数据块2|FRE74.2
|LTU通信选择块|FRE74.3
|故障诊断标志块|FRE74.4
|星敏感器命令块|FRE74.5
|惯性调姿命令块|FRE74.6
|轨控命令块|FRE74.7
|SDC命令块|FRE74.8
|LTU命令块|FRE74.9
|内存修改块|FRE74.10
|应急控制器注入块|FRE74.11
|系统软件标志修改块|FRE74.12
|程序块|FRE74.13
|相平面系数块|FRE74.14
|轮控系数1及磁控系数|FRE74.15
|轮控系数块2|FRE74.16
|陀螺脉冲当量系数块|FRE74.17
|星敏修正系数块|FRE74.18
|条件判断、阀值和限幅相关数据块|FRE74.19

具体的内容见注入文件。",0,0,0,0,0,0,1,0
功能描述：接收GPS秒脉冲整秒时间,0,0,0,0,0,0,1,0
"功能描述：计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0
功能描述：利用估计的四元数转换姿态角。,0,1,0,0,0,0,0,0
"上行注入功能是地面干预星上运行状态的重要手段，主要是指OBDH通讯协议中定义的控制分系统“接收遥控注入数据”功能。上行注入数据块由地面发送到OBDH分系统，再由OBDH分系统通过B总线发送到AOCC执行。包括下表的功能点。
序号|功能描述|功能编号
|接收数据指令注入|FREQ7.8.1
|接收固定参数注入|FREQ7.8.2
|可变地址注入|FREQ7.8.3
|轨道参数注入|FREQ7.8.4
|程序修改注入|FREQ7.8.5
|星敏感器指令注入|FREQ7.8.6

具体的内容见注入文件。",0,0,0,0,0,0,1,0
"功能描述：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
甚高陀螺通讯故障诊断|大量程通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理
1553B内总线总线监视及处理要求|CCU作为内1553B总线的BC，在与各RT通讯时需要进行总线状态监视
部件故障诊断与处理|确定各敏感器和执行机构故障诊断及处理
陀螺故障检测|确定各敏感器和执行机构故障诊断及处理
动量轮故障检测|检测工作中的动量轮的故障
大力矩飞轮故障检测|检测工作中的大力矩飞轮的故障
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式7的系统故障诊断|在模式7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
磁力矩器数模一致性诊断|磁力矩器数模一致性诊断
DSS输出一致性诊断|DSS输出一致性诊断
ASS1输出一致性诊断|ASS1输出一致性诊断
ACU 1553B接收故障诊断及处理|由于卫星的执行机构控制均需通过ACU进行，当ACU接收控制指令内存区异常将导致卫星失去控制能力，因此有必要对ACU接收执行机构控制指令的正确性进行判断。在检测到执行机构控制指令接收校验和异常后CCU需要自主进行处理",0,0,0,1,0,0,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议。
功能编号|功能|引用文档
FREQ45|初始化|陀螺协议
FREQ46|陀螺使用要求|任务书
FREQ47|通信|陀螺协议
FREQ48|通信故障处理|任务书
FREQ49|数据解包与转换|陀螺协议
FREQ50|陀螺数据有效性判断、处理|任务书
FREQ51|陀螺模拟量采集、处理|任务书
FREQ52|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"软件需求标识：FREQ4 
软件需求名称：星时计算 
软件需求描述：星时计算。见“任务书”4.1.3.1“星时计算”。",0,0,0,0,0,1,0,0
"功能描述：地面注入数据处理
说明：计算目标器GPS时，将输入、输出改为目标器的相应变量。",0,1,0,0,0,0,0,0
"软件需求名称：初始化 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。
调用条件：上电/复位。
处理：依据“用户需求”、“任务书”、“上行注入”对非0变量进行初始化。 ",1,0,0,0,0,0,0,0
"功能描述：使用星敏感器C的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。
",0,0,0,0,0,1,0,0
"功能描述：检测动量轮的故障。
",0,1,0,0,0,0,0,0
"功能描述：发送星敏陀螺数据给OBDH保存
处理：将星敏陀螺数据打包后放到星敏陀螺数据内存地址空间中。",0,0,0,1,0,0,0,0
功能描述：计算磁卸载所需的磁矩与磁力矩器工作脉宽。,0,1,0,0,0,0,0,0
功能描述：决定磁卸载或喷气卸载方式,0,1,0,0,0,0,0,0
功能描述：根据陀螺输入，预估卫星惯性姿态。,0,1,0,0,0,0,0,0
"功能描述：数传天线数据处理
",0,0,0,0,0,1,0,0
功能描述：检测工作中的动量轮的故障并设置WheelState。,0,1,0,0,0,0,0,0
"功能描述：对动量轮的角动量进行调整。
",0,1,0,0,0,0,0,0
功能描述：接收遥控固定参数注入块的红外太阳姿态修正系数,0,0,0,0,0,0,1,0
功能描述：利用红外、数字/太阳敏感器确定姿态。,0,1,0,0,0,0,0,0
"软件需求标识：FREQ16 
软件需求名称：加速度计数据处理 
需求类别：其他 
软件需求描述：加速度计数据处理。",0,0,0,0,0,1,0,0
"功能描述：模式6切换方式。
处理：
if() 置WorkMode=5；若，若，WorkModeT=6；
if() 置WorkMode=5；若，若，WorkModeT=6；
若且且 ，置WorkMode＝7；
if(且且且且AutoPermission=1) 置WorkMode=5；WorkModeT=4；；//阴影区进入阳照区自主转对日定向；可注入修改，初值为1；
if(且且且且且AtuoPermission=1) 置WorkMode=5；WorkModeT=4；；//南纬60度强制转对日定向，为纬度系数，可注入修改，该条件优先于下一个条件
if( 且且且) 置WorkMode=5；WorkModeT=6；；；//程控指令自主转对地姿态
收到星务的“对日定向” 指令，置WorkMode=5；WorkModeT=4；；；//成像任务完成后指令转入对日定向，并清除辐射定标目标角
收到星务的“辐射定标”指令，置WorkMode=5，WorkModeT=6，；//辐射定标模式，为注入的辐射定标目标角
若FailureFlag=1，置WorkMode=2；
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；",0,1,0,0,0,0,0,0
"功能：利用红外、数字太阳敏感器确定姿态。
",0,1,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件1553B初始化、变量的初始化                                                                                                                                                                                                                                                                                                                                                                                                             处理：
进行1553B初始化，处理过程见的OBDH初始化功能
设置3个星敏的 RTS信号为无效
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0
"功能描述：使用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
功能描述：置卫星姿态无控，处于自由飞行状态。,0,1,0,0,0,0,0,0
"功能描述：利用加速度计数据诊断加速度计部件状态
",0,1,0,0,0,0,0,0
功能：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
"模式字定义如下，装订值为0：
模式字|工作模式描述
0|主动段
1|正常对地运行
2|偏航机动
3|全姿态捕获
4|对地捕获
5|帆板未展开
6|轨控
7|无控
8|侧摆机动
9| 侧摆保持
10|CMG启动模式
11|入轨段控制
12|自旋模式
13|应急模式
14|星敏全姿态捕获模式

定义星箭分离前为主动段工作模式（包括射前和主动段飞行状态），BZ1=0。主动段工作模式下，应用软件进行下列工作：
星时计算；
数据采样，但无任何控制指令输出；
组帧遥测数据；
响应OBDH通讯命令；
仅在主动段查询星箭分离信号的有效性，确认依据为：一个控制周期读取3路星箭分离状态位，若3路中的2路读入为“1”，则认为本周期查到星箭已分离。如果在连续5个周期内每个周期都查到星箭已分离，则可确认为星箭已分离，进入入轨段模式，BZ1=B。
通过注入在轨维护程序，实现部件测试功能，此功能仅在主动段模式下有效。
判别星箭分离后，应用软件开自锁阀3、5及1N推力器短期加温，并进入入轨段模式。
工作模式的转换可分为以下二种情况：
按地面上行注入进行转换：通过注入姿控数据块中的模式字进行转换；
按应用软件用户需求给定的条件判别，由软件自主控制转换：自主转换分两种：一种为正常运行转换；一种为故障时转换。下面分别进行说明
正常运行转换如下图所示：
正常运行自主转换如下表所示：条件标识原则：ZCCX—Y，其中ZCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。
标识|具体条件
ZCC0—B|星箭分离
ZCCB—1|Tin >4800 
ZCC1—2|
ZCC1—6|
ZCC1—8|且且且且
ZCC2—1|
ZCC2—6|
ZCC4—1|FEA=A
ZCC6—1|
ZCC6—2|)且
ZCC8—1|""满足下列条件之一：
且CBStyleFlag<2且且(
且连续次
且CBStyleFlag>1且且且)连续次
且""
ZCC8—9|""满足下列条件之一：
且CBStyleFlag<2且且
(
且)连续次
且CBStyleFlag>1且且且)连续次
且""
ZCC9—8|""满足下列条件之一：
且
""
ZCCA—1|""CMG_NewFault
且(max()<
且 ()<0.000262且 ()<0.017)连续次""

故障自主转换如下表所示：条件标识原则：GCX—Y，其中GCC表示正常自主转换条件，X为转出的模式字，Y为转入的模式字。其中进入应急模式的条件为读到应急线路加电，记为GCC-D。其余的自主故障切换如下图所示：
故障条件定义如下：
标识|具体条件
GCC1—3|FailureFlag=1并且WacqSunorSTSModeFlag =0并且ZT7属于[1，4]区间内
GCC1—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC1—A|CMG_NewFault0且 1ZT14
GCC1—E|FailureFlag=1并且WacqSunorSTSModeFlag =1并且ZT7属于[1，4]区间内
GCC3—7|FailureFlag＝4且AutoInStopNum<2
GCC3—E|SMODE＝3且TSMODE>8000（若ZT11=4则取值为32000）
GCC4—1|FEA=A
GCC4—3|WacqUseIresOrSTSFlag=1且TCOUNT>24000
GCC5—3|脉冲发完后
GCC6—1|FailureFlag＝2且无机动要求
GCC6—2|FailureFlag＝2且无机动要求
GCC7—3|>6900 且AutoInStopNum<2且WacqSunFlag =0
GCC7—E|>6900 且AutoInStopNum<2且WacqSunFlag =1
GCC8—1|FailureFlag=3
GCC8—A|""满足下列条件之一：
CBStyleFlag=0，且CMG通讯故障计数器CMGComFailCnt[i] (i=1,2,3) >CMGErapolationNum为ZT14选定的CMG之一
CMG_NewFault且 1ZT14""
GCC9—3|FailureFlag=1并且WacqSunorSTSModeFlag =0并且ZT7属于[1，4]区间内
GCC9—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCC9—A|CMG_NewFault且 1ZT14
GCC9—E|FailureFlag=1并且WacqSunorSTSModeFlag =1并且ZT7属于[1，4]区间内
GCCA—1|""满足下列条件之一：
>400且max()>0.08连续次
CMG_NewFault且>6000""
GCCB—3|FailureFlag=1并且ZT7属于[1，4]区间内
GCCB—7|FailureFlag=1并且ZT7不属于[1，4]区间内
GCCE—1|StarCatchFlag=1且(1-()<0.000685)且norm()<0.000875
GCCE—7|TCOUNT>31200或（FailureFlag＝4且AutoInStopNum<2）

AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,1,0,0,0,0,0,0
"软件需求名称：故障诊断和处理 
需求类别：其他 
软件需求描述：《用户需求》4.8。 
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.8.1|陀螺故障检测及选择|《用户需求》4.8.1|
FREQ12.3-R4.8.2|加计故障检测及选择|《用户需求》4.8.2|
FREQ12.3-R4.8.3|星敏感器故障检测及选择|《用户需求》4.8.3|
FREQ12.3-R4.8.4|帆板驱动机构故障检测及选择|《用户需求》4.8.4|
FREQ12.3-R4.8.5|动量轮故障检测及选择|《用户需求》4.8.5|
FREQ12.3-R4.8.6-K|推进系统故障检测及选择|《用户需求》4.8.6|
FREQ12.3-R4.8.7-K|系统故障检测及选择|《用户需求》4.8.7|
",0,1,0,0,0,0,0,0
"功能描述：使用星敏感器A、C的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：实时计算地心矢量、太阳矢量在本体系下的表示，以及星体X轴指向的赤经、赤纬
",0,1,0,0,0,0,0,0
"软件需求标识：FREQ13 
软件需求名称：采集时序 
软件需求描述：
              不再要求“不论部件是否通讯，均进行延时计数。”",0,0,0,0,0,1,0,0
"功能描述：估计各个加速度计零位漂移增量
",0,1,0,0,0,0,0,0
"功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、。
",0,1,0,0,0,0,0,0
"功能模式：姿态机动目标姿态确定。
",0,1,0,0,0,0,0,0
"功能描述：计算三轴的轮控力矩。
处理：
STEP1:分别计算P,I,D项。，的限幅值可以通过内存修改；，的限幅值可以通过内存修改。计算公式见（1）；
STEP2:PID加补偿的控制律计算。若{BZ1≠8(侧摆机动)或（BZ1=8且ZT43(3)=1允许侧摆机动引入结构滤波器）}且ZT39(4)=1引入结构滤波器，则调用结构滤波器算法得到，。计算公式见（2）；
STEP3:若ZT8≤3姿控发动机可用，ZT2=2飞轮整星零动量控制模式，BZ1≠1（三轴稳定正常轨道运行姿态）或2（偏航机动并稳定运行）或8（侧摆机动）或9（侧摆角保持），则：
若或，则=0.01；
若或，则=0.01；
若或，则=0.01。",0,1,0,0,0,0,0,0
"需求名称|功能描述
部件数据有效性判断|对部件采样数据的有效性进行判断，并选择引入闭环控制系统的数据
陀螺数据有效性判断|判断定姿用陀螺数据的有效性，选择参与定姿的陀螺
模拟太阳敏感器数据有效性判断|确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号选取
红外地球敏感器数据有效性判断|判断红外地球敏感器有效性
星敏感器数据有效性判断|对星敏感器输出数据进行有效性判断，并选取定姿星敏组合
数字太阳敏感器数据有效性判断|对数字太阳敏感器输出数据进行有效性判断
部件故障诊断|对部件进行故障诊断
陀螺故障诊断|由平衡方程方法、星敏感器数据等对陀螺进行故障检测
CMG故障诊断|根据CMG输出数据和理论数据进行CMG故障检测
推进喷气异常检测|检测推力器微漏、过量喷气等，必要时作相应的主备份切换和禁止。
帆板故障诊断|帆板故障检测及处理
模式1的系统故障诊断|在模式1中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式2的系统故障诊断|在模式2中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式3的系统故障诊断|在模式3中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式4、6、7的系统故障诊断|在模式4、6、7中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式5的系统故障诊断|在模式5中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式8的系统故障诊断|在模式8中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
模式9的系统故障诊断|在模式9中，根据姿态角和姿态角速度偏差等数据进行系统故障的检测
RS422通讯故障诊断|进行RS422通讯故障诊断及处理
光纤陀螺通讯诊断及处理|进行光纤陀螺通讯故障诊断及处理
数字太阳通讯诊断及处理|进行数字太阳通讯故障诊断及处理
太阳模拟量通讯诊断及处理|进行太阳通讯故障诊断及处理
对地数传天线通讯诊断及处理|进行对地数传天线通讯故障诊断及处理
中继天线通讯诊断及处理|进行中继天线通讯故障诊断及处理
1553B内总线通讯故障诊断|进行1553B内总线通讯故障诊断及处理
红外通讯故障诊断|红外通讯故障诊断及处理
大量程陀螺通讯故障诊断|大量程通讯故障诊断及处理
CMG通讯故障诊断|CMG通讯故障诊断及处理
ACU通讯故障诊断|ACU通讯故障诊断及处理
帆板通讯故障诊断|帆板通讯故障诊断及处理
多头星敏通讯故障诊断|多头星敏通讯故障诊断及处理",0,1,0,0,0,0,0,0
"功能描述：使用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B单独或组合定姿的方式，调用相应姿态修正程序。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入章节号|功能描述
|喷气开关逻辑相平面分区，喷气脉冲宽度计算|FREQ31|4.3.1.1|进行单轴相平面分区及控制规律计算
|三轴姿态喷气控制与推力器脉宽分配|FREQ32|4.3.1.3|为三轴姿态喷气控制选择推力器
|轨控发动机与其备份的使用|FREQ33|4.3.1.4|轨控模式时使用轨控发动机及其备份
|动量轮摩擦补偿计算|FREQ34|4.3.2.2|动量轮摩擦力矩的补偿电压计算
|动量轮角动量保持控制|FREQ35|4.3.2.3|计算将动量轮保持至标称角动量所需的电压
|动量轮的启动与保持|FREQ36|4.3.2.4|启动动量轮至标称角动量，并保持
|正常飞行模式动量轮分配电压计算|FREQ37|4.3.2.5|计算正常飞行模式轮控所需电压
|正常模式轮子保护与动量卸载|FREQ38|4.3.3.1|决定采用磁卸载还是喷气卸载方式，调用相应程序
|磁卸载计算|FREQ39|4.3.3.2|计算磁卸载所需的磁矩与磁力矩器工作电压
|结构滤波器计算|FREQ95|4.3.2.6|PID计算控制力矩经过结构滤波器后，改善姿态控制效果
|太阳定向主程序|FREQ40|4.4.3.3|搜索并捕获太阳，完成并保持帆板对太阳定向
|重捕地球与建立正常姿态（1）|FREQ41|4.4.4.1|在完成对日定向后，由地面指令转入重捕地球。在偏航捕获阶段，通过红外和太阳敏感器定姿，消除卫星的偏航角。在完成偏航捕获后，由红外地球敏感器测量信号进行计算得到俯仰角和滚动角，控制滚动、俯仰使其趋向于0
|捕获地球与建立正常姿态（2）|FREQ42|4.4.4.2|当红外敏感器故障时，在太阳定向完成后，利用数字太阳与星敏感器信息，进行全姿态捕获，并建立正常姿态。
|三轴等效角动量偏差|FREQ91|4.3.4.1|根据飞轮实测角动量和标称角动量计算三轴等效角动量偏差
|俯仰通道轮控算法|FREQ92|4.3.4.2|根据俯仰角和俯仰通道角动量偏差信息实现俯仰轴姿态控制
|磁进动、章动阻尼及俯仰轮卸载控制|FREQ93|4.3.4.3|通过磁力矩器，实现滚动-偏航轴的进动控制及章动阻尼，并对俯仰飞轮进行磁卸载
|三轴轮控算法|FREQ94|4.3.4.4|偏置动量轮处于力矩模式，根据红外地球敏感器测量信息计算得到的滚动角和俯仰角实现三轴姿态控制。滚动、俯仰轴采用角动量反馈方式控制，偏航轴采用耦合控制
|帆板捕获及跟踪控制|FREQ102|4.3.5|根据地面指令或自主使帆板跟踪太阳
|干扰补偿控制算法及动量轮分配电压计算|FREQ95|任务书的4.1.15|计算有效载荷干扰补偿控制电压，以及计算动量轮分配电压
|全姿态捕获动量轮控制方式主程序|FREQ40.5|4.4.5|全姿态捕获动量轮控制方式主程序
",0,1,0,0,0,0,0,0
"功能描述：根据红外输出，估计卫星姿态与陀螺漂移。
",0,1,0,0,0,0,0,0
功能：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
"软件需求名称：姿态确定算法 
需求类别：其他 
软件需求描述：
表格工作项|软件需求标识|软件需求名称|
FREQ12.3-R4.4.1|陀螺姿态预估|《用户需求》4.4.1|
FREQ12.3-R4.4.2|星敏感器陀螺确定惯性姿态|《用户需求》4.4.2|
FREQ12.3-R4.4.3|中继跟踪目标姿态计算|《用户需求》4.4.3|
FREQ12.3-R4.4.4-K|太阳捕获及太阳定向|《用户需求》4.4.4|
FREQ12.3-R4.4.5|轨控目标姿态计算|《用户需求》4.4.5|
FREQ12.3-R4.4.6|误差四元数计算|《用户需求》4.4.6|
",0,1,0,0,0,0,0,0
"功能描述：接收GPS数据
处理：将接收GPS数据存储地址中内容解包成对应的UTC时间、位置和速度数据、定轨数据和GPS秒脉冲对应的整秒时刻的数据格式。由于GPS数据中有数据有效性标志，所以其中的微秒部分不考虑大于1秒的情况，由GPS保证。",0,0,0,0,0,0,1,0
"功能描述：
处理
",0,1,0,0,0,0,0,0
"功能描述：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。
",0,1,0,0,0,0,0,0
根据地面注入的接收内存读出的地址和长度，将对应地址和长度的内存数据放入发送内存读出数据的存储空间内；,0,0,0,0,0,0,0,1
"功能描述：选择相平面参数、角加速度
处理：根据工作模式设置相平面参数；根据推力器分支及追踪器构型设置角加速度。
说明：10种构型，2种分支共计20组角加速度（每组包括正负三轴共6个）；",0,1,0,0,0,0,0,0
"功能描述：选择通讯的星敏，发取数指令，采集发送的数据，并处理成需要的数据格式。
处理：
 （1）AOCC置取数指令并发送；
（2）AOCC等待接收数据，如果200us没有数据应答，AOCC认为超时故障，把故障计数器加1，退出接收过程；
（3）如果在200us内收到星敏感器数据传递的一个字节数据，则继续接收星敏感器发送的数据，直到规定的数据接收完毕，如果接收过程中有超时，则把故障计数器加1，退出接收过程；
（4）当规定的数据接收完别后，判别星敏感器返回的指令头与发送的指令头是否一致，不一致则把故障计数器加1，退出接收过程；
（5）当校验正确时，把接收的星敏感器数据进行格式转换，并保存。
见本文 “AOCC与星敏感器串行通讯接口”。",0,0,0,0,0,1,0,0
"功能描述：与CMG通信，控制CMG并获得CMG数据。
处理：
功能编号|功能|引用文档
FREQ74|初始化|与CMG通讯协议
FREQ75|CMG使用要求|任务书
FREQ76|通信(串口)|与CMG通讯协议
FREQ77|通信故障处理|任务书
FREQ78|数据解包与转换|与CMG通讯协议
FREQ79|帆板数据有效性判断、处理|任务书
FREQ80|帆板模拟量采集、处理|任务书
FREQ81|部件在轨转发（在轨修改）|任务书
",0,0,1,0,0,0,0,0
功能描述：搜索太阳，直到数字太阳敏感器有太阳信息。,0,1,0,0,0,0,0,0
"功能描述：选择通讯的CMG线LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）CMG共有三个LTU，AOCC每个控制周期根据注入文件中的ZT14和加电状态的最大组合向指定的CMG LTU发送取数指令
（2）向选择的CMG LTU发送完取数指令，获得CMG LTU返回的数据，将数据转换为所需的数据格式，具体参见LTU通讯协议。
（3）CMG LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
"功能描述：将CMG启动到标称转数。
处理：
发送指令“运行CMG启动模式”进入CMG启动模式。
	根据地面数据指令，设置CMG引入状态；
	应用软件连续5个控制周期给引入的CMG加电；
	根据自锁阀状态设置自锁阀1和/或自锁阀2开；
	上述动作完成后，自主控制引入的4或5个CMG框架角转到标称位置；
	当框架角度达到要求值后，地面发“CMG高速启动”指令，应用软件连续5个控制周期自主向引入的4或5个CMG发送“CMG高速启动”指令，令4或5个CMG的高速转速达到6000rpm；（本步骤也可通过地面指令完成）
	CMG高速启动时间为10~15分钟
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；//在有星敏和无星敏时均可启动CMG
调用目标姿态确定；
调用控制器输入量计算；
调用CMG奇异状态的判断及算法计算；
调用CMG启动与保持；
if(CMGStartComm =1) 给CMG发启动指令；
if(Flag_equation=0)调用相平面喷气脉宽；
调用系统故障诊断；",0,1,0,0,0,0,0,0
"功能描述：将陀螺有效输出数据，换算成卫星三轴角速度。
",0,1,0,0,0,0,0,0
"功能描述：实时计算卫星轨道参数及太阳方位，太阳敏感器理论输出。
处理：同用户需求的4.2。为防止t-t0过大导致系统切机，在轨道计算中增加时间超差不调用轨道计算，仅外推轨道幅角；太阳星历的计算仍然调用。
STEP1：计算卫星轨道根数。计算公式见4.2(1)；
STEP2：计算太阳轨道和太阳敏感器理论输出，其中岁差补偿公式有更改，Cbo的计算公式改用红外定姿姿态。计算公式见4.2(2)；
STEP3：若FlagIresOrbSun=0，则FHSL=FHSR=1左右红外都不见太阳。FlagIresOrbSun是注入内存修改变量，若注入修改令FlagIresOrbSun=1，则引入红外软件见太阳保护。
STEP4：若计算的轨道半径r和相差以上，或计算的轨道角速度和0.001108rad/s相差0.00008以上，则判定轨道计算偏差太大，置BZ2=4，同时置r=6871，=0.001108，。",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。
|红外2数据的采集与处理|FREQ1.3.2|""红外2
1553取数指令""|红外2的弦宽和前基|在通讯允许的条件下（红外2的当班标志为1），向红外2 RT发取数指令，获得红外2数据并处理成对应的弦宽和前基。
",0,0,0,0,0,1,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0 |主动段|FREQ52
1|入轨段控制|FREQ53
2|巡天观测模式|FREQ54
3|定点观测模式|FREQ55
4|小天区扫描模式|FREQ56
5|姿态机动|FREQ57
6|轨控|FREQ58
7|捕获太阳并对日定姿模式|FREQ59
8|帆板未展开|FREQ60
9|无控|FREQ61
10|应急模式|FREQ62

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制见用户需求的4。主要模式的姿态确定调用流程的功能点如下：
序号|功能编号|功能描述|用户需求中对应章节
|FREQ53.1|对日定向姿态确定调用流程|5.2.1.1
|FREQ54.1|巡天模式姿态确定调用流程|5.2.1.2
|FREQ55.1|定点观测模式姿态确定调用流程|5.2.1.3
|FREQ56.1|小天区扫描模式姿态确定调用流程|5.2.1.4
|FREQ57.1|姿态机动模式姿态确定调用流程|5.2.1.5
|FREQ58.1|轨控模式姿态确定调用流程|5.2.1.6
",0,1,0,0,0,0,0,0
"功能描述：利用500秒滚动和俯仰角积分和罗盘原理，计算出偏航角。姿态确定由红外和陀螺。姿态控制是喷气控制
",0,1,0,0,0,0,0,0
功能描述：若AOCC与星敏感器通讯不成功，则记录星敏感器故障一次。若连续240次不成功，判断该星敏感器故障。若星敏感器连续2000次故障，需重新启动星敏感器。,0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
对地数传天线1数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向对地数传天线1 LTU发控制指令，获得对地数传天线1数据并处理成对应的角度等信息。
对地数传天线2数据的采集与处理|对地数传天线2的角度和角度偏差|在总线指令要求通讯允许的条件下，每500ms向对地数传天线2 LTU发控制指令，获得对地数传天线2数据并处理成对应的角度等信息。
中继天线数据的采集与处理|在总线指令要求通讯允许的条件下，每500ms向中继天线 LTU发控制指令，获得中继天线数据并处理成对应的角度等信息。",0,0,0,0,0,1,0,0
"功能描述：光纤陀螺数据处理
",0,0,0,0,0,1,0,0
功能描述：星上自主检测动量轮故障。,0,1,0,0,0,0,0,0
功能描述：接收遥控注入数据，收到遥控注入结束标识后传输结束。,0,0,0,0,0,0,1,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内",0,0,0,0,0,0,0,1
"功能描述：接收遥控固定参数注入块的相平面参数
处理：
调整推力角加速度修正因子初装值。",0,0,0,0,0,0,1,0
"功能描述：接收发送AOCC重要数据
处理：
控制分系统重要数据保存在系统内ICU以及外系统的CTU，应用软件上电/复位后首先从ICU恢复重要数据，如果连续5个控制周期申请重要数据失败（帧头错误、校验和错误或者收到的数据为非法数据）则认为从ICU恢复重要数据失败。应用软件通过外部1553B总线向OBDH申请星上时间和重要数据，如果连续15个控制周期申请重要数据失败，则根据星箭分离状态进行模式转换，并清除服务请求和矢量字。若星箭已分离则设置模式字为“入轨段”，星箭未分离则设置模式字为“主动段”。
申请重要数据成功后，按照重要数据中保存的部件当班状态初始化各部件软件当班状态，对于光纤陀螺产品需根据重要数据中的当班状态进行恢复对于三浮陀螺则根据重要数据中的Fi_GyroSelt状态进行恢复，并统一根据Fi_GyroSelt和当班状态补发产品开指令；对于CMG、红外、星敏产品根据重要数据中的当班状态恢复状态；统一根据当班状态和选择标志补发产品开指令；针对三浮陀螺产品，陀螺开指令连续发送3个控制周期后，连续3个控制周期发送陀螺马达开指令
  申请重要数据失败后，对于陀螺产品则根据ACU提供的部件加电状态初始化陀螺的当班状态和Fi_GyroSelt状态，并根据Fi_GyroSelt状态和当班状态补发产品开指令；对于红外产品，则根据ACU提供的部件加电状态初始化红外的当班状态和Fi_IRESSelt状态，并根据Fi_IRESSelt和当班状态补发产品开指令；对于CMG，根据ACU提供的部件加电状态初始化CMG的当班状态和Fi_CMGSelt状态，并根据Fi_CMGSelt状态和当班状态补发产品开指令；对于星敏感器，软件当班状态仍保持“不当班”状态，等待地面指令设置相应部件当班状态；
重要数据恢复成功后，使用第二块重要数据中的q\q\q\ q恢复“星体在惯性系下的姿态四元数q1/qng1、q2/qng2、q3/qng3、q4/qng4”。
第二块重要数据增加保存星敏定姿方式下的卫星三轴姿态角估值。",0,0,0,0,0,0,1,0
功能描述：秒脉冲信号处理。,0,0,0,1,0,0,0,0
"功能描述：接收记录AOCC时间指令
处理：CTU在需要恢复星上时间时，向AOCC发送“记录AOCC时间指令”，AOCC收到指令后立即记录AOCC时间并将时间数据写入发送AOCC时间指定的存储地址空间中。",0,0,0,0,0,0,1,0
"功能描述：轨控模式控制
",0,0,0,1,0,0,0,0
"功能描述：根据注入轨控开始时间和轨控长度，由6个喷管完成轨控。
处理：
根据注入轨控开始时间和轨控长度，由6个喷管完成轨控，进入轨控模式后需进行如下设置。
		自锁阀1、2均开；
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；//在有星敏和无星敏时均可启动CMG
调用目标姿态确定；
调用控制器输入量计算；
if(OrContrlCmg=0)  调用 姿控发动机轨控1；
else{调用 姿控发动机轨控2；调用 CMG的控制；}
调用系统故障诊断；",0,1,0,0,0,0,0,0
"功能描述：根据注入的时间，控制轨控发动机，完成初始轨道捕获和正常运行期间的轨道保持
处理过程：过程如下：
STEP1：进行姿态预估（见用户需求），得到姿态角和角速度
STEP2：令，：
STEP3：根据ZT6的值，计算得到：
STEP4：实现轨控开关机功能（见用户需求1.5），输出相应的状态标志及数据：
STEP5：进行轨控段喷气姿态控制（见用户需求）
STEP5：进行飞轮动量保持控制及飞轮启动（见用户需求）",0,1,0,0,0,0,0,0
"1）上电/复位软件初始化
功能描述：上电/复位软件初始化
2）取回重要数据初始化
功能描述：取回重要数据初始化
输入：重要数据的陀螺引入标志、推力器组件、数字太阳标志
输出：陀螺引入标志、推力器组件标志
3）未取回重要数据初始化
功能描述：未取回重要数据初始化
输出：陀螺引入标志、推力器组件标志",1,0,0,0,0,0,0,0
"功能描述：进行单轴相平面分区及控制规律计算。由、、决定是否要喷气；喷气的脉冲宽度；确定本时刻的。
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星时计算|FREQ1.4.1|上周期绝对星时；上周期锁存的星时计数器的值|本周期的绝对星时|""每周期无条件的进行星时的计算。处理要求见任务书。
""
|OBDH星时校时|FREQ1.4.2|""OBDH校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用OBDH校时方式时，每秒有OBDH校时指令时进行校时。处理见任务书。
|GPS秒脉冲高精度校时|FREQ1.4.3|""GPS秒脉冲校时指令中的绝对星时;
及对应锁存的对应时间的星时计数器的值""|上周期绝对星时；上周期锁存的星时计数器的值|采用GPS秒脉冲方式时，每秒有GPS秒脉冲指令时进行校时。处理要求见任务书。
|两种校时方式的切换|FREQ1.4.4||校时方式标志|OBDH星时校时、GPS秒脉冲高精度校时是否引入系统由注入指令控制，OBDH星时校时为系统默认使用的校时方式。具体见任务书要求
|星敏感器数据星时时标处理|FREQ1.4.6|同步标志；本周期的绝对星时；本周期锁存星时计数值；锁存的星敏同步计数值|星敏感器测量数据对应的星时|具体处理要求见任务书。
",0,0,0,0,0,1,0,0
功能描述：红外数据处理。,0,0,0,0,0,1,0,0
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。",0,0,0,0,0,0,0,1
"功能描述：PID计算控制力矩经过结构滤波器后，改善姿态控制效果。
",0,1,0,0,0,0,0,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ98|初始化|任务书
FREQ99|磁力矩器使用要求|任务书
FREQ100|通信(DA)|任务书
FREQ101|通信故障处理|预留
FREQ102|数据解包与转换|预留
FREQ103|磁力矩器数据有效性处理|预留
FREQ104|磁力矩器硬件采集、处理|任务书
FREQ105|部件在轨转发（在轨修改）|预留
",0,0,0,0,1,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,1,0,0
"功能描述：减小卫星的俯仰角。
输入：陀螺数据输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）、见太阳状态、故障标志IRES_FLAG
红外弦宽
红外数据处理（全姿态捕获）的输出，",0,1,0,0,0,0,0,0
"功能描述：发送星敏陀螺数据给OBDH保存
处理：将星敏陀螺数据打包后放到星敏陀螺数据内存地址空间中。
星敏陀螺数据组帧时，对本周期未取到星敏数据、陀螺数据的处理，以及校验和的计算方法与《 卫星控制分系统AOCC与数传分系统数据处理器通讯协议》文件中向数传分系统发送的星敏陀螺数据要求一致。",0,0,0,0,0,0,0,1
功能描述：根据CMG所对应的期望角动量与CMG产生的实际角动量之差，自主诊断CMG的工作状态。,0,1,0,0,0,0,0,0
"功能描述：利用估计的四元数转换姿态角，送给星敏感器的四元数。
",0,1,0,0,0,0,0,0
"功能描述：主动段模式初始化
处理：
- WorkMode（工作模式）：0（主动段）；
- StarTime（星上时间）：0.0；
- 俯仰磁力矩器线路主份工作；
- 星务校时：禁止星务校时；
- 均匀校时：禁止均匀校时；",1,0,0,0,0,0,0,0
"AppInit中星箭分离的查询
硬件初始化后，按5取3的方式查星箭分离状态位(对星箭分离状态位读5次，有连续3次或3次以上读入为“1”，则认为查到星箭已分离，每次读的时间间隔要求大于1ms)。
AppInit中星箭未分离的初始化
如果星箭未分离，对应用软件相关变量、硬件初始化。进入主动段工作模式。在主动段工作模式下，每个控制周期按5取3的方式查星箭分离状态位，如果连续3个周期内都查到星箭已分离，则可确认为星箭已分离。进入初始速率阻尼模式，并置星时0.375s。
AppInit中星箭已分离的初始化
对应用软件相关变量、硬件初始化，星时清0，进入复位模式。
在复位模式下，与星务分系统通讯，取回保存在星务分系统的重要数据，具体见《卫星姿轨控分系统AOCC与星务通讯协议》。如果取数成功，根据控制模式字进入初始化。若连续5秒从星务分系统取重要数据失败则认为申请失败。取重要数据不成功，设置工作模式为“太阳捕获模式”，星时为2100秒，发送CMG1~5“复位及高速断电”指令。ALTU当班状态根据前面章节的内容进行复位后设置；切除6个陀螺，发送“陀螺1~5开”指令，新加电陀螺等10分钟后引入，并置状态分为120，10分钟内系统不引入，不进行速率阻尼。",0,0,0,1,0,0,0,0
功能描述：为机动过程姿态确定提供初始姿态。,0,1,0,0,0,0,0,0
"功能描述：
 128ms周期计时（功能编号：FReq-13）。
处理： 设置128ms控制周期中断标志，计数器值为0时产生中断，不需要显示的重新装载。",0,0,1,0,0,0,0,0
"功能描述：规划串口数据接收发送。
处理：
功能编号|功能|引用文档
FREQ101|初始化|任务书
FREQ102|规划串口使用要求|任务书
FREQ103|通信|任务书
FREQ104|通信故障处理|任务书
FREQ105|数据解包与转换|任务书
FREQ106|规划串口数据有效性处理|任务书
FREQ107|规划串口硬件采集、处理|预留
FREQ108|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
功能描述：发送遥测数据,0,0,0,0,0,0,0,1
"功能描述：三轴稳定模式下，检测系统故障。
处理：
（1）基本处理
将系统故障打分FSY限幅到[7，]。
（2）FSY加减分
条件|FSY的处理
（红外输出有效），ZT3≠C(用星敏感器+陀螺定姿，且接入控制回路)，ZT3≠A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式)，|FSY加一分
（红外输出有效），ZT3≠C(用星敏感器+陀螺定姿，且接入控制回路)，ZT3≠A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式),{或}|FSY减一分
（红外输出有效），ZT3=C(用星敏感器+陀螺定姿，且接入控制回路)或ZT3=A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式)，|FSY加一分
（红外输出有效），ZT3=C(用星敏感器+陀螺定姿，且接入控制回路)或ZT3=A(星敏无陀螺定姿，且接入控制回路，整星零动量控制方式),{，}|FSY减一分
或或，FGF=1|FSY减一分
或或，FGF≠1|FSY减4分
，FSTD>1，且{（且）或ZT5=0}|FSY加4分

处理FSY,ZT3,AttTurnFlag和
条件|FSY的处理
C，A，BZ5连续239次为0|FSY=1
，FSTD连续954次为1,ZT5=0|FSY=1
，FSTD连续954次为1,|""FSY=
ZT3=3,；AttTurnFlag=1""
A，FSTD连续250次为1|FSY=1
，FSTD≠1|AttTurnFlag=0
FSY≤64H,ZT3=C,ZT5≠0|""FSY=
ZT3=3,；AttTurnFlag=1""
，AttTurnFlag=1，ZT41[2]=1允许自主由红外转回星敏定姿时，若连续120次(且，且)|，AttTurnFlag=0

(4) 若ZT226，FSY07，ZT8 =F，ZT9 =F，则ZT8=0,ZT9=0,BZ7=Jeti2。
（5）根据FSY的结果和ZT22、ZT8、ZT9对BZ1进行处理
条件|BZ1的处理
ZT226，FSY07且ZT8  3，ZT9  3|BZ1 = 3
ZT226，FSY07且ZT8  4或ZT9  4|BZ1 = 7

（6）根据FSY的结果和ZT22、ZT8、ZT9以及BZ7重置BZ7
条件|BZ7的处理
ZT226，FSY07且ZT8 = 0（可自主切换主备份姿控发动机），BZ7=1（可用姿轨控主份推力器）|BZ7 = 2
ZT226，FSY07且ZT8 = 0，BZ7=3（可用姿轨控主份及备份推力器）|BZ7 = 2
ZT226，FSY07且ZT8 = 0，BZ7=2（可用姿轨控备份推力器）|BZ7 = 1

（7）若ZT226，FSY07，ZT43[4]=1允许自主给陀螺加电，则陀螺自主加电。
（8）若ZT226，FSY07，ZT44[4]=0，FlagWHCtl=A或ZT3=B，则FlagWHCtl=5;ZT3=3;ZT8=0;BZ7=Jeti;陀螺漂移赋值；Ix,Iy,Iz,Ihx,Ihz清0。
（9）指定FlagAttTurnIres=0后，系统不使用红外进行姿态监视，仅根据有效红外进行姿态修正。",0,0,0,1,0,0,0,0
"功能描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在AOCC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。
功能编号|功能|引用文档
FREQ61|初始化|与一体化太阳通信协议
FREQ62|数太使用要求|任务书、数太协议
FREQ63|通信|任务书、数太协议
FREQ64|通信故障处理|任务书
FREQ65|数据解包与转换|数太协议
FREQ66|数太数据有效性判断、处理|任务书
FREQ67|数太模拟量采集、处理|预留
FREQ68|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
功能描述：将动量轮保持至标称角动量所需的电压。,0,1,0,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得9个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据，AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式。",0,0,0,0,0,1,0,0
功能描述：当滚动（俯仰）、偏航发动机计数器归零发出中断请求时关闭相应推力器。,0,0,1,0,0,0,0,0
功能描述：动量轮喷气卸载进入和退出条件计算。,0,1,0,0,0,0,0,0
功能描述：接收数据指令注入块的模式运行类指令,0,0,0,0,0,0,1,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|+Y帆板1553B取数指令（广播同步消息）
+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。
-Y帆板数据的采集与处理|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|+Y帆板控制数据
+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|-Y帆板控制数据
-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,1,0,0
功能描述：确定数字太阳数据的有效性。,0,1,0,0,0,0,0,0
"软件需求标识：FREQ5 
软件需求名称：星时校正 
软件需求描述：星时校时。
",0,0,0,0,0,1,0,0
"功能描述：计算小天区扫描模式下的目标姿态，并给出当前的扫描阶段：行扫中，转弯等。
",0,1,0,0,0,0,0,0
"功能描述：二次电源切换。
处理：
ACU内部含有两套二次电源，两套互为备份，可以同时加电工作，通常仅一份工作。AOCC每个控制周期采集工作电源的状态模拟量，并设置当班状态（若某份的5V和12V遥测模拟量均≥2V则当班，若主备二次电源同时符合加电条件则置主份当班）。
若当班电源的5V或12V遥测模拟量连续5个控制周期<2V时，且允许ACU二次电源自主切换，则先发送另一份电源开、隔两个控制周期后再发送本电源关指令，并禁止ACU二次电源自主切换。。
上电/复位初始化为允许自主切换，主份当班。",0,0,1,0,0,0,0,0
"功能描述：根据CMG输出数据和理论数据进行CMG故障检测。
处理：推力器喷气异常检测的阈值由10*mp改为20*mp。软件设计时应注意故障计数器值的设置和清除。喷管切换时不要清120秒累计喷气时间计数。",0,1,0,0,0,0,0,0
"计算机上电/复位后应用软件的工作流程如下。
图5-1应用软件初始化和复位处理流程",0,0,0,1,0,0,0,0
"功能描述：利用估计的四元数转换姿态角，送给星敏感器的四元数。

",0,1,0,0,0,0,0,0
"功能描述：由-Z面姿控发动机(A1/A2/A3/A4/+X/-X)进行变轨。
处理
有姿控发动机姿控加变轨方式见用户需求5.3.1.3和姿控发动机变轨，cmg姿控方式见5.3.1.，两种方式由地面选取。",0,1,0,0,0,0,0,0
"功能描述：接收TG状态数据
处理：将接收TG状态数据存储地址中内容解包TG状态。",0,0,0,0,0,0,1,0
功能描述：接收遥控固定参数注入块的系统功能参数设置区数据,0,0,0,0,0,0,1,0
"功能描述：将星务通过CAN总线广播的GPS定位数据转换成轨道根数。
处理：
由GPS定位数据r（位置），v（速度）计算出轨道六要素（半长轴、偏心率（由两部分组成）、轨道倾角、升交点赤经、平近地点幅角）并通过半长轴、轨道倾角、升交点赤经、平近地点幅角、星时校验，再通过轨道六要素计算其他轨道根数。",0,1,0,0,0,0,0,0
"功能描述：模式3切换方式。
处理：
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：若地面指令转入对日定向运行模式或者太阳捕获模式，置CMGStartFlag=1。",0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器A、B修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,1,0,0,0,0,0,0
"功能描述：发送星敏感器数据
处理：OBDH在每个遥测格式的第0帧，从AOCC接收8字节星敏感器数据。其处理过程如下：
STEP1：AOCC应用程序每0.524秒查询一次有无OBDH发送数据请求，如果有则转入第二步，否则退出；
STEP2：判别是否此时星上正在取新的星图，如果是则此次发送8字节固定数4444444444444444，否则转第三步；
STEP3：判别8颗星图（每个星图32字节）数据是否取完，如果没取完，则将取星图数据计数器加1，从规定的星图数据缓存区中取8个字节的数据放入OBDH规定的内存中；否则转第四步。
STEP4：将取星图数据计数器清0，星上开始取新的星图数据 。",0,0,0,0,0,0,0,1
功能描述：计算太阳星历及光行差计算。,0,1,0,0,0,0,0,0
"功能描述：对星敏感器输出数据进行有效性判断。
输入：STSFailureDiagPermFlag, ZT6，星敏1 输出四元数，
星敏2输出四元数，星敏3输出四元数，预估四元数
t， t星A，t星B ，t星C ,  tmdts ,ZAR , ZBO Z , ZCR Z ,  ms ,  ms1 ,  ms2 ， ms3。
输出：ZA，XA，ZB，XB，ZC，XC，
星敏感器参与定姿标志FSTA，FSTB，FSTC，FSTD 。",0,1,0,0,0,0,0,0
"通讯串口
04H|波特率寄存器|RW|波特率寄存器低位：0x04（115200）
08H|波特率寄存器|RW|波特率寄存器高位：0x00

CAN总线初始化
寄存器名称|初始化内容|初始化意义
""CAN_ADDR        
(CAN总线地址)""|无。|无说明。
""控制寄存器
(Control Register)
""|0x03|""D7D6D5：保留。
D4：超载（接收设备不能按数据发送速率接收数据而造成的数据丢失）中断使能。
高：开放。低：禁止
D3：错误中断使能。
高：开放。低：禁止
D2：发送中断使能。
高：开放。低：禁止
D1：接收中断使能。
高：开放。低：禁止
D0：复位模式。
在初始化的时候，复位模式位置1，才可以进行初始化设置。""
命令寄存器(Command register)|0x=00001100|""D7D6D5：保留。必须。
D4：进入睡眠状态。
高：睡眠 。低：睡眠唤醒。
D3：清除超载状态。不产生超载中断。
高：清除。低：无动作。
D2：释放接收缓冲器。（读接收缓存器内容后，释放缓存器，以便其他报文立即可用）。
高：释放。低：无动作。
D1：夭折发送。
D0：发送请求。
高：报文即将发送。低：无动作。""
""验收代码寄存器
(Acceptance 
Code Register)""|0x87= 10000111|""当通过验收测试的报文被接收，且若存在空的接收缓存器，则各自的描述符和数据场被顺序存贮在空的缓存器中，在不存在空的接收缓存器的情况下，数据超载位被置位高(超载)，当完整的报文被正确接收，将出现下列操作：
接收缓存器状态位被置为高(满)
若接收中断开放位被置为高(开放)，接收中断被置为高(置位)
验收码位(AC.7~AC.0)和报文标识符的最高8位(ID.10~ID.3)必须等于由验收屏蔽位必须满足""
""验收屏蔽寄存器
((Acceptance 
Mask Register))""|0xf8|最后三位相关。
总线时序寄存器0(Bus Timing Register 0)|0x00|""总线时序寄存器的内容决定波特率预分频器(BRP)和同步跳转宽度(SJW)的数值。

通过总线定时器的内容，将波特率预分频器设置为2，即将输入的系统时钟二分频，由于输入的系统时钟已经是将计算机晶体频率14.7456MHz二分频，即7.3728MHz。所以这个时候时钟为3.6864 MHz。""
总线时序寄存器1(Bus Timing Register 1)|0x18|""采样（SAM）=1总线采样1次。
TSEG1和TSEG2确定每位周期的时钟周期数目和采样点位置：

由于一位周期是由

而

波特率＝""
""时钟分频器
(Clock Divider
register)""|0x40|""D7:CAN模式。
0：基本模式。
D5:1(旁路输入比较器，仅在复位模式下起作用)。""
""OCR
(output Control)""|0x|

在完成上述初始化后，要再次初始化控制寄存器。将最低位初始化为0。
说明：地址表上“CAN总线地址”实际是一个写信号的地址，完成对CAN总线控制芯片的选择。因为CAN总线控制芯片的分时复用地址/数据总线（AD7~AD0）实际是和的数据线(D0~D7)接在一起的，该分时复用地址实际是选择控制寄存器用的。这样对于端口寄存器的选择，必须通过数据的写入来完成。对“CAN总线地址”的写入，起到选通CAN控制芯片的作用，而写入的内容，就是对端口寄存器的选择。",1,0,0,0,0,0,0,0
功能描述：启动动量轮至标称角动量，并保持。,0,1,0,0,0,0,0,0
"功能描述：根据太阳矢量在帆板1法平面内投影与帆板法线之间的夹角，通过帆板驱动机构1控制帆板1，使帆板1能捕获及跟踪太阳。
",0,1,0,0,0,0,0,0
功能描述：轨控模式时使用轨控发动机及其备份。,0,1,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的结构滤波器系数
处理：
调整各系数的初装值。",0,0,0,0,0,0,1,0
"控制计算机有实时遥测数据和延时遥测数据。包括下表的功能点。
序号|功能描述|功能编号
|发送姿态数据包|FREQ7.3.1
|发送敏感器数据包1|FREQ7.3.2
|发送敏感器数据包2|FREQ7.3.3
|发送红外太阳修正数据包|FREQ7.3.4
|发送敏感器修正数据包|FREQ7.3.5
|发送姿态控制数据包|FREQ7.3.6
|发送轨道数据包|FREQ7.3.7
|发送天线数据包|FREQ7.3.8
|发送部件工作状态数据包|FREQ7.3.9
|发送星敏感器自检数据包|FREQ7.3.10
|发送系统工作状态包|FREQ7.3.11
|发送全姿态捕获模式状态数据包|FREQ7.3.12
|发送控制模拟量遥测数据包1|FREQ7.3.13
|发送控制模拟量遥测数据包2|FREQ7.3.14
|发送控制分系统延时遥测数据包|FREQ7.3.15

具体的内容及遥测模式切换的原则详见遥测文件。",0,0,0,0,0,0,0,1
"功能描述：根据陀螺输入预估卫星对地姿态。
",0,0,0,1,0,0,0,0
"功能描述：接收AOCC重要数据
处理：将接收AOCC重要数据地址中内容解包成重要数据的数据格式。
在AOCC上电/复位或者切机时，AOCC通过方式代码的服务申请，请求OBDH发送星上时间和AOCC重要数据。若连续三个控制周期申请AOCC重要数据失败（重要数据第一块的第一个字不是A090H或者校验和错误或者未收到重要数据），则应用软件按照重要数据的初始值运行。",0,0,0,0,0,0,1,0
"功能描述：动量轮摩擦力矩的补偿电压计算。
",0,1,0,0,0,0,0,0
"功能描述：根据框架角偏差计算指令转速。
处理：主要处理过程如下：
当接收到由OBDH发送来的中继快扫到位指令,进入天线预置状态，令FAFP=1，预置的目标角为命令块中的-10对应时刻通过轨道计算得到的天线框架角。控制中继天线转动快扫到达目标位置。当时间大于-10后，退出预置状态令FAFP=0。
当接收到由OBDH发送来的中继复位指令,进入天线复位状态，令FARP=1。根据命令块中数据标志来确定天线要复位的位置。如果标志为55H，天线复位到命令块中指定的角度位置；如果标志为FFH，则天线复位到零位。
当地面上行注入ZT40（1）=1时，天线进入螺旋扫描状态。按照特定的步长控制天线转动，当螺旋扫描持续的时间超过注入的天线捕获扫描时间时，将ZT40(1) 置0退出螺旋扫描状态。
当接收到由OBDH发送来的中继程序跟踪停止指令，停止向中继捕获跟踪控制单元发送控制信息，并设定标志传到遥测。其余情况下天线处于程序跟踪状态。
卫星增加了侧摆中继时传的工作模式，快摆时工作时序见任务书.5。",0,1,0,0,0,0,0,0
功能描述：根据给定电压乘电压/力矩系数和角动量变化率之差判断轮子的故障。,0,1,0,0,0,0,0,0
"功能描述：输出磁力矩器控制电源。
处理：
功能编号|功能|引用文档
FREQ110|初始化|任务书
FREQ111|磁力矩器使用要求|任务书
FREQ112|通信(DA)|任务书
FREQ113|通信故障处理|预留
FREQ114|数据解包与转换|预留
FREQ115|磁力矩器数据有效性处理|预留
FREQ116|磁力矩器硬件采集、处理|任务书
FREQ117|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"功能描述：利用B，C头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.9
STEP1：计算，将下标A换成C；FM3更改：若，则：，FSTD=1；
STEP2：计算，的各项乘以，的各项乘以。将下标A换成C；
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,1,0,0,0,0,0,0
功能描述：CMG启动模式控制,0,1,0,0,0,0,0,0
"功能：利用星敏感器B 、C的测量，修正姿态四元数与估计角速度。
",0,1,0,0,0,0,0,0
功能描述：利用星敏感器A、C的测量，修正姿态四元数与估计陀螺漂移。,0,1,0,0,0,0,0,0
功能描述：在CMG控制过程中判断CMG是否饱和而需喷气卸载；在喷气卸载过程中判断CMG是否卸载完毕。,0,1,0,0,0,0,0,0
功能描述：利用星敏感器A、B的测量，估计姿态。,0,1,0,0,0,0,0,0
"功能：在不使用陀螺数据时，对姿态角、角速度与姿态四元数预估。
",0,1,0,0,0,0,0,0
"功能描述：选择通讯的帆板LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）帆板共有四个LTU，各有两个互为备份的LTU，通过每个LTU均可获得对应的帆板转角和零位信息；每个控制周期根据BAPTALTUSeltFlag确定进行通讯的帆板LTU，发送取数指令，具体如下表所示：
BAPTALTUSeltFlag|进行通讯的帆板LTU|发送的取数指令
01H|帆板LTU1、2的主份|B3H
02H|帆板LTU1的备份、帆板LTU2的主份|B3H
03H|帆板LTU1的主份、帆板LTU2的备份|B3H
04H|帆板LTU1的备份、帆板LTU2的备份|B3H
其它|根据LTU故障诊断的结果决定帆板LTU的选取。初始状态为帆板LTU1|B3H

（2）向帆板LTU发完取数命令后，获得LTU返回数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式。在控制周期任务后根据帆板控制算法算出需要发送的帆板控制指令。AOCC发送的帆板控制指令包括：定角保持命令、帆板正向捕获命令、帆板正向跟踪命令、帆板反向捕获命令、帆板反向跟踪命令、角度保持命令和帆板归零命令。为了提高太阳帆板驱动机构的驱动稳定度，帆板驱动机构控制增加了步进电机相电流修正方法，控制计算机应用软件需要根据注入文件标志LBaptaCurCtrlMode和RBaptaCurCtrlMode的要求在相关控制指令中指定使用所要求的修正表格。具体参见LTU通讯协议件。
（3）帆板LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
功能描述：GPS定轨程序。,0,0,0,0,1,0,0,0
"功能编号|功能|引用文档
FREQ86|初始化|预留
FREQ87|模太使用要求|任务书
FREQ88|通信(AD)|任务书
FREQ89|通信故障处理|预留
FREQ90|数据解包与转换|任务书
FREQ91|模太硬件故障处理|预留
FREQ92|模太数据有效性处理|任务书
FREQ93|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"功能描述：运行段喷气姿态控制及飞轮控联合运行。
处理：同用户需求的
（1）各轴喷气参数设置如表35所示
表35：运行段喷气姿态控制各轴喷气参数设置
|滚动|俯仰|偏航
|2.0|2.0|2.0
|1.0 mθD11（注1）|1.0 mθD11（注1）|1.0 mθD11（注1）
|1.0 mθD11（注2）|1.0 mθD11（注2）|1.0 mθD11（注2）
|4.5（注4）|4.5（注4）|4.5（注4）
|3.0 mθB31|3.0 mθB31|3.0 mθB31
|0.14|0.2|0.1
|0.2（注3注4）|0.2（注3注4）|0.2（注3注4）
|（注3-1）|（注3-1）|（注3-1）
|0.03|0.03|0.03
|0.08|0.08|0.08
|0.43（注3注4）|0.43（注3注4）|0.43（注3注4）
|（注3-1）|（注3-1）|（注3-1）
|0.2（注1）|0.2（注1）|0.2（注1）
|0.06（注2）|0.06（注2）|0.06（注2）
KJ2(s)|3|3|3
KJ2(s)|0.5（注3-1）|0.5（注3-1）|0.5（注3-1）
aJS（/s2）|0.137|0.235|0.089

注1：在FHU = A或 { BZ1 = 4，FEA = 0 }的条件下
注2：在FHU = A，ZT3 = F或A或B的条件下
注3：在{ BZ1=8且FRTS=1}的条件下
注3-1：在{ BZ1 = 3，ZT36 = F }的条件下
注4：在ZT40(2)=1,BZ1=1,ZT8≤3,ZT2≤2,FWH≠22的条件下
（2）进行各轴平面喷气控制规律计算（同用户需求的）
（3）根据姿轨控喷气规律计算结果，发出相应的喷气指令（同用户需求的）",0,1,0,0,0,0,0,0
"功能描述：置卫星姿态无控处于自由飞行
处理过程：过程如下：
STEP1：进行姿态预估（见用户需求），得到姿态角和角速度
STEP2：当ZT7为0、7、3、5时，发相应的帆板控制指令：
ZT7取值|处理
ZT7 = 0|发左右帆板转角均为0度的指令
ZT7 = 7|发左右帆板转角均为180度的指令
ZT7 = 3|发左为90度，右为 -90指令
ZT7 = 5|发左右均为90度指令

STEP3：关自锁阀LV-1，LV-2，LV-3，LV-4，关推力器J1，J2，… ，J16。
STEP4：如果ZT7 ≥ 8，则每隔5分钟根据LS（包括LS11、LS12、LS13、LS14、LS15、LS21、LS22、LS23、LS24、LS25）取值发相应的指令一次
LS取值|处理
L15 = 1|发左右帆板转角为0度指令
L25 = 1|发左右帆板转角为180度指令
""L15 + L25 = 0且
L11 + L21 = 1""|发左帆板转角为 -90度指令；右帆板为90度指令
""L15 + L25 = 0且
L13 + L23 = 1""|发左帆板转角为 90度指令；右帆板为-90度指令

STEP5：置六个动量轮的电压为0",0,1,0,0,0,0,0,0
功能描述：计算磁卸载所需的磁矩与磁力矩器工作电压,0,1,0,0,0,0,0,0
"功能：利用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器A修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|红外1数据的采集与处理|FREQ1.3.1|""红外1
1553B取数指""|红外1的弦宽和前基|在通讯允许的条件下（红外1的当班标志为1），每1秒向红外1RT发取数指令，获得红外1数据并处理成对应的弦宽和前基。CCU应用软件取数消息与同步消息的发送时间间隔大于3ms
|红外2数据的采集与处理|FREQ1.3.2|""红外2
LTU取数指令""|红外2的数据|在通讯允许的条件下（红外2的当班标志为1），向红外2 LTU发取数指令，获得红外2数据并处理成对应的数据。
",0,0,0,0,0,1,0,0
"功能描述：完成整星绕滚动轴的姿态侧摆角保持功能
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
条件|FRTS的取值
ZT35(2) = 1且|1
其余情况|0

STEP2：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP3：进行运行段姿态确定，具体过程如下：
进行红外数据采集及处理和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP4：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3且ZT9  3且ZT时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
当ZT40(4) = 1时，进行数传天线捕获跟踪控制
STEP5：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
"功能描述：发送姿态数据
处理：
AOCC每个控制周期（250ms）组织24个字节姿态数据，OBDH每500ms取1次姿态数据（48个字节）。每个数据包中的2个姿态的时标需按照时间顺序排列。",0,0,0,0,0,0,0,1
"功能描述：接收遥控固定参数注入块的执行机构参数设定及诊断参数
处理：
调整CMG高速角动量与标称值偏差阀值系数的初装值。",0,0,0,0,0,0,1,0
功能：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。,0,0,0,0,1,0,0,0
光行差修正的初始设置为：AOCC应用软件对APS星敏信息进行补偿计算，不向星敏发送相对J2000的时间和速度。,0,0,0,0,0,1,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
功能编号|功能|引用文档
FREQ44|初始化|陀螺协议
FREQ45|陀螺使用要求|任务书
FREQ46|通信|陀螺协议
FREQ47|通信故障处理|任务书
FREQ48|数据解包与转换|陀螺协议
FREQ49|陀螺数据有效性判断、处理|任务书
FREQ50|陀螺模拟量采集、处理|任务书
FREQ51|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"功能描述：使用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：收到动量轮开数据指令或自主开动量轮。
处理：
收到动量轮开数据指令或自主开动量轮时，
按《卫星控制分系统注入参数及数据指令的用户需求》中动量轮引入状态，在相邻的4个周期依次使引入状态的动量轮加电；动量轮故障诊断自主关动量轮时，关闭动量轮一次电源。",0,0,1,0,0,0,0,0
"功能描述：发送AOCC指定内存内容
处理： 
（1）接收内存读出的地址和长度
（2）将对应地址和长度的内存数据放入发送内存读出数据的存储空间内
    AOCC应用软件应对内存下卸的地址区域进行保护：当内存下卸指令中的首地址、末地址均在PROM硬件地址范围、RAM硬件地址范围、1553B总线接口芯片的RAM地址范围内，则应用软件按照内存下卸指令的要求下卸目标区域的数据；若内存下卸指令中的地址超出上述3个区域的地址范围，则应用软件不更新1553B总线接口芯片中内存下卸内容子地址中对应数据。",0,0,0,0,1,0,0,0
"功能描述：选择通讯的红外LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）AOCC每两个0.524秒根据加断电控制字IR_PWR（设置原则见任务书的附录D），向加电的红外LTU发送取数命令（向红外LTU1发送13H，向红外LTU2发送23H），获得每个红外LTU返回的5个字节数据。
（2）将数据根据LTU通讯协议转换成（红外1的前沿到基准）、（红外2的前沿到基准），（红外1的前沿到后沿）、（红外2的前沿到后沿）。
（3）AOCC每两个0.524秒同时向两个红外LTU发自检命令，根据返回的自检信息确定红外1、2有无信号标志HL（1为有效，0为无效）和HR（1为有效，0为无效）。
（4）每31个0.524秒控制周期（约16秒），根据ZT31向红外LTU1和LTU2发送切换方案命令
ZT31(1)＝1，红外H1用主份；ZT31(1)＝0，红外H1用备份
ZT31(2)＝1，红外H2用主份；ZT31(2)＝0，红外H2用备份
ZT31(3)＝1，ZT31(4)＝0，ZT5＝1，红外H1加电
ZT31(3)＝0，ZT31(4)＝1，ZT5＝2，红外H2加电
其余情况下，红外H1、H2都加电
红外LTU数据采集过程中的故障处理见本文的5.2.9.3。",0,0,0,0,0,1,0,0
功能描述：由GPS得到轨道外推的16根数。,0,1,0,0,0,0,0,0
"功能描述：根据陀螺输入，予估卫星对地姿态。

处理：
STEP1:计算；
STEP2:计算，区分工作模式BZ1=1（三轴稳定正常轨道运行姿态）或8（侧摆机动）或9（侧摆角保持），BZ1≠1和8和9两种情况；
STEP3:计算；
STEP4:若BZ1=1（三轴稳定正常轨道运行姿态）或2（偏航机动并稳定运行）或6（轨控期间），；
STEP5:若BZ1=1（三轴稳定正常轨道运行姿态），则；
STEP6:若BZ1=8（侧摆机动），则，；
STEP7:若BZ1=9（侧摆角保持），则，；
STEP8:若BZ1=B（入轨段控制模式）且(消初偏结束时刻)。",0,1,0,0,0,0,0,0
"功能描述：红外数据处理
",0,0,0,0,1,0,0,0
"功能描述：
 太阳捕获功能主要实现速率阻尼、俯仰搜索、滚动搜索、巡航等功能，使卫星由任意姿态进入保持对日定向巡航姿态运行。太阳捕获功能分为速率阻尼、俯仰搜索、滚动搜索和巡航四种方式（FReq-6）。
                        表5-2 方式字定义
名称|方式字定义|说明
RDSM|0|速率阻尼方式.(默认方式，程控结束后进入)
PASM|1|俯仰搜索方式
RASM|2|滚动搜索方式
CSM|3|巡航运行方式

处理： 
  （1） 模块初始化设置
   程序结束后，根据任务书5.4.5.3.1节进行模块初始化设置。考虑到地面遥控指令可以重新进入太阳捕获模式（速率阻尼初始化置陀螺故障诊断不允许），软件对模块初始化中的变量分为2个部分，其中以下部分为程控结束后只设置一次的变量：   
推力器输出状态清零；
CleNum = 0;  
采用MRE板数据设置陀螺顶替标志；（考虑S陀螺健康时才进行相应顶替）。
若有飞轮的电源状态为开，则允许飞轮进行转速控制WheelCon＝TRUE；
部分软件自身使用的变量。
（2）在太阳捕获中需要进行动量轮刹车控制以及方式控制：
动量轮刹车控制详见5.2.17节。（有动量轮加电，则进行动量轮刹车控制。）
（3）方式控制如下：
(I) 对卫星进行速率阻尼，连续35个控制周期三轴角速度绝对值（实际取最大值即可）小于0.14°/s，进入俯仰搜索方式；或者进入速率阻尼方式的时间超过2000个控制周期（256秒）后，进入俯仰搜索，开始搜索太阳。
(II)进入俯仰搜索方式，使卫星以+/-0.5/s（速率阻尼结束后进入时根据SPz13选择极性)绕Y轴转动，若5625个控制周期（720秒）后没有捕获到太阳，进入滚动搜索方式。进入滚动搜索方式后，使卫星以0.5°/s绕X轴转动。
(III) 若(II)中滚动搜索方式经过6250个控制周期（800秒）后还未见到太阳则再重复俯仰搜索和滚动搜索，则再次进入（II），即俯仰捕获方式（这种情况下b＝-0.5/s）。其中滚动搜索不成功的故障处理逻辑见5.2.14节。
(IV) 在(II)(III)过程中一旦捕获到太阳且持续时间大于2.048秒(16个控制周期)，则进入巡航方式。进入巡航模式后，控制SADA归零。
说明：捕获太阳时，对于持续时间大于2.048秒的判断，太阳连续可见（SP61/62 = 1）的条件下，俯仰搜索时，俯仰角绝对值大于1°的累计时间；滚动搜索时，滚动角绝对值大于1°的累计时间。",0,1,0,0,0,0,0,0
"功能描述：
卫星异常情况进入停控模式的处理（功能编号：FReq-17）。
处理：
软件设置停控方式字（为三取二变量，可与太阳捕获方式共用），当判断为停控方式时，停止模式判断和处理，停止控制器计算，停止故障判断和处理，将5N推力器输出和开关脉冲输出口清零；
一旦软件进入停控方式，将无法自主恢复太阳捕获的控制方式。此时，如果想恢复正常控制，在确认部件工作状态后，地面遥控操作；
速率阻尼后，三轴中任意一轴角速度持续625个控制周期（80s）大于2.0°/s，转入停控方式，其中任意一轴角速度大于2.0°/s，实现为三轴角度绝对值的最大值大于2.0°/s； ",0,1,0,0,0,0,0,0
