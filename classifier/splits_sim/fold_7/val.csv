Requirements Description,初始化,控制计算,控制输出,故障诊断和处理,数据有效性判断,数据采集,遥控,遥测
"功能描述：发动机关机中断信号处理                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：
应用软件处理发动机关机中断信号，信号源为3路伽玛关机信号，应用软件查到关机后，立触地关机标志有效，发7500N关机指令。",0,0,1,0,0,0,0,0
"功能描述：将注入到SRAM中的程序搬家至相应EEPROM区
处理：
- 将解包得到的目的地址、注入长度、源地址分别赋给变量E2_StartAddress, E2_Length, SourceAddress；
- 调用系统软件提供的函数E2prom_Prog(unsigned int E2_StartAddress, unsigned int E2_Length, unsigned int SourceAddress)
说明：应用软件需要考虑跨页操作，地面保证发送“启动EEPROM修改”指令后，10ms内不对EEPROM进行操作。",0,0,0,0,0,0,1,0
功能描述：检测红外HL、HR 的故障，并选取正确的红外信号。,0,0,0,0,1,0,0,0
"功能描述：利用星敏感器B、C的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的功能。
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式控制|FREQ5.2.1|4.1|入轨段控制模式控制调用流程
|正常对地运行模式控制|FREQ5.2.2|4.2|正常对地运行模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|偏置飞行模式控制|FREQ5.2.5|4.4|偏置飞行模式控制调用流程
|轨控模式控制|FREQ5.2.8|4.5|轨控模式控制调用流程
|全姿态捕获模式控制|FREQ5.2.9|4.10|全姿态捕获模式控制调用流程
|无控模式控制|FREQ5.2.10|4.11|无控模式控制调用流程
|陀螺标定模式控制|FREQ5.2.11|4.8|陀螺标定模式控制调用流程
|惯性定向模式控制|FREQ5.2.12|4.6|惯性定向模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|入轨段控制模式初始化|FREQ5.3.1|4.1|入轨段控制模式初始化设置
|正常对地运行模式初始化|FREQ5.3.2|4.2|正常对地运行模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|偏置飞行模式初始化|FREQ5.3.5|4.4|偏置飞行模式初始化设置
|轨控模式初始化|FREQ5.3.8|4.5|轨控模式初始化设置
|全姿态捕获模式初始化|FREQ5.3.9|4.10|全姿态捕获模式初始化设置
|无控模式初始化|FREQ5.3.10|4.11|无控模式初始化设置
|陀螺标定模式初始化|FREQ5.3.11|4.8|陀螺标定模式初始化设置
|惯性定向模式初始化|FREQ5.3.12|4.6|惯性定向模式初始化设置

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制及部件有效性和故障诊断以及模式初始化的内容具体见用户需求的4。",0,1,0,0,0,0,0,0
"功能描述：选择通讯的陀螺LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
处理：
（1）陀螺共有三个互为备份的LTU，通过每个LTU均可获得12个陀螺的数据；每个控制周期AOCC向陀螺LTU发送取数命令来获得数据， AOCC根据GROLTUSeltFlag来确定和哪个LTU进行通讯。具体如下表所示： 
GROLTUSeltFlag|进行通讯的陀螺LTU
01H|陀螺LTU1
02H|陀螺LTU2
03H|陀螺LTU3
其它|根据LTU故障诊断的结果决定陀螺LTU的选取。初始状态为陀螺LTU1

取数指令由三个字节组成：
第一个字节为对陀螺LTU的命令设置，有四种命令格式：取数指令1、取数指令2、复位指令、地检模式指令，应用软件只自主发取数指令1和取数指令2两种格式，并由注入控制方式指定及LTU通信选择块中的陀螺LTU取数方式来切换，默认为取数指令1；其余两种格式（复位指令和地检模式指令）通过地面注入LTU命令块来设置。
第二个字节为对光纤陀螺的命令设置，有四种命令格式：测量模式1（有温度补偿）、测量模式2（无温度补偿）、地检模式1（只传地面数据）、地地检模式2（地面数据+头部测量数据），由注入控制方式指定及LTU通信选择块中的光纤陀螺指令切换方式字来切换这四种格式，默认为测量模式1（有温度补偿）。
第三个字节为前两个字节的累加和。
另外，每个控制周期AOCC还向选取的陀螺LTU发送取陀螺状态指令，指令为3字节指令（D5、AA、7F），得到的状态信息用于遥测。
（2）向选择的陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式，具体参见LTU通讯协议。",0,0,0,0,0,1,0,0
"功能编号|功能|引用文档
FREQ86|初始化|预留
FREQ87|模太使用要求|任务书
FREQ88|通信(AD)|任务书
FREQ89|通信故障处理|预留
FREQ90|数据解包与转换|任务书
FREQ91|模太硬件故障处理|预留
FREQ92|模太数据有效性处理|任务书
FREQ93|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
功能描述：对星敏感器输出数据进行有效性判断。,0,1,0,0,0,0,0,0
"序|需求名称|编号|功能及处理描述
|液浮陀螺数据的采集与处理|FREQ2. 1|向选择的液浮陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式
|光纤陀螺数据的采集与处理|FREQ2.2|向选择的光纤陀螺LTU发送完取数指令，获得陀螺LTU返回的数据，将数据转换为控制计算所需的数据格式
",0,0,0,0,0,1,0,0
"功能描述：
  应急软件初始化功能在软件上电或复位时调用，完成应急软件相关变量的初始化工作和硬件初始化。
处理： 完成80C32E处理器初始化、软件变量初始化、ASIC芯片初始化、1553B初始化，初始化流程的前后顺序可适当调整。
（1）80C32E处理器初始化：
初始化项目|寄存器名|初始值|说明
中断使能寄存器|IE|0x00|关闭中断。
计时器控制寄存器|TCON|0x05|外部中断0、1触发方式设置为下降沿触发。
计时器模式寄存器|TMOD|0x61|定时器1工作模式为2：自动装入TL1计数（8位）;定时器0工作模式为1: 16位定时器
定时器1初值|""TH1
TL1""|""0x00
0x00""|计数器（定时器）1从0开始进行计数，计数到256时溢出，触发计数器1中断，从而得到128ms
中断优先级寄存器|IP|0x01|中断优先级设置:全帧遥测数据接口帧同步中断为高优先级, 其余低优先级
P1口|P1_4|1|选择主份TM
P1口|P1_0|1|清狗电平
内部RAM|0x00~0xFF|0x00|上电后将内部RAM初始化为0

（2）软件变量初始化
软件变量初始化时，先将32KB外部RAM初始化为0，之后将非零变量显示初始化。帆板初始状态为正向复位，部件状态为不加电，推力器采用A分支，部件故障诊断不允许。
（3）ASIC芯片初始化
按照任务书、以及硬件技术说明书对ASIC芯片进行初始化，主要涉及GPIO口、GC计数器、GT定时器，同步串口等。
（4）1553B初始化
详见5.2.9.1节 FReq-9。
初始化完成后，允许总中断、T1(128ms)定时器中断、外部中断0，并启动T1。",1,0,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的系统安全模式姿态控制器系数
处理：
调整安全模式偏航角偏差限幅的初装值。",0,0,0,0,0,0,1,0
"功能描述：喷气控制，要求将CMG控至标称角动量，保持这个标称角动量。
输入：地面注入的CMG引入标志[i]（0切除；1引入）；各CMG的框架角度Sgang[i]（弧度）；三轴角动量偏差、、（Nms）；CMG有效标志Lcmg[i]（1代表有效，0代表无效）",0,1,0,0,0,0,0,0
功能描述：接收GPS秒脉冲整秒时间,0,0,0,0,0,0,1,0
功能描述：无陀螺时用红外估计滚动、俯仰姿态角及角速度信息。,0,1,0,0,0,0,0,0
功能描述：计算地磁场矢量分量。,0,1,0,0,0,0,0,0
功能描述：根据位置速度计算轨道参数,0,1,0,0,0,0,0,0
"功能描述：CAN通信上行/下行数据的组帧和解包。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：星务接收、星务发送、快帧遥测1打包、快帧遥测2打包、快帧遥测3打包、快帧遥测4打包、快帧遥测5打包、姿态广播、星敏广播、陀螺广播、重要数据打包、上行:数据指令响应处理、上行:固定地址注入解包、上行:可变地址注入解包、上行:轨道注入解包、上行:程序注入、上行:内存下卸指令注入、上行:任务块、上行:地面站、重要数据返回解包、GPS定位广播解包、整星广播对时解包、GPS高精度秒脉冲对时广播解包、CAN总线使用要求",0,0,0,1,0,0,0,0
功能描述：计算CMG的框架角速度。                                                                                                                                                                                                                                                                                                                                                                                                                                                                           处理：修改奇异规避算法。,0,1,0,0,0,0,0,0
"功能描述：接收遥控固定参数注入块的相平面参数
处理：
调整推力角加速度修正因子初装值。",0,0,0,0,0,0,1,0
"功能描述：发送星敏陀螺数据
处理：将星敏陀螺数据打包后放到发送星敏陀螺数据存储地址中
AOCC每个控制周期（250ms）组织128个字节星敏陀螺数据，OBDH每500ms取1次星敏陀螺数据（256个字节）。其中前128字节数据对应小星时的星敏陀螺数据，后128字节数据对应大星时的星敏陀螺数据。",0,0,0,0,0,0,1,0
功能描述：确定陀螺数据转换矩阵A及B；计算漂移。,0,1,0,0,0,0,0,0
"功能描述：入轨后或太阳丢失后，搜索太阳并捕获太阳。
处理：
自主或指令转入该模式，进行如下设置。
根据自锁阀状态设置自锁阀1和/或自锁阀2开。
系统诊断出故障后进入该模式，100秒内不控，具体要求见用户需求。
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
if(CMGStartFlag=1) 调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺数据处理；
	调用惯性姿态陀螺预估；
调用星敏感器数据处理；
调用太阳捕获控制；
调用目标姿态确定；
调用控制器输入量计算；
喷气卸载条件计算
if(CMGStartFlag=1) 调用CMG奇异状态的判断及算法计算；
	if(CMGInControlFlag=1 且UnLoadMode=0)
{ 调用CMG的控制；
if(SSTCatchSuc＝1) 调用 磁卸载控制； }
else { if(CMGStartFlag=1) 调用 CMG启动与保持；
if(TimeStopC<=0且Flag_equation=0) 
{调用 相平面喷气脉宽； }
else {置喷气脉宽为0；SpeedControlTime=0；WacFlag=1；}
}
	调用 系统故障诊断；",0,1,0,0,0,0,0,0
"功能描述：卫星绕俯仰轴转动，直到满足姿态角条件，进入下一阶段偏航捕获。姿态确定由红外和陀螺。姿态控制是喷气控制
",0,1,0,0,0,0,0,0
"软件需求名称：1553通信上行/下行数据的组帧和处理。 
软件需求描述：1553通信上行/下行数据的组帧和处理。
调用条件：每个控制任务模式计算完成后；
输入：计算结果。
输出：按照协议组帧数据。
处理：主要完成下列数据组帧、解包功能：遥测组帧、遥控接收、遥测帧头打包、遥测数据打包、下行：重要数据组帧、上行：数据指令处理、任务成像指令、上行：模式转换指令处理、上行：软件标志字指令处理、上行：控制参数指令处理、上行：变轨和位保指令处理、上行：部件加断电指令处理、上行：校时指令处理、上行：轨道注入指令处理、上行：部件数据转发指令处理、在轨维护指令处理、内存下传指令、重要数据保存、重要数据恢复",0,0,0,0,0,0,0,1
"功能描述：置卫星姿态无控，处于自由飞行状态。
",0,1,0,0,0,0,0,0
"AppInit中星箭分离的查询
硬件初始化后，按5取3的方式查星箭分离状态位(对星箭分离状态位读5次，有连续3次或3次以上读入为“1”，则认为查到星箭已分离，每次读的时间间隔要求大于1ms)。
AppInit中星箭未分离的初始化
如果星箭未分离，对应用软件相关变量、硬件初始化。进入主动段工作模式。在主动段工作模式下，每个控制周期按5取3的方式查星箭分离状态位，如果连续3个周期内都查到星箭已分离，则可确认为星箭已分离。进入初始速率阻尼模式，并置星时0.375s。
AppInit中星箭已分离的初始化
对应用软件相关变量、硬件初始化，星时清0，进入复位模式。
在复位模式下，与星务分系统通讯，取回保存在星务分系统的重要数据，具体见《卫星姿轨控分系统AOCC与星务通讯协议》。如果取数成功，根据控制模式字进入初始化。若连续5秒从星务分系统取重要数据失败则认为申请失败。取重要数据不成功，设置工作模式为“太阳捕获模式”，星时为2100秒，发送CMG1~5“复位及高速断电”指令。ALTU当班状态根据前面章节的内容进行复位后设置；切除6个陀螺，发送“陀螺1~5开”指令，新加电陀螺等10分钟后引入，并置状态分为120，10分钟内系统不引入，不进行速率阻尼。",0,0,0,1,0,0,0,0
"功能描述：采集帆板归零信号，并处理成需要的数据格式。
处理：帆板归零的信号",0,0,0,0,0,1,0,0
功能描述：利用星敏感器数据进行卫星姿态捕获。,0,1,0,0,0,0,0,0
"功能：利用红外、数字太阳敏感器确定姿态。
",0,1,0,0,0,0,0,0
"功能描述：
 从1553B接收遥控指令数据，进行指令处理（FReq-7）。
处理：根据收到的遥控指令执行按照、ISUA、ISUC进行分类处理，实现指令的处理或者转发。
指令转发前，进行指令的校验，校验通过后，方可转发。指令子单元的分类标识全为立即指令。
指令校验的原则是：校验和、RT地址、RT子地址、指令总长度、注入指令单元的类型识别字、指令序号、注入指令子单元的子单元类型识别字、分类标识、长度均正确；
遥控指令包含三种类型，具体如下：
（1） 切换ISU-C模块指令
指令功能：用于向ISU-C发送切换模块指令。
类型标识字：C300H
指令码长度：216bit
指令码定义及说明：指令码高有效字在前，指令码低有效字在后。
ISU-C注入间接指令32位指令码定义
序号|指令名称|32位指令码
序号|指令名称|功能数据
序号|指令名称|D23～D0（16进制表示）
序号|指令名称|D11～D0
|SADP-A开|0X 000
|SADP-A关|0X 001
|SADP-B开|0X 002
|SADP-B关|0X 003
|MTP-A开|0X 004
|MTP-A关|0X 005
|MTP-B开|0X 006
|MTP-B关|0X 007
|MPSDP-A接A份电源|0X 008
|MPSDP-A接B份电源|0X 009
|MPSDP-B接A份电源|0X 00A
|MPSDP-B接B份电源|0X 00B
|MPSDP-A关|0X 00C
|MPSDP-B关|0X 00D
|LV1开|0X 00E
|LV1关|0X 00F
|LV2开|0X 010
|LV2关|0X 011
|ISU-A DC/DC1加电|0X 012
|ISU-A DC/DC1断电|0X 013
|ISU-A DC/DC2加电|0X 014
|ISU-A DC/DC2断电|0X 015
|ISU-A 主供电接DC/DC1备供电接DC/DC2|0X 016
|ISU-A 主供电接DC/DC2备供电接DC/DC1|0X 017
|ISU-A甲机复位|0X 018
|ISU-A乙机复位|0X 019

类别：01代表指令当量为16ms；10代表指令当量为64ms，MEO卫星指令类型全为01。
脉宽：指令实际脉冲宽度=（脉宽数值+1）*指令当量；
MEO卫星离散开关指令脉冲宽度默认为7（128ms）；指令宽度可随实际需要更改。
指令码高有效字对应上表D31~D16；指令码低有效字对应上表D15~D0。
（2） 切换控制部件指令
指令功能：用于向ISU-A发送切换控制部件指令。
类型标识字：C311H
指令码长度：116bit
指令码定义及说明：
定义
D7~D0
指令码

此指令专门用于CMU应用软件转发的开关控制分系统部件的时标指令。文中的8位指令码定义如下：
表4-8 ISU-A注入间接指令码列表
序号|指令名称|指令码
|地球敏感器A开|0x 50
|地球敏感器A关|0x 4F
|地球敏感器B开|0x 52
|地球敏感器B关|0x 51
|Z2陀螺开|0x 31
|Z2陀螺关|0x 32
|Z3陀螺开|0x 33
|Z3陀螺关|0x 34
|GX电源开|0x 35
|GX电源关|0x 36
|GY电源开|0x 37
|GY电源关|0x 38
|GZ电源开|0x 39
|GZ电源关|0x 3A
|GS电源开|0x 3B
|GS电源关|0x 3C
|反作用轮A开|0x 2E
|反作用轮A关|0x 2F
|反作用轮B开|0x 49
|反作用轮B关|0x 4A
|反作用轮C开|0x 4B
|反作用轮C关|0x 4C
|反作用轮D开|0x 4D
|反作用轮D关|0x 4E
|ISU-C 驱动线路主份电源开|0x 67
|ISU-C 驱动线路主份电源关|0x 68
|ISU-C 驱动线路备份电源开|0x 61
|ISU-C 驱动线路备份电源关|0x 62
|ISU-C CIP主份线路电源开|0x 65
|ISU-C CIP主份线路电源关|0x 66
|ISU-C CIP备份线路电源开|0x 63
|ISU-C CIP备份线路电源关|0x 64
|CMU SPE-A开|0x 57
|CMU SPE-A关|0x 58
|CMU SPE-B开|0x 59
|CMU SPE-B关|0x 5A

说明：此36条指令脉宽均为128ms，脉宽由ISUA保证。
（3） 控制模式转换指令
指令功能：此指令用于控制模式转换。
类型标识字：C322H
指令码长度：116
指令码定义及说明：
指令码|定义
方式字|定义
00H|捕获模式——速率阻尼方式
04H|停控模式

（4） 5N推力器健康状态设置指令
指令功能：设置5N推力器健康状态
类型标识字：C333H
指令码长度：216
指令码定义及说明：
推力器健康状态设置高16位D31~D16在前，
推力器健康状态设置低16位D15~D0在后。
D31~ D0定义如下：
D31|D30|D29|D28|D27|D26|D25|D24
0|0|0|0|0|0|0|0
D23|D22|D21|D20|D19|D18|D17|D16
0|0|JK-6A|JK-5A|JK-4A|JK-3A|JK-2A|JK-1A
D15|D14|D13|D12|D11|D10|D9|D8
0|0|0|0|0|0|0|0
D7|D6|D5|D4|D3|D2|D1|D0
0|0|JK-6B|JK-5B|JK-4B|JK-3B|JK-2B|JK-1B

注：健康标志位为0表示对应推力器健康，健康标志位为1表示对应推力器不健康。将推力器设置为健康，可以使其上线；将推力器设为不健康，可以使其离线。推力器上线后方可被开启，推力器离线后不能被开启。当接收到此指令时，须同时把上述信息以MPS配置信息的形式发送给ISU-C（通过DPRU转发）。
（5） 控制部件健康字设置指令
指令功能：更改部件健康字
类型标识字：C344H
指令码长度：216
指令码定义及说明： 设置状态在前，部件标识在后。
设置状态：取值为0x0000时设置为健康，取值为0x5A5A时设置为不健康；
部件名称及标识见下表分配值：特别当编号为0xFFFF时，表示选择下表所有部件。例如，当设置状态为0x0000，部件编号为0xFFFF时，设置下表所有部件健康。
序号|部件名称|标识|部件编号
1|X陀螺|GA-X|0x0101
2|Y陀螺|GA-Y|0x0202 
3|Z陀螺|GA-Z|0x0303 
4|S陀螺|GA-S|0x0404 
5|喷气控制线路主份|MPSDP-A|0x0707 
6|喷气控制线路备份|MPSDP-B|0x0808 

(6) 控制标志字设置指令
指令功能：设置部件或者控制标志字	
类型标识字：C355H
指令码长度：216
指令码定义及说明： 
标志字识别码在前，标志字指令内容在后。
更改的标志字的内容16位二进制码，具体内容定义：
序号|标志字识别码|指令内容定义|对应符号
标志字1|0x0101|""0：S陀螺顶替X陀螺；
1：S陀螺顶替Y陀螺；  
2：S陀螺顶替Z陀螺；
3：禁止顶替。""|
标志字2|0x0202|""0：A分支推力器工作；
1：B分支推力器工作；  
2：双分支推力器工作。""|
标志字3|0x0303|""0：不允许推力器故障判断；
A：允许推力器故障判断。""|
标志字4|0x0404|""0：不允许二浮陀螺故障判断；
A：允许二浮陀螺故障判断。""|
标志字5|0x0505|""0：设置推力器未发生切换；
A：设置推力器已发生切换。""|任务书中推力器故障诊断中的 flgSwitch
",0,0,0,1,0,0,0,0
"功能描述：接收对应秒脉冲的整秒时刻
处理： 将接收对应秒脉冲的整秒时刻存储地址中内容解包成对应秒脉冲的整秒时刻的数据格式。",0,0,0,0,0,0,1,0
"功能描述：采集动量轮的转速方向和脉冲计量，计算动量轮的角动量
处理：处理如下：
（1）读每路动量轮计算器的值，将读到的计数器的值减去上一个周期的计数器的值，得到差值；
（2）根据转换公式将脉冲数转换为角动量（动量轮角速度为1800r/min时的角动量为15Nms）。
（3）令（i = 1，2，… ，4）。为上一次轮子角动量值。",0,0,0,0,0,1,0,0
"功能：对日定向和对地定向的目标姿态确定。
",0,0,0,0,1,0,0,0
功能描述：对弦宽、基准与给定的范围进行比较，同时根据太阳星历输出进行见太阳判断，确定红外输出的有效性。,0,1,0,0,0,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|+Y帆板数据的采集与处理|FREQ1.6.1|""+Y帆板1553B取数指令（广播同步消息）
""|+Y帆板转角及状态信息|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
|-Y帆板数据的采集与处理|FREQ1.6.2|-Y帆板1553B取数指令|-Y帆板转角及状态信息|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
|+Y帆板控制指令的输出处理|FREQ1.6.3|""+Y帆板控制数据
""|+Y帆板控制指令消息输出|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
|-Y帆板控制指令的输出处理|FREQ1.6.4|""-Y帆板控制数据
""|-Y帆板控制指令消息输出|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
|帆板的程序注入修改|FREQ1.6.5|从OBDH收到的帆板需修改程序内容|帆板需修改程序内容|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
|帆板的内存下传|FREQ1.6.6|从OBDH收到的帆板内存下传设置指令|内存下传设置指令|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。
",0,0,0,0,0,1,0,0
"软件需求标识：FREQ4 
软件需求名称：星时计算 
软件需求描述：星时计算。见“任务书”4.1.3.1“星时计算”。",0,0,0,0,0,1,0,0
"功能描述：滚动/俯仰姿态机动目标姿态确定的初始化。根据目标角和星体机动前姿态求出欧拉角，以及轨迹的加速、匀速和减速等特征时间点。
",0,1,0,0,0,0,0,0
功能描述：对弦宽、基准与给定的范围进行比较，确定红外故障。若两红外数据均有效，则还可根据本周期与上周期红外姿态角确定红外故障。,0,1,0,0,0,0,0,0
"功能描述：根据地面指令ZT3,ZT42,ZT43，给无故障陀螺自主加电。
处理：同用户需求的。
（1）可以进行陀螺自主加电的条件：①或②
①{6个陀螺中至多只有1个有故障，即姿控数据块中ZT42的低4位和ZT43的低2位中至多只有1位等于1}且{加电陀螺不足5个，即姿控数据块中ZT15的低4位和ZT16的低2位中至多只有4位等于1}；
②{ZT3=A，即“星敏无陀螺定姿，且接入控制回路，整星零动量控制方式”或ZT3=B或ZT3=F}且{6个陀螺中至少有3个正常，即姿控数据块中ZT42的低4位和ZT43的低2位中至少有3位等于1}。
（2）陀螺自主加电的步骤：
STEP1:若满足条件(1)②，则根据ZT42,ZT43按陀螺1至6的升序开启3个正常陀螺，设置ZT15,ZT16相应位为1，并设置BZ3=ZT15，BZ4=ZT16；否则若满足(1)①，则{若ZT42,ZT43显示6个陀螺都正常，则开陀螺12356；否则根据ZT42,ZT43开启5个正常的陀螺}，设置ZT15,ZT16相应位为1。
STEP2:加电后设置陀螺正在加电标志FlagGyroAdd=1（正在加电）。令工作陀螺计分为0FH。",0,1,0,0,0,0,0,0
"软件需求名称：太阳敏感器使用及通信 
需求类别：其他 
软件需求描述：与数字太阳通信，发送取数指令，获得部件数据。
处理：
在OBC每个控制周期中可能会通过串口向数太发送控制指令或者接收下传数据，见任务书时序图。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
太敏初始化|FREQ41|太敏初始化|B|2
太敏数据采集|FREQ42|太敏数据采集|A|3
数据解包与转换|FREQ43|数据解包与转换|A|4
太敏数据有效性判断|FREQ44|太敏数据有效性判断|A|5
太敏故障重构|FREQ45|太敏故障重构|C|
",0,0,0,0,0,1,0,0
"应用软件共分21个工作模式，分别是等待段、太阳定向、恒星定向2、惯性调姿、恒星定向4、轨控定向、着陆准备、主减速、快速调整、接近下降、悬停、避障、缓速下降、自主定位、起飞准备、垂直上升、上升调姿、轨道入射、星光环月、速率阻尼和无控。模式字和各模式的对应关系如下：
表5.2.4.4-1 工作模式
模式字|工作模式|使用场合
0|等待段|""加电之后，判出分离27s之前，
或复位之后，重要数据恢复之前。""
1|太阳定向|""组合体地月转移巡航和环月阶段正常运行状态；
上升器远程引导巡航""
2|恒星定向2|变轨建立点火姿态前
3|惯性调姿|变轨建立点火姿态
4|恒星定向4|变轨建立点火姿态后
5|轨控定向|""动力下降之前的轨控
月面上升之后的轨控""
6|着陆准备|建立着陆点火姿态
7|主减速|动力下降
8|快速调整|动力下降
9|接近下降|动力下降
10|悬停|动力下降
11|避障|动力下降
12|缓速下降|动力下降
13|自主定位|月面工作阶段
14|起飞准备|建立月面起飞初始状态
15|垂直上升|月面上升
16|上升调姿|月面上升
17|轨道入射|月面上升
18|星光环月|月球轨道交会对接自主段
19|速率阻尼|轨控姿态超差
20|无控|动力下降着陆、交会对接段轨道器最后逼近、故障
",0,1,0,0,0,0,0,0
功能描述：对工作的飞轮进行电压补偿，并输出控制电压。,0,1,0,0,0,0,0,0
"功能描述：使用红外、星敏、太阳定姿时，计算正常飞行轮控所需电压。
",0,1,0,0,0,0,0,0
"软件需求名称：遥测打包 
需求类别：其他 
软件需求描述：打包内容见“遥测”。",0,0,0,0,0,0,0,1
功能描述：接收遥控固定参数注入块的红外太阳姿态滤波参数,0,0,0,0,0,0,1,0
"功能：利用星敏感器B、C的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
"功能描述：二次电源切换。
处理：
ACU内部含有两套二次电源，两套互为备份，可以同时加电工作，通常仅一份工作。AOCC每个控制周期采集工作电源的状态模拟量，并设置当班状态（5V和12V遥测模拟量≥3V即当班，若同时符合条件则置主份当班），若连续4个控制周期两套电源均不当班，且允许自主切换，则连续两个控制周期先后发送主份电源开、备份电源关两条指令，并置主份当班。
若当班电源的5V或12V遥测模拟量连续5个控制周期<3V时，且允许自主切换，则连续两个控制周期先后发送另一份电源开、本电源关两条指令，并禁止自主切换；若禁止自主切换，则设置切机命令字。
上电/复位初始化为允许自主切换，当班标志为保持。",0,0,0,1,0,0,0,0
"功能描述：部件加电标志。与光纤陀螺通信功能。
处理：
见陀螺通信协议、任务书。
功能编号|功能|引用文档
FREQ49|初始化|陀螺协议
FREQ50|陀螺使用要求|任务书
FREQ51|通信|陀螺协议
FREQ52|通信故障处理|任务书
FREQ53|数据解包与转换|陀螺协议
FREQ54|陀螺数据有效性判断、处理|任务书
FREQ55|陀螺模拟量采集、处理|任务书
FREQ56|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
"功能描述：判断陀螺的使用范围。
",0,1,0,0,0,0,0,0
在载荷成像时，OBDH向AOCC索要辅助数据，包括姿态数据、陀螺数据、星敏感器数据，索要辅助数据的频率为1s。AOCC只有在辅助数据发出后，将辅助数据内容更新。,0,0,0,0,0,0,0,1
"功能描述：光纤陀螺数据处理
",0,0,0,0,0,1,0,0
"功能描述：使用星敏感器A的测量，修正姿态四元数与估计陀螺漂移。
",0,1,0,0,0,0,0,0
"功能描述：卫星正常运行模式之一，完成三周对地指向，包含辐射定标方式。
处理：控制分系统按照地面规划的指令在轨道A、B、C、D四个点进行姿态机动来完成日地、地日、地地之间的姿态转换。辐射标定模式下的姿态固定，由数据指令控制进入标定模式。
在该模式下，控制系统根据数据块指令提供的开始和结束时间，开始、停止对指定天线控制角度进行计算，并0.5秒向天线发送一次控制指令。
正常模式初始化需向引入的星敏发送TC_RATE_LIMIT指令，将星敏工作的最大转速设置为固定地址注入的ratelimitnormal值（高精度状态）。
每个控制周期顺序调用用户需求中的逻辑：
调用轨道与星历；
调用CMG数据采集及处理；
调用部件故障检测与信号选取；
调用陀螺的数据处理；
调用四元数陀螺预估；
调用星敏感器数据处理；
if(MoveSTSInSystemFlag=2且SSTCatchSuc＝0) 调用 星敏感器对日定向 的a项；
调用利用星敏感器的姿态确定；
调用中继天线捕获跟踪控制；
调用对地数传天线捕获跟踪控制；
调用目标姿态确定；
调用控制器输入量计算；
调用喷气卸载条件计算；
调用CMG奇异状态的判断及算法计算；
if((UnLoadMode =0  或 TimeStopC > 0.0) 
{调用CMG的控制；调用磁卸载控制；}
else {if(Flag_equation=0且TimeStopC<=0)调用相平面喷气脉宽；
调用CMG启动与保持；}
调用系统故障诊断；",0,1,0,0,0,0,0,0
"功能描述：利用太阳敏感器信息，进行太阳捕获，对太阳定向
",0,1,0,0,0,0,0,0
功能描述：星上实时计算中继星的轨道。,0,1,0,0,0,0,0,0
功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。,0,1,0,0,0,0,0,0
"功能描述：使用星敏感器B的测量，修正姿态四元数与姿态角速度。
",0,1,0,0,0,0,0,0
功能描述：使用GPS通道版数据进行GPS定轨。,0,1,0,0,0,0,0,0
功能描述：根据陀螺输入，预估卫星惯性姿态四元数。,0,1,0,0,0,0,0,0
"软件需求名称：接收广播 
需求类别：其他 
软件需求描述：接收并处理广播指令。",0,0,0,0,0,0,1,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器1
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器1的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器2
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器2的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器3
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器3的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,1,0,0
功能描述：由平衡方程方法、星敏感器数据、红外/太阳数据，以及动力学输出对陀螺进行故障检测。,0,1,0,0,0,0,0,0
"软件需求名称：星敏感器使用及通信 
需求类别：其他 
软件需求描述：与星敏感器通信，获得星敏感器数据。
处理：
见星敏通信协议、任务书附录1时序。 
表格工作项|软件需求名称|软件需求标识|软件需求描述|1
星敏初始化|FREQ34|星敏初始化|B|2
星敏数据采集|FREQ35|星敏数据采集|A|3
数据解包与转换|FREQ36|数据解包与转换|A|4
星敏数据有效性判断|FREQ37|星敏数据有效性判断|A|5
星敏数据曝光时刻计算|FREQ38|星敏数据曝光时刻计算|A|6
星敏数据有效性判断、处理|FREQ39|星敏数据有效性判断、处理|A|7
星敏故障重构|FREQ40|星敏故障重构|C|
",0,0,0,0,0,1,0,0
"功能描述：与地检通信，获得地检数据。
处理：
功能编号|功能|引用文档
FREQ78|初始化|小卫星统一化平台中心控制单元通讯协议：地检协议
FREQ79|地检使用要求|任务书、地检协议
FREQ80|通信(串口)|任务书、地检协议
FREQ81|通信故障处理|任务书
FREQ82|数据解包与转换|地检协议
FREQ83|地检数据有效性判断、处理|任务书
FREQ84|地检模拟量采集、处理|预留
FREQ85|部件在轨转发（在轨修改）|预留
",0,0,0,0,0,1,0,0
功能描述：标称角动量、安装、分配矩阵及轮子组合计算,0,1,0,0,0,0,0,0
功能描述：接收BG与数传天线伺服控制器状态设置数据,0,0,0,0,0,0,1,0
功能描述：设置7类快帧遥测数据下传顺序,0,0,0,0,0,0,0,1
"功能描述：内总线指令处理
处理：
内总线指令设置、控制等操作。",0,0,0,0,0,1,0,0
"功能描述：
 128ms周期计时（功能编号：FReq-13）。
处理： 设置128ms控制周期中断标志，计数器值为0时产生中断，不需要显示的重新装载。",0,0,1,0,0,0,0,0
"功能：利用双矢量姿态输出修正姿态估值、估计陀螺漂移及红外常值误差。
",0,1,0,0,0,0,0,0
功能描述：动量轮喷气卸载进入和退出条件计算。,0,1,0,0,0,0,0,0
"功能描述：利用A，B头的测量数据修正与估计陀螺漂移。
处理：同用户需求的4.7。
STEP1：计算；FM3更改：若，则：，FSTD=1；
STEP2：计算，。的各项乘以，的各项乘以。
STEP3：计算q；
STEP4：将32位定点数转换成24位浮点数；
STEP5：计算。",0,1,0,0,0,0,0,0
"功能描述：收到动量轮开数据指令或自主开动量轮。
处理：
收到动量轮开数据指令或自主开动量轮时，
按《卫星控制分系统注入参数及数据指令的用户需求》中动量轮引入状态，在相邻的4个周期依次使引入状态的动量轮加电；动量轮故障诊断自主关动量轮时，关闭动量轮一次电源。",0,0,1,0,0,0,0,0
CTU复位后需要从AOCC恢复重要数据和星上时间。首先CTU发送“接收用于做时间差值的时间码”指令，将CTU目前的时间发送给AOCC。AOCC将星上时间和接收到的CTU时间做差值处理，将AOCC时间-CTU时间保存。CTU在1s后发送“发送时间差值”指令，AOCC将保存的时间差值发送给CTU。,0,0,0,0,0,0,0,1
根据地面注入的接收内存读出的地址和长度，将对应地址和长度的内存数据放入发送内存读出数据的存储空间内；,0,0,0,0,0,0,0,1
AOCC在收到此指令并且判断数据正确后，即认为星箭分离有效，通过方式代码的服务请求，申请OBDH停止发送星箭分离信号。当AOCC应用软件接收到CTU发送至AOCC的通知进全捕指令时，AOCC自主转入全捕模式，并通过服务请求告诉CTU  AOCC已收到CTU通知进全捕指令，停止传送该信号，具体要求详见《星串行数据总线通信协议》。,0,0,0,0,0,0,1,0
功能描述：进行单轴相平面分区及控制规律计算。,0,1,0,0,0,0,0,0
功能描述：利用轨道外推的计算结果，计算其他待用参数。,0,1,0,0,0,0,0,0
"功能描述：完成陀螺判断和处理功能（功能编号：FReq-14）。
处理：陀螺故障判断与处理逻辑，进行陀螺饱和故障、陀螺输出常值故障诊断、陀螺跳数故障、控制量与角速度增量不匹配的故障诊断。其中陀螺常值故障诊断由以前的角速度前后周期绝对值之差累计，变更为：角速度前后周期之差累计。并且陀螺平衡方程满足时，增加清相关计数器的可靠性操作。具体处理逻辑详见任务书 中的5.4.5.8.1节。",0,1,0,0,0,0,0,0
功能描述：置卫星姿态无控，处于自由飞行状态。,0,1,0,0,0,0,0,0
"功能描述：使用估计的四元数转换姿态角。
",0,1,0,0,0,0,0,0
"功能描述：计算速度增量关机喷气时间
",0,1,0,0,0,0,0,0
"功能描述：卫星绕x轴转动，使红外搜索地球。
输入：	陀螺数据处理的输出 ，
红外数据有效性标志F_IresValid（由有效性判据给出）
故障标志IRES_Flag，计时器TES
红外数据有效性输出 ，",0,1,0,0,0,0,0,0
"功能描述：轨控姿态机动模式控制
",0,1,0,0,0,0,0,0
"功能描述：利用陀螺确定出卫星对目标的姿态四元数。
",0,1,0,0,0,0,0,0
"功能描述：处理地面遥控注入的程序代码
处理：解包程序代码注入包，得到目的地址、注入内容长度；将注入内容放入目的地址内。
说明：星务分系统向GNCC送数采用256字节(有效使用249字节)帧格式。数据格式见《卫星GNC分系统GN与星务分系统通讯协议》",0,0,0,0,0,0,1,0
"功能描述：接收数据指令注入块的部件使用选择类指令
处理：
序号37使用四个陀螺定姿和序号38使用三个陀螺定姿初值更改，改为默认使用3个陀螺。",0,0,0,0,0,0,1,0
"需求名称|功能及处理描述
+Y帆板数据的采集与处理|每周期无条件的向+Y帆板RT发取数指令，获得+Y帆板数据并处理成对应的角度。CCU应用软件取数消息与同步消息的发送时间间隔不小于2ms。
-Y帆板数据的采集与处理|每周期无条件的向-Y帆板RT发取数指令，获得-Y帆板数据并处理成对应的角度。
+Y帆板控制指令的输出处理|根据协议将+Y帆板的控制数据转换为相应的控制指令消息并输出
-Y帆板控制指令的输出处理|根据协议将-Y帆板的控制数据转换为相应的控制指令消息并输出
帆板的程序注入修改|将从OBDH收到的帆板需修改程序内容，按内总线的格式发送给帆板RT需修改的程序内容
帆板的内存下传|地面注入帆板内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至帆板 RT。",0,0,0,0,0,1,0,0
"功能描述：仅利用星敏感器A的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
"功能描述：根据红外数据计算卫星姿态。
",0,0,0,1,0,0,0,0
"    当由于陀螺故障或者动量轮故障不能构成PID 控制方式时，根据地面遥控
指令可以进入“偏置动量控制模式”。偏置动量轮处于力矩模式，可以根据红外
敏感器测量信息计算得到的滚动角和俯仰角。俯仰轴采用角动量反馈方式控制，
偏航轴采用耦合控制，滚动轴采用磁控或角动量反馈方式控制。处理同用户需求的4.3.4。具体包括的下一层功能点列表如下：
序|功能编号|功能描述|输入、输出及处理
1|FREQ4.14.1|三轴等效角动量偏差|
2|FREQ4.14.2|俯仰通道轮控算法|
3|FREQ4.14.3|磁进动、章动阻尼及俯仰轮卸载控制|
4|FREQ4.14.4|三轴轮控算法|
",0,0,0,0,1,0,0,0
"功能描述：执行偏航机动及返调至运行姿态
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP2：根据当前星时t的取值进行不同的处理：
STEP3：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
"功能描述：通过注入轨道参数，实时计算卫星轨道参数。
处理： 
由地面注入轨道参数或GPS数据计算的轨道参数（如果GPS引入且数据验证有效），结合当前星时，通过外推公式计算出卫星轨道数据。",0,1,0,0,0,0,0,0
"功能描述：采集星上时钟的计数值，计算星时及作相应的处理
处理：包括CPU内部星时时钟和CPU外部星时时钟的星时采集计算与校时。
（1）CPU外部星时时钟的星时采集计算与校时
CPU外部星时时钟星时计算的输入为上一个周期对应的绝对星时t，和上个周期中控制周期星时锁存寄存器中读取的计数值为TOLD。在每个控制周期中处理过程如下：
STEP1：选取控制周期星时锁存通道，读取锁存的计算值，记为TNEW；
STEP2：计算TNEW减去TOLD的差值，记为DELTT（当量为1微秒）；
STEP3：本周期的绝对星时t=t+DELTT/1000000；
STEP4：保存本周期的计数值，即TOLD=TNEW。
CPU外部星时时钟星时校时包括OBDH校时和GPS高精度校时两种校时方式：
OBDH校时：当“OBDH星时校时开关”为允许的情况下，进行校时，要求“OBDH星时校时开关”为可内存修改的变量（默认为“OBDH星时校时开关”为“允许”），地面可通过内存修改的方式设置“OBDH星时校时开关”。也分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时；
 GPS高精度校时。
OBDH星时校时为系统默认使用的校时方式。GPS秒脉冲高精度时间是否引入系统由注入指令执行控制：若注入指令表示“使用GPS秒脉冲高精度校时时间”，则当满足GPS秒脉冲高精度校时条件时AOCC应用软件仅进行GPS秒脉冲高精度校时时间的计算，系统使用该时间。GPS秒脉冲高精度方式优先级高于OBDH星时校时，当GPS秒脉冲校时时不再进行OBDH星时校时。如果连续超过1分钟均不满足GPS秒脉冲高精度校时条件，则可进行OBDH星时校时。一旦再满足GPS秒脉冲高精度校时条件则继续采用GPS秒脉冲高精度校时。其中GPS秒脉冲高精度校时条件及校时计算具体见任务书中规定。
（2）CPU内部星时时钟的星时采集计算与校时
CPU内部星时时钟星时计算方法。同CPU外部星时时钟星时计算；CPU内部星时时钟星时校时只包括OBDH校时：分为两种情况：一种是OBDH周期性向AOCC发送卫星时间，发送周期为1分钟。另一种是当在上电和复位后，由应用软件主动发出校时申请，完成校时。
星时的选取
根据注入的姿控数据块2中的CPU星时时钟选用标志来实现内部星时时钟和外部星时时钟的切换，默认为CPU外部星时时钟
均匀校时
内部和外部时钟星时计算中在计算完本周期绝对星时后增加每周期修正量，并在计算前先将它限幅到1毫秒，每周期的修正量初始为0，通过内存修改来修改该修正量。",0,0,0,0,1,0,0,0
"包括三个功能点：发送姿态数据、陀螺数据、星敏感器数据辅助数据，功能描述和列写如下：
序号|功能描述|功能编号
1|发送姿态数据|FREQ7.14.1
2|发送陀螺数据|FREQ7.14.2
3|发送星敏感器数据|FREQ7.14.3
",0,0,0,0,0,0,0,1
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：，
输出：保持角动量所需电压， 
      角动量偏差积分项：，
",0,1,0,0,0,0,0,0
"功能描述：复位取回重要数据初始化
处理：
- 若取回模式为Mode1、2、3、4、6、12、13、14、15、16，更新模式字；若为模式4、6、12、13，从子模式0开始运行；
- 若取回模式为Mode5，切换至Mode3（动量轮启动模式）；
- 若取回模式为Mode7、8、9、10、11，切换至Mode16（紧急撤离模式），SubMode1。
- 按保存的重要数据更新其它变量；
- 陀螺：根据陀螺引入标志，发陀螺开指令、设置陀螺引入；
- 自锁阀：根据自锁阀状态设置自锁阀开关，再根据自锁阀开关设置喷管选择；
- LTU自主切换标志：更新ALTU、NSMU、微波、可见光、机械手分系统自主切换标志；
- LTU当班标志：更新NSMU、星敏A、星敏B、CCD相机A、CCD相机B、微波、可见光、机械手当班标志；
- LTU加电：对当班LTU（ALTU、NSMU、星敏A、星敏B、CCD相机A、CCD相机B、微波、可见光）补发加电指令；
- 更新磁力矩器线路俯仰通道主、备选择标志；
- 红外数字太阳定姿（非星敏定姿），禁止星务校时；",1,0,0,0,0,0,0,0
功能描述：确定动量轮角动量数据的有效性。,0,1,0,0,0,0,0,0
功能描述：机动姿态保持模式初始化,0,1,0,0,0,0,0,0
功能描述：在CMG控制过程中判断CMG是否饱和而需喷气卸载；在喷气卸载过程中判断CMG是否卸载完毕。,0,1,0,0,0,0,0,0
"软件需求名称：初始化 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。
调用条件：上电/复位。
处理：依据“用户需求”、“任务书”、“上行注入”对非0变量进行初始化。 ",1,0,0,0,0,0,0,0
"功能描述：根据任务要求，应用软件1553B初始化、变量的初始化                                                                                                                                                                                                                                                                                                                                                                                                             处理：
进行1553B初始化，处理过程见的OBDH初始化功能
设置3个星敏的 RTS信号为无效
把模式字初始化为零
上电时，将在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff；复位时，若在轨维护程序区未发生双错，则应用软件从三取二区恢复在轨注入模块地址映射表JumpSlot、继续运行在轨维护程序；若在轨维护程序区发生双错，则应用软件不恢复在轨注入模块地址映射表JumpSlot，同时在轨注入模块地址映射表中的模块ID的三区都置为0，把和注入模块的地址三区都置为0Xffffffff，运行原PROM区的函数模块
为变量赋初值，因为上电或复位时，系统软件都先把变量区清零，应用软件只需将不为零的变量赋值即可。",1,0,0,0,0,0,0,0
"功能描述：为三轴姿态喷气控制选择推力器
输入：JetFlagXP_A、JFN_A、JFP_A 、JFN_A、JFgZP_A 、JFgZN_A（6个姿控分支标志），F_SatStage（卫星构型状态字）、，（星敏感器与陀螺定姿输出的姿态角及角速度）或，、，（其它定姿方式下输出的姿态角及角速度）、，、（协调控制力矩）、(机械臂运动产生的干扰力矩)、，（目标姿态角）
输出：X, Y, Z, FJX, , FJZ（喷气状态），、 
TJAi (i=1~6), TJCi (i=1~10)（A分支6个、C分支10个推力器脉宽）、
Ai (i=1~6), Ci (i=1~10)（A分支6个、C分支10个推力器开关标志）、（累计三轴姿控正/反向喷气时间）",0,1,0,0,0,0,0,0
功能描述：抖动帆板。,0,1,0,0,0,0,0,0
功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。,0,1,0,0,0,0,0,0
"需求名称|功能及处理描述
CMG 1数据的采集与处理|CMG 1的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 1的当班标志为1），每周期向CMG 1RT发取数指令，获得CMG 1数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 2数据的采集与处理|CMG 2的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 2的当班标志为1），每周期向CMG 2RT发取数指令，获得CMG 2数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 3数据的采集与处理|CMG 3的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 3的当班标志为1），每周期向CMG 3RT发取数指令，获得CMG 3数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 4数据的采集与处理|CMG 4的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 4的当班标志为1），每周期向CMG 4RT发取数指令，获得CMG 4数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 5数据的采集与处理|CMG 5的高速角动量、低速框架角度和角速度及状态信息|在通讯允许的条件下（CMG 5的当班标志为1），每周期向CMG 5RT发取数指令，获得CMG 5数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG 控制指令的输出处理|根据控制方式发送相应的控制指令，具体见内总线通讯协议
CMG 6数据的采集与处理|在通讯允许的条件下（CMG 6的当班标志为1），每周期向CMG 6 RT发取数指令，获得CMG 6数据并处理成对应的高速角动量、低速框架角度和角速度。
CMG的程序注入修改|将从OBDH收到的CMG需修改程序内容，按内总线的格式发送给CMG RT需修改的程序内容
CMG的内存下传|地面注入CMG内存下传设置指令，应用软件进行判断后转发“内存下传设置指令”至CMG RT。",0,0,0,0,0,1,0,0
功能描述：把陀螺数据、、输入并变换到星体坐标系中的、、。,0,0,0,0,1,0,0,0
功能描述：接收总线指令。,0,0,0,0,0,0,1,0
"功能描述：选择通讯的太阳LTU，发取数指令，采集LTU发送的数据，并处理成需要的数据格式。
输出：数字太阳敏感器输出；模拟太阳敏感器输出；模拟式太阳敏感器视场码；0-1式太阳敏感器的信号（0或1）；数字太阳敏感器视场码。
处理：
（1）太阳共有两个互为备份的LTU，通过每个LTU均可获得数字太阳、模拟太阳、0-1太阳数据；每个控制周期根据DSSLTUSeltFlag确定进行通讯的太阳LTU，发送取数指令，具体如下表所示：
DSSLTUSeltFlag |进行通讯的太阳LTU|发送的取数指令
01H|太阳LTU1|43H
02H|太阳LTU2|43H
其它|根据LTU故障诊断的结果决定太阳LTU的选取。初始状态为太阳LTU1|43H

（2）向太阳LTU发完取数命令后，获得太阳LTU返回的个字节数据，将数据根据LTU通讯协议转换为控制计算所需的数据格式，具体参见LTU通讯协议件。
（3）太阳LTU数据采集过程中的故障处理见任务书中规定。",0,0,0,0,0,1,0,0
"序|需求名称|编号|输入章节号|功能描述
|姿态控制算法|FREQ4.0|5.4|选择控制方式，并计算控制输出
|喷气控制|FREQ4.1|5.4.1|为三轴姿态喷气控制选择喷管；并记录喷气时间等
|CMG控制说明|FREQ4.2|5.4.2.1|CMG控制说明
|CMG高速启动|FREQ4.4|5.4.2.2|启动CMG高速
|CMG群角动量释放|FREQ4.5|5.4.2.3|释放CMG群积累的角动量
|姿态控制力矩及CMG框架指令计算|FREQ4.6|5.4.2.4|使用红外、星敏、太阳定姿时，计算CMG的框架角速率指令
|偏置动量的CMG指令计算|FREQ4.7|5.4.2.5|计算在整星角动量偏置下，计算CMG控制时的框架角速率指令
|喷气卸载条件计算|FREQ4.8|5.4.4|喷气卸载进入和退出条件计算
|CMG数据处理|FREQ4.9|5.4.3|CMG数据处理
|磁卸载控制|FREQ4.10|5.4.5|根据合成角动量及地磁场强度决定并输出磁棒控制电压
|地面站位置计算|FREQ4.11|5.6.1|地面站赤经赤纬计算
|运行段帆板控制|FREQ4.12|5.5.1|三轴稳定模式下的帆板控制
|太阳帆板自主跟踪控制|FREQ4.13|5.5.2|根据帆板角误差、控制帆板跟踪太阳
|数传天线指向控制|FREQ4.14|5.6.2|根据指令完成数传天线的指向控制
|中继轨道计算|FREQ4.21|5.7.1|中继轨道计算
|中继天线指向控制|FREQ4.22|5.7.2和5.7.3|根据指令完成中继天线的指向控制
|CMG群标称角动量维持算法算法产品规范|FREQ4.15|/|规范化算法：
|直线型相平面喷气姿态控制算法产品规范|FREQ4.16|/|规范化算法：
|SGCMG群框架角速度指令解算算法产品规范|FREQ4.17|/|规范化算法：
|四阶结构滤波器算法产品规范|FREQ4.18|/|规范化算法：
|连续电压式磁卸载算法产品规范|FREQ4.19|/|规范化算法：
|地面目标矢量计算算法产品规范|FREQ4.20|/|规范化算法：
|双脉冲变轨|FREQ4.23|""任务书的
4.2.3""|根据地面注入的指令可实现两次轨控的功能
|3CMG框架角速度指令解算|FREQ4.24|5.4.2.6|当采用3CMG进行姿态控制时，根据控制器计算出的力矩，实现CMG的框架角速度指令解算
|CMG群角动量释放流程|FREQ4.25|5.4.2.7|CMG群角动量释放流程
|CMG标称框架角计算算法|FREQ4.26|5.4.2.8|根据外部标志及时间，计算CMG的标称框架角
",0,1,0,0,0,0,0,0
功能描述：启动动量轮至标称角动量，并保持。,0,1,0,0,0,0,0,0
"1）上电/复位软件初始化
功能描述：上电/复位软件初始化
2）取回重要数据初始化
功能描述：取回重要数据初始化
输入：重要数据的陀螺引入标志、推力器组件、数字太阳标志
输出：陀螺引入标志、推力器组件标志
3）未取回重要数据初始化
功能描述：未取回重要数据初始化
输出：陀螺引入标志、推力器组件标志",1,0,0,0,0,0,0,0
"功能描述：滚动通道喷气中断处理程序。
处理：将推力器1-8关掉",0,0,0,1,0,0,0,0
"功能描述：接收遥控固定参数注入块的执行机构参数设定及诊断参数
处理：
调整CMG高速角动量与标称值偏差阀值系数的初装值。",0,0,0,0,0,0,1,0
"功能描述：利用星敏感器和陀螺输出计算姿态四元数。
",0,1,0,0,0,0,0,0
"功能描述：卫星的10个工作模式切换方式。
处理：
对每个模式分别按照切换条件处理。见用户需求3.3节。
工作模式切换表
""换后
模式
切换
前模式""|Mode1|Mode2|Mode3|Mode4|Mode5|Mode6|Mode7|Mode8|Mode9
Mode0|1,2||||||||1,2
Mode1||1,2||||||2|1,2
Mode2|||2|2||||1,2|1,2
Mode3||2||1,2|||||1,2
Mode4||1,2|||1,2||||1,2
Mode5||1,2||1,2||1,2|||1,2
Mode6||1,2||2|1,2||1,2||1,2
Mode7||2|||1,2|1|||1,2
Mode8||1,2|||||||1,2
Mode9||1,2|||||||

说明：代号“1”表示自主进入；代号“2”表示地面/总线指令进入",0,1,0,0,0,0,0,0
"软件需求名称：帆板驱动装置的处理 
需求类别：其他 
软件需求描述：对帆板驱动装置的加断电等进行特殊处理。",0,0,1,0,0,0,0,0
"软件需求标识：FREQ18 
软件需求名称：模拟太敏数据处理 
需求类别：其他 
软件需求描述：模拟太敏数据处理。",0,0,0,0,0,1,0,0
功能描述：利用陀螺确定出卫星对目标的姿态四元数。,0,1,0,0,0,0,0,0
"功能描述：从SDC获取部件供电状态信息
处理：读入各部件加电状态信息并遥测打包。",0,0,0,0,0,1,0,0
"软件需求标识：FREQ25 
软件需求名称：地检数据采集处理 
需求类别：其他 
软件需求描述：地检数据采集处理。",0,0,0,0,0,1,0,0
"功能描述：与CAN通信获得上行/下行数据。
调用条件：AOCC在CAN总线中断中接收/发送数据；
输入：上行数据。
输出：下行数据。
处理：通过CAN总线与星务分系统通信，交换数据，以实现星地联系和对卫星的人工干预。",0,0,0,0,0,0,0,1
"功能描述：发送矢量字
处理：将包括服务请求编码的矢量字放到发送矢量字指定存储的地址空间即可。应用软件中对应各个请求编码的条件如表 43所示：
表 43：对应矢量字各个请求编码的条件
服务编码|发送的条件
0000|无服务请求
bit0=1|申请传送AOCC重要数据
bit0=0|无AOCC重要数据服务请求
bit1=1|申请传送OBDH时间
bit1=0|无OBDH时间服务请求
bit2=1|AOCS应急控制标志有效
bit2=0|AOCS应急控制标志无效
bit3=1|AOCC硬件状态数据状态准备好
bit3=0|AOCC硬件状态数据状态未准备好
bit4=1|AOCC内存数据状态为准备好
bit4=0|AOCC内存数据状态为未准备好
bit8=1|AOCC黑匣子数据状态为准备好
bit8=0|AOCC黑匣子数据状态为未准备好
",0,0,0,0,0,0,0,1
"软件需求名称：部件加断电 
需求类别：其他 
软件需求描述：对部件加断电指令的处理。",0,0,0,1,0,0,0,0
"功能描述：接收AOCC重要数据1-4，并处理重要数据1中的内容。
处理：应急线路加电后与OBDH通信，获得陀螺和推力器状态，若连续3个控制周期都没有成功取得重要数据，默认陀螺使用7、8、9号，推力器使用主备份推力器，模拟式太阳敏感器使用ASS1和ASS21。由于AOCC可使用的陀螺为12个（陀螺1~12），可使用的陀螺为9个（陀螺1~9），因此，无法使用陀螺10~12的数据。当恢复AOCC重要数据后，若ZT9表明使用了陀螺10~12，则设置ZT9中陀螺10~12为不可用，陀螺7、8、9为可用，陀螺工作状态BZ9按照设置后的ZT9中由小到大的顺序（从陀螺1到陀螺9）选用3个陀螺。",0,0,0,0,0,0,1,0
功能描述：自旋模式控制,0,1,0,0,0,0,0,0
功能描述：利用GPS通道板数据进行GPS定轨程序。,0,0,0,0,1,0,0,0
"序|需求名称|编号|输入|输出|功能及处理描述
|星敏感器1数据的采集与处理|FREQ1.5.1|""星敏感器
1553B取数指令
""|星敏感器1的四元素、角速度和状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器1数据并处理成对应的四元素和角速度。
|星敏感器2数据的采集与处理|FREQ1.5.2|""星敏感器
1553B取数指令""|星敏感器2的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器2数据并处理成对应的四元素和角速度。
|星敏感器3数据的采集与处理|FREQ1.5.3|""星敏感器
1553B取数指令""|星敏感器3的四元素、角速度状态信息|在通讯允许的条件下（星敏感器的当班标志为1），每周期向星敏感器RT发取数指令，获得星敏感器3数据并处理成对应的四元素和角速度。
|星敏感器4数据的采集与处理|FREQ1.5.4|""星敏感器4
1553B取数指令""|星敏感器4的四元素、角速度状态信息|在通讯允许的条件下（星敏感器4的当班标志为1），每周期向星敏感器 RT发取数指令，获得星敏感器4数据并处理成对应的四元素和角速度。
",0,0,0,0,0,1,0,0
功能：在不使用陀螺数据时，对姿态角、角速度与姿态四元数预估。,0,1,0,0,0,0,0,0
功能描述：发送控制对中继天线的控制角度。,0,0,1,0,0,0,0,0
"各个模式切换的功能点列表如下：
序号|功能编号|功能
|FREQ51|主动段模式切换
|FREQ51.1|入轨段控制模式切换
|FREQ51.2|巡天观测模式切换
|FREQ51.3|定点观测模式切换
|FREQ51.4|小天区扫描模式切换
|FREQ51.5|姿态机动切换
|FREQ51.6|轨控模式切换
|FREQ51.7|捕获太阳并对日定姿模式切换
|FREQ51.8|帆板未展开切换
|FREQ51.9|无控模式切换
|FREQ51.10|应急模式模式切换
|FREQ51.0|主动段模式初始化
|FREQ51.1.0|入轨段控制模式初始化
|FREQ51.2.0|巡天观测模式初始化
|FREQ51.3.0|定点观测模式初始化
|FREQ51.4.0|小天区扫描模式初始化
|FREQ51.5.0|姿态机动初始化
|FREQ51.6.0|轨控模式初始化
|FREQ51.7.0|捕获太阳并对日定姿模式初始化
|FREQ51.8.0|帆板未展开初始化
|FREQ51.9.0|无控模式初始化
|FREQ51.10.0|应急模式模式初始化

工作模式的转换条件及对应的模式初始化内容具体见用户需求4。
AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,1,0,0,0,0,0,0
光行差修正的初始设置为：AOCC应用软件对APS星敏信息进行补偿计算，不向星敏发送相对J2000的时间和速度。,0,0,0,0,0,1,0,0
"功能描述：根据姿态角和姿态角速度偏差数据进行系统故障的检测。
处理：
若SystemAttDeterPatternFlag由0变1，则重新计算q，qng赋值。
轨控模式姿态角控制量超差阀值从0.077 mSYSS2改为0.0873 mSYSS2。
5.7.3（1）增加姿态超差判断。",0,1,0,0,0,0,0,0
"功能描述：根据陀螺输出，预估卫星姿态和姿态角速度。                                                                                                                                                                                                                                                                                                                                                                                                                              输入：上周期姿态角估值
陀螺数据处理的输出 
陀螺系统在星体三轴方向等效的漂移估值 (量纲：弧度/小时)（消初偏时取装订值）。
卫星外推轨道计算输出：",0,1,0,0,0,0,0,0
"功能描述：已知扫描区域中心坐标和扫描范围后，计算扫描起点的目标姿态。
",0,1,0,0,0,0,0,0
"功能描述：利用星敏感器数据进行卫星姿态捕获。
",0,1,0,0,0,0,0,0
"功能描述：进行单轴相平面分区及控制规律计算。由决定是否要喷气；喷气的脉冲宽度；确定本时刻的。
",0,1,0,0,0,0,0,0
"功能描述：实现CMGs的PD/PID控制。
输入：姿态角误差，角速度误差，；，系统合成角动量（Nms）；Jacobi矩阵sgJ，矩阵sgF；CMG使用标志Lcmg[i]；奇异回避向量，奇异测度JD，机动补偿力矩，(陀螺切除用)",0,1,0,0,0,0,0,0
"功能描述：规划串口数据接收发送。
处理：
功能编号|功能|引用文档
FREQ101|初始化|任务书
FREQ102|规划串口使用要求|任务书
FREQ103|通信|任务书
FREQ104|通信故障处理|任务书
FREQ105|数据解包与转换|任务书
FREQ106|规划串口数据有效性处理|任务书
FREQ107|规划串口硬件采集、处理|预留
FREQ108|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"序号|功能描述|功能编号
|姿态数据包|FREQ60.1
|星敏感器数据包1|FREQ60.2
|星敏感器数据包2|FREQ60.3
|红外太阳修正数据包|FREQ60.4
|星敏感器修正数据包|FREQ60.5
|姿态控制数据包1|FREQ60.6
|姿态控制数据包2|FREQ60.7
|轨道数据包1|FREQ60.8
|轨道数据包2|FREQ60.9
|AOCC状态数据包|FREQ60.10
|LTU自检数据包|FREQ60.11
|星敏感器自检数据包|FREQ60.12
|变轨数据包|FREQ60.13
|正常模式和发射模式延时遥测数据|FREQ60.14
|应急模式延时遥测数据|FREQ60.15
|全姿态捕获模式延时遥测数据|FREQ60.16
|变轨模式延时遥测数据|FREQ60.17

具体格式和定义见遥测文件。",0,0,0,0,0,0,0,1
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的重要的功能。
模式字|工作模式描述|功能编号
0 |主动段|FREQ52
1|入轨段控制|FREQ53
2|巡天观测模式|FREQ54
3|定点观测模式|FREQ55
4|小天区扫描模式|FREQ56
5|姿态机动|FREQ57
6|轨控|FREQ58
7|捕获太阳并对日定姿模式|FREQ59
8|帆板未展开|FREQ60
9|无控|FREQ61
10|应急模式|FREQ62

主动段和应急工作模式下并不进行姿态确定和控制的计算，其它各个模式控制中调用卫星轨道和星历计算、姿态确定、姿态和轨道控制见用户需求的4。主要模式的姿态确定调用流程的功能点如下：
序号|功能编号|功能描述|用户需求中对应章节
|FREQ53.1|对日定向姿态确定调用流程|5.2.1.1
|FREQ54.1|巡天模式姿态确定调用流程|5.2.1.2
|FREQ55.1|定点观测模式姿态确定调用流程|5.2.1.3
|FREQ56.1|小天区扫描模式姿态确定调用流程|5.2.1.4
|FREQ57.1|姿态机动模式姿态确定调用流程|5.2.1.5
|FREQ58.1|轨控模式姿态确定调用流程|5.2.1.6
",0,1,0,0,0,0,0,0
"功能描述：决定采用磁卸载还是喷气卸载方式，调用相应程序。
",0,1,0,0,0,0,0,0
"功能：利用星敏感器A、B的测量，修正姿态四元数与估计陀螺漂移。
输入：星敏感器A、B修正新息，四元数、陀螺常漂
输出：修正四元数、陀螺常漂
",0,1,0,0,0,0,0,0
功能描述：确定陀螺数据的有效性。,0,1,0,0,0,0,0,0
功能描述：计算在整星角动量偏置下，CMG控制时的框架角速率指令。,0,1,0,0,0,0,0,0
功能描述：由平衡方程方法进行陀螺的故障检测。,0,1,0,0,0,0,0,0
"功能描述：接收AOCC系统注入参数
处理：
当收到接收遥控注入结束标识消息后，将接收AOCC系统注入参数存储地址中内容解包成对应的参数和变量的数据格式。只有当某个块类型的所有数据都收到，且每块数据的校验和都正确时，才能使用此种类型的注入数据。注入的数据具体见上行注入文件。需要注意的是：地面注入ZT9时：若ZT9中为1的个数小于3个，则不改变星上ZT9的取值，如果等于3个，则BZ9=ZT9；应用软件不响应ZT1=2、ZT1=6、ZT1=8的注入指令。",0,0,0,0,0,0,1,0
功能描述：使用红外、星敏、太阳定姿时，计算正常飞行轮控所需电压。,0,1,0,0,0,0,0,0
"功能描述：仅利用星敏感器A、C的测量，修正姿态四元数与姿态角速度移。
",0,1,0,0,0,0,0,0
功能描述：星敏感器数据处理,0,0,0,0,0,1,0,0
"功能描述：确定ASS21，ASS22，ASS31，ASS32及帆板角度传感器，等的信号的选取。
处理：同用户需求的5.1。
——5.1（2）；;",0,0,0,1,0,0,0,0
功能描述：确定红外数据的有效性,0,1,0,0,0,0,0,0
功能描述：中继卫星轨道确定。,0,1,0,0,0,0,0,0
"功能描述：进行单轴相平面分区及控制规律计算。由、、决定是否要喷气；喷气的脉冲宽度；确定本时刻的。
",0,1,0,0,0,0,0,0
"功能描述：完成整星绕滚动轴的姿态侧摆角保持功能
处理过程：过程如下：
STEP1：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
条件|FRTS的取值
ZT35(2) = 1且|1
其余情况|0

STEP2：当ZT F（不用红外+单个斜装陀螺定姿），进行姿态预估，得到姿态角和角速度。
STEP3：进行运行段姿态确定，具体过程如下：
进行红外数据采集及处理和q及s姿态予估器
当星敏感器修正时间大于等于4500秒时，将星敏感器测量回路求得的姿态角和角速度，赋值为姿态角和角速度，
得到输入控制律的姿态角和角速度，
STEP4：进行运行段控制，具体过程如下：
根据ZT2的值进行飞轮控制
当ZT8  3且ZT9  3且ZT时，进行运行段喷气姿态控制
进行陀螺故障检测及选择
当ZT40(4) = 1时，进行数传天线捕获跟踪控制
STEP5：根据ZT7的取值，进行相应的帆板控制。
ZT7的值|处理
 8|进行运行段帆板控制
ZT7 = 0|发两翼帆板归零指令
ZT7 = 3|发左翼为90度，右翼为 -90度指令
ZT7 = 5|发左右皆为90度指令
ZT7 = 7|发左右皆为180度指令
ZT7 = 9|发指令
ZT7 = A|发指令
ZT7 = B|发指令
",0,1,0,0,0,0,0,0
功能描述：计算地磁场强度。,0,1,0,0,0,0,0,0
"功能描述：卫星丢失姿态后，使用红外地球敏感器直接捕获地球，建立正常对地姿态。
",0,1,0,0,0,0,0,0
"功能描述：计算将动量轮保持至标称角动量所需的电压。
输入：动量轮启动的程控指令
      实测飞轮角动量，
      标称角动量：，
      角动量偏差积分项：， ，
",0,1,0,0,0,0,0,0
"功能描述：决定利用星敏感器A、B、C单独或组合定姿的方式，调用相应姿态修正程序。
",0,1,0,0,0,0,0,0
功能描述：AOCC收到CTU发来的“记录AOCC时间数据”消息后应在900ms内准备好AOCC 时间数据。CTU发出“记录AOCC时间数据”1s后读取该数据。,0,0,0,0,0,0,0,1
"根据不同的任务要求划分了各个模式，模式控制作为一个功能的集合体反映了任务的执行情况，是确认测试和系统实验验证的功能。
序|需求名称|编号|输入章节号|功能描述
|主动段模式控制|FREQ5.2.0|4|主动段模式控制调用流程
|初始速率阻尼模式控制|FREQ5.2.1|4.1|初始速率阻尼模式控制调用流程
|正常对日巡航模式控制|FREQ5.2.2|4.2|正常对日巡航模式控制调用流程
|点对点机动模式控制|FREQ5.2.3|4.3|点对点机动模式控制调用流程
|姿态/角速度预置模式控制|FREQ5.2.4|4.4|姿态/角速度预置模式控制调用流程
|对地定向模式控制|FREQ5.2.5|4.5|对地定向模式控制调用流程
|匀地速跟踪模式控制|FREQ5.2.6|4.6|匀地速跟踪模式控制调用流程
|轨控模式控制|FREQ5.2.9|4.9|轨控模式控制调用流程
|太阳捕获模式控制|FREQ5.2.10|4.10|太阳捕获模式控制调用流程
|无控模式控制|FREQ5.2.11|4.11|无控模式控制调用流程
|凝视姿态跟踪模式控制|FREQ5.2.12|4.12|凝视姿态跟踪模式控制调用流程

模式初始化的功能点如下：
序|需求名称|编号|输入章节号|功能描述
|主动段模式初始化|FREQ5.3.0|4|主动段模式初始化设置
|初始速率阻尼模式初始化|FREQ5.3.1|4.1|初始速率阻尼模式初始化设置
|正常对日巡航模式初始化|FREQ5.3.2|4.2|正常对日巡航模式初始化设置
|点对点机动模式初始化|FREQ5.3.3|4.3|点对点机动模式初始化设置
|姿态/角速度预置模式初始化|FREQ5.3.4|4.4|姿态/角速度预置模式初始化设置
|对地定向模式初始化|FREQ5.3.5|4.5|对地定向模式初始化设置
|匀地速跟踪模式初始化|FREQ5.3.6|4.6|匀地速跟踪模式初始化设置
|轨控模式初始化|FREQ5.3.9|4.9|轨控模式初始化设置
|太阳捕获模式初始化|FREQ5.3.10|4.10|太阳捕获模式初始化设置
|无控模式初始化|FREQ5.3.11|4.11|无控模式初始化设置
|凝视姿态跟踪模式初始化|FREQ5.3.12|4.12|凝视姿态跟踪模式初始化设置
",0,1,0,0,0,0,0,0
"功能描述：与推进线路盒通信，输出本周期喷气脉宽。
处理：
功能编号|功能|引用文档
FREQ90|初始化|任务书
FREQ91|推力器使用要求|任务书
FREQ92|通信|任务书
FREQ93|通信故障处理|预留
FREQ94|数据解包与转换|预留
FREQ95|推力器数据有效性处理|预留
FREQ96|推力器模拟量采集、处理|任务书
FREQ97|部件在轨转发（在轨修改）|预留
",0,0,1,0,0,0,0,0
"功能描述：根据从SLTU接收的0.25秒或1秒内陀螺的角度增量，算出卫星在惯性空间的角速度。
输入：0.25秒或1秒内陀螺的角度增量 (量纲：弧度)
(i=1,2,3,…6，依次表示陀螺G1，G2，…，G6的输出)；
采样周期 (量纲：秒)；
陀螺数据有效性标志F_GyroValid(由陀螺有效性判据给出)。
陀螺系统在星体三轴方向等效的常值漂移估值 (量纲：弧度/小时)
星敏感器数据有效性标志：F_SAValid，F_SBValid，F_SCValid
",0,1,0,0,0,0,0,0
功能描述：红外数据处理。,0,0,0,0,0,1,0,0
"功能描述：采集22路数字太阳粗码、监视码和全开码。
处理：
采集方法：连续采集28路（中间有细码信息，处理时略过），采集1路的操作步骤（以DSS1的粗码1为例）：
向选通地址输出偏移地址：0x1200 0000 = 00H；
等待至少100µs,启动A/D转换：0x1200 0020 = 0；
等待至少40µs后；
连续3次读取A/D数据总线上的数据：data1 = 0x1200 0020 (data2，data3类似)；
取data1、data2、data3三个数据的中间值，作为本路模拟量的最终采集结果。",0,0,0,0,0,1,0,0
"功能描述：速率阻尼。
",0,1,0,0,0,0,0,0
"功能描述：轨控模式初始化
",0,1,0,0,0,0,0,0
"包括下表的功能点。
序号|功能描述|功能编号
|向ICU发送控制计算机重要数据|FREQ7.6.1
|向OBDH发送控制计算机重要数据|FREQ7.6.2

发送控制计算机重要数据的具体要求见重要数据文件。",0,0,0,0,0,0,0,1
"功能描述：接收同步控制。
处理：根据应急线路同步字的编码内容进行相应的处理：
编码|相应的处理
28H|发送内存的数据区指针复位
",0,0,0,0,0,0,1,0
"    各个模式切换的功能点列表如下：
模式字|功能|功能编号
0|主动段模式切换|FREQ5.1
1|入轨段消初偏模式切换|FREQ5.2
2|正飞模式切换|FREQ5.3
3|大角度机动模式切换|FREQ5.4
4|正常运行模式切换|FREQ5.5
5|轨控模式切换|FREQ5.6
6|SAR未展开模式切换|FREQ5.7
7|帆板未展开模式切换|FREQ5.8
8|偏置动量控制模式切换|FREQ5.9
9|全姿态捕获模式切换|FREQ5.10
A|应急安全模式切换|FREQ5.11
B|停控模式切换|FREQ5.12

工作模式的转换如下表所示： 
模式字|到1|到2|到3|到4|到5|到6|到7|到8|到9|到10|到11
从0|ZC0-1||||||||ZC0-9||
从1||ZC1-2|||||||ZC1-9|ZC1-10|
从2|||ZC2-3|ZC2-4||ZC2-6|ZC2-7|ZC2-8|ZC2-9|ZC2-10|ZC2-11
从3||||ZC3-4|||||ZC3-9|ZC3-10|ZC3-11
从4||ZC4-2|ZC4-3||ZC4-5|ZC4-6|ZC4-7|ZC4-8|ZC4-9|ZC4-10|ZC4-11
从5||||ZC5-4|||||ZC5-9|ZC5-10|ZC5-11
从6||ZC6-2||ZC6-4|||||ZC6-9|ZC6-10|ZC6-11
从7||ZC7-2|||||||ZC7-9|ZC7-10|ZC7-11
从8||ZC8-2||ZC8-4|||||ZC8-9|ZC8-10|ZC8-11
从9||ZC9-2||ZC9-4||||||ZC9-10|ZC9-11
从10|||||||||ZC10-9||
从|||||||||ZC11-9|ZC11-10|

条件标识原则：ZCX—Y，其中ZC表示转换条件，X为转出的模式字，Y为转入的模式字。具体见用户需求3.3。AOCC切机或复位后通过OBDH恢复重要数据来恢复模式，具体见重要数据文件要求。",0,1,0,0,0,0,0,0
"功能描述：滚动机动目标姿态确定。
",0,0,0,1,0,0,0,0
功能描述：帆板故障检测，切换帆板LTU。,0,1,0,0,0,0,0,0
"功能描述：模式3切换方式。
处理：
满足进入应急模式的条件则进入应急安全模式，置WorkMode=9；
注：若地面指令转入对日定向运行模式或者太阳捕获模式，置CMGStartFlag=1。",0,1,0,0,0,0,0,0
"功能描述：将陀螺有效输出数据，换算成卫星三轴角度增量。
",0,1,0,0,0,0,0,0
功能描述：根据飞轮角动量及地磁场强度决定并输出磁棒控制电压、、。,0,1,0,0,0,0,0,0
